/* jce - 2.6.19 | 2017-08-10 | http://www.joomlacontenteditor.net | Copyright (C) 2006 - 2017 Ryan Demmer. All rights reserved | GNU/GPL Version 2 or later - http://www.gnu.org/licenses/gpl-2.0.html */
!function($,Wf){function onBeforeBuildList(){var mode=Wf.Cookie.get("wf_"+Wf.getName()+"_mode","list");"grid"===mode&&$("li.file","#item-list").hide()}function onAfterBuildList(){var mode=Wf.Cookie.get("wf_"+Wf.getName()+"_mode","list");"grid"===mode&&togglePreviewThumbnails()}function loadPreviewThumbnail(item){var src=($(item).attr("id"),$(item).data("preview"));$(item).data("thumbnail")&&(src=Wf.String.path(Wf.getURI(),$(item).data("thumbnail")));var img=new Image;if($(item).addClass("thumbnail-loading"),$(img).load(function(){var span=$(".uk-thumbnail",item).get(0);span||(span=$("<span/>").addClass("uk-thumbnail uk-position-cover").appendTo(item),$.support.backgroundSize?$(span).css("background-image",'url("'+img.src+'")'):$(span).append('<img src="'+img.src+'" />')),$(item).removeClass("thumbnail-loading").addClass("thumbnail-loaded")}),$(img).bind("error.local",function(){$(item).removeClass("thumbnail-loading").addClass("thumbnail-error")}),options.can_edit_images&&options.cache_enable&&!$(item).data("thumbnail")){var args={action:"thumbnail",img:$(item).attr("id")},fields=$(":input","form").serializeArray();$.each(fields,function(i,field){args[field.name]=field.value}),src="index.php?option=com_jce&view=editor&plugin="+$("body").data("plugin")+"&"+$.param(args),$(img).unbind("error.local").bind("error.server",function(){$(this).unbind("error.server").bind("error.local",function(){$(item).removeClass("thumbnail-loading").addClass("thumbnail-error")}),src=$(item).data("preview"),$(item).data("thumbnail")&&(src=Wf.String.path(Wf.getURI(),$(item).data("thumbnail"))),img.src=src})}img.src=src}function createPreviewThumbnails(force){var area=$("#browser-list").height()+$("#browser-list").scrollTop(),selector=[".thumbnail-loading"];force||selector.concat(".thumbnail-loading",".thumbnail-loaded",".thumbnail-error");var filter=[".jpg",".jpeg",".bmp",".tiff",".png"];$("#item-list .file").filter(filter.join(",")).not(selector.join(",")).each(function(){var pos=$(this).position();pos.top<area&&loadPreviewThumbnail(this)})}function togglePreviewThumbnails(force){var mode=Wf.Cookie.get("wf_"+Wf.getName()+"_mode","list");"grid"===mode?(createPreviewThumbnails(force),$("#browser-list").bind("scroll.browser-list",function(e){createPreviewThumbnails()}),$("#item-list").data("sortable")&&$("#item-list").sortable("option","axis",!1)):($("#browser-list").unbind("scroll.browser-list"),$("#item-list").unbind("click.item-list-images"),$("#item-list").data("sortable")&&$("#item-list").sortable("option","axis","y"))}function switchMode(){var mode=Wf.Cookie.get("wf_"+Wf.getName()+"_mode","list");mode="grid"===mode?"list":"grid",Wf.Cookie.set("wf_"+Wf.getName()+"_mode",mode),$("#browser").toggleClass("view-mode-grid","grid"===mode),togglePreviewThumbnails(!0)}function editImage(){var item=$.fn.filebrowser.getselected(),ed=tinyMCEPopup.editor,iw=parseFloat($(item).data("width")),ih=parseFloat($(item).data("height")),src=($(window).width()-20,$(window).height()-20,$(item).attr("id")),url=$(item).data("preview"),query=url.indexOf("?");query!==-1&&(url=url.substring(0,query));ed.windowManager.open({url:ed.getParam("site_url")+"index.php?option=com_jce&view=editor&plugin="+Wf.getName()+"&layout=editor",size:"mce-modal-landscape-full",close_previous:!1,inline:!0,title:tinyMCEPopup.getLang("dlg.edit_image","Edit Image")},{src:src,url:url,width:iw,height:ih,save:function(item){$("#src").trigger("filebrowser:load",{name:item})},scope:this})}function getUploadOptions(){var rw=options.upload_resize_width||"",rh=options.upload_resize_height||"",$resize=$('<div class="uk-form-row uk-repeatable uk-grid uk-grid-small uk-width-1-1"><div class="uk-width-2-10">   <input name="upload_resize_state" type="checkbox" value="0" />   <label for="upload_resize_state" title="'+tinyMCEPopup.getLang("dlg.upload_resize_tip","Resize Image")+'" class="hastip">'+tinyMCEPopup.getLang("dlg.resize","Resize Image")+'</label></div><div class="uk-width-5-10 uk-form-constrain">   <div class="uk-form-controls">       <input type="text" name="upload_resize_width[]" value="" />       <strong class="uk-margin-left uk-margin-right uk-vertical-align-middle">&times;</strong>       <input type="text" name="upload_resize_height[]" value="" />   </div>   <label class="uk-form-label"><input class="uk-constrain-checkbox" type="checkbox" checked />'+tinyMCEPopup.getLang("dlg.proportional","Proportional")+'</label></div><div class="uk-width-2-10">   <label class="uk-form-label uk-width-3-10">'+tinyMCEPopup.getLang("dlg.upload_resize_suffix","Suffix")+'</label>   <div class="uk-form-controls uk-width-7-10">     <input type="text" name="upload_resize_suffix[]" value="" />   </div></div> <div class="uk-width-1-10 uk-text-right">   <button class="uk-button uk-button-link uk-repeatable-create uk-float-right"><i class="uk-icon-plus"></i></button>   <button class="uk-button uk-button-link uk-repeatable-delete uk-float-right"><i class="uk-icon-trash"></i></button> </div></div>'),$watermark=$('<div class="uk-form-row" id="upload_watermark_options"><input id="upload_watermark" name="upload_watermark_state" type="checkbox" value="0" /><label for="upload_watermark" title="'+tinyMCEPopup.getLang("dlg.upload_watermark_tip","Watermark Image")+'" class="hastip">'+tinyMCEPopup.getLang("dlg.upload_watermark","Watermark Image")+"</label></div>");if(options.upload_resize&&options.can_edit_images){rw=rw.split(","),rh=rh.split(","),num=Math.max(rw.length,rh.length);for(var i=0;i<num;i++){var $opt=$resize.clone(),w=rw[i]||"",h=rh[i]||"";$("#upload-options").append($opt),$opt.find('input[name^="upload_resize_width"]').val(w),$opt.find('input[name^="upload_resize_height"]').val(h),$opt.find(".uk-constrain-checkbox").constrain(),i>0&&$('input[name="upload_resize_state"]',$opt).remove(),$opt.repeatable().on("repeatable:create",function(e,o,n){$('input[name="upload_resize_state"]',n).remove(),$(n).find(".uk-constrain-checkbox").trigger("constrain:update")})}var state=parseInt(options.upload_resize_state);$("#upload-options").find('input[name="upload_resize_state"]').prop("checked",!!state).click(function(){var el=this;this.value=this.checked?1:0,$(".uk-repeatable","#upload-options").each(function(){$(this).find(":input").not(el).prop("disabled",!el.checked)})}).val(state),$("#upload-options").find(":input").not('input[name="upload_resize_state"]').prop("disabled",!state)}if(options.upload_watermark&&options.can_edit_images){var state=parseInt(options.upload_watermark_state);$("#upload-options").append($watermark).find('input[name="upload_watermark_state"]').prop("checked",!!state).click(function(){this.value=this.checked?1:0}).val(state)}(options.upload_resize||options.upload_watermark)&&options.can_edit_images&&($("#upload-options").prepend('<h4 class="uk-text-bold">'+tinyMCEPopup.getLang("dlg.image_options","Image Options")+"</h4>"),$("#upload-options").show(),$(".hastip","#upload-options").tips()),$("#upload-queue").on("uploadwidget:fileadded",function(e,file){if(/^(jpg|jpeg|png|bmp|tiff|gif)$/i.test(file.extension)&&options.upload_resize&&options.can_edit_images){$('<div class="uk-grid uk-grid-collapse uk-width-1-1 queue-item-resize uk-placeholder uk-placeholder-small uk-repeatable uk-hidden"> <div class="uk-width-1-6">   <label for="upload_resize" title="'+tinyMCEPopup.getLang("dlg.upload_resize_tip","Resize")+'">'+tinyMCEPopup.getLang("dlg.resize","Resize")+'</label> </div><div class="uk-width-4-10 uk-flex-item-auto uk-form-constrain">   <div class="uk-form-controls">       <input type="text" name="upload_file_resize_width[]" value="" />       <strong class="uk-margin-left uk-margin-right uk-vertical-align-middle">&times;</strong>       <input type="text" name="upload_file_resize_height[]" value="" />   </div>   <label class="uk-form-label"><input class="uk-constrain-checkbox" type="checkbox" checked />'+tinyMCEPopup.getLang("dlg.proportional","Proportional")+'</label></div><div class="uk-width-3-10 uk-grid uk-grid-small uk-repeatable-hidden-first">   <label class="uk-form-label uk-width-3-10">'+tinyMCEPopup.getLang("dlg.upload_resize_suffix","Suffix")+'</label>   <div class="uk-form-controls uk-width-7-10">     <input type="text" name="upload_file_resize_suffix[]" value="" />   </div></div> <div class="uk-width-1-10 uk-float-right">   <button class="uk-button uk-button-link uk-repeatable-create uk-float-right"><i class="uk-icon-plus"></i></button>   <button class="uk-button uk-button-link uk-repeatable-delete uk-float-right"><i class="uk-icon-trash"></i></button> </div></div>').appendTo(file.element).repeatable().on("repeatable:create",function(e,o,n){$(n).find(".uk-constrain-checkbox").trigger("constrain:update")}).find(".uk-constrain-checkbox").constrain();var btn=$('<button class="uk-button uk-button-link queue-item-action" title="'+tinyMCEPopup.getLang("dlg.resize_item_options","Options")+'"><i class="uk-icon uk-icon-gear"></i></button>').click(function(e){e.preventDefault(),e.stopPropagation(),$(".queue-item-resize",file.element).toggleClass("uk-hidden")});$(".queue-item-actions",file.element).append(btn)}})}function onInit(e,o){var mode=Wf.Cookie.get("wf_"+Wf.getName()+"_mode","list");$('<div class="uk-button view-mode" role="button"><i class="uk-icon-th-list"></i><i class="uk-icon-th"></i></div>').insertBefore("#show-details").click(function(){switchMode()}),$("#show-details").click(function(e){"grid"===mode&&createPreviewThumbnails()})}function onUpload(){}var options={};$(window).ready(function(){$("input.filebrowser").on("filebrowser:oninit",onInit).on("filebrowser:onbeforebuildList",onBeforeBuildList).on("filebrowser:onafterbuildlist",onAfterBuildList).on("filebrowser:onpaste",onAfterBuildList).on("filebrowser:editimage",editImage).on("filebrowser:onuploadopen",getUploadOptions).on("filebrowser:onupload",onUpload).on("filebrowser:onlistsort",createPreviewThumbnails).on("filebrowser:onmaximise",createPreviewThumbnails),options=FileBrowser.options})}(jQuery,Wf);