"use strict";angular.module("starter.directives",[]).directive("LoadingContainer",function(){return{restrict:"A",scope:!1,link:function(e,t,a){var n=angular.element('<span class="loaderspinner72">loading...</span>');t.append(n),t.addClass("loading-container"),e.$watch(a.loadingContainer,function(e){n.toggleClass("ng-hide",!e)})}}}),angular.module("starter.jquery-extras",[]).run(function(){angular.element(document).ready(function(){var e=document.getElementById("adminForm"),n=jQuery(e);n.find(".post-attrs-group a").click(function(e){var t,a=jQuery(e.target);a.hasClass("xticon")&&(a=a.parent("a")),t=a.attr("data-value"),n.find(".xt-subform").hide(),n.find(".xt-subform-"+t).show()}),n.find(".xt-subform").css("display","none")})}),angular.module("starter.requests-service",["extlycore","ngResource"]).factory("Requests",["SefHelper","$resource",function(e,t){var a=e.route("index.php?option=com_autotweet&view=requests&format=json"),n=jQuery("#XTtoken").attr("name"),r=function(e){var t=e.split(/@EXTLYSTART@|@EXTLYEND@/);return 3===t.length?JSON.parse(t[1]):{status:!1,message:e}};return t(a,{},{query:{method:"POST",params:{task:"@taskCommand",_token:n},isArray:!0,transformResponse:function(e,t){return r(e)}},save:{method:"POST",params:{task:"@taskCommand",_token:n,ref_id:"@ref_id"},transformResponse:function(e,t){return r(e)}},get:{method:"POST",params:{task:"@taskCommand",_token:n,id:"@request_id"},transformResponse:function(e,t){return r(e)}}})}]),angular.module("starter.agenda-service",[]).factory("Agenda",function(){var t="agendas-autotweet",e=this;return e.get=function(){return JSON.parse(localStorage.getItem(t)||"[]")},e.put=function(e){localStorage.setItem(t,JSON.stringify(e))},e.clear=function(){this.put([])},{get:e.get,put:e.put,clear:e.clear}}),angular.module("starter.request-helper",[]).factory("RequestHelper",[function(){var e=this;return e.formatDatesTimes=function(e){var t=[];return _.each(e,function(e){t.push(e.agendaDate+" "+e.agendaTime)}),t},e.hasPastDates=function(e){var a=new Date,n=!1;if(!e||0===e.length)return!1;try{_.each(e,function(e){var t=e;e.match(/^\d\d\d\d-\d\d-\d\d \d?\d:\d\d$/)&&(t=e.replace(" ","T")+":00"),e.match(/^\d\d\d\d-\d\d-\d\d \d?\d:\d\d:\d\d$/)&&(t=e.replace(" ","T")),new Date(t).getTime()<a.getTime()&&(n=!0)})}catch(e){n=!0}return n},e.getChannels=function(e){return _.isNumber(e)&&0<e?[e]:_.isString(e)&&0<parseInt(e)?[e]:_.isArray(e)?e:[]},e.getChannelsText=function(e){var t;return window.channelchooser?(t=angular.element(window.channelchooser).find("option"),t=_.filter(t,function(e){return e.selected&&0<parseInt(e.value)}),_.reduce(t,function(e,t){var a=angular.element(t).text();return _.isEmpty(e)?a:e+", "+a},"")):""},e.isValidAgendaRepeat=function(e,t){return!(t&&0<t.length&&1<e.length)},e.generateRequestHash=function(){var e,t=new Date;return e=CryptoJS.MD5(""+t.getTime()+_.random(0,9007199254740992)),e=CryptoJS.MD5(e+_.random(0,9007199254740992)),(e=CryptoJS.MD5(e+_.random(0,9007199254740992))).toString(CryptoJS.enc.Hex)},e.isValidCronjobExpr=function(e){return _.isEmpty(e)||/^(((([0-9]+)(\,[0-9]+)*)|\*) ){4}((([0-9]+)(\,[0-9]+)*)|\*)$/.test(e)},{formatDatesTimes:e.formatDatesTimes,hasPastDates:e.hasPastDates,getChannelsText:e.getChannelsText,isValidAgendaRepeat:e.isValidAgendaRepeat,generateRequestHash:e.generateRequestHash,getChannels:e.getChannels,isValidCronjobExpr:e.isValidCronjobExpr}}]),angular.module("starter.editor-controller",["starter.requests-service","starter.agenda-service","starter.request-helper","ui.bootstrap.buttons","localytics.directives"]).controller("EditorController",function($scope,$rootScope,$sce,Requests,Agenda,RequestHelper){var i=this,l=$scope.editorCtrl;l.waiting=!1,l.showDialog=!1,i.saveAndLoad=!1,l.addRequest=function(e){var t,a,n={},r={},s=[];if(e.preventDefault(),l.showDialog=!1,l.waiting)i.error({messageType:"error",message:"Please, try to save it again."});else if(t=angular.element(window.description).val(),!window.description&&_.isUndefined(t)&&(t=angular.element(document.getElementById("description")).val()),0!==(t=t.trim()).length){if(s=Agenda.get(),s=RequestHelper.formatDatesTimes(s),RequestHelper.hasPastDates(s))return i.error({messageType:"error",message:"Agenda has dates in the past. Please, remove them."}),!1;if(a=null,window.unix_mhdmd){if(a=angular.element(window.unix_mhdmd).val(),!RequestHelper.isValidCronjobExpr(a))return i.error({messageType:"error",message:"Repeat Expression is invalid."}),!1;if(!RequestHelper.isValidAgendaRepeat(s,a))return i.error({messageType:"error",message:"Repeat Expression not allowed for more than one Agenda date."}),!1}n.plugin=l.plugin,n.description=t,n.url=l.url_value,l.image_url_value=angular.element(window.image_url).val(),n.image_url=l.image_url_value,window.hashtags?n.hashtags=angular.element(window.hashtags).val():n.hashtags="",r.ref_id=l.ref_id,r.fulltext=l.fulltext_value,window.itemeditor_postthis?r.postthis=angular.element(window.itemeditor_postthis).val():r.postthis=null,window.itemeditor_evergreen?r.evergreen=angular.element(window.itemeditor_evergreen).val():r.evergreen=null,r.unix_mhdmd=a,r.repeat_until=l.repeat_until_value,r.channels=l.channelchooser_value,r.channels_text=RequestHelper.getChannelsText(l.channelchooser_value),r.agenda=s,r.image="",l.option_filter&&(r.option_filter=l.option_filter),"autotweetpost"==l.plugin?n.taskCommand="applyAjaxOwnAction":n.taskCommand="applyAjaxPluginAction",n.option=l.option,n.view=l.view,n.task=l.task,n.returnurl=l.returnurl,n[angular.element(window.XTtoken).attr("name")]=1,n.lang=angular.element(window.XTlang).val(),n.published=l.published,n.ajax=1,n.ref_id=l.ref_id,n.id=l.request_id,n.autotweet_advanced_attrs=JSON.stringify(r),l.waiting=!0,new Requests(n).$save(null,i.success,i.error)}else i.error({messageType:"error",message:"Empty message. Please, fill the main text field."})},i.success=function(e){l.showDialog=!0,l.messageResult=e.status,l.messageText=$sce.trustAsHtml(e.message),l.request_id=0,l.ref_id=e.hash,l.waiting=!1,e.status&&i.redirectOnSuccess&&Joomla.submitbutton("cancel"),i.redirectOnSuccess=!1,i.saveAndLoad?($rootScope.$emit("editRequest",e.request_id),i.saveAndLoad=!1):i.reset(),$rootScope.$emit("newRequest")},i.error=function(e){l.showDialog=!0,l.messageResult=!1,l.messageText=$sce.trustAsHtml("Error: "+e.message),i.redirectOnSuccess=!1,l.waiting=!1,$scope.$digest()},i.callbackAddRequest=function(e){i.saveAndLoad=!1,i.addRequest(e)},i.callbackAddRequestLoad=function(e){i.saveAndLoad=!0,i.addRequest(e)},i.callbackAddRequestAndRedirect=function(e){i.redirectOnSuccess=!0,i.callbackAddRequestLoad(e)},l.menuitemlistHide=function(){var e=document.getElementById("menulist_group"),t=angular.element(e);t.hasClass("hide")?t.removeClass("hide"):t.addClass("hide")},i.load=function(e){i.reset(),l.waiting=!1,l.messageResult="success",l.messageText=$sce.trustAsHtml("-Loaded-"),l.request_id=e.id,l.ref_id=e.ref_id,l.plugin=e.plugin,$rootScope.$emit("updateMessageView",e.description,e.xtform.hashtags),l.url_value=e.url,l.image_url_value=e.image_url,setTimeout(function(){window.xtRefreshPreview("","image_url")},1),e.autotweet_advanced_attrs&&(l.fulltext_value=e.autotweet_advanced_attrs.fulltext,l.option_filter=e.autotweet_advanced_attrs.option,$rootScope.$emit("loadAgenda",e.autotweet_advanced_attrs.agenda),setTimeout(function(){angular.element(document.getElementById("ctrl_itemeditor_postthis_"+e.autotweet_advanced_attrs.postthis)).click(),angular.element(document.getElementById("ctrl_itemeditor_evergreen_"+e.autotweet_advanced_attrs.evergreen)).click()},1),l.channelchooser_value=e.autotweet_advanced_attrs.channels,angular.element(window.unix_mhdmd).val(e.autotweet_advanced_attrs.unix_mhdmd),l.repeat_until_value=e.autotweet_advanced_attrs.repeat_until)},i.getHash=function(){return RequestHelper.generateRequestHash()},i.reset=function(){l.showDialog=!1,l.request_id=0,l.ref_id=i.getHash(),l.plugin="autotweetpost",$rootScope.$emit("updateMessageView","",""),l.url_value="",l.menuitem_value="",l.fulltext_value="",l.image_url_value="",window.xtRefreshPreview("","image_url"),angular.element(document.getElementById("image_url-image")).html(""),setTimeout(function(){angular.element(document.getElementById("ctrl_itemeditor_postthis_1")).click(),angular.element(document.getElementById("ctrl_itemeditor_evergreen_2")).click()},1),l.channelchooser_value=[],window.unix_mhdmd&&angular.element(window.unix_mhdmd).val(""),l.repeat_until_value="",$rootScope.$emit("loadAgenda",[]),window.unix_mhdmd_minute&&(angular.element(window.unix_mhdmd_minute).val("*"),angular.element(window.unix_mhdmd_hour).val("*"),angular.element(window.unix_mhdmd_day).val("*"),angular.element(window.unix_mhdmd_month).val("*"),angular.element(window.unix_mhdmd_weekday).val("*"))},i.editRequest=function(e,t){var a={};e.preventDefault(),l.showDialog=!1,l.waiting?i.error({messageType:"error",message:"Please, try to save it again."}):t&&(a.id=t,a.request_id=t,a.taskCommand="readAjaxAction",a.ajax=1,l.waiting=!0,new Requests(a).$get(null,i.load,i.error))},i.publishRequest=function(e,t){var a={};e.preventDefault(),l.showDialog=!1,l.waiting?i.error({messageType:"error",message:"Please, try to publish it again."}):t&&(a.id=t,a.request_id=t,a.taskCommand="publishAjaxAction",a.ajax=1,l.waiting=!0,new Requests(a).$save(null,i.success,i.error))},i.cancelRequest=function(e,t){var a={};e.preventDefault(),l.showDialog=!1,l.waiting?i.error({messageType:"error",message:"Please, try to cancel it again."}):t&&(a.id=t,a.request_id=t,a.taskCommand="cancelAjaxAction",a.ajax=1,l.waiting=!0,new Requests(a).$save(null,i.success,i.error))},i.loadUrl=function(e){var t={};l.showDialog=!1,l.waiting?i.error({messageType:"error",message:"Unable to load Urls, Please, try it again."}):(t.itemId=e,t.taskCommand="routeAjaxItemId",t.ajax=1,l.waiting=!0,new Requests(t).$save(null,i.successRoute,i.error))},i.successRoute=function(e){l.url_value=e.url,l.waiting=!1},i.reset(),$rootScope.$on("editRequest",i.editRequest),$rootScope.$on("publishRequest",i.publishRequest),$rootScope.$on("cancelRequest",i.cancelRequest);var e,t=document.getElementById("toolbar-apply");t&&angular.element(t).find("button").attr("onclick",null).click(i.callbackAddRequestLoad),(t=document.getElementById("toolbar-save"))&&angular.element(t).find("button").attr("onclick",null).click(i.callbackAddRequestAndRedirect),(t=document.getElementById("toolbar-save-new"))&&angular.element(t).find("button").attr("onclick",null).click(i.callbackAddRequest),t=document.getElementById("F0FHeaderHolder"),e=angular.element(t).find("button"),_.each(e,function(e,t){0===t&&angular.element(e).attr("onclick",null).click(i.callbackAddRequestLoad),1===t&&angular.element(e).attr("onclick",null).click(i.callbackAddRequestAndRedirect),2===t&&angular.element(e).attr("onclick",null).click(i.callbackAddRequest)})}),angular.module("starter.requests-controller",["starter.requests-service","ngTable"]).controller("RequestsController",function($scope,$timeout,$rootScope,Requests,ngTableParams){var a=this,n=$scope.requestsCtrl,e=document.getElementById("list_limit"),r=angular.element(e).val();n.firstTime=!0,n.requestsTable=new ngTableParams({count:r},{total:0,counts:[],getData:function(t,e){n.waiting=!0,Requests.query({taskCommand:"browse",ajax:1,boxchecked:0,hidemainmenu:0,filter_order:"publish_up",filter_order_Dir:"ASC",limitstart:0,limit:r,publish_up:0,search:"",plugin:0,published:0},function(e){$timeout(function(){n.waiting=!1,t.resolve(e),n.firstTime&&(n.firstTime=!1,a.loadReqParam(e))},500)})}}),a.loadReqParam=function(e){var n=a.getQueryParams("req-id");if(!n)return!1;e.$promise.then(function(t){var a=0;$rootScope.$emit("editRequest",n),_.each(t,function(e){e.id==n&&(t[a].$selected=!0),a++})})},a.getQueryParams=function(e){var t=window.location.search.substring(1);return _.chain(t.split("&")).map(function(e){var t=e.split("=");return[t[0],decodeURIComponent(t[1])]}).object().value()[e]},n.requestsTable.doRefresh=function(){n.requestsTable.reload()},n.requestsTable.selectRow=function(e){for(var t=0;t<n.requestsTable.data.length;t++)n.requestsTable.data[t].$selected=!1;e.$selected=!0},n.requestsTable.editRow=function(e){$rootScope.$emit("editRequest",e.id)},n.requestsTable.publishRow=function(e){$rootScope.$emit("publishRequest",e.id)},n.requestsTable.cancelRow=function(e){$rootScope.$emit("cancelRequest",e.id)},$rootScope.$on("newRequest",n.requestsTable.doRefresh)}),angular.module("starter.agenda-controller",["starter.agenda-service"]).controller("AgendaController",function($scope,$rootScope,Agenda){var a=$scope.agendaCtrl,n=a.agendas=Agenda.get();Agenda.clear(),a.add=function(){var e=a.scheduling_date_value,t=a.scheduling_time_value;e&&t&&(e=e.trim()).length&&(n.push({agendaDate:e,agendaTime:t}),Agenda.put(n),a.scheduling_date_value="")},a.remove=function(e){n.splice(n.indexOf(e),1),Agenda.put(n)},$rootScope.$on("newRequest",function(){Agenda.clear(),n=a.agendas=Agenda.get()}),$rootScope.$on("loadDate",function(e,t){a.scheduling_date_value=t}),$rootScope.$on("loadTime",function(e,t){a.scheduling_time_value=t}),$rootScope.$on("loadAgenda",function(e,t){var r=[];_.each(t,function(e){var t,a,n=e.split(" ");t=n[0],3==(n=(a=n[1]).split(":")).length&&(n.splice(2,1),a=n.join(":")),r.push({agendaDate:t,agendaTime:a})}),Agenda.put(r),n=a.agendas=Agenda.get(),a.scheduling_date_value=""})}),angular.module("starter.message-controller",[]).controller("MessageController",function($scope,$rootScope){var a=this||{},n=$scope.messageCtrl;n.remainingCount=0,n.remainingCountClass="",n.countRemaining=function(){var e,t;t=n.description_value?n.description_value.length:0,e="label",0<(t+=_.isEmpty(a.hashtags_value)?0:a.hashtags_value.length+1)&&t<=60?e="label label-success":60<t&&t<=100?e="label label-warning":100<t&&(e="label label-important"),n.remainingCount=t,n.remainingCountClass=e},a.updateMessageView=function(e,t,a){n.description_value=t,window.hashtags&&(n.hashtags_value=a),n.countRemaining()},$rootScope.$on("updateMessageView",a.updateMessageView)}),function(){var e=["starter.message-controller","starter.editor-controller","starter.requests-controller","starter.agenda-controller","starter.jquery-extras"];try{angular.module("starter.cronjob-expr-controller"),e.push("starter.cronjob-expr-controller")}catch(e){}angular.module("starter",e).config(function($logProvider,$compileProvider){$logProvider.debugEnabled(!1),$compileProvider.debugInfoEnabled(!1)})}();
