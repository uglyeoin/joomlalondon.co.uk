"use strict";define("import",["extlycore"],function(t){var s=t.ExtlyModel.extend({url:function(){return t.SefHelper.route("index.php?option=com_autotweet&view=feeds&task=getImportBegin")}}),o=t.ExtlyModel.extend({url:function(){return t.SefHelper.route("index.php?option=com_autotweet&view=feeds&task=getImportStatus")}}),r=t.ExtlyModel.extend({url:function(){return t.SefHelper.route("index.php?option=com_autotweet&view=feeds&task=getImportEnd")}});new(Backbone.View.extend({events:{"click #toolbar-process button":"onImportBegin","click #toolbar-process .toolbar":"onImportBegin","click #cpanel-import":"onImportBegin"},initialize:function(){var t;(t=this.$("#toolbar-process button")).attr("onclick",""),t.click(function(t){t.preventDefault()}),(t=this.$("#toolbar-process .toolbar")).attr("onclick",""),t.click(function(t){t.preventDefault()}),(t=this.$("#cpanel-import")).attr("onclick",""),t.click(function(t){t.preventDefault()}),this.resetBar(0)},onImportBegin:function(){var t=new s,e=this.$("#XTtoken").attr("name");this.$(".import-progress").removeClass("hide"),this.$(".import-progress .success-message").addClass("hide"),this.$("#toolbar-process button").addClass("disabled"),this.$("#toolbar-process .toolbar").addClass("disabled"),this.$("#cpanel-import").addClass("disabled"),t.on("change",this.loadImportBegin,this),t.fetch({data:{_token:e},wait:!0,dataType:"text",error:function(t,e,s){alert(e.responseText)}})},loadImportBegin:function(t){t.get("status")?(this.feeds=t.get("feeds"),this.nextFeed(),this.onImportStatus(0)):alert(t.get("message"))},onImportStatus:function(t){var e=new o,s=this.$("#XTtoken").attr("name");e.on("change",this.loadimportStatus,this),e.fetch({data:{_token:s,feedId:this.currentFeed.id,isContinue:t},wait:!0,dataType:"text",error:function(t,e,s){alert(e.responseText)}})},loadimportStatus:function(t){var e;t.get("status")?(e=t.get("completed"),this.assignTotal(t.get("total")),e?0===_.size(this.feeds)?this.onImportEnd():(this.nextFeed(),this.onImportStatus(0)):this.onImportStatus(1)):alert(t.get("message"))},onImportEnd:function(){var t=new r,e=this.$("#XTtoken").attr("name");t.on("change",this.loadImportEnd,this),t.fetch({data:{_token:e},wait:!0,dataType:"text",error:function(t,e,s){alert(e.responseText)}})},loadImportEnd:function(t){t.get("status")?(this.resetBar(100),this.$(".import-progress .success-message").removeClass("hide"),this.$("#toolbar-process button").removeClass("disabled"),this.$("#toolbar-process .toolbar").removeClass("disabled"),this.$("#cpanel-import").removeClass("disabled")):alert(t.get("message"))},assignFeedName:function(t){this.$(".import-progress .feed").val(t)},assignTotal:function(t){this.$(".import-progress .total").val(t)},resetBar:function(t){var e=this.$(".import-progress .bar");this.barImport=t||1,e.attr("style","width: "+this.barImport+"%;")},incBar:function(){var t=this.$(".import-progress .bar");this.barImport+=5,100<this.barImport?this.resetBar(0):t.attr("style","width: "+this.barImport+"%;")},nextFeed:function(){var t;this.currentFeed=_.first(this.feeds),this.feeds=_.rest(this.feeds),t=this.currentFeed.id+" - "+this.currentFeed.name,this.assignFeedName(t),this.assignTotal(0),this.incBar()}}))({el:jQuery("body")})});
