/*! UIkit 2.18.0 | http://www.getuikit.com | (c) 2014 YOOtheme | MIT License */
(function(n){if(typeof define=="function"&&define.amd&&define("uikit",function(){var t=window.UIkit||n(window,window.jQuery,window.document);return t.load=function(n,i,r,u){var e=n.split(","),o=[],f,s=(u.config&&u.config.uikit&&u.config.uikit.base?u.config.uikit.base:"").replace(/\/+$/g,""),h;if(!s)throw new Error("Please define base path to UIkit in the requirejs config.");for(f=0;f<e.length;f+=1)h=e[f].replace(/\./g,"/"),o.push(s+"/components/"+h);i(o,function(){r(t)})},t}),!window.jQuery)throw new Error("UIkit requires jQuery");window&&window.jQuery&&n(window,window.jQuery,window.document)})(function(n,t,i){"use strict";var r={},u=window.UIkit;r.version="2.18.0";r.noConflict=function(){return u&&(window.UIkit=u,t.UIkit=u,t.fn.uk=u.fn),r};r.prefix=function(n){return n};r.$=t;r.$doc=r.$(document);r.$win=r.$(window);r.$html=r.$("html");r.fn=function(n,i){var o=arguments,e=n.match(/^([a-z\-]+)(?:\.([a-z]+))?/i),u=e[1],f=e[2];return r[u]?this.each(function(){var e=t(this),n=e.data(u);n||e.data(u,n=r[u](this,f?undefined:i));f&&n[f].apply(n,Array.prototype.slice.call(o,1))}):(t.error("UIkit component ["+u+"] does not exist."),this)};r.support={};r.support.transition=function(){var n=function(){var r=i.body||i.documentElement,n={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var t in n)if(r.style[t]!==undefined)return n[t]}();return n&&{end:n}}();r.support.animation=function(){var n=function(){var r=i.body||i.documentElement,n={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"animationend",OAnimation:"oAnimationEnd oanimationend",animation:"animationend"};for(var t in n)if(r.style[t]!==undefined)return n[t]}();return n&&{end:n}}();r.support.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(n){setTimeout(n,1e3/60)};r.support.touch="ontouchstart"in window&&navigator.userAgent.toLowerCase().match(/mobile|tablet/)||n.DocumentTouch&&document instanceof n.DocumentTouch||n.navigator.msPointerEnabled&&n.navigator.msMaxTouchPoints>0||n.navigator.pointerEnabled&&n.navigator.maxTouchPoints>0||!1;r.support.mutationobserver=n.MutationObserver||n.WebKitMutationObserver||null;r.Utils={};r.Utils.str2json=function(n,t){try{return t?JSON.parse(n.replace(/([\$\w]+)\s*:/g,function(n,t){return'"'+t+'":'}).replace(/'([^']+)'/g,function(n,t){return'"'+t+'"'})):new Function("","var json = "+n+"; return JSON.parse(JSON.stringify(json));")()}catch(i){return!1}};r.Utils.debounce=function(n,t,i){var r;return function(){var u=this,f=arguments,e=function(){r=null;i||n.apply(u,f)},o=i&&!r;clearTimeout(r);r=setTimeout(e,t);o&&n.apply(u,f)}};r.Utils.removeCssRules=function(n){var i,r,t,u,e,f,s,h,c,o;n&&setTimeout(function(){try{for(o=document.styleSheets,u=0,s=o.length;u<s;u++){for(t=o[u],r=[],t.cssRules=t.cssRules,i=e=0,h=t.cssRules.length;e<h;i=++e)t.cssRules[i].type===CSSRule.STYLE_RULE&&n.test(t.cssRules[i].selectorText)&&r.unshift(i);for(f=0,c=r.length;f<c;f++)t.deleteRule(r[f])}}catch(l){}},0)};r.Utils.isInView=function(n,i){var u=t(n);if(!u.is(":visible"))return!1;var f=r.$win.scrollLeft(),e=r.$win.scrollTop(),o=u.offset(),s=o.left,h=o.top;return i=t.extend({topoffset:0,leftoffset:0},i),h+u.height()>=e&&h-i.topoffset<=e+r.$win.height()&&s+u.width()>=f&&s-i.leftoffset<=f+r.$win.width()?!0:!1};r.Utils.checkDisplay=function(n,i){var u=r.$("[data-uk-margin], [data-uk-grid-match], [data-uk-grid-margin], [data-uk-check-display]",n||document);return n&&!u.length&&(u=t(n)),u.trigger("display.uk.check"),i&&(typeof i!="string"&&(i='[class*="uk-animation-"]'),u.find(i).each(function(){var n=r.$(this),i=n.attr("class"),t=i.match(/uk\-animation\-(.+)/);n.removeClass(t[0]).width();n.addClass(t[0])})),u};r.Utils.options=function(n){if(t.isPlainObject(n))return n;var i=n?n.indexOf("{"):-1,u={};if(i!=-1)try{u=r.Utils.str2json(n.substr(i))}catch(f){}return u};r.Utils.animate=function(n,i){var u=t.Deferred();return n=r.$(n),i=i,n.css("display","none").addClass(i).one(r.support.animation.end,function(){n.removeClass(i);u.resolve()}).width(),n.css("display",""),u.promise()};r.Utils.uid=function(n){return(n||"id")+(new Date).getTime()+"RAND"+Math.ceil(Math.random()*1e5)};r.Utils.template=function(n,t){for(var o=n.replace(/\n/g,"\\n").replace(/\{\{\{\s*(.+?)\s*\}\}\}/g,"{{!$1}}").split(/(\{\{\s*(.+?)\s*\}\})/g),u=0,f,h,i,s,r=[],e=0;u<o.length;){if(f=o[u],f.match(/\{\{\s*(.+?)\s*\}\}/)){u=u+1;f=o[u];h=f[0];i=f.substring(f.match(/^(\^|\#|\!|\~|\:)/)?1:0);switch(h){case"~":r.push("for(var $i=0;$i<"+i+".length;$i++) { var $item = "+i+"[$i];");e++;break;case":":r.push("for(var $key in "+i+") { var $val = "+i+"[$key];");e++;break;case"#":r.push("if("+i+") {");e++;break;case"^":r.push("if(!"+i+") {");e++;break;case"/":r.push("}");e--;break;case"!":r.push("__ret.push("+i+");");break;default:r.push("__ret.push(escape("+i+"));")}}else r.push("__ret.push('"+f.replace(/\'/g,"\\'")+"');");u=u+1}return s=new Function("$data",["var __ret = [];","try {","with($data){",e?'__ret = ["Not all blocks are closed correctly."]':r.join(""),"};","}catch(e){__ret = [e.message];}",'return __ret.join("").replace(/\\n\\n/g, "\\n");',"function escape(html) { return String(html).replace(/&/g, '&amp;').replace(/\"/g, '&quot;').replace(/<\/g, '&lt;').replace(/>/g, '&gt;');}"].join("\n")),t?s(t):s};r.Utils.events={};r.Utils.events.click=r.support.touch?"tap":"click";window.UIkit=r;t.UIkit=r;t.fn.uk=r.fn;r.langdirection=r.$html.attr("dir")=="rtl"?"right":"left";r.components={};r.component=function(n,i){var u=function(i,f){var e=this;return this.UIkit=r,this.element=i?r.$(i):null,this.options=t.extend(!0,{},this.defaults,f),this.plugins={},this.element&&this.element.data(n,this),this.init(),(this.options.plugins.length?this.options.plugins:Object.keys(u.plugins)).forEach(function(n){u.plugins[n].init&&(u.plugins[n].init(e),e.plugins[n]=!0)}),this.trigger("init.uk.component",[n,this]),this};return u.plugins={},t.extend(!0,u.prototype,{defaults:{plugins:[]},boot:function(){},init:function(){},on:function(n,t,i){return r.$(this.element||this).on(n,t,i)},one:function(n,t,i){return r.$(this.element||this).one(n,t,i)},off:function(n){return r.$(this.element||this).off(n)},trigger:function(n,t){return r.$(this.element||this).trigger(n,t)},find:function(n){return r.$(this.element?this.element:[]).find(n)},proxy:function(n,t){var i=this;t.split(" ").forEach(function(t){i[t]||(i[t]=function(){return n[t].apply(n,arguments)})})},mixin:function(n,t){var i=this;t.split(" ").forEach(function(t){i[t]||(i[t]=n[t].bind(i))})},option:function(){if(arguments.length==1)return this.options[arguments[0]]||undefined;arguments.length==2&&(this.options[arguments[0]]=arguments[1])}},i),this.components[n]=u,this[n]=function(){var i,u;if(arguments.length)switch(arguments.length){case 1:typeof arguments[0]=="string"||arguments[0].nodeType||arguments[0]instanceof jQuery?i=t(arguments[0]):u=arguments[0];break;case 2:i=t(arguments[0]);u=arguments[1]}return i&&i.data(n)?i.data(n):new r.components[n](i,u)},r.domready&&r.component.boot(n),u};r.plugin=function(n,t,i){this.components[n].plugins[t]=i};r.component.boot=function(n){r.components[n].prototype&&r.components[n].prototype.boot&&!r.components[n].booted&&(r.components[n].prototype.boot.apply(r,[]),r.components[n].booted=!0)};r.component.bootComponents=function(){for(var n in r.components)r.component.boot(n)};r.domObservers=[];r.domready=!1;r.ready=function(n){r.domObservers.push(n);r.domready&&n(document)};r.on=function(n,t,i){n&&n.indexOf("ready.uk.dom")>-1&&r.domready&&t.apply(r.$doc);return r.$doc.on(n,t,i)};r.one=function(n,t,i){return n&&n.indexOf("ready.uk.dom")>-1&&r.domready?(t.apply(r.$doc),r.$doc):r.$doc.one(n,t,i)};r.trigger=function(n,t){return r.$doc.trigger(n,t)};r.domObserve=function(n,t){r.support.mutationobserver&&(t=t||function(){},r.$(n).each(function(){var n=this,i=r.$(n),u;if(!i.data("observer"))try{u=new r.support.mutationobserver(r.Utils.debounce(function(){t.apply(n,[]);i.trigger("changed.uk.dom")},50));u.observe(n,{childList:!0,subtree:!0});i.data("observer",u)}catch(f){}}))};r.on("domready.uk.dom",function(){r.domObservers.forEach(function(n){n(document)});r.domready&&r.Utils.checkDisplay(document)});if(t(function(){r.$body=r.$("body");r.ready(function(){r.domObserve("[data-uk-observe]")});r.on("changed.uk.dom",function(n){var t=n.target;r.domObservers.forEach(function(n){n(t)});r.Utils.checkDisplay(t)});if(r.trigger("beforeready.uk.dom"),r.component.bootComponents(),setInterval(function(){var n={x:window.pageXOffset,y:window.pageYOffset},t,i=function(){(n.x!=window.pageXOffset||n.y!=window.pageYOffset)&&(t={x:0,y:0},window.pageXOffset!=n.x&&(t.x=window.pageXOffset>n.x?1:-1),window.pageYOffset!=n.y&&(t.y=window.pageYOffset>n.y?1:-1),n={dir:t,x:window.pageXOffset,y:window.pageYOffset},r.$doc.trigger("scrolling.uk.document",[n]))};if(r.support.touch)r.$html.on("touchmove touchend MSPointerMove MSPointerUp pointermove pointerup",i);return(n.x||n.y)&&i(),i}(),15),r.trigger("domready.uk.dom"),r.support.touch&&navigator.userAgent.match(/(iPad|iPhone|iPod)/g))r.$win.on("load orientationchange resize",r.Utils.debounce(function(){var n=function(){return t(".uk-height-viewport").css("height",window.innerHeight),n};return n()}(),100));r.trigger("afterready.uk.dom");r.domready=!0}),r.$html.addClass(r.support.touch?"uk-touch":"uk-notouch"),r.support.touch){var f=!1,o,e="uk-hover",s=".uk-overlay, .uk-overlay-hover, .uk-overlay-toggle, .uk-animation-hover, .uk-has-hover";r.$html.on("touchstart MSPointerDown pointerdown",s,function(){f&&t("."+e).removeClass(e);f=t(this).addClass(e)}).on("touchend MSPointerUp pointerup",function(n){o=t(n.target).parents(s);f&&f.not(o).removeClass(e)})}return r}),function(n){function l(n,t,i,r){return Math.abs(n-t)>=Math.abs(i-r)?n-t>0?"Left":"Right":i-r>0?"Up":"Down"}function a(){i=null;t.last&&(t.el.trigger("longTap"),t={})}function h(){i&&clearTimeout(i);i=null}function o(){r&&clearTimeout(r);u&&clearTimeout(u);f&&clearTimeout(f);i&&clearTimeout(i);r=u=f=i=null;t={}}function s(n){return n.pointerType==n.MSPOINTER_TYPE_TOUCH&&n.isPrimary}if(!n.fn.swipeLeft){var t={},r,u,f,i,c=750,e;n(function(){var y,w,p=0,b=0,v;"MSGesture"in window&&(e=new MSGesture,e.target=document.body);n(document).on("MSGestureEnd gestureend",function(n){var i=n.originalEvent.velocityX>1?"Right":n.originalEvent.velocityX<-1?"Left":n.originalEvent.velocityY>1?"Down":n.originalEvent.velocityY<-1?"Up":null;i&&(t.el.trigger("swipe"),t.el.trigger("swipe"+i))}).on("touchstart MSPointerDown pointerdown",function(u){(u.type!="MSPointerDown"||s(u.originalEvent))&&(v=u.type=="MSPointerDown"||u.type=="pointerdown"?u:u.originalEvent.touches[0],y=Date.now(),w=y-(t.last||y),t.el=n("tagName"in v.target?v.target:v.target.parentNode),r&&clearTimeout(r),t.x1=v.pageX,t.y1=v.pageY,w>0&&w<=250&&(t.isDoubleTap=!0),t.last=y,i=setTimeout(a,c),e&&(u.type=="MSPointerDown"||u.type=="pointerdown"||u.type=="touchstart")&&e.addPointer(u.originalEvent.pointerId))}).on("touchmove MSPointerMove pointermove",function(n){(n.type!="MSPointerMove"||s(n.originalEvent))&&(v=n.type=="MSPointerMove"||n.type=="pointermove"?n:n.originalEvent.touches[0],h(),t.x2=v.pageX,t.y2=v.pageY,p+=Math.abs(t.x1-t.x2),b+=Math.abs(t.y1-t.y2))}).on("touchend MSPointerUp pointerup",function(i){(i.type!="MSPointerUp"||s(i.originalEvent))&&(h(),t.x2&&Math.abs(t.x1-t.x2)>30||t.y2&&Math.abs(t.y1-t.y2)>30?f=setTimeout(function(){t.el.trigger("swipe");t.el.trigger("swipe"+l(t.x1,t.x2,t.y1,t.y2));t={}},0):"last"in t&&(isNaN(p)||p<30&&b<30?u=setTimeout(function(){var i=n.Event("tap");i.cancelTouch=o;t.el.trigger(i);t.isDoubleTap?(t.el.trigger("doubleTap"),t={}):r=setTimeout(function(){r=null;t.el.trigger("singleTap");t={}},250)},0):t={},p=b=0))}).on("touchcancel MSPointerCancel",o);n(window).on("scroll",o)});["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(t){n.fn[t]=function(i){return n(this).on(t,i)}})}}(jQuery),function(n){"use strict";var t=[];n.component("stackMargin",{defaults:{cls:"uk-margin-small-top"},boot:function(){n.ready(function(t){n.$("[data-uk-margin]",t).each(function(){var t=n.$(this),i;t.data("stackMargin")||(i=n.stackMargin(t,n.Utils.options(t.attr("data-uk-margin"))))})})},init:function(){var i=this;if(this.columns=this.element.children(),this.columns.length){n.$win.on("resize orientationchange",function(){var t=function(){i.process()};return n.$(function(){t();n.$win.on("load",t)}),n.Utils.debounce(t,20)}());n.$html.on("changed.uk.dom",function(){i.columns=i.element.children();i.process()});this.on("display.uk.check",function(){i.columns=i.element.children();this.element.is(":visible")&&this.process()}.bind(this));t.push(this)}},process:function(){var t=this;return n.Utils.stackMargin(this.columns,this.options),this},revert:function(){return this.columns.removeClass(this.options.cls),this}});n.ready(function(){var t=[],i=function(){t.forEach(function(n){if(n.is(":visible")){var t=n.parent().width(),i=n.data("width"),r=t/i,u=Math.floor(r*n.data("height"));n.css({height:t<i?u:n.data("height")})}})};n.$win.on("resize",n.Utils.debounce(i,15));return function(r){n.$("iframe.uk-responsive-width",r).each(function(){var i=n.$(this);!i.data("responsive")&&i.attr("width")&&i.attr("height")&&(i.data("width",i.attr("width")),i.data("height",i.attr("height")),i.data("responsive",!0),t.push(i))});i()}}());n.Utils.stackMargin=function(t,i){i=n.$.extend({cls:"uk-margin-small-top"},i);i.cls=i.cls;t=n.$(t).removeClass(i.cls);var u=!1,r=t.filter(":visible:first"),f=r.length?r.position().top+r.outerHeight()-1:!1;f!==!1&&t.each(function(){var t=n.$(this);t.is(":visible")&&(u?t.addClass(i.cls):t.position().top>=f&&(u=t.addClass(i.cls)))})}}(UIkit),function(n){"use strict";function t(t,i){i=n.$.extend({duration:1e3,transition:"easeOutExpo",offset:0,complete:function(){}},i);var r=t.offset().top-i.offset,u=n.$doc.height(),f=window.innerHeight;r+f>u&&(r=u-f);n.$("html,body").stop().animate({scrollTop:r},i.duration,i.transition).promise().done(i.complete)}n.component("smoothScroll",{boot:function(){n.$html.on("click.smooth-scroll.uikit","[data-uk-smooth-scroll]",function(){var t=n.$(this),i;return t.data("smoothScroll")||(i=n.smoothScroll(t,n.Utils.options(t.attr("data-uk-smooth-scroll"))),t.trigger("click")),!1})},init:function(){var i=this;this.on("click",function(r){r.preventDefault();t(n.$(this.hash).length?n.$(this.hash):n.$("body"),i.options)})}});n.Utils.scrollToElement=t;n.$.easing.easeOutExpo||(n.$.easing.easeOutExpo=function(n,t,i,r,u){return t==u?i+r:r*(-Math.pow(2,-10*t/u)+1)+i})}(UIkit),function(n){"use strict";var i=n.$win,f=n.$doc,r=[],e=function(){for(var t=0;t<r.length;t++)n.support.requestAnimationFrame.apply(window,[r[t].check])},t,u;n.component("scrollspy",{defaults:{target:!1,cls:"uk-scrollspy-inview",initcls:"uk-scrollspy-init-inview",topoffset:0,leftoffset:0,repeat:!1,delay:0},boot:function(){f.on("scrolling.uk.document",e);i.on("load resize orientationchange",n.Utils.debounce(e,50));n.ready(function(t){n.$("[data-uk-scrollspy]",t).each(function(){var t=n.$(this),i;t.data("scrollspy")||(i=n.scrollspy(t,n.Utils.options(t.attr("data-uk-scrollspy"))))})})},init:function(){var t=this,i,u=this.options.cls.split(/,/),f=function(){var f=t.options.target?t.element.find(t.options.target):t.element,e=f.length===1?1:0,r=0;f.each(function(){var f=n.$(this),o=f.data("inviewstate"),s=n.Utils.isInView(f,t.options),h=f.data("ukScrollspyCls")||u[r].trim();!s||o||f.data("scrollspy-idle")||(i||(f.addClass(t.options.initcls),t.offset=f.offset(),i=!0,f.trigger("init.uk.scrollspy")),f.data("scrollspy-idle",setTimeout(function(){f.addClass("uk-scrollspy-inview").toggleClass(h).width();f.trigger("inview.uk.scrollspy");f.data("scrollspy-idle",!1);f.data("inviewstate",!0)},t.options.delay*e)),e++);!s&&o&&t.options.repeat&&(f.data("scrollspy-idle")&&clearTimeout(f.data("scrollspy-idle")),f.removeClass("uk-scrollspy-inview").toggleClass(h),f.data("inviewstate",!1),f.trigger("outview.uk.scrollspy"));r=u[r+1]?r+1:0})};f();this.check=f;r.push(this)}});t=[];u=function(){for(var i=0;i<t.length;i++)n.support.requestAnimationFrame.apply(window,[t[i].check])};n.component("scrollspynav",{defaults:{cls:"uk-active",closest:!1,topoffset:0,leftoffset:0,smoothscroll:!1},boot:function(){f.on("scrolling.uk.document",u);i.on("resize orientationchange",n.Utils.debounce(u,50));n.ready(function(t){n.$("[data-uk-scrollspy-nav]",t).each(function(){var t=n.$(this),i;t.data("scrollspynav")||(i=n.scrollspynav(t,n.Utils.options(t.attr("data-uk-scrollspy-nav"))))})})},init:function(){var s=[],u=this.find("a[href^='#']").each(function(){s.push(n.$(this).attr("href"))}),o=n.$(s.join(",")),f=this.options.cls,h=this.options.closest||this.options.closest,e=this,r,c=function(){var t,c,l,s;for(r=[],t=0;t<o.length;t++)n.Utils.isInView(o.eq(t),e.options)&&r.push(o.eq(t));if(r.length){if(l=i.scrollTop(),s=function(){for(var n=0;n<r.length;n++)if(r[n].offset().top>=l)return r[n]}(),!s)return;e.options.closest?(u.closest(h).removeClass(f),c=u.filter("a[href='#"+s.attr("id")+"']").closest(h).addClass(f)):c=u.removeClass(f).filter("a[href='#"+s.attr("id")+"']").addClass(f);e.element.trigger("inview.uk.scrollspynav",[s,c])}};this.options.smoothscroll&&n.smoothScroll&&u.each(function(){n.smoothScroll(this,e.options.smoothscroll)});c();this.element.data("scrollspynav",this);this.check=c;t.push(this)}})}(UIkit),function(n){"use strict";var t=[];n.component("toggle",{defaults:{target:!1,cls:"uk-hidden",animation:!1,duration:200},boot:function(){n.ready(function(i){n.$("[data-uk-toggle]",i).each(function(){var t=n.$(this),i;t.data("toggle")||(i=n.toggle(t,n.Utils.options(t.attr("data-uk-toggle"))))});setTimeout(function(){t.forEach(function(n){n.getToggles()})},0)})},init:function(){var n=this;this.aria=this.options.cls.indexOf("uk-hidden")!==-1;this.getToggles();this.on("click",function(t){n.element.is('a[href="#"]')&&t.preventDefault();n.toggle()});t.push(this)},toggle:function(){if(this.totoggle.length){if(this.options.animation&&n.support.animation){var i=this,t=this.options.animation.split(",");t.length==1&&(t[1]=t[0]);t[0]=t[0].trim();t[1]=t[1].trim();this.totoggle.css("animation-duration",this.options.duration+"ms");this.totoggle.hasClass(this.options.cls)?(this.totoggle.toggleClass(this.options.cls),this.totoggle.each(function(){n.Utils.animate(this,t[0]).then(function(){n.$(this).css("animation-duration","");n.Utils.checkDisplay(this)})})):this.totoggle.each(function(){n.Utils.animate(this,t[1]+" uk-animation-reverse").then(function(){n.$(this).toggleClass(i.options.cls).css("animation-duration","");n.Utils.checkDisplay(this)}.bind(this))})}else this.totoggle.toggleClass(this.options.cls),n.Utils.checkDisplay(this.totoggle);this.updateAria()}},getToggles:function(){this.totoggle=this.options.target?n.$(this.options.target):[];this.updateAria()},updateAria:function(){this.aria&&this.totoggle.length&&this.totoggle.each(function(){n.$(this).attr("aria-hidden",n.$(this).hasClass("uk-hidden"))})}})}(UIkit),function(n){"use strict";n.component("alert",{defaults:{fade:!0,duration:200,trigger:".uk-alert-close"},boot:function(){n.$html.on("click.alert.uikit","[data-uk-alert]",function(t){var i=n.$(this),r;i.data("alert")||(r=n.alert(i,n.Utils.options(i.attr("data-uk-alert"))),n.$(t.target).is(r.options.trigger)&&(t.preventDefault(),r.close()))})},init:function(){var n=this;this.on("click",this.options.trigger,function(t){t.preventDefault();n.close()})},close:function(){var n=this.trigger("close.uk.alert"),t=function(){this.trigger("closed.uk.alert").remove()}.bind(this);this.options.fade?n.css("overflow","hidden").css("max-height",n.height()).animate({height:0,opacity:0,"padding-top":0,"padding-bottom":0,"margin-top":0,"margin-bottom":0},this.options.duration,t):t()}})}(UIkit),function(n){"use strict";n.component("buttonRadio",{defaults:{target:".uk-button"},boot:function(){n.$html.on("click.buttonradio.uikit","[data-uk-button-radio]",function(t){var i=n.$(this),u,r;i.data("buttonRadio")||(u=n.buttonRadio(i,n.Utils.options(i.attr("data-uk-button-radio"))),r=n.$(t.target),r.is(u.options.target)&&r.trigger("click"))})},init:function(){var t=this;this.find(t.options.target).attr("aria-checked","false").filter(".uk-active").attr("aria-checked","true");this.on("click",this.options.target,function(i){var r=n.$(this);r.is('a[href="#"]')&&i.preventDefault();t.find(t.options.target).not(r).removeClass("uk-active").blur();r.addClass("uk-active");t.find(t.options.target).not(r).attr("aria-checked","false");r.attr("aria-checked","true");t.trigger("change.uk.button",[r])})},getSelected:function(){return this.find(".uk-active")}});n.component("buttonCheckbox",{defaults:{target:".uk-button"},boot:function(){n.$html.on("click.buttoncheckbox.uikit","[data-uk-button-checkbox]",function(t){var i=n.$(this),u,r;i.data("buttonCheckbox")||(u=n.buttonCheckbox(i,n.Utils.options(i.attr("data-uk-button-checkbox"))),r=n.$(t.target),r.is(u.options.target)&&r.trigger("click"))})},init:function(){var t=this;this.find(t.options.target).attr("aria-checked","false").filter(".uk-active").attr("aria-checked","true");this.on("click",this.options.target,function(i){var r=n.$(this);r.is('a[href="#"]')&&i.preventDefault();r.toggleClass("uk-active").blur();r.attr("aria-checked",r.hasClass("uk-active"));t.trigger("change.uk.button",[r])})},getSelected:function(){return this.find(".uk-active")}});n.component("button",{defaults:{},boot:function(){n.$html.on("click.button.uikit","[data-uk-button]",function(){var t=n.$(this),i;t.data("button")||(i=n.button(t,n.Utils.options(t.attr("data-uk-button"))),t.trigger("click"))})},init:function(){var n=this;this.element.attr("aria-pressed",this.element.hasClass("uk-active"));this.on("click",function(t){n.element.is('a[href="#"]')&&t.preventDefault();n.toggle();n.trigger("change.uk.button",[n.element.blur().hasClass("uk-active")])})},toggle:function(){this.element.toggleClass("uk-active");this.element.attr("aria-pressed",this.element.hasClass("uk-active"))}})}(UIkit),function(n){"use strict";var t=!1,i;n.component("dropdown",{defaults:{mode:"hover",remaintime:800,justify:!1,boundary:n.$win,delay:0},remainIdle:!1,boot:function(){var t=n.support.touch?"click":"mouseenter";n.$html.on(t+".dropdown.uikit","[data-uk-dropdown]",function(i){var u=n.$(this),r;u.data("dropdown")||(r=n.dropdown(u,n.Utils.options(u.attr("data-uk-dropdown"))),(t=="click"||t=="mouseenter"&&r.options.mode=="hover")&&r.element.trigger(t),r.element.find(".uk-dropdown").length&&i.preventDefault())})},init:function(){var t=this;if(this.dropdown=this.find(".uk-dropdown"),this.centered=this.dropdown.hasClass("uk-dropdown-center"),this.justified=this.options.justify?n.$(this.options.justify):!1,this.boundary=n.$(this.options.boundary),this.flipped=this.dropdown.hasClass("uk-dropdown-flip"),this.boundary.length||(this.boundary=n.$win),this.element.attr("aria-haspopup","true"),this.element.attr("aria-expanded",this.element.hasClass("uk-open")),this.options.mode=="click"||n.support.touch)this.on("click.uikit.dropdown",function(i){var r=n.$(i.target);r.parents(".uk-dropdown").length||((r.is("a[href='#']")||r.parent().is("a[href='#']")||t.dropdown.length&&!t.dropdown.is(":visible"))&&i.preventDefault(),r.blur());t.element.hasClass("uk-open")?(r.is("a:not(.js-uk-prevent)")||r.is(".uk-dropdown-close")||!t.dropdown.find(i.target).length)&&t.hide():t.show()});else this.on("mouseenter",function(){t.remainIdle&&clearTimeout(t.remainIdle);i&&clearTimeout(i);i=setTimeout(t.show.bind(t),t.options.delay)}).on("mouseleave",function(){i&&clearTimeout(i);t.remainIdle=setTimeout(function(){t.hide()},t.options.remaintime)}).on("click",function(i){var r=n.$(i.target);t.remainIdle&&clearTimeout(t.remainIdle);(r.is("a[href='#']")||r.parent().is("a[href='#']"))&&i.preventDefault();t.show()})},show:function(){n.$html.off("click.outer.dropdown");t&&t[0]!=this.element[0]&&(t.removeClass("uk-open"),t.attr("aria-expanded","false"));i&&clearTimeout(i);this.checkDimensions();this.element.addClass("uk-open");this.element.attr("aria-expanded","true");this.trigger("show.uk.dropdown",[this]);n.Utils.checkDisplay(this.dropdown,!0);t=this.element;this.registerOuterClick()},hide:function(){this.element.removeClass("uk-open");this.remainIdle=!1;this.element.attr("aria-expanded","false");t&&t[0]==this.element[0]&&(t=!1)},registerOuterClick:function(){var r=this;n.$html.off("click.outer.dropdown");setTimeout(function(){n.$html.on("click.outer.dropdown",function(u){i&&clearTimeout(i);var f=n.$(u.target);t&&t[0]==r.element[0]&&(f.is("a:not(.js-uk-prevent)")||f.is(".uk-dropdown-close")||!r.dropdown.find(u.target).length)&&(r.hide(),n.$html.off("click.outer.dropdown"))})},10)},checkDimensions:function(){var e,o,s;if(this.dropdown.length){this.justified&&this.justified.length&&this.dropdown.css("min-width","");var h=this,t=this.dropdown.css("margin-"+n.langdirection,""),i=t.show().offset(),f=t.outerWidth(),r=this.boundary.width(),u=this.boundary.offset()?this.boundary.offset().left:0;this.centered&&(t.css("margin-"+n.langdirection,(parseFloat(f)/2-t.parent().width()/2)*-1),i=t.offset(),(f+i.left>r||i.left<0)&&(t.css("margin-"+n.langdirection,""),i=t.offset()));this.justified&&this.justified.length&&(e=this.justified.outerWidth(),t.css("min-width",e),n.langdirection=="right"?(o=r-(this.justified.offset().left+e),s=r-(t.offset().left+t.outerWidth()),t.css("margin-right",o-s)):t.css("margin-left",this.justified.offset().left-i.left),i=t.offset());f+(i.left-u)>r&&(t.addClass("uk-dropdown-flip"),i=t.offset());i.left-u<0&&(t.addClass("uk-dropdown-stack"),t.hasClass("uk-dropdown-flip")&&(this.flipped||(t.removeClass("uk-dropdown-flip"),i=t.offset(),t.addClass("uk-dropdown-flip")),setTimeout(function(){(t.offset().left-u<0||!h.flipped&&t.outerWidth()+(i.left-u)<r)&&t.removeClass("uk-dropdown-flip")},0)),this.trigger("stack.uk.dropdown",[this]));t.css("display","")}}})}(UIkit),function(n){"use strict";var t=[];n.component("gridMatchHeight",{defaults:{target:!1,row:!0},boot:function(){n.ready(function(t){n.$("[data-uk-grid-match]",t).each(function(){var t=n.$(this),i;t.data("gridMatchHeight")||(i=n.gridMatchHeight(t,n.Utils.options(t.attr("data-uk-grid-match"))))})})},init:function(){var i=this;if(this.columns=this.element.children(),this.elements=this.options.target?this.find(this.options.target):this.columns,this.columns.length){n.$win.on("load resize orientationchange",function(){var t=function(){i.match()};return n.$(function(){t()}),n.Utils.debounce(t,50)}());n.$html.on("changed.uk.dom",function(){i.columns=i.element.children();i.elements=i.options.target?i.find(i.options.target):i.columns;i.match()});this.on("display.uk.check",function(){this.element.is(":visible")&&this.match()}.bind(this));t.push(this)}},match:function(){var t=this.columns.filter(":visible:first"),i;if(t.length)return i=Math.ceil(100*parseFloat(t.css("width"))/parseFloat(t.parent().css("width")))>=100,i?this.revert():n.Utils.matchHeights(this.elements,this.options),this},revert:function(){return this.elements.css("min-height",""),this}});n.component("gridMargin",{defaults:{cls:"uk-grid-margin"},boot:function(){n.ready(function(t){n.$("[data-uk-grid-margin]",t).each(function(){var t=n.$(this),i;t.data("gridMargin")||(i=n.gridMargin(t,n.Utils.options(t.attr("data-uk-grid-margin"))))})})},init:function(){var t=n.stackMargin(this.element,this.options)}});n.Utils.matchHeights=function(t,i){t=n.$(t).css("min-height","");i=n.$.extend({row:!0},i);var r=function(t){if(!(t.length<2)){var i=0;t.each(function(){i=Math.max(i,n.$(this).outerHeight())}).each(function(){var t=n.$(this),r=i-(t.outerHeight()-t.height());t.css("min-height",r+"px")})}};i.row?(t.first().width(),setTimeout(function(){var u=!1,i=[];t.each(function(){var t=n.$(this),f=t.offset().top;f!=u&&i.length&&(r(n.$(i)),i=[],f=t.offset().top);i.push(t);u=f});i.length&&r(n.$(i))},0)):r(t)}}(UIkit),function(n){"use strict";function u(t,i){if(i)return typeof t=="object"?(t=t instanceof jQuery?t:n.$(t),t.parent().length&&(i.persist=t,i.persist.data("modalPersistParent",t.parent()))):t=typeof t=="string"||typeof t=="number"?n.$("<div><\/div>").html(t):n.$("<div><\/div>").html("UIkit.modal Error: Unsupported data type: "+typeof t),t.appendTo(i.element.find(".uk-modal-dialog")),i}var t=!1,r=n.$html,i;n.component("modal",{defaults:{keyboard:!0,bgclose:!0,minScrollHeight:150,center:!1},scrollable:!1,transition:!1,init:function(){i||(i=n.$("body"));var t=this;this.transition=n.support.transition;this.paddingdir="padding-"+(n.langdirection=="left"?"right":"left");this.dialog=this.find(".uk-modal-dialog");this.element.attr("aria-hidden",this.element.hasClass("uk-open"));this.on("click",".uk-modal-close",function(n){n.preventDefault();t.hide()}).on("click",function(i){var r=n.$(i.target);r[0]==t.element[0]&&t.options.bgclose&&t.hide()})},toggle:function(){return this[this.isActive()?"hide":"show"]()},show:function(){var i=this;if(!this.isActive())return t&&t.hide(!0),this.element.removeClass("uk-open").show(),this.resize(),t=this,r.addClass("uk-modal-page").height(),this.element.addClass("uk-open"),this.element.attr("aria-hidden","false"),this.element.trigger("show.uk.modal"),n.Utils.checkDisplay(this.dialog,!0),this},hide:function(t){if(this.isActive()){if(!t&&n.support.transition){var i=this;this.one(n.support.transition.end,function(){i._hide()}).removeClass("uk-open")}else this._hide();return this}},resize:function(){var r=i.width(),n,t;this.scrollbarwidth=window.innerWidth-r;i.css(this.paddingdir,this.scrollbarwidth);this.element.css("overflow-y",this.scrollbarwidth?"scroll":"auto");!this.updateScrollable()&&this.options.center&&(n=this.dialog.outerHeight(),t=parseInt(this.dialog.css("margin-top"),10)+parseInt(this.dialog.css("margin-bottom"),10),n+t<window.innerHeight?this.dialog.css({top:window.innerHeight/2-n/2-t}):this.dialog.css({top:""}))},updateScrollable:function(){var n=this.dialog.find(".uk-overflow-container:visible:first");if(n.length){n.css("height",0);var t=Math.abs(parseInt(this.dialog.css("margin-top"),10)),r=this.dialog.outerHeight(),u=window.innerHeight,i=u-2*(t<20?20:t)-r;return n.css("height",i<this.options.minScrollHeight?"":i),!0}return!1},_hide:function(){this.element.hide().removeClass("uk-open");this.element.attr("aria-hidden","true");r.removeClass("uk-modal-page");i.css(this.paddingdir,"");t===this&&(t=!1);this.trigger("hide.uk.modal")},isActive:function(){return t==this}});n.component("modalTrigger",{boot:function(){n.$html.on("click.modal.uikit","[data-uk-modal]",function(t){var i=n.$(this),r;i.is("a")&&t.preventDefault();i.data("modalTrigger")||(r=n.modalTrigger(i,n.Utils.options(i.attr("data-uk-modal"))),r.show())});n.$html.on("keydown.modal.uikit",function(n){t&&n.keyCode===27&&t.options.keyboard&&(n.preventDefault(),t.hide())});n.$win.on("resize orientationchange",n.Utils.debounce(function(){t&&t.resize()},150))},init:function(){var t=this;this.options=n.$.extend({target:t.element.is("a")?t.element.attr("href"):!1},this.options);this.modal=n.modal(this.options.target,this.options);this.on("click",function(n){n.preventDefault();t.show()});this.proxy(this.modal,"show hide isActive")}});n.modal.dialog=function(t,i){var r=n.modal(n.$(n.modal.dialog.template).appendTo("body"),i);r.on("hide.uk.modal",function(){r.persist&&(r.persist.appendTo(r.persist.data("modalPersistParent")),r.persist=!1);r.element.remove()});return u(t,r),r};n.modal.dialog.template='<div class="uk-modal"><div class="uk-modal-dialog" style="min-height:0;"><\/div><\/div>';n.modal.alert=function(t,i){n.modal.dialog(['<div class="uk-margin uk-modal-content">'+String(t)+"<\/div>",'<div class="uk-modal-footer uk-text-right"><button class="uk-button uk-button-primary uk-modal-close">Ok<\/button><\/div>'].join(""),n.$.extend({bgclose:!1,keyboard:!1},i)).show()};n.modal.confirm=function(t,i,r){i=n.$.isFunction(i)?i:function(){};var u=n.modal.dialog(['<div class="uk-margin uk-modal-content">'+String(t)+"<\/div>",'<div class="uk-modal-footer uk-text-right"><button class="uk-button uk-button-primary js-modal-confirm">Ok<\/button> <button class="uk-button uk-modal-close">Cancel<\/button><\/div>'].join(""),n.$.extend({bgclose:!1,keyboard:!1},r));u.element.find(".js-modal-confirm").on("click",function(){i();u.hide()});u.show()}}(UIkit),function(n){"use strict";function t(t){var i=n.$(t),r="auto",u;return i.is(":visible")?r=i.outerHeight():(u={position:i.css("position"),visibility:i.css("visibility"),display:i.css("display")},r=i.css({position:"absolute",visibility:"hidden",display:"block"}).outerHeight(),i.css(u)),r}n.component("nav",{defaults:{toggle:">li.uk-parent > a[href='#']",lists:">li.uk-parent > ul",multiple:!1},boot:function(){n.ready(function(t){n.$("[data-uk-nav]",t).each(function(){var t=n.$(this),i;t.data("nav")||(i=n.nav(t,n.Utils.options(t.attr("data-uk-nav"))))})})},init:function(){var t=this;this.on("click.uikit.nav",this.options.toggle,function(i){i.preventDefault();var r=n.$(this);t.open(r.parent()[0]==t.element[0]?r:r.parent("li"))});this.find(this.options.lists).each(function(){var r=n.$(this),i=r.parent(),u=i.hasClass("uk-active");r.wrap('<div style="overflow:hidden;height:0;position:relative;"><\/div>');i.data("list-container",r.parent());i.attr("aria-expanded",i.hasClass("uk-open"));u&&t.open(i,!0)})},open:function(i,r){var f=this,e=this.element,u=n.$(i);this.options.multiple||e.children(".uk-open").not(i).each(function(){var t=n.$(this);t.data("list-container")&&t.data("list-container").stop().animate({height:0},function(){n.$(this).parent().removeClass("uk-open")})});u.toggleClass("uk-open");u.attr("aria-expanded",u.hasClass("uk-open"));u.data("list-container")&&(r?(u.data("list-container").stop().height(u.hasClass("uk-open")?"auto":0),this.trigger("display.uk.check")):u.data("list-container").stop().animate({height:u.hasClass("uk-open")?t(u.data("list-container").find("ul:first")):0},function(){f.trigger("display.uk.check")}))}})}(UIkit),function(n){"use strict";var i={x:window.scrollX,y:window.scrollY},f=n.$win,u=n.$doc,r=n.$html,t={show:function(t){if(t=n.$(t),t.length){var o=n.$("body"),f=t.find(".uk-offcanvas-bar:first"),e=n.langdirection=="right",s=f.hasClass("uk-offcanvas-bar-flip")?-1:1,h=s*(e?-1:1);i={x:window.pageXOffset,y:window.pageYOffset};t.addClass("uk-active");o.css({width:window.innerWidth,height:window.innerHeight}).addClass("uk-offcanvas-page");o.css(e?"margin-right":"margin-left",(e?-1:1)*f.outerWidth()*h).width();r.css("margin-top",i.y*-1);f.addClass("uk-offcanvas-bar-show");this._initElement(t);u.trigger("show.uk.offcanvas",[t,f]);t.attr("aria-hidden","false")}},hide:function(t){var e=n.$("body"),u=n.$(".uk-offcanvas.uk-active"),s=n.langdirection=="right",f=u.find(".uk-offcanvas-bar:first"),o=function(){e.removeClass("uk-offcanvas-page").css({width:"",height:"","margin-left":"","margin-right":""});u.removeClass("uk-active");f.removeClass("uk-offcanvas-bar-show");r.css("margin-top","");window.scrollTo(i.x,i.y);n.$doc.trigger("hide.uk.offcanvas",[u,f]);u.attr("aria-hidden","true")};u.length&&(n.support.transition&&!t?(e.one(n.support.transition.end,function(){o()}).css(s?"margin-right":"margin-left",""),setTimeout(function(){f.removeClass("uk-offcanvas-bar-show")},0)):o())},_initElement:function(i){if(!i.data("OffcanvasInit")){i.on("click.uk.offcanvas swipeRight.uk.offcanvas swipeLeft.uk.offcanvas",function(i){var r=n.$(i.target);if(!i.type.match(/swipe/)&&!r.hasClass("uk-offcanvas-close")){if(r.hasClass("uk-offcanvas-bar"))return;if(r.parents(".uk-offcanvas-bar:first").length)return}i.stopImmediatePropagation();t.hide()});i.on("click","a[href^='#']",function(){var r=n.$(this),i=r.attr("href");if(i!="#"){n.$doc.one("hide.uk.offcanvas",function(){var t=n.$(i);t.length||(t=n.$('[name="'+i.replace("#","")+'"]'));n.Utils.scrollToElement&&t.length?n.Utils.scrollToElement(t):window.location.href=i});t.hide()}});i.data("OffcanvasInit",!0)}}};n.component("offcanvasTrigger",{boot:function(){r.on("click.offcanvas.uikit","[data-uk-offcanvas]",function(t){var i,r;t.preventDefault();i=n.$(this);i.data("offcanvasTrigger")||(r=n.offcanvasTrigger(i,n.Utils.options(i.attr("data-uk-offcanvas"))),i.trigger("click"))});r.on("keydown.uk.offcanvas",function(n){n.keyCode===27&&t.hide()})},init:function(){var i=this;this.options=n.$.extend({target:i.element.is("a")?i.element.attr("href"):!1},this.options);this.on("click",function(n){n.preventDefault();t.show(i.options.target)})}});n.offcanvas=t}(UIkit),function(n){"use strict";function t(t,i,r){var u=n.$.Deferred(),f=t,e=t,o;return r[0]===i[0]?(u.resolve(),u.promise()):(typeof t=="object"&&(f=t[0],e=t[1]||t[0]),o=function(){i&&i.hide().removeClass("uk-active "+e+" uk-animation-reverse");r.addClass(f).one(n.support.animation.end,function(){r.removeClass(""+f+"").css({opacity:"",display:""});u.resolve();i&&i.css({opacity:"",display:""})}.bind(this)).show()},r.css("animation-duration",this.options.duration+"ms"),i&&i.length?(i.css("animation-duration",this.options.duration+"ms"),i.css("display","none").addClass(e+" uk-animation-reverse").one(n.support.animation.end,function(){o()}.bind(this)).css("display","")):(r.addClass("uk-active"),o()),u.promise())}var i;n.component("switcher",{defaults:{connect:!1,toggle:">*",active:0,animation:!1,duration:200},animating:!1,boot:function(){n.ready(function(t){n.$("[data-uk-switcher]",t).each(function(){var t=n.$(this),i;t.data("switcher")||(i=n.switcher(t,n.Utils.options(t.attr("data-uk-switcher"))))})})},init:function(){var t=this,r,i;this.on("click.uikit.switcher",this.options.toggle,function(n){n.preventDefault();t.show(this)});if(this.options.connect){if(this.connect=n.$(this.options.connect),this.connect.find(".uk-active").removeClass(".uk-active"),this.connect.length){this.connect.children().attr("aria-hidden","true");this.connect.on("click","[data-uk-switcher-item]",function(i){i.preventDefault();var r=n.$(this).attr("data-uk-switcher-item");if(t.index!=r)switch(r){case"next":case"previous":t.show(t.index+(r=="next"?1:-1));break;default:t.show(parseInt(r,10))}}).on("swipeRight swipeLeft",function(n){n.preventDefault();t.show(t.index+(n.type=="swipeLeft"?1:-1))})}if(r=this.find(this.options.toggle),i=r.filter(".uk-active"),i.length)this.show(i,!1);else{if(this.options.active===!1)return;i=r.eq(this.options.active);this.show(i.length?i:r.eq(0),!1)}r.not(i).attr("aria-expanded","false");i.attr("aria-expanded","true");this.on("changed.uk.dom",function(){t.connect=n.$(t.options.connect)})}},show:function(r,u){var e;if(!this.animating){isNaN(r)?r=n.$(r):(e=this.find(this.options.toggle),r=r<0?e.length-1:r,r=e.eq(e[r]?r:0));var f=this,e=this.find(this.options.toggle),o=n.$(r),s=i[this.options.animation]||function(n,r){if(!f.options.animation)return i.none.apply(f);var u=f.options.animation.split(",");return u.length==1&&(u[1]=u[0]),u[0]=u[0].trim(),u[1]=u[1].trim(),t.apply(f,[u,n,r])};(u!==!1&&n.support.animation||(s=i.none),o.hasClass("uk-disabled"))||(e.attr("aria-expanded","false"),o.attr("aria-expanded","true"),e.filter(".uk-active").removeClass("uk-active"),o.addClass("uk-active"),this.options.connect&&this.connect.length&&(this.index=this.find(this.options.toggle).index(o),this.index==-1&&(this.index=0),this.connect.each(function(){var u=n.$(this),r=n.$(u.children()),i=n.$(r.filter(".uk-active")),t=n.$(r.eq(f.index));f.animating=!0;s.apply(f,[i,t]).then(function(){i.removeClass("uk-active");t.addClass("uk-active");i.attr("aria-hidden","true");t.attr("aria-hidden","false");n.Utils.checkDisplay(t,!0);f.animating=!1})})),this.trigger("show.uk.switcher",[o]))}}});i={none:function(){var t=n.$.Deferred();return t.resolve(),t.promise()},fade:function(n,i){return t.apply(this,["uk-animation-fade",n,i])},"slide-bottom":function(n,i){return t.apply(this,["uk-animation-slide-bottom",n,i])},"slide-top":function(n,i){return t.apply(this,["uk-animation-slide-top",n,i])},"slide-vertical":function(n,i){var r=["uk-animation-slide-top","uk-animation-slide-bottom"];return n&&n.index()>i.index()&&r.reverse(),t.apply(this,[r,n,i])},"slide-left":function(n,i){return t.apply(this,["uk-animation-slide-left",n,i])},"slide-right":function(n,i){return t.apply(this,["uk-animation-slide-right",n,i])},"slide-horizontal":function(n,i){var r=["uk-animation-slide-right","uk-animation-slide-left"];return n&&n.index()>i.index()&&r.reverse(),t.apply(this,[r,n,i])},scale:function(n,i){return t.apply(this,["uk-animation-scale-up",n,i])}};n.switcher.animations=i}(UIkit),function(n){"use strict";n.component("tab",{defaults:{target:">li:not(.uk-tab-responsive, .uk-disabled)",connect:!1,active:0,animation:!1,duration:200},boot:function(){n.ready(function(t){n.$("[data-uk-tab]",t).each(function(){var t=n.$(this),i;t.data("tab")||(i=n.tab(t,n.Utils.options(t.attr("data-uk-tab"))))})})},init:function(){var t=this;this.on("click.uikit.tab",this.options.target,function(i){if(i.preventDefault(),!t.switcher||!t.switcher.animating){var r=t.find(t.options.target).not(this);r.removeClass("uk-active").blur();t.trigger("change.uk.tab",[n.$(this).addClass("uk-active")]);t.options.connect||(r.attr("aria-expanded","false"),n.$(this).attr("aria-expanded","true"))}});this.options.connect&&(this.connect=n.$(this.options.connect));this.responsivetab=n.$('<li class="uk-tab-responsive uk-active"><a><\/a><\/li>').append('<div class="uk-dropdown uk-dropdown-small"><ul class="uk-nav uk-nav-dropdown"><\/ul><div>');this.responsivetab.dropdown=this.responsivetab.find(".uk-dropdown");this.responsivetab.lst=this.responsivetab.dropdown.find("ul");this.responsivetab.caption=this.responsivetab.find("a:first");this.element.hasClass("uk-tab-bottom")&&this.responsivetab.dropdown.addClass("uk-dropdown-up");this.responsivetab.lst.on("click.uikit.tab","a",function(i){i.preventDefault();i.stopPropagation();var r=n.$(this);t.element.children(":not(.uk-tab-responsive)").eq(r.data("index")).trigger("click")});this.on("show.uk.switcher change.uk.tab",function(n,i){t.responsivetab.caption.html(i.text())});this.element.append(this.responsivetab);this.options.connect&&(this.switcher=n.switcher(this.element,{toggle:">li:not(.uk-tab-responsive)",connect:this.options.connect,active:this.options.active,animation:this.options.animation,duration:this.options.duration}));n.dropdown(this.responsivetab,{mode:"click"});t.trigger("change.uk.tab",[this.element.find(this.options.target).filter(".uk-active")]);this.check();n.$win.on("resize orientationchange",n.Utils.debounce(function(){t.element.is(":visible")&&t.check()},100));this.on("display.uk.check",function(){t.element.is(":visible")&&t.check()})},check:function(){var t=this.element.children(":not(.uk-tab-responsive)").removeClass("uk-hidden"),e,u,i,f,r;if(t.length){if(e=t.eq(0).offset().top+Math.ceil(t.eq(0).height()/2),u=!1,this.responsivetab.lst.empty(),t.each(function(){n.$(this).offset().top>e&&(u=!0)}),u)for(r=0;r<t.length;r++)i=n.$(t.eq(r)),f=i.find("a"),i.css("float")=="none"||i.attr("uk-dropdown")||(i.addClass("uk-hidden"),i.hasClass("uk-disabled")||this.responsivetab.lst.append('<li><a href="'+f.attr("href")+'" data-index="'+r+'">'+f.html()+"<\/a><\/li>"));this.responsivetab[this.responsivetab.lst.children().length?"removeClass":"addClass"]("uk-hidden")}}})}(UIkit),function(n){"use strict";n.component("cover",{defaults:{automute:!0},boot:function(){n.ready(function(t){n.$("[data-uk-cover]",t).each(function(){var t=n.$(this),i;t.data("cover")||(i=n.cover(t,n.Utils.options(t.attr("data-uk-cover"))))})})},init:function(){this.parent=this.element.parent();n.$win.on("load resize orientationchange",n.Utils.debounce(function(){this.check()}.bind(this),100));this.on("display.uk.check",function(){this.element.is(":visible")&&this.check()}.bind(this));if(this.check(),this.element.is("iframe")&&this.options.automute){var t=this.element.attr("src");this.element.attr("src","").on("load",function(){this.contentWindow.postMessage('{ "event": "command", "func": "mute", "method":"setVolume", "value":0}',"*")}).attr("src",[t,t.indexOf("?")>-1?"&":"?","enablejsapi=1&api=1"].join(""))}},check:function(){this.element.css({width:"",height:""});this.dimension={w:this.element.width(),h:this.element.height()};this.element.attr("width")&&!isNaN(this.element.attr("width"))&&(this.dimension.w=this.element.attr("width"));this.element.attr("height")&&!isNaN(this.element.attr("height"))&&(this.dimension.h=this.element.attr("height"));this.ratio=this.dimension.w/this.dimension.h;var n=this.parent.width(),t=this.parent.height(),i,r;n/this.ratio<t?(i=Math.ceil(t*this.ratio),r=t):(i=n,r=Math.ceil(n/this.ratio));this.element.css({width:i,height:r})}})}(UIkit);
/*!
 @package noty - jQuery Notification Plugin
 @version version: 2.2.5
 @contributors https://github.com/needim/noty/graphs/contributors
 @documentation Examples and Documentation - http://needim.github.com/noty/
 @license Licensed under the MIT licenses: http://www.opensource.org/licenses/mit-license.php
 */
typeof Object.create!="function"&&(Object.create=function(n){function t(){}return t.prototype=n,new t}),function(n){var i={init:function(t){return this.options=n.extend({},n.noty.defaults,t),this.options.layout=this.options.custom?n.noty.layouts.inline:n.noty.layouts[this.options.layout],n.noty.themes[this.options.theme]?this.options.theme=n.noty.themes[this.options.theme]:t.themeClassName=this.options.theme,delete t.layout,delete t.theme,this.options=n.extend({},this.options,this.options.layout.options),this.options.id="noty_"+(new Date).getTime()*Math.floor(Math.random()*1e6),this.options=n.extend({},this.options,t),this._build(),this},_build:function(){var t=n('<div class="noty_bar noty_type_'+this.options.type+'"><\/div>').attr("id",this.options.id),i,r;t.append(this.options.template).find(".noty_text").html(this.options.text);this.$bar=this.options.layout.parent.object!==null?n(this.options.layout.parent.object).css(this.options.layout.parent.css).append(t):t;this.options.themeClassName&&this.$bar.addClass(this.options.themeClassName).addClass("noty_container_type_"+this.options.type);this.options.buttons&&(this.options.closeWith=[],this.options.timeout=!1,i=n("<div/>").addClass("noty_buttons"),this.options.layout.parent.object!==null?this.$bar.find(".noty_bar").append(i):this.$bar.append(i),r=this,n.each(this.options.buttons,function(t,i){var u=n("<button/>").addClass(i.addClass?i.addClass:"gray").html(i.text).attr("id",i.id?i.id:"button-"+t).appendTo(r.$bar.find(".noty_buttons")).on("click",function(){n.isFunction(i.onClick)&&i.onClick.call(u,r)})}));this.$message=this.$bar.find(".noty_message");this.$closeButton=this.$bar.find(".noty_close");this.$buttons=this.$bar.find(".noty_buttons");n.noty.store[this.options.id]=this},show:function(){var t=this;if(t.options.custom?t.options.custom.find(t.options.layout.container.selector).append(t.$bar):n(t.options.layout.container.selector).append(t.$bar),t.options.theme&&t.options.theme.style&&t.options.theme.style.apply(t),n.type(t.options.layout.css)==="function"?this.options.layout.css.apply(t.$bar):t.$bar.css(this.options.layout.css||{}),t.$bar.addClass(t.options.layout.addClass),t.options.layout.container.style.apply(n(t.options.layout.container.selector)),t.showing=!0,t.options.theme&&t.options.theme.style&&t.options.theme.callback.onShow.apply(this),n.inArray("click",t.options.closeWith)>-1)t.$bar.css("cursor","pointer").one("click",function(n){t.stopPropagation(n);t.options.callback.onCloseClick&&t.options.callback.onCloseClick.apply(t);t.close()});if(n.inArray("hover",t.options.closeWith)>-1)t.$bar.one("mouseenter",function(){t.close()});if(n.inArray("button",t.options.closeWith)>-1)t.$closeButton.one("click",function(n){t.stopPropagation(n);t.close()});return n.inArray("button",t.options.closeWith)==-1&&t.$closeButton.remove(),t.options.callback.onShow&&t.options.callback.onShow.apply(t),t.$bar.animate(t.options.animation.open,t.options.animation.speed,t.options.animation.easing,function(){t.options.callback.afterShow&&t.options.callback.afterShow.apply(t);t.showing=!1;t.shown=!0}),t.options.timeout&&t.$bar.delay(t.options.timeout).promise().done(function(){t.close()}),this},close:function(){var t,i;if(!this.closed&&(!this.$bar||!this.$bar.hasClass("i-am-closing-now"))){if(t=this,this.showing){t.$bar.queue(function(){t.close.apply(t)});return}if(!this.shown&&!this.showing){i=[];n.each(n.noty.queue,function(n,r){r.options.id!=t.options.id&&i.push(r)});n.noty.queue=i;return}t.$bar.addClass("i-am-closing-now");t.options.callback.onClose&&t.options.callback.onClose.apply(t);t.$bar.clearQueue().stop().animate(t.options.animation.close,t.options.animation.speed,t.options.animation.easing,function(){t.options.callback.afterClose&&t.options.callback.afterClose.apply(t)}).promise().done(function(){t.options.modal&&(n.notyRenderer.setModalCount(-1),n.notyRenderer.getModalCount()==0&&n(".noty_modal").fadeOut("fast",function(){n(this).remove()}));n.notyRenderer.setLayoutCountFor(t,-1);n.notyRenderer.getLayoutCountFor(t)==0&&n(t.options.layout.container.selector).remove();typeof t.$bar!="undefined"&&t.$bar!==null&&(t.$bar.remove(),t.$bar=null,t.closed=!0);delete n.noty.store[t.options.id];t.options.theme.callback&&t.options.theme.callback.onClose&&t.options.theme.callback.onClose.apply(t);t.options.dismissQueue||(n.noty.ontap=!0,n.notyRenderer.render());t.options.maxVisible>0&&t.options.dismissQueue&&n.notyRenderer.render()})}},setText:function(n){return this.closed||(this.options.text=n,this.$bar.find(".noty_text").html(n)),this},setType:function(n){return this.closed||(this.options.type=n,this.options.theme.style.apply(this),this.options.theme.callback.onShow.apply(this)),this},setTimeout:function(n){if(!this.closed){var t=this;this.options.timeout=n;t.$bar.delay(t.options.timeout).promise().done(function(){t.close()})}return this},stopPropagation:function(n){n=n||window.event;typeof n.stopPropagation!="undefined"?n.stopPropagation():n.cancelBubble=!0},closed:!1,showing:!1,shown:!1},t;n.notyRenderer={};n.notyRenderer.init=function(t){var r=Object.create(i).init(t);return r.options.killer&&n.noty.closeAll(),r.options.force?n.noty.queue.unshift(r):n.noty.queue.push(r),n.notyRenderer.render(),n.noty.returns=="object"?r:r.options.id};n.notyRenderer.render=function(){var t=n.noty.queue[0];n.type(t)==="object"?t.options.dismissQueue?t.options.maxVisible>0?n(t.options.layout.container.selector+" li").length<t.options.maxVisible&&n.notyRenderer.show(n.noty.queue.shift()):n.notyRenderer.show(n.noty.queue.shift()):n.noty.ontap&&(n.notyRenderer.show(n.noty.queue.shift()),n.noty.ontap=!1):n.noty.ontap=!0};n.notyRenderer.show=function(t){t.options.modal&&(n.notyRenderer.createModalFor(t),n.notyRenderer.setModalCount(1));t.options.custom?t.options.custom.find(t.options.layout.container.selector).length==0?t.options.custom.append(n(t.options.layout.container.object).addClass("i-am-new")):t.options.custom.find(t.options.layout.container.selector).removeClass("i-am-new"):n(t.options.layout.container.selector).length==0?n("body").append(n(t.options.layout.container.object).addClass("i-am-new")):n(t.options.layout.container.selector).removeClass("i-am-new");n.notyRenderer.setLayoutCountFor(t,1);t.show()};n.notyRenderer.createModalFor=function(t){if(n(".noty_modal").length==0){var i=n("<div/>").addClass("noty_modal").addClass(t.options.theme).data("noty_modal_count",0);t.options.theme.modal&&t.options.theme.modal.css&&i.css(t.options.theme.modal.css);i.prependTo(n("body")).fadeIn("fast")}};n.notyRenderer.getLayoutCountFor=function(t){return n(t.options.layout.container.selector).data("noty_layout_count")||0};n.notyRenderer.setLayoutCountFor=function(t,i){return n(t.options.layout.container.selector).data("noty_layout_count",n.notyRenderer.getLayoutCountFor(t)+i)};n.notyRenderer.getModalCount=function(){return n(".noty_modal").data("noty_modal_count")||0};n.notyRenderer.setModalCount=function(t){return n(".noty_modal").data("noty_modal_count",n.notyRenderer.getModalCount()+t)};n.fn.noty=function(t){return t.custom=n(this),n.notyRenderer.init(t)};n.noty={};n.noty.queue=[];n.noty.ontap=!0;n.noty.layouts={};n.noty.themes={};n.noty.returns="object";n.noty.store={};n.noty.get=function(t){return n.noty.store.hasOwnProperty(t)?n.noty.store[t]:!1};n.noty.close=function(t){return n.noty.get(t)?n.noty.get(t).close():!1};n.noty.setText=function(t,i){return n.noty.get(t)?n.noty.get(t).setText(i):!1};n.noty.setType=function(t,i){return n.noty.get(t)?n.noty.get(t).setType(i):!1};n.noty.clearQueue=function(){n.noty.queue=[]};n.noty.closeAll=function(){n.noty.clearQueue();n.each(n.noty.store,function(n,t){t.close()})};t=window.alert;n.noty.consumeAlert=function(t){window.alert=function(i){t?t.text=i:t={text:i};n.notyRenderer.init(t)}};n.noty.stopConsumeAlert=function(){window.alert=t};n.noty.defaults={layout:"top",theme:"defaultTheme",type:"alert",text:"",dismissQueue:!0,template:'<div class="noty_message"><span class="noty_text"><\/span><div class="noty_close"><\/div><\/div>',animation:{open:{height:"toggle"},close:{height:"toggle"},easing:"swing",speed:500},timeout:!1,force:!1,modal:!1,maxVisible:5,killer:!1,closeWith:["click"],callback:{onShow:function(){},afterShow:function(){},onClose:function(){},afterClose:function(){},onCloseClick:function(){}},buttons:!1};n(window).on("resize",function(){n.each(n.noty.layouts,function(t,i){i.container.style.apply(n(i.container.selector))})})}(jQuery);window.noty=function(n){return jQuery.notyRenderer.init(n)},function(n){n.noty.layouts.bottom={name:"bottom",options:{},container:{object:'<ul id="noty_bottom_layout_container" />',selector:"ul#noty_bottom_layout_container",style:function(){n(this).css({bottom:0,left:"5%",position:"fixed",width:"90%",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:9999999})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none"},addClass:""}}(jQuery),function(n){n.noty.layouts.bottomCenter={name:"bottomCenter",options:{},container:{object:'<ul id="noty_bottomCenter_layout_container" />',selector:"ul#noty_bottomCenter_layout_container",style:function(){n(this).css({bottom:20,left:0,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});n(this).css({left:(n(window).width()-n(this).outerWidth(!1))/2+"px"})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(n){n.noty.layouts.bottomLeft={name:"bottomLeft",options:{},container:{object:'<ul id="noty_bottomLeft_layout_container" />',selector:"ul#noty_bottomLeft_layout_container",style:function(){n(this).css({bottom:20,left:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});window.innerWidth<600&&n(this).css({left:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(n){n.noty.layouts.bottomRight={name:"bottomRight",options:{},container:{object:'<ul id="noty_bottomRight_layout_container" />',selector:"ul#noty_bottomRight_layout_container",style:function(){n(this).css({bottom:20,right:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});window.innerWidth<600&&n(this).css({right:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(n){n.noty.layouts.center={name:"center",options:{},container:{object:'<ul id="noty_center_layout_container" />',selector:"ul#noty_center_layout_container",style:function(){var t,i;n(this).css({position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});t=n(this).clone().css({visibility:"hidden",display:"block",position:"absolute",top:0,left:0}).attr("id","dupe");n("body").append(t);t.find(".i-am-closing-now").remove();t.find("li").css("display","block");i=t.height();t.remove();n(this).hasClass("i-am-new")?n(this).css({left:(n(window).width()-n(this).outerWidth(!1))/2+"px",top:(n(window).height()-i)/2+"px"}):n(this).animate({left:(n(window).width()-n(this).outerWidth(!1))/2+"px",top:(n(window).height()-i)/2+"px"},500)}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(n){n.noty.layouts.centerLeft={name:"centerLeft",options:{},container:{object:'<ul id="noty_centerLeft_layout_container" />',selector:"ul#noty_centerLeft_layout_container",style:function(){var t,i;n(this).css({left:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});t=n(this).clone().css({visibility:"hidden",display:"block",position:"absolute",top:0,left:0}).attr("id","dupe");n("body").append(t);t.find(".i-am-closing-now").remove();t.find("li").css("display","block");i=t.height();t.remove();n(this).hasClass("i-am-new")?n(this).css({top:(n(window).height()-i)/2+"px"}):n(this).animate({top:(n(window).height()-i)/2+"px"},500);window.innerWidth<600&&n(this).css({left:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(n){n.noty.layouts.centerRight={name:"centerRight",options:{},container:{object:'<ul id="noty_centerRight_layout_container" />',selector:"ul#noty_centerRight_layout_container",style:function(){var t,i;n(this).css({right:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});t=n(this).clone().css({visibility:"hidden",display:"block",position:"absolute",top:0,left:0}).attr("id","dupe");n("body").append(t);t.find(".i-am-closing-now").remove();t.find("li").css("display","block");i=t.height();t.remove();n(this).hasClass("i-am-new")?n(this).css({top:(n(window).height()-i)/2+"px"}):n(this).animate({top:(n(window).height()-i)/2+"px"},500);window.innerWidth<600&&n(this).css({right:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(n){n.noty.layouts.inline={name:"inline",options:{},container:{object:'<ul class="noty_inline_layout_container" />',selector:"ul.noty_inline_layout_container",style:function(){n(this).css({width:"100%",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:9999999})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none"},addClass:""}}(jQuery),function(n){n.noty.layouts.top={name:"top",options:{},container:{object:'<ul id="noty_top_layout_container" />',selector:"ul#noty_top_layout_container",style:function(){n(this).css({top:0,left:"5%",position:"fixed",width:"90%",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:9999999})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none"},addClass:""}}(jQuery),function(n){n.noty.layouts.topCenter={name:"topCenter",options:{},container:{object:'<ul id="noty_topCenter_layout_container" />',selector:"ul#noty_topCenter_layout_container",style:function(){n(this).css({top:20,left:0,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});n(this).css({left:(n(window).width()-n(this).outerWidth(!1))/2+"px"})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(n){n.noty.layouts.topLeft={name:"topLeft",options:{},container:{object:'<ul id="noty_topLeft_layout_container" />',selector:"ul#noty_topLeft_layout_container",style:function(){n(this).css({top:20,left:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});window.innerWidth<600&&n(this).css({left:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(n){n.noty.layouts.topRight={name:"topRight",options:{},container:{object:'<ul id="noty_topRight_layout_container" />',selector:"ul#noty_topRight_layout_container",style:function(){n(this).css({top:20,right:20,position:"fixed",width:"310px",height:"auto",margin:0,padding:0,listStyleType:"none",zIndex:1e7});window.innerWidth<600&&n(this).css({right:5})}},parent:{object:"<li />",selector:"li",css:{}},css:{display:"none",width:"310px"},addClass:""}}(jQuery),function(n){n.noty.themes.defaultTheme={name:"defaultTheme",helpers:{borderFix:function(){if(this.options.dismissQueue){var t=this.options.layout.container.selector+" "+this.options.layout.parent.selector;switch(this.options.layout.name){case"top":n(t).css({borderRadius:"0px 0px 0px 0px"});n(t).last().css({borderRadius:"0px 0px 5px 5px"});break;case"topCenter":case"topLeft":case"topRight":case"bottomCenter":case"bottomLeft":case"bottomRight":case"center":case"centerLeft":case"centerRight":case"inline":n(t).css({borderRadius:"0px 0px 0px 0px"});n(t).first().css({"border-top-left-radius":"5px","border-top-right-radius":"5px"});n(t).last().css({"border-bottom-left-radius":"5px","border-bottom-right-radius":"5px"});break;case"bottom":n(t).css({borderRadius:"0px 0px 0px 0px"});n(t).first().css({borderRadius:"5px 5px 0px 0px"})}}}},modal:{css:{position:"fixed",width:"100%",height:"100%",backgroundColor:"#000",zIndex:1e4,opacity:.6,display:"none",left:0,top:0}},style:function(){this.$bar.css({overflow:"hidden",background:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABsAAAAoCAYAAAAPOoFWAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAPZJREFUeNq81tsOgjAMANB2ov7/7ypaN7IlIwi9rGuT8QSc9EIDAsAznxvY4pXPKr05RUE5MEVB+TyWfCEl9LZApYopCmo9C4FKSMtYoI8Bwv79aQJU4l6hXXCZrQbokJEksxHo9KMOgc6w1atHXM8K9DVC7FQnJ0i8iK3QooGgbnyKgMDygBWyYFZoqx4qS27KqLZJjA1D0jK6QJcYEQEiWv9PGkTsbqxQ8oT+ZtZB6AkdsJnQDnMoHXHLGKOgDYuCWmYhEERCI5gaamW0bnHdA3k2ltlIN+2qKRyCND0bhqSYCyTB3CAOc4WusBEIpkeBuPgJMAAX8Hs1NfqHRgAAAABJRU5ErkJggg==') repeat-x scroll left top #fff"});this.$message.css({fontSize:"13px",lineHeight:"16px",textAlign:"center",padding:"8px 10px 9px",width:"auto",position:"relative"});this.$closeButton.css({position:"absolute",top:4,right:4,width:10,height:10,background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAATpJREFUeNoszrFqVFEUheG19zlz7sQ7ijMQBAvfYBqbpJCoZSAQbOwEE1IHGytbLQUJ8SUktW8gCCFJMSGSNxCmFBJO7j5rpXD6n5/P5vM53H3b3T9LOiB5AQDuDjM7BnA7DMPHDGBH0nuSzwHsRcRVRNRSysuU0i6AOwA/02w2+9Fae00SEbEh6SGAR5K+k3zWWptKepCm0+kpyRoRGyRBcpPkDsn1iEBr7drdP2VJZyQXERGSPpiZAViTBACXKaV9kqd5uVzCzO5KKb/d/UZSDwD/eyxqree1VqSu6zKAF2Z2RPJJaw0rAkjOJT0m+SuT/AbgDcmnkmBmfwAsJL1dXQ8lWY6IGwB1ZbrOOb8zs8thGP4COFwx/mE8Ho9Go9ErMzvJOW/1fY/JZIJSypqZfXX3L13X9fcDAKJct1sx3OiuAAAAAElFTkSuQmCC)",display:"none",cursor:"pointer"});this.$buttons.css({padding:5,textAlign:"right",borderTop:"1px solid #ccc",backgroundColor:"#fff"});this.$buttons.find("button").css({marginLeft:5});this.$buttons.find("button:first").css({marginLeft:0});this.$bar.on({mouseenter:function(){n(this).find(".noty_close").stop().fadeTo("normal",1)},mouseleave:function(){n(this).find(".noty_close").stop().fadeTo("normal",0)}});switch(this.options.layout.name){case"top":this.$bar.css({borderRadius:"0px 0px 5px 5px",borderBottom:"2px solid #eee",borderLeft:"2px solid #eee",borderRight:"2px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"});break;case"topCenter":case"center":case"bottomCenter":case"inline":this.$bar.css({borderRadius:"5px",border:"1px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"});this.$message.css({fontSize:"13px",textAlign:"center"});break;case"topLeft":case"topRight":case"bottomLeft":case"bottomRight":case"centerLeft":case"centerRight":this.$bar.css({borderRadius:"5px",border:"1px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"});this.$message.css({fontSize:"13px",textAlign:"left"});break;case"bottom":this.$bar.css({borderRadius:"5px 5px 0px 0px",borderTop:"2px solid #eee",borderLeft:"2px solid #eee",borderRight:"2px solid #eee",boxShadow:"0 -2px 4px rgba(0, 0, 0, 0.1)"});break;default:this.$bar.css({border:"2px solid #eee",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"})}switch(this.options.type){case"alert":case"notification":this.$bar.css({backgroundColor:"#FFF",borderColor:"#CCC",color:"#444"});break;case"warning":this.$bar.css({backgroundColor:"#FFEAA8",borderColor:"#FFC237",color:"#826200"});this.$buttons.css({borderTop:"1px solid #FFC237"});break;case"error":this.$bar.css({backgroundColor:"red",borderColor:"darkred",color:"#FFF"});this.$message.css({fontWeight:"bold"});this.$buttons.css({borderTop:"1px solid darkred"});break;case"information":this.$bar.css({backgroundColor:"#57B7E2",borderColor:"#0B90C4",color:"#FFF"});this.$buttons.css({borderTop:"1px solid #0B90C4"});break;case"success":this.$bar.css({backgroundColor:"lightgreen",borderColor:"#50C24E",color:"darkgreen"});this.$buttons.css({borderTop:"1px solid #50C24E"});break;default:this.$bar.css({backgroundColor:"#FFF",borderColor:"#CCC",color:"#444"})}},callback:{onShow:function(){n.noty.themes.defaultTheme.helpers.borderFix.apply(this)},onClose:function(){n.noty.themes.defaultTheme.helpers.borderFix.apply(this)}}}}(jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype={constructor:t,options:{css:{base:"html, body",root:"#ark",actions:"#ark-actions",content:"#ark-content",editbox:"#ark-edit",stack:"[data-stack]",edit:"[data-edit]",item:'#ark-content [data-stack="%s"] [data-view="%s"] [data-select="%s"]',hide:{value:"var-hide",css:".var-hide"},block:{value:"var-block",css:".var-block"},bootstrap:{button:{value:"btn",selector:".btn"},active:{value:"active",selector:".active"},hide:{value:"hidden",selector:".hidden"},show:{value:"show ",selector:".show "}}},data:{data:"data-",id:"data-id",name:"data-name",stack:"data-stack",action:{value:"action",data:"data-action"},value:{value:"value",data:"data-value"},edit:{value:"edit",data:"data-edit"},type:{value:"type",data:"data-type"},key:{value:"key",data:"data-key"}},html:{blank:"--",dash:" - ",quote:'"%s"',date:"DD/MM/YYYY HH:mm:ss",messages:{feature:{soon:"Coming Soon!",upgrade:"Upgrade!",plugin:"Check Plugin!"}},errors:{generic:"Error!",data:"No Data!",path:"No Path!",action:"No Action!",form:"No Form!",permission:"No Access!",cancel:"Cancelled!"},ds:"/",url:"",sprintf:/%s/},namespace:".base",view:null,text:{prefix:null},escape:{global:"g",caseinsensitive:"i",fullstop:".",asterisk:"*",plus:"+",questionmark:"?",caret:"^",dollar:"$",curlybrackets:"{}",roundbrackets:"()",squarebrackets:"\\[\\]",pipe:"|",backslash:"\\/",forwardslash:"\\\\"},id:{alpha:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",numeric:"0123456789",special:"-_!#*()[]{}@:?",length:4,count:1},trim:{mask:" "},extension:{lower:!0},fields:{group:!0},find:{root:"",path:"",view:null,group:"views"},highlight:{view:null,group:"views",delay:0,select:!0,base:"",scroll:!0,offset:150,animate:600,flash:150,wigglelimit:5,wigglespeed:25,scrollbar:!1},message:{winks:{fastest:500,faster:1e3,fast:2e3,slow:5e3,slower:7e3,slowest:1e4},wink:3e3,type:"error",position:"top",queue:!0,max:3,close:["button"],tmpl:"ark-noty",buttons:null,translate:{on:!1,prefix:!0,revalue:!1}},confirmbox:{position:"center",wink:!1,type:"message",yes:{css:"btn btn-success",text:"Ok",callback:"base:confirm:yes"},no:{css:"btn",text:"Cancel",callback:"base:confirm:no"}},promptbox:{position:"center",wink:!1,type:"message",yes:{css:"btn btn-success",text:"Ok",callback:"base:prompt:yes"},no:{css:"btn",text:"Cancel",callback:"base:prompt:no"}},debug:!0,permissions:{},browser:{root:""}},el:{},initialise:function(){},root:function(){return t.prototype},set:function(t){var i=this.root().options,r=jQuery.fn.arkoptions(),u=this.options?this.options:{},f=t?t:{};return this.options=n.extend(!0,{},i,r,u,f),this.options},text:function(t,i,r){var u=r?n.extend({},this.options.text,r):this.options.text,f=u.prefix===!0?this.options.text.prefix:u.prefix,e=f?f+t:t;return Joomla.JText._(e,i||"")},escape:function(t,i){var f=i?n.extend({},this.options.escape,i):this.options.escape,r="",u="",e=["global","caseinsensitive"];return n.each(f,function(t,i){n.inArray(t,e)===-1?r+=i:u+=i}),r=new RegExp("(["+r+"])",u),t.replace(r,"\\$1")},safe:function(n){return n.replace(/[!"#$%&'()*+,.\/:;<=>?@\[\\\]^`{|}~]/g,"\\$&")},id:function(t){var i=t?n.extend({},this.options.id,t):this.options.id,r=[],u;if(i.length&&(i.alpha||i.numeric||i.special)){while(r.length<i.count)u=this._id(i.length,i.alpha,i.numeric,i.special),n.inArray(u,r)===-1&&r.push(u);return i.count>1?r:r[0]}return""},_id:function(n,t,i,r){var u=[],f,s;u.push(t);u.push(i);u.push(r);var e=u.join(""),h=e.length,o="";for(f=1;f<=n;f++)s=Math.floor(Math.random()*h),o+=e[s];return o},trim:function(t,i){var r;return(r=typeof i=="string"?{mask:i}:i?n.extend({},this.options.trim,i):this.options.trim,r.mask===" ")?n.trim(t):t.replace(new RegExp("^["+r.mask+"]+"),"").replace(new RegExp("["+r.mask+"]+$"),"")},extension:function(t,i){var f=i?n.extend({},this.options.extension,i):this.options.extension,r=t?t.split("."):[],u=r.length>1?r.pop():"";return f.lower?u.toLowerCase():u},toURL:function(n){var t="/",i;return this.options.html.ds!==t?(i=new RegExp(this.escape(this.options.html.ds),"g"),n.replace(i,t)):n},fields:function(t,i){var r={},u=i?n.extend({},this.options.fields,i):this.options.fields;return n.each(n(t).serializeArray(),function(){var n=this.name,i,t;if(u.groups===!1)for(i=n.split("["),t="";t=i.pop();)if(t!=="]"){n=t.replace("]","");break}r[n]!==undefined?(r[n].push||(r[n]=[r[n]]),r[n].push(this.value||"")):r[n]=this.value||""}),r},toArray:function(t){return n.type(t)==="object"?n.map(t,function(n){return[n]}):n.type(t)==="array"?t:[t]},exists:function(n){return n===document.body?!0:document.body.contains(n)},find:function(t,i,r){if(!t||!i)return!1;var u=r?n.extend({},this.options.find,r):this.options.find,e=n(u.root||this.options.css.root),o=u.view||n(document).triggerHandler("arkcollapse:request:value",{group:u.group})||this.options.view,f=u.path||this.options.css.item;return f=f.replace(this.options.html.sprintf,t).replace(this.options.html.sprintf,o).replace(this.options.html.sprintf,this.safe(i)),e.find(f)},onscreen:function(t,i,r){var e,u,o,s,f,c,h;return((i===null||typeof i=="undefined")&&(i=1),(r===null||typeof r=="undefined")&&(r=1),e=n(window),u={top:e.scrollTop(),left:e.scrollLeft()},u.right=u.left+e.width(),u.bottom=u.top+e.height(),o=t.outerHeight(),s=t.outerWidth(),!s||!o)?!1:(f=t.offset(),f.right=f.left+s,f.bottom=f.top+o,c=!(u.right<f.left||u.left>f.right||u.bottom<f.top||u.top>f.bottom),!c)?!1:(h={top:Math.min(1,(f.bottom-u.top)/o),bottom:Math.min(1,(u.bottom-f.top)/o),left:Math.min(1,(f.right-u.left)/s),right:Math.min(1,(u.right-f.left)/s)},h.left*h.right>=i&&h.top*h.bottom>=r)},highlight:function(t,i,r,u,f){if(!t||!i||!r||!u)return!1;var e=f?n.extend({},this.options.highlight,f):this.options.highlight,o=e.view||n(document).triggerHandler("arkcollapse:request:value",{group:e.group});return n(document).delay(e.delay).queue(n.proxy(function(r){var f,s,h;if(e.view&&n(document).triggerHandler("arkcollapse:request:toggle",{value:e.view,group:e.group}),e.select&&t)switch(t){case"folder":case"folders":n(document).triggerHandler("observer:request:active",{type:"folders",stack:i,value:[u]});n(document).triggerHandler("observer:request:active",{type:"files",stack:i,value:[]});break;case"file":case"files":n(document).triggerHandler("observer:request:active",{type:"folders",stack:i,value:[]});n(document).triggerHandler("observer:request:active",{type:"files",stack:i,value:[u]})}f=this.find(i,u,{view:o});s=n(e.base||this.options.css.base);f.length&&s.length&&(e.scroll&&!this.onscreen(f)&&(h=Math.round(f.offset().top-parseInt(e.offset)),s.animate({scrollTop:h},e.animate)),s.promise().then(n.proxy(function(){o==="list"?f.fxFlash({speed:e.flash}):f.fxWiggle("start",{limit:e.wigglelimit,delay:e.wigglespeed})},this)),e.scrollbar&&n(document).triggerHandler("explorer:request:rescroll",{stack:i}),r())},this)),!0},message:function(t,i,r){var e;if(t)if(e=!1,i&&(e=i==="alert"?!0:e,r=r||{},r.type=i,r.type=i==="info"?"information":r.type,r.type=i==="message"?"alert":r.type),e||typeof noty!="function")alert(t);else{n.type(r)==="object"&&n.type(r.wink)==="string"&&(r.wink=this.options.message.winks[r.wink]||"");var u=r?n.extend({},this.options.message,r):this.options.message,f={text:t,type:n.inArray(u.type,["alert","success","error","warning","information","confirm","preloader"])!==-1?u.type:this.options.message.type,timeout:n.isNumeric(u.wink)||u.wink===!1?u.wink:this.options.message.wink,layout:n.inArray(u.position,["top","topLeft","topCenter","topRight","centerLeft","center","centerRight","bottomLeft","bottomCenter","bottomRight","bottom"])?u.position:this.options.message.position,dismissQueue:n.type(u.queue)==="boolean"?u.queue:this.options.message.queue,maxVisible:n.isNumeric(u.max)?u.max:this.options.message.max,closeWith:n.isArray(u.close)?u.close:this.options.message.close,theme:u.tmpl||this.options.message.tmpl,buttons:u.buttons&&u.buttons.length?u.buttons:null};return u.translate.on&&(f.text=this.text(f.text,u.translate.revalue?f.text:"",{prefix:u.translate.prefix})),u.el&&n(u.el).length?n(u.el).noty(f):noty(f)}},confirmbox:function(t,i,r){var u=r?n.extend(!0,{},this.options.confirmbox,r):this.options.confirmbox;i=i||u.type;u.buttons=[{addClass:u.yes.css,text:u.yes.text,onClick:function(t){t.close();u.yes.callback&&n(document).trigger(u.yes.callback)}},{addClass:u.no.css,text:u.no.text,onClick:function(t){t.close();u.no.callback&&n(document).trigger(u.no.callback)}}];this.message(t,i,u)},promptbox:function(t,i,r,u){var f=u?n.extend(!0,{},this.options.promptbox,u):this.options.promptbox;r=r||f.type;i=i||"";t=t+'<br /><br /><input type="text" name="" value="'+i+'" />';f.buttons=[{addClass:f.yes.css,text:f.yes.text,onClick:function(t){t.close();f.yes.callback&&n(document).trigger(f.yes.callback)}},{addClass:f.no.css,text:f.no.text,onClick:function(t){t.close();f.no.callback&&n(document).trigger(f.no.callback)}}];this.message(t,r,f)},preloader:function(n,t){arguments.callee._preloader&&arguments.callee._preloader.closed&&(arguments.callee._preloader=null);n=n||(arguments.callee._preloader?"off":"on");t=t||{};msg=t.message||this.options.html.messages.loading;t.position=t.position||"bottomCenter";t.wink=t.wink||!1;n!=="on"||arguments.callee._preloader?n==="off"&&arguments.callee._preloader?(arguments.callee._preloader.close(),arguments.callee._preloader=null):n==="update"&&arguments.callee._preloader&&arguments.callee._preloader.setText(msg):arguments.callee._preloader=this.message(msg,"preloader",t)},debug:function(n,t,i){this.options.debug&&window.console&&(i=i&&window.console[i]?i:"warn",t?window.console[i](n+"() : "+t):window.console[i](n+"() : "+this.options.html.errors.generic))},permission:function(n){return this.options.permissions.hasOwnProperty(n)?this.options.permissions[n]:!1},browser:function(t,i){var e=i?n.extend({},this.options.browser,i):this.options.browser,o=n(e.root||this.options.css.root),u=o.attr("class").split(" ");if(t){var r,f="";return r=n.inArray(t,["platform","browser","major","minor"])!==-1?"nav-"+t+"-":"",r=n.inArray(t,["id","template","club"])!==-1?"tmpl-"+t+"-":r,n.each(u,function(n,t){if(t.indexOf(r)===0)return f=t.replace(r,""),!1}),f}return u}};jQuery.fn.arkbase=function(n){return new t(n)};jQuery.fn.arkoptions=function(t){return arguments.callee._options=arguments.callee._options||{},typeof t=="object"&&n.extend(!0,arguments.callee._options,t),arguments.callee._options}})(window.jQuery);
//! moment.js
//! version : 2.9.0
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
(function(n){function it(n,t,i){switch(arguments.length){case 2:return n!=null?n:t;case 3:return n!=null?n:t!=null?t:i;default:throw new Error("Implement me");}}function g(n,t){return dr.call(n,t)}function vt(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function pi(n){t.suppressDeprecationWarnings===!1&&typeof console!="undefined"&&console.warn&&console.warn("Deprecation warning: "+n)}function o(n,t){var i=!0;return nt(function(){return i&&(pi(n),i=!1),t.apply(this,arguments)},t)}function bu(n,t){vi[n]||(pi(t),vi[n]=!0)}function wi(n,t){return function(i){return r(n.call(this,i),t)}}function ku(n,t){return function(i){return this.localeData().ordinal(n.call(this,i),t)}}function du(n,t){var r=(t.year()-n.year())*12+(t.month()-n.month()),i=n.clone().add(r,"months"),u,f;return t-i<0?(u=n.clone().add(r-1,"months"),f=(t-i)/(i-u)):(u=n.clone().add(r+1,"months"),f=(t-i)/(u-i)),-(r+f)}function gu(n,t,i){var r;return i==null?t:n.meridiemHour!=null?n.meridiemHour(t,i):n.isPM!=null?(r=n.isPM(i),r&&t<12&&(t+=12),r||t!==12||(t=0),t):t}function bi(){}function et(n,i){i!==!1&&er(n);ki(this,n);this._d=new Date(+n._d);at===!1&&(at=!0,t.updateOffset(this),at=!1)}function yt(n){var i=ir(n),r=i.year||0,u=i.quarter||0,f=i.month||0,e=i.week||0,o=i.day||0,s=i.hour||0,h=i.minute||0,c=i.second||0,l=i.millisecond||0;this._milliseconds=+l+c*1e3+h*6e4+s*36e5;this._days=+o+e*7;this._months=+f+u*3+r*12;this._data={};this._locale=t.localeData();this._bubble()}function nt(n,t){for(var i in t)g(t,i)&&(n[i]=t[i]);return g(t,"toString")&&(n.toString=t.toString),g(t,"valueOf")&&(n.valueOf=t.valueOf),n}function ki(n,t){var u,i,r;if(typeof t._isAMomentObject!="undefined"&&(n._isAMomentObject=t._isAMomentObject),typeof t._i!="undefined"&&(n._i=t._i),typeof t._f!="undefined"&&(n._f=t._f),typeof t._l!="undefined"&&(n._l=t._l),typeof t._strict!="undefined"&&(n._strict=t._strict),typeof t._tzm!="undefined"&&(n._tzm=t._tzm),typeof t._isUTC!="undefined"&&(n._isUTC=t._isUTC),typeof t._offset!="undefined"&&(n._offset=t._offset),typeof t._pf!="undefined"&&(n._pf=t._pf),typeof t._locale!="undefined"&&(n._locale=t._locale),ut.length>0)for(u in ut)i=ut[u],r=t[i],typeof r!="undefined"&&(n[i]=r);return n}function h(n){return n<0?Math.ceil(n):Math.floor(n)}function r(n,t,i){for(var r=""+Math.abs(n),u=n>=0;r.length<t;)r="0"+r;return(u?i?"+":"":"-")+r}function di(n,t){var i={milliseconds:0,months:0};return i.months=t.month()-n.month()+(t.year()-n.year())*12,n.clone().add(i.months,"M").isAfter(t)&&--i.months,i.milliseconds=+t-+n.clone().add(i.months,"M"),i}function nf(n,t){var i;return t=bt(t,n),n.isBefore(t)?i=di(n,t):(i=di(t,n),i.milliseconds=-i.milliseconds,i.months=-i.months),i}function gi(n,i){return function(r,u){var f,e;return u===null||isNaN(+u)||(bu(i,"moment()."+i+"(period, number) is deprecated. Please use moment()."+i+"(number, period)."),e=r,r=u,u=e),r=typeof r=="string"?+r:r,f=t.duration(r,u),nr(this,f,n),this}}function nr(n,i,r,u){var o=i._milliseconds,f=i._days,e=i._months;u=u==null?!0:u;o&&n._d.setTime(+n._d+o*r);f&&pr(n,"Date",ii(n,"Date")+f*r);e&&yr(n,ii(n,"Month")+e*r);u&&t.updateOffset(n,f||e)}function ot(n){return Object.prototype.toString.call(n)==="[object Array]"}function pt(n){return Object.prototype.toString.call(n)==="[object Date]"||n instanceof Date}function tr(n,t,r){for(var e=Math.min(n.length,t.length),o=Math.abs(n.length-t.length),f=0,u=0;u<e;u++)(r&&n[u]!==t[u]||!r&&i(n[u])!==i(t[u]))&&f++;return f+o}function e(n){if(n){var t=n.toLowerCase().replace(/(.)s$/,"$1");n=pu[n]||wu[t]||t}return n}function ir(n){var r={},t;for(var i in n)g(n,i)&&(t=e(i),t&&(r[t]=n[i]));return r}function tf(i){var r,u;if(i.indexOf("week")===0)r=7,u="day";else if(i.indexOf("month")===0)r=12,u="month";else return;t[i]=function(f,e){var o,s,c=t._locale[i],h=[];if(typeof f=="number"&&(e=f,f=n),s=function(n){var i=t().utc().set(u,n);return c.call(t._locale,i,f||"")},e!=null)return s(e);for(o=0;o<r;o++)h.push(s(o));return h}}function i(n){var t=+n,i=0;return t!==0&&isFinite(t)&&(i=t>=0?Math.floor(t):Math.ceil(t)),i}function wt(n,t){return new Date(Date.UTC(n,t+1,0)).getUTCDate()}function rr(n,i,r){return tt(t([n,11,31+i-r]),i,r).week}function ur(n){return fr(n)?366:365}function fr(n){return n%4==0&&n%100!=0||n%400==0}function er(n){var t;n._a&&n._pf.overflow===-2&&(t=n._a[l]<0||n._a[l]>11?l:n._a[s]<1||n._a[s]>wt(n._a[c],n._a[l])?s:n._a[f]<0||n._a[f]>24||n._a[f]===24&&(n._a[w]!==0||n._a[b]!==0||n._a[k]!==0)?f:n._a[w]<0||n._a[w]>59?w:n._a[b]<0||n._a[b]>59?b:n._a[k]<0||n._a[k]>999?k:-1,n._pf._overflowDayOfYear&&(t<c||t>s)&&(t=s),n._pf.overflow=t)}function or(t){return t._isValid==null&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&t._pf.charsLeftOver===0&&t._pf.unusedTokens.length===0&&t._pf.bigHour===n)),t._isValid}function sr(n){return n?n.toLowerCase().replace("_","-"):n}function rf(n){for(var r=0,i,t,f,u;r<n.length;){for(u=sr(n[r]).split("-"),i=u.length,t=sr(n[r+1]),t=t?t.split("-"):null;i>0;){if(f=hr(u.slice(0,i).join("-")),f)return f;if(t&&t.length>=i&&tr(u,t,!0)>=i-1)break;i--}r++}return null}function hr(n){var i=null;if(!d[n]&&ui)try{i=t.locale();require("./locale/"+n);t.locale(i)}catch(r){}return d[n]}function bt(n,i){var r,u;return i._isUTC?(r=i.clone(),u=(t.isMoment(n)||pt(n)?+n:+t(n))-+r,r._d.setTime(+r._d+u),t.updateOffset(r,!1),r):t(n).local()}function uf(n){return n.match(/\[[\s\S]/)?n.replace(/^\[|\]$/g,""):n.replace(/\\/g,"")}function ff(n){for(var i=n.match(fi),t=0,r=i.length;t<r;t++)i[t]=a[i[t]]?a[i[t]]:uf(i[t]);return function(u){var f="";for(t=0;t<r;t++)f+=i[t]instanceof Function?i[t].call(u,n):i[t];return f}}function kt(n,t){return n.isValid()?(t=cr(t,n.localeData()),lt[t]||(lt[t]=ff(t)),lt[t](n)):n.localeData().invalidDate()}function cr(n,t){function r(n){return t.longDateFormat(n)||n}var i=5;for(ft.lastIndex=0;i>=0&&ft.test(n);)n=n.replace(ft,r),ft.lastIndex=0,i-=1;return n}function ef(n,t){var i=t._strict;switch(n){case"Q":return oi;case"DDDD":return hi;case"YYYY":case"GGGG":case"gggg":return i?cu:ru;case"Y":case"G":case"g":return au;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?lu:uu;case"S":if(i)return oi;case"SS":if(i)return si;case"SSS":if(i)return hi;case"DDD":return iu;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return eu;case"a":case"A":return t._locale._meridiemParse;case"x":return su;case"X":return hu;case"Z":case"ZZ":return st;case"T":return ou;case"SSSS":return fu;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?si:ei;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return ei;case"Do":return i?t._locale._ordinalParse:t._locale._ordinalParseLenient;default:return new RegExp(af(lf(n.replace("\\","")),"i"))}}function dt(n){n=n||"";var r=n.match(st)||[],f=r[r.length-1]||[],t=(f+"").match(yu)||["-",0,0],u=+(t[1]*60)+i(t[2]);return t[0]==="+"?u:-u}function of(n,r,u){var o,e=u._a;switch(n){case"Q":r!=null&&(e[l]=(i(r)-1)*3);break;case"M":case"MM":r!=null&&(e[l]=i(r)-1);break;case"MMM":case"MMMM":o=u._locale.monthsParse(r,n,u._strict);o!=null?e[l]=o:u._pf.invalidMonth=r;break;case"D":case"DD":r!=null&&(e[s]=i(r));break;case"Do":r!=null&&(e[s]=i(parseInt(r.match(/\d{1,2}/)[0],10)));break;case"DDD":case"DDDD":r!=null&&(u._dayOfYear=i(r));break;case"YY":e[c]=t.parseTwoDigitYear(r);break;case"YYYY":case"YYYYY":case"YYYYYY":e[c]=i(r);break;case"a":case"A":u._meridiem=r;break;case"h":case"hh":u._pf.bigHour=!0;case"H":case"HH":e[f]=i(r);break;case"m":case"mm":e[w]=i(r);break;case"s":case"ss":e[b]=i(r);break;case"S":case"SS":case"SSS":case"SSSS":e[k]=i(("0."+r)*1e3);break;case"x":u._d=new Date(i(r));break;case"X":u._d=new Date(parseFloat(r)*1e3);break;case"Z":case"ZZ":u._useUTC=!0;u._tzm=dt(r);break;case"dd":case"ddd":case"dddd":o=u._locale.weekdaysParse(r);o!=null?(u._w=u._w||{},u._w.d=o):u._pf.invalidWeekday=r;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":n=n.substr(0,1);case"gggg":case"GGGG":case"GGGGG":n=n.substr(0,2);r&&(u._w=u._w||{},u._w[n]=i(r));break;case"gg":case"GG":u._w=u._w||{};u._w[n]=t.parseTwoDigitYear(r)}}function sf(n){var i,o,f,u,r,e,s;i=n._w;i.GG!=null||i.W!=null||i.E!=null?(r=1,e=4,o=it(i.GG,n._a[c],tt(t(),1,4).year),f=it(i.W,1),u=it(i.E,1)):(r=n._locale._week.dow,e=n._locale._week.doy,o=it(i.gg,n._a[c],tt(t(),r,e).year),f=it(i.w,1),i.d!=null?(u=i.d,u<r&&++f):u=i.e!=null?i.e+r:r);s=ne(o,f,u,e,r);n._a[c]=s.year;n._dayOfYear=s.dayOfYear}function gt(n){var t,i,r=[],u,e;if(!n._d){for(u=cf(n),n._w&&n._a[s]==null&&n._a[l]==null&&sf(n),n._dayOfYear&&(e=it(n._a[c],u[c]),n._dayOfYear>ur(e)&&(n._pf._overflowDayOfYear=!0),i=ti(e,0,n._dayOfYear),n._a[l]=i.getUTCMonth(),n._a[s]=i.getUTCDate()),t=0;t<3&&n._a[t]==null;++t)n._a[t]=r[t]=u[t];for(;t<7;t++)n._a[t]=r[t]=n._a[t]==null?t===2?1:0:n._a[t];n._a[f]===24&&n._a[w]===0&&n._a[b]===0&&n._a[k]===0&&(n._nextDay=!0,n._a[f]=0);n._d=(n._useUTC?ti:bf).apply(null,r);n._tzm!=null&&n._d.setUTCMinutes(n._d.getUTCMinutes()-n._tzm);n._nextDay&&(n._a[f]=24)}}function hf(n){var t;n._d||(t=ir(n._i),n._a=[t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],gt(n))}function cf(n){var t=new Date;return n._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function ni(i){if(i._f===t.ISO_8601){lr(i);return}i._a=[];i._pf.empty=!0;for(var r=""+i._i,u,e,h,l=r.length,c=0,s=cr(i._f,i._locale).match(fi)||[],o=0;o<s.length;o++)e=s[o],u=(r.match(ef(e,i))||[])[0],u&&(h=r.substr(0,r.indexOf(u)),h.length>0&&i._pf.unusedInput.push(h),r=r.slice(r.indexOf(u)+u.length),c+=u.length),a[e]?(u?i._pf.empty=!1:i._pf.unusedTokens.push(e),of(e,u,i)):i._strict&&!u&&i._pf.unusedTokens.push(e);i._pf.charsLeftOver=l-c;r.length>0&&i._pf.unusedInput.push(r);i._pf.bigHour===!0&&i._a[f]<=12&&(i._pf.bigHour=n);i._a[f]=gu(i._locale,i._a[f],i._meridiem);gt(i);er(i)}function lf(n){return n.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(n,t,i,r,u){return t||i||r||u})}function af(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function vf(n){var t,f,u,r,i;if(n._f.length===0){n._pf.invalidFormat=!0;n._d=new Date(NaN);return}for(r=0;r<n._f.length;r++)(i=0,t=ki({},n),n._useUTC!=null&&(t._useUTC=n._useUTC),t._pf=vt(),t._f=n._f[r],ni(t),or(t))&&(i+=t._pf.charsLeftOver,i+=t._pf.unusedTokens.length*10,t._pf.score=i,(u==null||i<u)&&(u=i,f=t));nt(n,f||t)}function lr(n){var t,i,r=n._i,u=vu.exec(r);if(u){for(n._pf.iso=!0,t=0,i=ht.length;t<i;t++)if(ht[t][1].exec(r)){n._f=ht[t][0]+(u[6]||" ");break}for(t=0,i=ct.length;t<i;t++)if(ct[t][1].exec(r)){n._f+=ct[t][0];break}r.match(st)&&(n._f+="Z");ni(n)}else n._isValid=!1}function yf(n){lr(n);n._isValid===!1&&(delete n._isValid,t.createFromInputFallback(n))}function pf(n,t){for(var r=[],i=0;i<n.length;++i)r.push(t(n[i],i));return r}function wf(i){var r=i._i,u;r===n?i._d=new Date:pt(r)?i._d=new Date(+r):(u=gr.exec(r))!==null?i._d=new Date(+u[1]):typeof r=="string"?yf(i):ot(r)?(i._a=pf(r.slice(0),function(n){return parseInt(n,10)}),gt(i)):typeof r=="object"?hf(i):typeof r=="number"?i._d=new Date(r):t.createFromInputFallback(i)}function bf(n,t,i,r,u,f,e){var o=new Date(n,t,i,r,u,f,e);return n<1970&&o.setFullYear(n),o}function ti(n){var t=new Date(Date.UTC.apply(null,arguments));return n<1970&&t.setUTCFullYear(n),t}function kf(n,t){if(typeof n=="string")if(isNaN(n)){if(n=t.weekdaysParse(n),typeof n!="number")return null}else n=parseInt(n,10);return n}function df(n,t,i,r,u){return u.relativeTime(t||1,!!i,n,r)}function gf(n,i,r){var u=t.duration(n).abs(),c=p(u.as("s")),e=p(u.as("m")),o=p(u.as("h")),s=p(u.as("d")),h=p(u.as("M")),l=p(u.as("y")),f=c<y.s&&["s",c]||e===1&&["m"]||e<y.m&&["mm",e]||o===1&&["h"]||o<y.h&&["hh",o]||s===1&&["d"]||s<y.d&&["dd",s]||h===1&&["M"]||h<y.M&&["MM",h]||l===1&&["y"]||["yy",l];return f[2]=i,f[3]=+n>0,f[4]=r,df.apply({},f)}function tt(n,i,r){var e=r-i,u=r-n.day(),f;return u>e&&(u-=7),u<e-7&&(u+=7),f=t(n).add(u,"d"),{week:Math.ceil(f.dayOfYear()/7),year:f.year()}}function ne(n,t,i,r,u){var f=ti(n,0,1).getUTCDay(),o,e;return f=f===0?7:f,i=i!=null?i:u,o=u-f+(f>r?7:0)-(f<u?7:0),e=7*(t-1)+(i-u)+o+1,{year:e>0?n:n-1,dayOfYear:e>0?e:ur(n-1)+e}}function ar(i){var r=i._i,f=i._f,u;return(i._locale=i._locale||t.localeData(i._l),r===null||f===n&&r==="")?t.invalid({nullInput:!0}):(typeof r=="string"&&(i._i=r=i._locale.preparse(r)),t.isMoment(r))?new et(r,!0):(f?ot(f)?vf(i):ni(i):wf(i),u=new et(i),u._nextDay&&(u.add(1,"d"),u._nextDay=n),u)}function vr(n,i){var u,r;if(i.length===1&&ot(i[0])&&(i=i[0]),!i.length)return t();for(u=i[0],r=1;r<i.length;++r)i[r][n](u)&&(u=i[r]);return u}function yr(n,t){var i;return typeof t=="string"&&(t=n.localeData().monthsParse(t),typeof t!="number")?n:(i=Math.min(n.date(),wt(n.year(),t)),n._d["set"+(n._isUTC?"UTC":"")+"Month"](t,i),n)}function ii(n,t){return n._d["get"+(n._isUTC?"UTC":"")+t]()}function pr(n,t,i){return t==="Month"?yr(n,i):n._d["set"+(n._isUTC?"UTC":"")+t](i)}function v(n,i){return function(r){return r!=null?(pr(this,n,r),t.updateOffset(this,i),this):ii(this,n)}}function wr(n){return n*400/146097}function br(n){return n*146097/400}function te(n){t.duration.fn[n]=function(){return this._data[n]}}function kr(n){typeof ender=="undefined"&&(ri=rt.moment,rt.moment=n?o("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",t):t)}for(var t,rt=typeof global!="undefined"&&(typeof window=="undefined"||window===global.window)?global:this,ri,p=Math.round,dr=Object.prototype.hasOwnProperty,u,c=0,l=1,s=2,f=3,w=4,b=5,k=6,d={},ut=[],ui=typeof module!="undefined"&&module&&module.exports,gr=/^\/?Date\((\-?\d+)/i,nu=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,tu=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,fi=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,ft=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,ei=/\d\d?/,iu=/\d{1,3}/,ru=/\d{1,4}/,uu=/[+\-]?\d{1,6}/,fu=/\d+/,eu=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,st=/Z|[\+\-]\d\d:?\d\d/gi,ou=/T/i,su=/[\+\-]?\d+/,hu=/[\+\-]?\d+(\.\d{1,3})?/,oi=/\d/,si=/\d\d/,hi=/\d{3}/,cu=/\d{4}/,lu=/[+-]?\d{6}/,au=/[+-]?\d+/,vu=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,ht=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],ct=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],yu=/([\+\-]|\d\d)/gi,ie="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),ci={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},pu={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},wu={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},lt={},y={s:45,m:45,h:22,d:26,M:11},li="DDD w W M D d".split(" "),ai="M D H h m s w W".split(" "),a={M:function(){return this.month()+1},MMM:function(n){return this.localeData().monthsShort(this,n)},MMMM:function(n){return this.localeData().months(this,n)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(n){return this.localeData().weekdaysMin(this,n)},ddd:function(n){return this.localeData().weekdaysShort(this,n)},dddd:function(n){return this.localeData().weekdays(this,n)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return r(this.year()%100,2)},YYYY:function(){return r(this.year(),4)},YYYYY:function(){return r(this.year(),5)},YYYYYY:function(){var n=this.year(),t=n>=0?"+":"-";return t+r(Math.abs(n),6)},gg:function(){return r(this.weekYear()%100,2)},gggg:function(){return r(this.weekYear(),4)},ggggg:function(){return r(this.weekYear(),5)},GG:function(){return r(this.isoWeekYear()%100,2)},GGGG:function(){return r(this.isoWeekYear(),4)},GGGGG:function(){return r(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return i(this.milliseconds()/100)},SS:function(){return r(i(this.milliseconds()/10),2)},SSS:function(){return r(this.milliseconds(),3)},SSSS:function(){return r(this.milliseconds(),3)},Z:function(){var n=this.utcOffset(),t="+";return n<0&&(n=-n,t="-"),t+r(i(n/60),2)+":"+r(i(n)%60,2)},ZZ:function(){var n=this.utcOffset(),t="+";return n<0&&(n=-n,t="-"),t+r(i(n/60),2)+r(i(n)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},x:function(){return this.valueOf()},X:function(){return this.unix()},Q:function(){return this.quarter()}},vi={},yi=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"],at=!1;li.length;)u=li.pop(),a[u+"o"]=ku(a[u],u);while(ai.length)u=ai.pop(),a[u+u]=wi(a[u],2);for(a.DDDD=wi(a.DDD,3),nt(bi.prototype,{set:function(n){var t;for(var i in n)t=n[i],typeof t=="function"?this[i]=t:this["_"+i]=t;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(n){return this._months[n.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(n){return this._monthsShort[n.month()]},monthsParse:function(n,i,r){var u,f,e;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),u=0;u<12;u++)if((f=t.utc([2e3,u]),r&&!this._longMonthsParse[u]&&(this._longMonthsParse[u]=new RegExp("^"+this.months(f,"").replace(".","")+"$","i"),this._shortMonthsParse[u]=new RegExp("^"+this.monthsShort(f,"").replace(".","")+"$","i")),r||this._monthsParse[u]||(e="^"+this.months(f,"")+"|^"+this.monthsShort(f,""),this._monthsParse[u]=new RegExp(e.replace(".",""),"i")),r&&i==="MMMM"&&this._longMonthsParse[u].test(n))||r&&i==="MMM"&&this._shortMonthsParse[u].test(n)||!r&&this._monthsParse[u].test(n))return u},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(n){return this._weekdays[n.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(n){return this._weekdaysShort[n.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(n){return this._weekdaysMin[n.day()]},weekdaysParse:function(n){var i,r,u;for(this._weekdaysParse||(this._weekdaysParse=[]),i=0;i<7;i++)if(this._weekdaysParse[i]||(r=t([2e3,1]).day(i),u="^"+this.weekdays(r,"")+"|^"+this.weekdaysShort(r,"")+"|^"+this.weekdaysMin(r,""),this._weekdaysParse[i]=new RegExp(u.replace(".",""),"i")),this._weekdaysParse[i].test(n))return i},_longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(n){var t=this._longDateFormat[n];return!t&&this._longDateFormat[n.toUpperCase()]&&(t=this._longDateFormat[n.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(n){return n.slice(1)}),this._longDateFormat[n]=t),t},isPM:function(n){return(n+"").toLowerCase().charAt(0)==="p"},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(n,t,i){return n>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(n,t,i){var r=this._calendar[n];return typeof r=="function"?r.apply(t,[i]):r},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(n,t,i,r){var u=this._relativeTime[i];return typeof u=="function"?u(n,t,i,r):u.replace(/%d/i,n)},pastFuture:function(n,t){var i=this._relativeTime[n>0?"future":"past"];return typeof i=="function"?i(t):i.replace(/%s/i,t)},ordinal:function(n){return this._ordinal.replace("%d",n)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(n){return n},postformat:function(n){return n},week:function(n){return tt(n,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},firstDayOfWeek:function(){return this._week.dow},firstDayOfYear:function(){return this._week.doy},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),t=function(t,i,r,u){var f;return typeof r=="boolean"&&(u=r,r=n),f={},f._isAMomentObject=!0,f._i=t,f._f=i,f._l=r,f._strict=u,f._isUTC=!1,f._pf=vt(),ar(f)},t.suppressDeprecationWarnings=!1,t.createFromInputFallback=o("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(n){n._d=new Date(n._i+(n._useUTC?" UTC":""))}),t.min=function(){var n=[].slice.call(arguments,0);return vr("isBefore",n)},t.max=function(){var n=[].slice.call(arguments,0);return vr("isAfter",n)},t.utc=function(t,i,r,u){var f;return typeof r=="boolean"&&(u=r,r=n),f={},f._isAMomentObject=!0,f._useUTC=!0,f._isUTC=!0,f._l=r,f._i=t,f._f=i,f._strict=u,f._pf=vt(),ar(f).utc()},t.unix=function(n){return t(n*1e3)},t.duration=function(n,r){var u=n,e=null,o,c,h,l;return t.isDuration(n)?u={ms:n._milliseconds,d:n._days,M:n._months}:typeof n=="number"?(u={},r?u[r]=n:u.milliseconds=n):(e=nu.exec(n))?(o=e[1]==="-"?-1:1,u={y:0,d:i(e[s])*o,h:i(e[f])*o,m:i(e[w])*o,s:i(e[b])*o,ms:i(e[k])*o}):(e=tu.exec(n))?(o=e[1]==="-"?-1:1,h=function(n){var t=n&&parseFloat(n.replace(",","."));return(isNaN(t)?0:t)*o},u={y:h(e[2]),M:h(e[3]),d:h(e[4]),h:h(e[5]),m:h(e[6]),s:h(e[7]),w:h(e[8])}):u==null?u={}:typeof u=="object"&&("from"in u||"to"in u)&&(l=nf(t(u.from),t(u.to)),u={},u.ms=l.milliseconds,u.M=l.months),c=new yt(u),t.isDuration(n)&&g(n,"_locale")&&(c._locale=n._locale),c},t.version="2.9.0",t.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",t.ISO_8601=function(){},t.momentProperties=ut,t.updateOffset=function(){},t.relativeTimeThreshold=function(t,i){return y[t]===n?!1:i===n?y[t]:(y[t]=i,!0)},t.lang=o("moment.lang is deprecated. Use moment.locale instead.",function(n,i){return t.locale(n,i)}),t.locale=function(n,i){var r;return n&&(r=typeof i!="undefined"?t.defineLocale(n,i):t.localeData(n),r&&(t.duration._locale=t._locale=r)),t._locale._abbr},t.defineLocale=function(n,i){return i!==null?(i.abbr=n,d[n]||(d[n]=new bi),d[n].set(i),t.locale(n),d[n]):(delete d[n],null)},t.langData=o("moment.langData is deprecated. Use moment.localeData instead.",function(n){return t.localeData(n)}),t.localeData=function(n){var i;if(n&&n._locale&&n._locale._abbr&&(n=n._locale._abbr),!n)return t._locale;if(!ot(n)){if(i=hr(n),i)return i;n=[n]}return rf(n)},t.isMoment=function(n){return n instanceof et||n!=null&&g(n,"_isAMomentObject")},t.isDuration=function(n){return n instanceof yt},u=yi.length-1;u>=0;--u)tf(yi[u]);t.normalizeUnits=function(n){return e(n)};t.invalid=function(n){var i=t.utc(NaN);return n!=null?nt(i._pf,n):i._pf.userInvalidated=!0,i};t.parseZone=function(){return t.apply(null,arguments).parseZone()};t.parseTwoDigitYear=function(n){return i(n)+(i(n)>68?1900:2e3)};t.isDate=pt;nt(t.fn=et.prototype,{clone:function(){return t(this)},valueOf:function(){return+this._d-(this._offset||0)*6e4},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var n=t(this).utc();return 0<n.year()&&n.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():kt(n,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):kt(n,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var n=this;return[n.year(),n.month(),n.date(),n.hours(),n.minutes(),n.seconds(),n.milliseconds()]},isValid:function(){return or(this)},isDSTShifted:function(){return this._a?this.isValid()&&tr(this._a,(this._isUTC?t.utc(this._a):t(this._a)).toArray())>0:!1},parsingFlags:function(){return nt({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(n){return this.utcOffset(0,n)},local:function(n){return this._isUTC&&(this.utcOffset(0,n),this._isUTC=!1,n&&this.subtract(this._dateUtcOffset(),"m")),this},format:function(n){var i=kt(this,n||t.defaultFormat);return this.localeData().postformat(i)},add:gi(1,"add"),subtract:gi(-1,"subtract"),diff:function(n,t,i){var f=bt(n,this),o=(f.utcOffset()-this.utcOffset())*6e4,u,r;return t=e(t),t==="year"||t==="month"||t==="quarter"?(r=du(this,f),t==="quarter"?r=r/3:t==="year"&&(r=r/12)):(u=this-f,r=t==="second"?u/1e3:t==="minute"?u/6e4:t==="hour"?u/36e5:t==="day"?(u-o)/864e5:t==="week"?(u-o)/6048e5:u),i?r:h(r)},from:function(n,i){return t.duration({to:this,from:n}).locale(this.locale()).humanize(!i)},fromNow:function(n){return this.from(t(),n)},calendar:function(n){var r=n||t(),u=bt(r,this).startOf("day"),i=this.diff(u,"days",!0),f=i<-6?"sameElse":i<-1?"lastWeek":i<0?"lastDay":i<1?"sameDay":i<2?"nextDay":i<7?"nextWeek":"sameElse";return this.format(this.localeData().calendar(f,this,t(r)))},isLeapYear:function(){return fr(this.year())},isDST:function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},day:function(n){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return n!=null?(n=kf(n,this.localeData()),this.add(n-t,"d")):t},month:v("Month",!0),startOf:function(n){n=e(n);switch(n){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return n==="week"?this.weekday(0):n==="isoWeek"&&this.isoWeekday(1),n==="quarter"&&this.month(Math.floor(this.month()/3)*3),this},endOf:function(t){return(t=e(t),t===n||t==="millisecond")?this:this.startOf(t).add(1,t==="isoWeek"?"week":t).subtract(1,"ms")},isAfter:function(n,i){var r;return i=e(typeof i!="undefined"?i:"millisecond"),i==="millisecond"?(n=t.isMoment(n)?n:t(n),+this>+n):(r=t.isMoment(n)?+n:+t(n),r<+this.clone().startOf(i))},isBefore:function(n,i){var r;return i=e(typeof i!="undefined"?i:"millisecond"),i==="millisecond"?(n=t.isMoment(n)?n:t(n),+this<+n):(r=t.isMoment(n)?+n:+t(n),+this.clone().endOf(i)<r)},isBetween:function(n,t,i){return this.isAfter(n,i)&&this.isBefore(t,i)},isSame:function(n,i){var r;return i=e(i||"millisecond"),i==="millisecond"?(n=t.isMoment(n)?n:t(n),+this==+n):(r=+t(n),+this.clone().startOf(i)<=r&&r<=+this.clone().endOf(i))},min:o("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(n){return n=t.apply(null,arguments),n<this?this:n}),max:o("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(n){return n=t.apply(null,arguments),n>this?this:n}),zone:o("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",function(n,t){return n!=null?(typeof n!="string"&&(n=-n),this.utcOffset(n,t),this):-this.utcOffset()}),utcOffset:function(n,i){var r=this._offset||0,u;return n!=null?(typeof n=="string"&&(n=dt(n)),Math.abs(n)<16&&(n=n*60),!this._isUTC&&i&&(u=this._dateUtcOffset()),this._offset=n,this._isUTC=!0,u!=null&&this.add(u,"m"),r!==n&&(!i||this._changeInProgress?nr(this,t.duration(n-r,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,t.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?r:this._dateUtcOffset()},isLocal:function(){return!this._isUTC},isUtcOffset:function(){return this._isUTC},isUtc:function(){return this._isUTC&&this._offset===0},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.utcOffset(this._tzm):typeof this._i=="string"&&this.utcOffset(dt(this._i)),this},hasAlignedHourOffset:function(n){return n=n?t(n).utcOffset():0,(this.utcOffset()-n)%60==0},daysInMonth:function(){return wt(this.year(),this.month())},dayOfYear:function(n){var i=p((t(this).startOf("day")-t(this).startOf("year"))/864e5)+1;return n==null?i:this.add(n-i,"d")},quarter:function(n){return n==null?Math.ceil((this.month()+1)/3):this.month((n-1)*3+this.month()%3)},weekYear:function(n){var t=tt(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return n==null?t:this.add(n-t,"y")},isoWeekYear:function(n){var t=tt(this,1,4).year;return n==null?t:this.add(n-t,"y")},week:function(n){var t=this.localeData().week(this);return n==null?t:this.add((n-t)*7,"d")},isoWeek:function(n){var t=tt(this,1,4).week;return n==null?t:this.add((n-t)*7,"d")},weekday:function(n){var t=(this.day()+7-this.localeData()._week.dow)%7;return n==null?t:this.add(n-t,"d")},isoWeekday:function(n){return n==null?this.day()||7:this.day(this.day()%7?n:n-7)},isoWeeksInYear:function(){return rr(this.year(),1,4)},weeksInYear:function(){var n=this.localeData()._week;return rr(this.year(),n.dow,n.doy)},get:function(n){return n=e(n),this[n]()},set:function(n,t){var i;if(typeof n=="object")for(i in n)this.set(i,n[i]);else n=e(n),typeof this[n]=="function"&&this[n](t);return this},locale:function(i){var r;return i===n?this._locale._abbr:(r=t.localeData(i),r!=null&&(this._locale=r),this)},lang:o("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(t){return t===n?this.localeData():this.locale(t)}),localeData:function(){return this._locale},_dateUtcOffset:function(){return-Math.round(this._d.getTimezoneOffset()/15)*15}});t.fn.millisecond=t.fn.milliseconds=v("Milliseconds",!1);t.fn.second=t.fn.seconds=v("Seconds",!1);t.fn.minute=t.fn.minutes=v("Minutes",!1);t.fn.hour=t.fn.hours=v("Hours",!0);t.fn.date=v("Date",!0);t.fn.dates=o("dates accessor is deprecated. Use date instead.",v("Date",!0));t.fn.year=v("FullYear",!0);t.fn.years=o("years accessor is deprecated. Use year instead.",v("FullYear",!0));t.fn.days=t.fn.day;t.fn.months=t.fn.month;t.fn.weeks=t.fn.week;t.fn.isoWeeks=t.fn.isoWeek;t.fn.quarters=t.fn.quarter;t.fn.toJSON=t.fn.toISOString;t.fn.isUTC=t.fn.isUtc;nt(t.duration.fn=yt.prototype,{_bubble:function(){var o=this._milliseconds,t=this._days,i=this._months,n=this._data,u,f,e,r=0;n.milliseconds=o%1e3;u=h(o/1e3);n.seconds=u%60;f=h(u/60);n.minutes=f%60;e=h(f/60);n.hours=e%24;t+=h(e/24);r=h(wr(t));t-=h(br(r));i+=h(t/30);t%=30;r+=h(i/12);i%=12;n.days=t;n.months=i;n.years=r},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return h(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months%12*2592e6+i(this._months/12)*31536e6},humanize:function(n){var t=gf(this,!n,this.localeData());return n&&(t=this.localeData().pastFuture(+this,t)),this.localeData().postformat(t)},add:function(n,i){var r=t.duration(n,i);return this._milliseconds+=r._milliseconds,this._days+=r._days,this._months+=r._months,this._bubble(),this},subtract:function(n,i){var r=t.duration(n,i);return this._milliseconds-=r._milliseconds,this._days-=r._days,this._months-=r._months,this._bubble(),this},get:function(n){return n=e(n),this[n.toLowerCase()+"s"]()},as:function(n){var t,i;if(n=e(n),n==="month"||n==="year")return t=this._days+this._milliseconds/864e5,i=this._months+wr(t)*12,n==="month"?i:i/12;t=this._days+Math.round(br(this._months/12));switch(n){case"week":return t/7+this._milliseconds/6048e5;case"day":return t+this._milliseconds/864e5;case"hour":return t*24+this._milliseconds/36e5;case"minute":return t*1440+this._milliseconds/6e4;case"second":return t*86400+this._milliseconds/1e3;case"millisecond":return Math.floor(t*864e5)+this._milliseconds;default:throw new Error("Unknown unit "+n);}},lang:t.fn.lang,locale:t.fn.locale,toIsoString:o("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var r=Math.abs(this.years()),u=Math.abs(this.months()),f=Math.abs(this.days()),n=Math.abs(this.hours()),t=Math.abs(this.minutes()),i=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(r?r+"Y":"")+(u?u+"M":"")+(f?f+"D":"")+(n||t||i?"T":"")+(n?n+"H":"")+(t?t+"M":"")+(i?i+"S":""):"P0D"},localeData:function(){return this._locale},toJSON:function(){return this.toISOString()}});t.duration.fn.toString=t.duration.fn.toISOString;for(u in ci)g(ci,u)&&te(u.toLowerCase());t.duration.fn.asMilliseconds=function(){return this.as("ms")};t.duration.fn.asSeconds=function(){return this.as("s")};t.duration.fn.asMinutes=function(){return this.as("m")};t.duration.fn.asHours=function(){return this.as("h")};t.duration.fn.asDays=function(){return this.as("d")};t.duration.fn.asWeeks=function(){return this.as("weeks")};t.duration.fn.asMonths=function(){return this.as("M")};t.duration.fn.asYears=function(){return this.as("y")};t.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(n){var t=n%10,r=i(n%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return n+r}});ui?module.exports=t:typeof define=="function"&&define.amd?(define(function(n,i,r){return r.config&&r.config()&&r.config().noGlobal===!0&&(rt.moment=ri),t}),kr(!0)):kr()}).call(this);
/*! jsviews.js v1.0.0-alpha single-file version:
includes JsRender, JsObservable and JsViews  http://github.com/BorisMoore/jsrender and http://jsviews.com/jsviews
informal pre V1.0 commit counter: 52 (Beta Candidate) */
(function(n,t,i){"use strict";function bt(n){return n}function bi(n){return n}function kt(n){e._dbgMode=n;vt=n?"Error: #index in nested view: use #getIndex()":"";d("dbg",ei.dbg=lt.dbg=n?bi:bt)}function dt(n){return{getTgt:n,map:function(t){var i=this,r;i.src!==t&&(i.src&&i.unmap(),typeof t=="object"&&(r=n.apply(i,arguments),i.src=t,i.tgt=r))}}}function ft(n,t){t&&t.onError&&t.onError(n)===!1||(this.name="JsRender Error",this.message=n||"JsRender error")}function u(n,t){var i;n=n||{};for(i in t)n[i]=t[i];return n}function gt(n,t,i){return(!l.rTag||n)&&(p=n?n.charAt(0):p,w=n?n.charAt(1):w,o=t?t.charAt(0):o,a=t?t.charAt(1):a,g=i||g,n="\\"+p+"(\\"+g+")?\\"+w,t="\\"+o+"\\"+a,y="(?:(?:(\\w+(?=[\\/\\s\\"+o+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))\\s*((?:[^\\"+o+"]|\\"+o+"(?!\\"+a+"))*?)",l.rTag=y+")",y=new RegExp(n+y+"(\\/)?|(?:\\/(\\w+)))"+t,"g"),at=new RegExp("<.*>|([^\\\\]|^)[{}]|"+n+".*"+t)),[p,w,o,a,g]}function ki(n,t){t||(t=n,n=i);var e,f,o,u,r=this,s=!t||t==="root";if(n){if(u=r.type===t?r:i,!u)if(e=r.views,r._.useKey){for(f in e)if(u=e[f].get(n,t))break}else for(f=0,o=e.length;!u&&f<o;f++)u=e[f].get(n,t)}else if(s)while(r.parent.parent)u=r=r.parent;else while(r&&!u)u=r.type===t?r:i,r=r.parent;return u}function ni(){var n=this.get("item");return n?n.index:i}function ti(){return this.index}function di(t){var f,e=this,o=e.linkCtx,r=(e.ctx||{})[t];return r===i&&o&&o.ctx&&(r=o.ctx[t]),r===i&&(r=ei[t]),r&&(typeof r!="function"||r._wrp||(f=function(){return r.apply(!this||this===n?e:this,arguments)},f._wrp=1,u(f,r))),f||r}function gi(n,t,u){var f,e,h,o=+u===u&&u,s=t.linkCtx;if(o&&(u=(o=t.tmpl.bnds[o-1])(t.data,t,r)),e=u.args[0],n||o){f=s&&s.tag||{_:{inline:!s,bnd:o},tagName:n+":",flow:!0,_is:"tag"};for(h in u.props)rt.test(h)&&(f[h]=u.props[h]);s&&(s.tag=f,f.linkCtx=f.linkCtx||s,u.ctx=c(u.ctx,s.view.ctx));f.tagCtx=u;u.view=t;f.ctx=u.ctx||{};delete u.ctx;t._.tag=f;e=et(f,f.convert||n!=="true"&&n)[0];e=e!=i?e:"";e=o&&t._.onRender?t._.onRender(e,t,o):e;t._.tag=i}return e}function et(n,t){var r=n.tagCtx,u=r.view,i=r.args;return t=t&&(""+t===t?u.getRsc("converters",t)||v("Unknown converter: '"+t+"'"):t),i=!i.length&&!r.index&&n.autoBind?[u.data]:t?i.slice(0):i,t&&(t.depends&&(n.depends=l.getDeps(n.depends,n,t.depends,t)),i[0]=t.apply(n,i)),i}function nr(n,t){for(var f,e,u=this;f===i&&u;)e=u.tmpl[n],f=e&&e[t],u=u.parent;return f||r[n][t]}function tr(n,t,f,e,o){var ct,h,wt,at,ut,a,vt,w,l,ft,tt,bt,k,yt,pt,nt,y,st,d,kt,g="",ht=+e===e&&e,p=t.linkCtx||0,it=t.ctx,dt=f||t.tmpl;for(n._is==="tag"&&(h=n,n=h.tagName),h=h||p.tag,ht&&(e=(bt=dt.bnds[ht-1])(t.data,t,r)),vt=e.length,a=0;a<vt;a++){if(l=e[a],d=l.props,tt=l.tmpl,tt=l.content=tt&&dt.tmpls[tt-1],f=l.props.tmpl,a||f&&h||(k=t.getRsc("tags",n)||v("Unknown tag: {{"+n+"}}")),f=f||(h?h:k).template||tt,f=""+f===f?t.getRsc("templates",f)||s(f):f,u(l,{tmpl:f,render:ot,index:a,view:t,ctx:c(l.ctx,it)}),!h){k._ctr?(h=new k._ctr,yt=!!h.init,h.attr=h.attr||k.attr||i):h={render:k.render};h._={inline:!p};p&&(p.attr=h.attr=p.attr||h.attr,p.tag=h,h.linkCtx=p);(h._.bnd=bt||p.fn)?h._.arrVws={}:h.dataBoundOnly&&v("{^{"+n+"}} tag must be data-bound");h.tagName=n;h.parent=ut=it&&it.tag;h._is="tag";h._def=k;for(st in d=l.props)rt.test(st)&&(h[st]=d[st])}l.tag=h;h.map&&h.tagCtxs&&(l.map=h.tagCtxs[a].map);h.flow||(ft=l.ctx=l.ctx||{},wt=h.parents=ft.parentTags=it&&c(ft.parentTags,it.parentTags)||{},ut&&(wt[ut.tagName]=ut),ft.tag=h)}for(h.tagCtxs=e,t._.tag=h,h.rendering={},a=0;a<vt;a++)l=h.tagCtx=e[a],d=l.props,y=et(h,h.convert),(pt=d.map||h).map&&(y.length||d.map)&&(nt=l.map=u(l.map||{unmap:pt.unmap},d),nt.src!==y[0]&&(nt.src&&nt.unmap(),pt.map.apply(nt,y)),y=[nt.tgt]),h.ctx=l.ctx,!a&&yt&&(kt=h.template,h.init(l,p,h.ctx),yt=i,h.template!==kt&&(h._.tmpl=h.template)),w=i,ct=h.render,(ct=h.render)&&(w=ct.apply(h,y)),y=y.length?y:[t],w=w!==i?w:l.render(y[0],!0)||(o?i:""),g=g?g+(w||""):w;return delete h.rendering,h.tagCtx=h.tagCtxs[0],h.ctx=h.tagCtx.ctx,h._.inline&&(at=h.attr)&&at!==b&&(g=at==="text"?lt.html(g):""),ht&&t._.onRender?t._.onRender(g,t,ht):g}function nt(n,t,i,r,u,f,e,o){var a,h,c,v=t==="array",l={key:0,useKey:v?0:1,id:""+wi++,onRender:o,bnds:{}},s={data:r,tmpl:u,content:e,views:v?[]:{},parent:i,type:t,get:ki,getIndex:ti,getRsc:nr,hlp:di,_:l,_is:"view"};return i?(a=i.views,h=i._,h.useKey?(a[l.key="_"+h.useKey++]=s,s.index=vt,s.getIndex=ni,c=h.tag,l.bnd=v&&(!c||!!c._.bnd&&c)):a.splice(l.key=s.index=f,0,s),s.ctx=n||i.ctx):s.ctx=n,s}function ir(n){var t,i,r,u,f;for(t in k)if(u=k[t],(f=u.compile)&&(i=n[t+"s"]))for(r in i)i[r]=f(r,i[r],n,t,u)}function rr(n,t,i){var u,r;return typeof t=="function"?t={depends:t.depends,render:t}:((r=t.template)&&(t.template=""+r===r?s[r]||s(r):r),t.init!==!1&&(u=t._ctr=function(){},(u.prototype=t).constructor=u)),i&&(t._parentTmpl=i),t}function ii(r,u,f,e,o,h){function v(i){if(""+i===i||i.nodeType>0){try{a=i.nodeType>0?i:!at.test(i)&&t&&t(n.document).find(i)[0]}catch(u){}return a&&(i=a.getAttribute(wt),r=r||i,i=s[i],i||(r=r||"_"+pi++,a.setAttribute(wt,r),i=s[r]=ii(r,a.innerHTML,f,e,o,h))),i}}var l,a;return u=u||"",l=v(u),h=h||(u.markup?u:{}),h.tmplName=r,f&&(h._parentTmpl=f),!l&&u.markup&&(l=v(u.markup))&&l.fn&&(l.debug!==u.debug||l.allowCode!==u.allowCode)&&(l=l.markup),l!==i?(r&&!f&&(ut[r]=function(){return u.render.apply(u,arguments)}),l.fn||u.fn?l.fn&&(u=r&&r!==l.tmplName?c(h,l):l):(u=ri(l,h),st(l.replace(ci,"\\$&"),u)),ir(h),u):void 0}function ri(n,t){var i,o=e.wrapMap||{},r=u({markup:n,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:ot},t);return t.htmlTag||(i=vi.exec(n),r.htmlTag=i?i[1].toLowerCase():""),i=o[r.htmlTag],i&&i!==o.div&&(r.markup=f.trim(r.markup)),r}function ur(n,t){function u(e,o,s){var a,h,v,c;if(e&&""+e!==e&&!e.nodeType&&!e.markup){for(v in e)u(v,e[v],o);return r}return o===i&&(o=e,e=i),e&&""+e!==e&&(s=o,o=e,e=i),c=s?s[f]=s[f]||{}:u,h=t.compile,(a=l.onBeforeStoreItem)&&(h=a(c,e,o,h)||h),e?o===null?delete c[e]:c[e]=h?o=h(e,o,s,n,t):o:o=h(i,o),h&&o&&(o._is=n),(a=l.onStoreItem)&&a(c,e,o,h),o}var f=n+"s";r[f]=u;k[n]=t}function ot(n,t,u,e,o,h){var w,et,tt,y,it,rt,ut,k,p,ft,d,ot,l,a=this,st=!a.attr||a.attr===b,g="";if(!!t===t&&(u=t,t=i),o===!0&&(ut=!0,o=0),a.tag?(k=a,a=a.tag,ft=a._,ot=a.tagName,l=ft.tmpl||k.tmpl,t=c(t,a.ctx),p=k.content,k.props.link===!1&&(t=t||{},t.link=!1),e=e||k.view,n=arguments.length?n:e):l=a.jquery&&(a[0]||v('Unknown template: "'+a.selector+'"'))||a,l&&(!e&&n&&n._is==="view"&&(e=n),e&&(p=p||e.content,h=h||e._.onRender,n===e&&(n=e.data),t=c(t,e.ctx)),e&&e.data!==i||((t=t||{}).root=n),l.fn||(l=s[l]||s(l)),l)){if(h=(t&&t.link)!==!1&&st&&h,d=h,h===!0&&(d=i,h=e._.onRender),t=l.helpers?c(l.helpers,t):t,f.isArray(n)&&!u)for(y=ut?e:o!==i&&e||nt(t,"array",e,n,l,o,p,h),w=0,et=n.length;w<et;w++)tt=n[w],it=nt(t,"item",y,tt,l,(o||0)+w,p,h),rt=l.fn(tt,it,r),g+=y._.onRender?y._.onRender(rt,it):rt;else y=ut?e:nt(t,ot||"data",e,n,l,o,p,h),ft&&!a.flow&&(y.tag=a),g+=l.fn(n,y,r);return d?d(g,y):g}return""}function v(n){throw new l.Error(n);}function h(n){v("Syntax error\n"+n)}function st(n,t,i,r){function v(t){t-=f;t&&s.push(n.substr(f,t).replace(it,"\\n"))}function c(t){t&&h('Unmatched or missing tag: "{{/'+t+'}}" in template:\n'+n)}function p(e,y,p,k,d,g,nt,tt,ut,ft,et,ot){g&&(d=":",k=b);ft=ft||i;var pt,lt,at=y&&[],ct="",st="",vt="",yt=!ft&&!d&&!nt;p=p||(ut=ut||"#data",d);v(ot);f=ot+e.length;tt?w&&s.push(["*","\n"+ut.replace(hi,"$1")+"\n"]):p?(p==="else"&&(ai.test(ut)&&h('for "{{else if expr}}" use "{{else expr}}"'),at=u[6],u[7]=n.substring(u[7],ot),u=o.pop(),s=u[3],yt=!0),ut&&(ut=ut.replace(it," "),ct=ht(ut,at,t).replace(li,function(n,t,i){return t?vt+=i+",":st+=i+",",a=a||rt.test(i.split(":")[0]),""})),st=st.slice(0,-1),ct=ct.slice(0,-1),pt=st&&st.indexOf("noerror:true")+1&&st||"",l=[p,k||!!r||a||"",ct,yt&&[],'\n\tparams:"'+ut+'",\n\tprops:{'+st+"}"+(vt?",ctx:{"+vt.slice(0,-1)+"}":""),pt,at||0],s.push(l),yt&&(o.push(u),u=l,u[7]=f)):et&&(lt=u[0],c(et!==lt&&lt!=="else"&&et),u[7]=n.substring(u[7],ot),u=o.pop());c(!u&&et);s=u[3]}var l,a,w=t&&t.allowCode,e=[],f=0,o=[],s=e,u=[,,,e];return c(o[0]&&o[0][3].pop()[0]),n.replace(y,p),v(n.length),(f=e[e.length-1])&&c(""+f!==f&&+f[7]===f[7]&&f[0]),ui(e,i?n:t,i)}function ui(n,i,r){var a,f,o,l,v,p,ht,ct,lt,at,et,w,s,ot,y,tt,k,rt,vt,d,yt,pt,st,ut,g,c=0,u="",nt="",ft={},wt=n.length;for(""+i===i?(y=r?'data-link="'+i.replace(it," ").slice(1,-1)+'"':i,i=0):(y=i.tmplName||"unnamed",i.allowCode&&(ft.allowCode=!0),i.debug&&(ft.debug=!0),w=i.bnds,ot=i.tmpls),a=0;a<wt;a++)if(f=n[a],""+f===f)u+='\nret+="'+f+'";';else if(o=f[0],o==="*")u+=""+f[1];else{if(l=f[1],v=f[2],rt=f[3],p=f[4],nt=f[5],vt=f[7],(pt=o==="else")||(c=0,w&&(s=f[6])&&(c=w.push(s))),(st=o===":")?(l&&(o=l===b?">":l+o),nt&&(ut="prm"+a,nt="try{var "+ut+"=["+v+"][0];}catch(e){"+ut+'="";}\n',v=ut)):(rt&&(tt=ri(vt,ft),tt.tmplName=y+"/"+o,ui(rt,tt),ot.push(tt)),pt||(k=o,yt=u,u=""),d=n[a+1],d=d&&d[0]==="else"),p+=",\n\targs:["+v+"]}",st&&(s||l&&l!==b)){if(g=new Function("data,view,j,u"," // "+y+" "+c+" "+o+"\n"+nt+"return {"+p+";"),g.paths=s,g._ctxs=o,r)return g;et=1}if(u+=st?"\n"+(s?"":nt)+(r?"return ":"ret+=")+(et?(et=0,at=!0,'c("'+l+'",view,'+(s?(w[c-1]=g,c):"{"+p)+");"):o===">"?(ct=!0,"h("+v+");"):(lt=!0,"(v="+v+")!="+(r?"=":"")+'u?v:"";')):(ht=!0,"{view:view,tmpl:"+(rt?ot.length:"0")+","+p+","),k&&!d){if(u="["+u.slice(0,-1)+"]",(r||s)&&(u=new Function("data,view,j,u"," // "+y+" "+c+" "+k+"\nreturn "+u+";"),s&&((w[c-1]=u).paths=s),u._ctxs=o,r))return u;u=yt+'\nret+=t("'+k+'",view,this,'+(c||u)+");";s=0;k=0}}u="// "+y+"\nvar j=j||"+(t?"jQuery.":"js")+"views"+(lt?",v":"")+(ht?",t=j._tag":"")+(at?",c=j._cnvt":"")+(ct?",h=j.converters.html":"")+(r?";\n":',ret="";\n')+(e.tryCatch?"try{\n":"")+(ft.debug?"debugger;":"")+u+(r?"\n":"\nreturn ret;\n")+(e.tryCatch?"\n}catch(e){return j._err(e);}":"");try{u=new Function("data,view,j,u",u)}catch(bt){h("Compiled template code:\n\n"+u,bt)}return i&&(i.fn=u),u}function ht(n,t,i){function b(b,k,d,g,nt,tt,it,rt,ut,ft,et,ot,ct,lt,at,vt,yt,pt,wt,bt){function dt(n,i,r,f,e,o,h,l){if(r&&(t&&(u==="linkTo"&&(s=t._jsvto=t._jsvto||[],s.push(nt)),(!u||c)&&t.push(nt.slice(i.length))),r!==".")){var a=(f?'view.hlp("'+f+'")':e?"view":"data")+(l?(o?"."+o:f?"":e?"":"."+r)+(h||""):(l=f?"":e?o||"":r,""));return a=a+(l?"."+l:""),i+(a.slice(0,9)==="view.data"?a.slice(5):a)}return n}var kt;if(tt=tt||"",d=d||k||ot,nt=nt||ut,ft=ft||yt||"",!it||e||f)return t&&vt&&!e&&!f&&(!u||c||s)&&(kt=v[r],bt.length-1>wt-kt&&(kt=bt.slice(kt,wt+1),vt=w+":"+kt+o,vt=y[vt]=y[vt]||st(p+vt+a,i,!0),vt.paths||ht(kt,vt.paths=[],i),(s||t).push({_jsvOb:vt}))),e?(e=!ct,e?b:'"'):f?(f=!lt,f?b:'"'):(d?(r++,v[r]=wt++,d):"")+(pt?r?"":u?(u=c=s=!1,"\b"):",":rt?(r&&h(n),u=nt,c=g,"\b"+nt+":"):nt?nt.split("^").join(".").replace(oi,dt)+(ft?(l[++r]=!0,nt.charAt(0)!=="."&&(v[r]=wt),ft):tt):tt?tt:at?(l[r--]=!1,at)+(ft?(l[++r]=!0,ft):""):et?(l[r]||h(n),","):k?"":(e=ct,f=lt,'"'));h(n)}var u,s,c,y=i.links,l={},v={0:-1},r=0,f=!1,e=!1;return(n+" ").replace(/\)\^/g,").").replace(si,b)}function c(n,t){return n&&n!==t?t?u(u({},t),n):n:t&&u({},t)}function fi(n){return pt[n]||(pt[n]="&#"+n.charCodeAt(0)+";")}function fr(n){var i,t,r=[];if(typeof n=="object")for(i in n)t=n[i],t&&t.toJSON&&!t.toJSON()||typeof t!="function"&&r.push({key:i,prop:n[i]});return r}if((!t||!t.views)&&!n.jsviews){var f,tt,y,at,vt,p="{",w="{",o="}",a="}",g="^",oi=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,si=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,it=/[ \t]*(\r\n|\n|\r)/g,hi=/\\(['"])/g,ci=/['"\\]/g,li=/\x08(~)?([^\x08]+)\x08/g,ai=/^if\s/,vi=/<(\w+)[>\s]/,yt=/[\x00`><"'&]/g,rt=/^on[A-Z]|^convert(Back)?$/,yi=yt,pi=0,wi=0,pt={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},b="html",wt="data-jsv-tmpl",ut={},k={template:{compile:ii},tag:{compile:rr},helper:{},converter:{}},r={jsviews:"v1.0.0-beta",render:ut,settings:function(n){u(e,n);kt(e._dbgMode);e.jsv&&e.jsv()},sub:{View:nt,Error:ft,tmplFn:st,cvt:et,parse:ht,extend:u,error:v,syntaxError:h,DataMap:dt},_cnvt:gi,_tag:tr,_err:function(n){return e._dbgMode?"Error: "+(n.message||n)+". ":""}};(ft.prototype=new Error).constructor=ft;ni.depends=function(){return[this.get("item"),"index"]};ti.depends=function(){return["index"]};for(tt in k)ur(tt,k[tt]);var ct,s=r.templates,lt=r.converters,ei=r.helpers,d=r.tags,l=r.sub,e=r.settings;t?(f=t,f.fn.render=ot,(ct=f.observable)&&(u(l,ct.sub),delete ct.sub)):(f=n.jsviews={},f.isArray=Array&&Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"});f.render=ut;f.views=r;f.templates=s=r.templates;e({debugMode:kt,delimiters:gt,_dbgMode:!0,tryCatch:!0});d({"else":function(){},"if":{render:function(n){var t=this;return t.rendering.done||!n&&(arguments.length||!t.tagCtx.index)?"":(t.rendering.done=!0,t.selected=t.tagCtx.index,t.tagCtx.render(t.tagCtx.view,!0))},onUpdate:function(n,t,i){for(var r,f,u=0;(r=this.tagCtxs[u])&&r.args.length;u++)if(r=r.args[0],f=!r!=!i[u].args[0],!this.convert&&!!r||f)return f;return!1},flow:!0},"for":{render:function(n){var u,t=this,r=t.tagCtx,e="",o=0;return t.rendering.done||((u=!arguments.length)&&(n=r.view.data),n!==i&&(e+=r.render(n,u),o+=f.isArray(n)?n.length:1),(t.rendering.done=o)&&(t.selected=r.index)),e},flow:!0,autoBind:!0},include:{flow:!0,autoBind:!0},"*":{render:bt,flow:!0}});d({props:u(u({},d["for"]),dt(fr))});d.props.autoBind=!0;lt({html:function(n){return n!=i?String(n).replace(yi,fi):""},attr:function(n){return n!=i?String(n).replace(yt,fi):n===null?n:""},url:function(n){return n!=i?encodeURI(String(n)):n===null?n:""}});gt()}})(this,this.jQuery),function(n,t,i){"use strict";function f(n){return r(n)?new k(n):new b(n)}function b(n){return this._data=n,this}function k(n){return this._data=n,this}function ht(n){return r(n)?[n]:n}function it(n,t){n=r(n)?n:[n];for(var i,e=t,o=e,h=n.length,f=[],s=0;s<h;s++){if(i=n[s],u(i)){f=f.concat(it(i.call(t,t),t));continue}else if(""+i!==i){t=o=i;o!==e&&f.push(e=o);continue}o!==e&&f.push(e=o);f.push(i)}return f}function rt(n,t){var r,i;for(r in n){i=!0;break}i||delete y[t]}function d(n,t){if(!(n.data&&n.data.off)){var v,y,p,f=t.oldValue,o=t.value,u=n.data,l=u.observeAll,h=!u.cb.noArray,c=u.paths;n.type===a?(u.cb.array||u.cb).call(u,n,t):(u.prop===t.path||u.prop==="*")&&(f=typeof f===s&&(c[0]||h&&r(f))&&f,o=typeof(o=t.value)===s&&(c[0]||h&&r(o))&&o,l?(v=l._path+"."+t.path,y=l.filter,p=[l.parents().slice(0)],f&&e(h,[f],c,u.cb,!0,y,p,v),o&&e(h,[o],c,u.cb,i,y,p,v)):(f&&e(h,[f],c,u.cb,!0),o&&e(h,[o],c,u.cb)),u.cb(n,t))}}function v(){function bt(i,r,u,f){var e,s,y=tt(n),p=ht(n);if(b||f)y&&t(p).off(i,d);else{if(l=y&&t._data(n))for(l=l&&l.events,l=l&&l[u?a:c],wt=l&&l.length;wt--;)if((ft=l[wt].data)&&ft.cb._cId===h._cId){if(u)return;(r==="*"&&ft.prop!==r||ft.prop===v)&&t(n).off(i,d)}s=u?{cb:h}:{fullPath:o,paths:r?[r]:[],prop:v,cb:h};et&&(s.observeAll={_path:et,path:function(){return e=ni.length,et.replace(/[[.]/g,function(n){return e--,n==="["?"["+t.inArray(ni[e-1],ni[e]):"."})},parents:function(){return ni},filter:ui});t(p).on(i,null,s,d);dt&&(dt[t.data(n,"obId")||t.data(n,"obId",st++)]=n)}}function hi(n,t){n._ob=ct(n,pt);var i=pt;return function(u,f){var o=n._ob,c=t.length;typeof o===s&&(kt(o,!0),(c||lt&&r(o))&&e(lt,[o],t,h,ct,!0));o=n._ob=ct(n,i);typeof o===s&&(kt(o),(c||lt&&r(o))&&e(lt,[o],t,h,ct,[i]));h(u,f)}}function kt(t,u,e,o){if(lt){var s=n,c=et;n=t;o&&(n=t[o],et+="."+o,ui&&(n=f._fltr(o,t,et,ui)));n&&(e||r(n))&&bt(a+".observe"+(h?".obs"+(yt=h._cId=h._cId||w++):""),i,!0,u);n=s;et=c}}var vt,ii,fi,ut,v,o,ri,b,h,yt,wt,ft,l,ct,ei,dt,gt,oi,ni,et,ui,lt=this!=!1,si=1,ti=ot,k=Array.apply(0,arguments),g=k.pop(),pt=k.shift(),at=pt,n=at,nt=k.length;for(u(g)?h=g:(g+""===g&&(et=g,ni=k.pop(),ui=k.pop(),g=k.pop(),nt=nt-3),g===!0?b=g:g&&(pt=g,si=0),g=k[nt-1],(nt&&g===i||u(g))&&(h=k.pop(),nt--)),nt&&u(k[nt-1])&&(ct=h,h=k.pop(),nt--),ti+=b?h?".obs"+h._cId:"":".obs"+(yt=h._cId=h._cId||w++),b||(dt=y[yt]=y[yt]||{}),r(at)?kt(at,b,!0):b&&nt===0&&at&&bt(ti,""),gt=0,vt=0;vt<nt;vt++)if(o=k[vt],o!==""){if(n=at,""+o===o){if(ut=o.split("^"),ut[1]&&(gt=ut[0].split(".").length,o=ut.join("."),gt=o.split(".").length-gt),ct&&(ei=ct(o,at))){nt+=ei.length-1;p.apply(k,[vt--,1].concat(ei));continue}ut=o.split(".")}else si&&!u(o)&&(o._jsvOb&&(b||(o._cb=oi=hi(o,k.slice(vt+1)),oi.noArray=lt===!1,o._rt=pt,oi._cId=h._cId),e(lt,[o._rt],k.slice(0,vt),o._cb,ct,b),o=o._ob),n=o),at=o,ut=[at];while(n&&(v=ut.shift())!==i)if(typeof n===s){if(""+v===v){if(v==="")continue;if(ut.length<gt+1&&!n.nodeType){if(!b&&(l=tt(n)&&t._data(n))){for(l=l.events,l=l&&l[c],wt=l&&l.length,fi=0;wt--;)ft=l[wt].data,ft&&ft.cb===h&&(ft.prop===v||ft.prop==="*")&&((ii=ut.join("."))&&ft.paths.push(ii),fi++);if(fi){n=n[v];continue}}if(v==="*"){!b&&l&&l.length&&bt(ti,"",!1,!0);u(n)?(ri=n.depends)&&e(lt,[ri],h,b||pt):bt(ti,"");for(ii in n)kt(n,b,i,ii);break}else v&&bt(ti+"."+v,ut.join("."))}et&&(et+="."+v);v=n[v]}if(u(v)){(ri=v.depends)&&e(lt,[n],it(ri,n),h,ct,b||[pt]);break}n=v}kt(n,b)}return yt&&rt(dt,yt),{cbId:yt,bnd:dt,leaf:n}}function ct(){return[].push.call(arguments,!0),v.apply(this,arguments)}function e(){var n=[].concat.apply([],arguments);return v.apply(n.shift(),n)}function ut(n,t,i){return i.indexOf(".")<0&&i.indexOf("[")<0&&t[n]}function lt(n,r,u,f,e){return f=f||ut,e=e||ut,{getTgt:n,obsSrc:r,obsTgt:u,map:function(i){var o=this,h,c;return o.src!==i&&(o.src&&o.unmap(),typeof i===s&&(c=n.apply(o,arguments),t.observable&&(t.observable(i).observeAll(o.obs=function(n,t){!h&&r&&(h=!0,r.call(o,i,c,n,t),h=!1)},f),t.observable(c).observeAll(o.obt=function(n,t){!h&&u&&(h=!0,u.call(o,i,c,n,t),h=!1)},e)),o.src=i,o.tgt=c)),o},unmap:function(){if(t.observable){var n=this;n.src&&(t.observable(n.src).unobserveAll(n.obs,f),t.observable(n.tgt).unobserveAll(n.obt,e),n.src=n.tgt=i)}}}}function ft(n,t){l(this._data,n,t,[],"root")}function et(n,t){l(this._data,n,t,[],"root",!0)}function l(n,t,u,e,o,h){function y(n,i){for(a=n.length,c=o+"[]";a--;)(b=f._fltr(a,n,c,u))&&l(b,t,u||"",e.slice(0),c,i)}function k(n,i){o=n.data.observeAll._path;var r=e;e[0]!==n.target&&(e=e.slice(0),e.unshift(n.target));switch(i.change){case"insert":y(i.items);break;case"remove":y(i.items,!0);break;case"refresh":y(i.oldItems,!0);y(n.target);break;case"set":c=o+"."+i.path;l(i.oldValue,t,0,e.slice(0),c,!0);l(i.value,t,0,e.slice(0),c)}t.apply(this,arguments);e=r}var a,p,c,b;if(typeof n===s)if(p=r(n)?"":"*",e.unshift(n),t?(p||u!==0)&&(k._cId=t._cId=t._cId||w++,v(n,p,k,h,u,e.slice(),o)):v(n,p,i,h,u,e.slice(),o),p)for(a in n)a.charAt(0)!=="_"&&a!==nt&&(c=o+"."+a,(b=f._fltr(a,n,c,u))&&l(b,t,u||0,e.slice(0),c,h));else y(n,h)}if(!t)throw"jsViews/jsObservable require jQuery";if(!t.observable){var g=t.event.special,o=t.views?t.views.sub:f.sub={},p=[].splice,r=t.isArray,nt=t.expando,s="object",h=parseInt,c=o.propChng=o.propChng||"propertyChange",a=o.arrChng=o.arrChng||"arrayChange",y=o._cbBnds=o._cbBnds||{},ot=c+".observe",u=t.isFunction,st=1,w=1,tt=t.hasData;o.getDeps=function(){var n=arguments;return function(){for(var i,t,r=[],f=n.length;f--;)i=n[f--],t=n[f],t&&(r=r.concat(u(t)?t(i,i):t));return r}};o.DataMap=lt;t.observable=f;f._fltr=function(n,t,i,r){var f=r&&u(r)?r(n,t,i):t[n];return f&&(f=u(f)?f.set&&f.call(t):f),typeof f===s&&f};f.Object=b;f.Array=k;t.observe=f.observe=v;t.unobserve=f.unobserve=ct;f._apply=e;b.prototype={_data:null,observeAll:ft,unobserveAll:et,data:function(){return this._data},setProperty:function(n,t,u){var f,h,s,e=this,o=e._data;if(n=n||"",o)if(r(n))for(f=n.length;f--;)h=n[f],e.setProperty(h.name,h.value,u===i||u);else if(""+n!==n)for(f in n)e.setProperty(f,n[f],t);else if(n!==nt){for(s=n.split(".");o&&s.length>1;)o=o[s.shift()];e._setProperty(o,s.join("."),t,u)}return e},_setProperty:function(n,t,i,r){var e,o,f=t?n[t]:n;u(f)&&f.set&&(o=f,e=f.set===!0?f:f.set,f=f.call(n));(f!==i||r&&f!=i)&&(!(f instanceof Date)||f>i||f<i)&&(e?(e.call(n,i),i=o.call(n)):t&&(n[t]=i),this._trigger(n,{change:"set",path:t,value:i,oldValue:f}))},_trigger:function(n,i){t(n).triggerHandler(c,i)}};k.prototype={_data:null,observeAll:ft,unobserveAll:et,data:function(){return this._data},insert:function(n,t){var i=this._data;return arguments.length===1&&(t=n,n=i.length),n=h(n),n>-1&&n<=i.length&&(t=r(t)?t:[t],t.length&&this._insert(n,t)),this},_insert:function(n,t){var i=this._data,r=i.length;p.apply(i,[n,0].concat(t));this._trigger({change:"insert",index:n,items:t},r)},remove:function(n,t){var r,u=this._data;return n===i&&(n=u.length-1),n=h(n),t=t?h(t):t===0?0:1,t>-1&&n>-1&&(r=u.slice(n,n+t),t=r.length,t&&this._remove(n,t,r)),this},_remove:function(n,t,i){var r=this._data,u=r.length;r.splice(n,t);this._trigger({change:"remove",index:n,items:i},u)},move:function(n,t,i){if(i=i?h(i):i===0?0:1,n=h(n),t=h(t),i>0&&n>-1&&t>-1&&n!==t){var r=this._data.slice(n,n+i);i=r.length;i&&this._move(n,t,i,r)}return this},_move:function(n,t,i,r){var u=this._data,f=u.length;u.splice(n,i);u.splice.apply(u,[t,0].concat(r));this._trigger({change:"move",oldIndex:n,index:t,items:r},f)},refresh:function(n){var t=this._data.slice(0);return this._refresh(t,n),this},_refresh:function(n,t){var i=this._data,r=i.length;p.apply(i,[0,i.length].concat(t));this._trigger({change:"refresh",oldItems:n},r)},_trigger:function(n,i){var r=this._data,u=r.length,f=t([r]);f.triggerHandler(a,n);u!==i&&f.triggerHandler(c,{change:"set",path:"length",value:u,oldValue:i})}};g[c]=g[a]={remove:function(n){var r,u,f,e,o,i=n.data;if(i&&(i.off=1,i=i.cb)&&(r=y[i._cId])){for(f=t._data(this).events[n.type],e=f.length;e--&&!u;)u=(o=f[e].data)&&o.cb===i;u||(delete r[t.data(this,"obId")],rt(r,i._cId))}}}}}(this,this.jQuery),function(n,t,i){"use strict";function or(n){var t=this.linkedElem;t&&et({target:t[0]},n)}function et(n,r){var p,nt,c,f,w,l,e,b,o,a,tt,k,g,u,s,v,y=n.target,it=y._jsvBnd,ut=/&(\d+)\+?/g;if(it)while(a=ut.exec(it))if((a=h[a[1]])&&(s=a.to)){if(f=a.linkCtx,o=f.view,u=f.tag,b=t(y),k=o.hlp(bt),g=o.hlp(kt),c=ot(y),p=ni[c],r===i&&(r=rt(c)?c(y):p?b[p]():b.attr(c)),l=s[1],s=s[0],l&&(w=rt(l)?l:o.getRsc("converters",l)),w&&(r=w.call(u,r)),tt=o.linkCtx,o.linkCtx=f,v={change:"change",oldValue:f._val,value:r},(!k||!(nt=k.call(f,n,v)===!1))&&(!u||!u.onBeforeChange||!(nt=u.onBeforeChange(n,v)===!1))&&r!==i&&(e=s[0],r!==i&&e)){if(e=e._jsvOb?e._ob:e,u&&(u._.chging=!0),d(e).setProperty(s[2]||s[1],r),g&&g.call(f,n,v),u){if(u.onAfterChange)u.onAfterChange(n,v);delete u._.chging}f._val=r}o.linkCtx=tt}}function au(n,t,u){var h,s,f,e=this,y=e.data,a=e.elem,l=e.convert,p=a.parentNode,b=p,o=e.view,k=o.ctx,w=o.linkCtx,v=o.hlp(bt);if(o.linkCtx=e,p&&(!v||!(t&&v.call(e,n,t)===!1))&&!(t&&n.data.prop!=="*"&&n.data.prop!==t.path)){if(t&&(e.eventArgs=t),t||e._initVal){if(delete e._initVal,s=u.call(o.tmpl,y,o,r),h=vu(s,e,f,e.attr||ot(a,!0,l!==i)),f=e.tag){if(t&&f.onUpdate&&f.onUpdate(n,t,s=s[0]?s:[s])===!1||h==="none"){f.tagCtxs=s;f.tagCtx=s[0];h===c&&f.onBeforeLink&&f.onBeforeLink();ct(f,f.tagCtx);ei(e,y,a);o.linkCtx=w;return}if(f._.chging)return;s=f.tagName.slice(-1)===":"?r._cnvt(f.tagName.slice(0,-1),o,s):r._tag(f,o,o.tmpl,s,!0)}else u._ctxs&&(l=l===""?"true":l,s=l?r._cnvt(l,o,s):r._tag(u._ctxs,o,o.tmpl,s,!0),f=o._.tag,h=e.attr||h);sr(s,e,h,f)&&t&&(v=o.hlp(kt))&&v.call(e,n,t)}f&&(f.contents=hi,f.nodes=ci,f.childTags=li,f.currentCtxs=pr,f.update=or,f.refresh=br,ct(f,f.tagCtx));ei(e,y,a);o.linkCtx=w}}function vu(n,r,u,f){var e,h,c,o,s=u&&u.parentElem||r.elem;if(n!==i){if(o=t(s),f=u&&u.attr||f,rt(n)&&it(r.expr+": missing parens"),f==="visible"&&(f="css-display"),c=/^css-/.test(f)&&f.slice(4))e=t.style(s,c),+n===n&&(e=parseInt(e)),e=t.style(s,c);else if(f!=="link"){if(f==="value")s.type===dt&&(e=o.prop(f=w));else if(f===ft)if(s.value===""+n)e=o.prop(w);else return f;e===i&&(h=ni[f],e=h?o[h]():o.attr(f))}r._val=e}return f}function sr(n,r,u,f){var k,o,h,v,d,a,y=n!==i,g=r.data,e=f&&f.parentElem||r.elem,p=t(e),s=r.view,b=r._val,nt=s.ctx,tt=s.linkCtx,l=f||u===c;if(f&&(f.parentElem=f.parentElem||r.expr||f._elCnt?e:e.parentNode,o=f._prv,h=f._nxt),!y){u===c&&f&&f.onBeforeLink&&f.onBeforeLink();return}if(/^css-/.test(u))r.attr==="visible"&&(n=n?yu(e):"none"),(l=l||b!==n)&&t.style(e,u.slice(4),n);else if(u!=="link"){if(u===w)a=1,n=n&&n!=="false";else if(u===ft)if(e.value===""+n)n=!0,a=1,u=w;else{ei(r,g,e);return}else(u==="selected"||u==="disabled"||u==="multiple"||u==="readonly")&&(n=n&&n!=="false"?u:null);(k=ni[u])?u===c?(s.linkCtx=r,s.ctx=r.ctx,f&&f._.inline?(d=f.nodes(!0),f._elCnt&&(o&&o!==h&&vi(o,h,e,f._tgId,"^",!0),o=o?o.previousSibling:h?h.previousSibling:e.lastChild),t(d).remove(),f&&f.onBeforeLink&&f.onBeforeLink(),v=s.link(s.data,e,o,h,n,f&&{tag:f._tgId,lazyLink:f.tagCtx.props.lazyLink})):(y&&p.empty(),f&&f.onBeforeLink&&f.onBeforeLink(),y&&(v=s.link(g,e,o,h,n,f&&{tag:f._tgId}))),s.linkCtx=tt,s.ctx=nt):(l=l||b!==n)&&(u==="text"&&e.children&&!e.children[0]?e.textContent!==i?e.textContent=n:e.innerText=n===null?"":n:p[k](n)):(l=l||b!==n)&&p[a?"prop":"attr"](u,n===i&&!a?null:n);r._val=n}return v||l}function hr(n,t){var i=this,r=i.hlp(bt),u=i.hlp(kt);if(!r||r.call(this,n,t)!==!1){if(t){var o=t.change,f=t.index,e=t.items;switch(o){case"insert":i.addViews(f,e);break;case"remove":i.removeViews(f,e.length);break;case"move":i.refresh();break;case"refresh":i.refresh()}}u&&u.call(this,n,t)}}function yu(t){var i,u,f=n.getComputedStyle,r=(t.currentStyle||f.call(n,t,"")).display;return r!=="none"||(r=ur[u=t.nodeName])||(i=e.createElement(u),e.body.appendChild(i),r=(f?f.call(n,i,""):i.currentStyle).display,ur[u]=r,e.body.removeChild(i)),r}function ui(n){var f,e,u=n.data,r=n._.bnd;if(!n._.useKey&&r)if((e=n._.bndArr)&&(t([e[1]]).off(wt,e[0]),n._.bndArr=i),r!==!!r&&r._.inline)u?r._.arrVws[n._.id]=n:delete r._.arrVws[n._.id];else if(u){f=function(t){t.data&&t.data.off||hr.apply(n,arguments)};t([u]).on(wt,f);n._.bndArr=[f,u]}}function ot(n,t,i){var u=n.nodeName.toLowerCase(),r=f.merge[u]||n.contentEditable==="true"&&{to:c,from:c};return r?t?u==="input"&&n.type===ft?ft:r.to:r.from:t?i?"text":c:""}function cr(n,r,u,f,e,o,s){var p,c,v,w,b,l=n.parentElem,h=n._prv,a=n._nxt,y=n._elCnt;if(h&&h.parentNode!==l&&it("Missing parentNode"),s){w=n.nodes();y&&h&&h!==a&&vi(h,a,l,n._.id,"_",!0);n.removeViews(i,i,!0);c=a;y&&(h=h?h.previousSibling:a?a.previousSibling:l.lastChild);t(w).remove();for(b in n._.bnds)at(b)}else{if(r){if(v=f[r-1],!v)return!1;h=v._nxt}y?(c=h,h=c?c.previousSibling:l.lastChild):c=h.nextSibling}p=u.render(e,o,n._.useKey&&s,n,s||r,!0);n.link(e,l,h,c,p,v)}function fi(n,t,r){var u,f,e;return r?(e="^`",f=t._.tag||{_:{inline:!0,bnd:r},tagCtx:{view:t},flow:!0},u=f._tgId,u||(h[u=fr++]=f,f._tgId=""+u)):(e="_`",y[u=t._.id]=t),"#"+u+e+(n===i?"":n)+"/"+u+e}function ei(n,t,r){var e,l,f,u=n.tag,a=n.convertBack,o=[],c=n._bndId||""+fr++,v=n._hdlr;if(delete n._bndId,u&&(o=u.depends||o,o=rt(o)?u.depends(u):o,f=u.linkedElem),(!n._depends||""+n._depends!=""+o)&&(n._depends&&d._apply(!1,[t],n._depends,v,!0),e=d._apply(!1,[t],n.fn.paths,o,v,n._ctxCb),e.elem=r,e.linkCtx=n,e._tgId=c,r._jsvBnd=r._jsvBnd||"",r._jsvBnd+="&"+c,n._depends=o,n.view._.bnds[c]=c,h[c]=e,f&&(e.to=[[],a]),(f||a!==i)&&wr(e,u&&u.convertBack||a),u)){if(u.onAfterBind)u.onAfterBind(e);u.flow||u._.inline||(r.setAttribute(s,(r.getAttribute(s)||"")+"#"+c+"^/"+c+"^"),u._tgId=""+c)}if(f&&f[0])for(u._.radio&&(f=f.children("input[type=radio]")),l=f.length;l--;)f[l]._jsvBnd=f[l]._jsvBnd||r._jsvBnd+"+",f[l]._jsvLnkdEl=u}function lr(n,t,i,r,u,f,e){return oi(this,n,t,i,r,u,f,e)}function oi(n,r,u,o,s,h,c,a){if(n&&r){if(r=r.jquery?r:t(r),!b){b=e.body;t(b).on(di,et).on("blur","[contenteditable]",function(n){var t=f.noValidate;f.noValidate=!0;et(n);f.noValidate=t})}for(var k,nt,tt,g,w,d,v,it,rt=fi,ft=o&&o.target==="replace",ut=r.length;ut--;)if(v=r[ut],""+n===n)w=p(v),it=w.ctx,w.ctx=o,st(n,v,p(v),u),w.ctx=it;else{if(h=h||p(v),n.markup!==i)h.link===!1&&(o=o||{},o.link=rt=!1),ft&&(d=v.parentNode),tt=n.render(u,o,s,h,i,rt),d?(c=v.previousSibling,a=v.nextSibling,t.cleanData([v],!0),d.removeChild(v),v=d):(c=a=i,t(v).empty());else if(n!==!0)break;if(v._dfr&&!a){for(g=l(v._dfr,!0,er),k=0,nt=g.length;k<nt;k++)w=g[k],(w=y[w.id])&&w.data!==i&&w.parent.removeViews(w._.key,i,!0);v._dfr=""}h.link(u,v,c,a,tt,i,o)}}return r}function pu(n,r,u,c,v,w,b,d){function vu(n,t,r,u,e,o,h,c,l,a,y,p){var w,b="";return g=c||l||"",u=u||a,r=r||p,vi&&!r&&(u||g||o)&&(vi=i,ut=gt.shift()),u=u||r,u&&(vi=i,f.noValidate||(r||p?ri[ut]||(w="'<"+ut+".../"):ri[u]?w="'<\/"+u:gt.length&&u===ut||(w="Mismatch: '<\/"+u),w&&ir(w+">' in:\n"+v)),fr=ft,ut=gt.shift(),ft=ii[ut],a=a?"<\/"+a+">":"",fr&&(at+=pt,pt="",ft?at+="-":(b=a+nr+"@"+at+gi+(y||""),at=lu.shift()))),ft?(o?pt+=o:t=a||p||"",g&&(t+=g,pt&&(t+=" "+s+'="'+pt+'"',pt=""))):t=o?t+b+e+nr+o+gi+h+g:b||n,g&&(gt.unshift(ut),ut=g.slice(1),gt[0]&&gt[0]===fu[ut]&&it("Parent of <tr> must be <tbody>"),vi=ri[ut],(ft=ii[ut])&&!fr&&(lu.unshift(at),at=""),fr=ft,at&&ft&&(at+="+")),t}function pi(n,t){var o,l,u,e,f,a,s,c=[];if(n){for(n._tkns.charAt(0)==="@"&&(t=nt.previousSibling,nt.parentNode.removeChild(nt),nt=null),bt=n.length;bt--;){if(ot=n[bt],u=ot.ch,o=ot.path)for(et=o.length-1;l=o.charAt(et--);)l==="+"?o.charAt(et)==="-"?(et--,t=t.previousSibling):t=t.parentNode:t=t.lastChild;u==="^"?(g=h[f=ot.id])&&(s=t&&(!nt||nt.parentNode!==t),(!nt||s)&&(g.parentElem=t),ot.elCnt&&s&&(t._dfr=(ot.open?"#":"/")+f+u+(t._dfr||"")),c.push([s?null:nt,ot])):(rt=y[f=ot.id])&&(rt.link||(rt.parentElem=t||nt&&nt.parentNode||r,k(rt,yt),rt._.onRender=fi,rt._.onArrayChange=hr,ui(rt)),e=rt.parentElem,ot.open?(rt._elCnt=ot.elCnt,t?t._dfr="#"+f+u+(t._dfr||""):(rt._prv||(e._dfr=ht(e._dfr,"#"+f+u)),rt._prv=nt)):(t&&(!nt||nt.parentNode!==t)?(t._dfr="/"+f+u+(t._dfr||""),rt._nxt=i):nt&&(rt._nxt||(e._dfr=ht(e._dfr,"/"+f+u)),rt._nxt=nt),si=rt.linkCtx,(a=rt.ctx&&rt.ctx.onAfterCreate||pu)&&a.call(si,rt)))}for(bt=c.length;bt--;)sr.push(c[bt])}return!n||n.elCnt}function yu(n){var t,i;if(n)for(bt=n.length,et=0;et<bt;et++)if(ot=n[et],vt.id)vt.id=vt.id!==ot.id&&vt.id;else if(i=g=h[ot.id].linkCtx.tag,!g.flow){if(!wr){for(t=1;i=i.parent;)t++;tr=tr||t}(wr||t===tr)&&(!kr||g.tagName===kr)&&ar.push(g)}}function iu(){for(cr=ti?r.querySelectorAll(tt):t(tt,r).get(),ni=cr.length,u&&u.innerHTML&&(wi=ti?u.querySelectorAll(tt):t(tt,u).get(),u=wi.length?wi[wi.length-1]:u),tr=0,wt=0;wt<ni;wt++)if(nt=cr[wt],u&&!su)su=nt===u;else if(c&&nt===c)break;else nt.parentNode&&au(l(nt,i,ar&&cu))&&!vt&&nt.getAttribute(a)&&sr.push([nt]);if(vr(u,ft),vr(c,ft),vt){kt&&kt.resolve();return}for(ft&&at+pt&&(nt=c,at&&(c?pi(l(at+"+",!0),c):pi(l(at,!0),r)),pi(l(pt,!0),r),c&&(lt=c.getAttribute(s),(ni=lt.indexOf(er)+1)&&(lt=lt.slice(ni+er.length-1)),c.setAttribute(s,pt+lt))),ni=sr.length,wt=0;wt<ni;wt++)nt=sr[wt],dt=nt[1],nt=nt[0],dt?(g=h[dt.id])&&((si=g.linkCtx)&&(g=si.tag,g.linkCtx=si),dt.open?(nt&&(g.parentElem=nt.parentNode,g._prv=nt),g._elCnt=dt.elCnt,!g||g.onBeforeLink&&g.onBeforeLink()===!1||g._.bound||(g._.bound=!0,rt=g.tagCtx.view,st(i,g._prv,rt,rt.data||n,dt.id)),g._.linking=!0):(g._nxt=nt,g._.linking&&(dr=g.tagCtx,rt=dr.view,g.contents=hi,g.nodes=ci,g.childTags=li,g.currentCtxs=pr,g.update=or,g.refresh=br,delete g._.linking,g._.bound||(g._.bound=!0,st(i,g._prv,rt,rt.data||n,dt.id)),ct(g,dr)))):(rt=p(nt),st(nt.getAttribute(a),nt,rt,rt.data||n,i,b));kt&&kt.resolve()}var si,g,wt,ni,et,bt,cr,nt,rt,ot,dt,wi,ki,lr,di,ei,ar,wr,kr,dr,tr,vt,uu,gr,eu,ai,ut,vi,yi,ur,lt,ft,fr,oi,pt,er,su,kt,tu=this,hu=tu._.id+"_",at="",sr=[],gt=[],lu=[],pu=tu.hlp(nu),au=pi;if(w&&(kt=w.lazyLink&&t.Deferred(),w.tmpl?lr="/"+w._.id+"_":(vt=w.get,w.tag&&(hu=w.tag+"^",w=!0)),w=w===!0),vt&&(au=yu,ar=vt.tags,wr=vt.deep,kr=vt.name),r=r?""+r===r?t(r)[0]:r.jquery?r[0]:r:tu.parentElem||e.body,ut=r.tagName.toLowerCase(),ft=!!ii[ut],u=u&&yr(u,ft),c=c&&yr(c,ft)||null,v!==i){if(ur=e.createElement("div"),yi=ur,er=pt="",oi=r.namespaceURI==="http://www.w3.org/2000/svg"?"svg_ns":(ai=ru.exec(v))&&ai[1]||"",bi&&ai&&ai[2]&&it("Unsupported: "+ai[2]),ft){for(ei=c;ei&&!(di=l(ei));)ei=ei.nextSibling;(lt=di?di._tkns:r._dfr)&&(ki=lr||"",(w||!lr)&&(ki+="#"+hu),et=lt.indexOf(ki),et+1&&(et+=ki.length,er=pt=lt.slice(0,et),lt=lt.slice(et),di?ei.setAttribute(s,lt):r._dfr=lt))}if(vi=i,v=(""+v).replace(ou,vu),!f.noValidate&&gt.length&&ir("Mismatched '<"+ut+"...>' in:\n"+v),d)return;for(rr.appendChild(ur),oi=o[oi]||o.div,uu=oi[0],yi.innerHTML=oi[1]+v+oi[2];uu--;)yi=yi.lastChild;for(rr.removeChild(ur),gr=e.createDocumentFragment();eu=yi.firstChild;)gr.appendChild(eu);r.insertBefore(gr,c)}return kt?setTimeout(iu,0):iu(),kt&&kt.promise()}function st(n,t,r,f,e,o){var w,v,b,l,k,d,y,p,a,s,tt;if(f=f||{},e)s=h[e],s=s.linkCtx?s.linkCtx.tag:s,a=s.linkCtx||{data:f,elem:s._elCnt?s.parentElem:t,view:r,ctx:r.ctx,attr:c,fn:s._.bnd,tag:s,_bndId:e},ar(a,a.fn);else if(n&&t)for(w=r.tmpl,n=wu(n,ot(t)),g.lastIndex=0;v=g.exec(n);)tt=g.lastIndex,b=e?c:v[1],y=v[3],k=v[10],l=i,a={data:f,elem:s&&s._elCnt?s.parentElem:t,view:r,ctx:o||r.ctx,attr:b,_initVal:!v[2]},v[6]&&(!b&&(l=/:([\w$]*)$/.exec(k))&&(l=l[1],l!==i&&(d=-l.length-1,y=y.slice(0,d-1)+nt,k=k.slice(0,d))),l===null&&(l=i),a.convert=v[5]||""),a.expr=b+y,p=w.links[y],p||(w.links[y]=p=u.tmplFn(yi+y+pi,w,!0,l),u.parse(k,p.paths=[],w)),a.fn=p,b||l===i||(a.convertBack=l),ar(a,p),g.lastIndex=tt}function ar(n,t){function i(i,r){au.call(n,i,r,t)}i.noArray=!0;n._ctxCb=bu(n.view);n._hdlr=i;i(!0)}function ht(n,t){var i;return n?(i=n.indexOf(t),i+1?n.slice(0,i)+n.slice(i+t.length):n):""}function si(n){return n&&(""+n===n?n:n.tagName==="SCRIPT"?n.type.slice(3):n.nodeType===1&&n.getAttribute(s)||"")}function l(n,t,i){function e(n,t,i,r,e,o){u.push({elCnt:f,id:r,ch:e,open:t,close:i,path:o,token:n})}var f,r,u=[];if(r=t?n:si(n))return u.elCnt=!n.type,f=r.charAt(0)==="@"||!n.type,u._tkns=r,r.replace(i||lu,e),u}function vr(n,t){n&&(n.type==="jsv"?n.parentNode.removeChild(n):t&&n.getAttribute(a)===""&&n.removeAttribute(a))}function yr(n,t){for(var i=n;t&&i&&i.nodeType!==1;)i=i.previousSibling;return i&&(i.nodeType!==1?(i=e.createElement("SCRIPT"),i.type="jsv",n.parentNode.insertBefore(i,n)):si(i)||i.getAttribute(a)||i.setAttribute(a,"")),i}function wu(n,i){return n=t.trim(n).replace(uu,"\\$&"),n.slice(-1)!==nt?n=pt+":"+n+(i?":":"")+nt:n}function hi(n,r){n!==!!n&&(r=n,n=i);var f,u=t(this.nodes());return u[0]&&(f=r?u.filter(r):u,u=n&&r?f.add(u.find(r)):f),u}function ci(n,t,i){var r,u=this,f=u._elCnt,o=!t&&f,e=[];for(t=t||u._prv,i=i||u._nxt,r=o?t===u._nxt?u.parentElem.lastSibling:t:u._.inline===!1?t||u.linkCtx.elem.firstChild:t&&t.nextSibling;r&&(!i||r!==i);)(n||f||r.tagName!=="SCRIPT")&&e.push(r),r=r.nextSibling;return e}function li(n,t){n!==!!n&&(t=n,n=i);var r=this,o=r.link?r:r.tagCtx.view,u=r._prv,f=r._elCnt,e=[];return u&&o.link(i,r.parentElem,f?u.previousSibling:u,r._nxt,i,{get:{tags:e,deep:n,name:t,id:f&&r._tgId}}),e}function pr(){var n=this.tagCtx.view;return this._.bnd.call(n.tmpl,n.data,n,r)}function ct(n,t){var f,r,s,e,o,a,v,l,y=t.view,c=n.linkCtx=n.linkCtx||{tag:n,data:y.data,view:y,ctx:y.ctx};if(n.onAfterLink)n.onAfterLink(t,c);if(f=n.targetTag?n.targetTag.linkedElem:n.linkedElem,f&&(r=f[0])&&((s=n._.radio)&&(f=f.children("input[type=radio]")),s||!n._.chging)){if(e=u.cvt(n,n.convert)[0],s||r!==c.elem){for(v=f.length;v--;){if(r=f[v],l=r._jsvLnkdEl,n._.inline&&(!l||l!==n&&l.targetTag!==n))for(r._jsvLnkdEl=n,o=c.elem?c.elem._jsvBnd:n._prv._jsvBnd,r._jsvBnd=o+"+",o=o.slice(1).split("&"),a=o.length;a--;)wr(h[o[a]],n.convertBack);s&&(r[w]=e===r.value)}c._val=e}s||r.value===i||e===i||(r.type===dt?r[w]=e&&e!=="false":f.val(e))}}function wr(n,t){var e,f,r,o,u=n.linkCtx,s=u.data,i=u.fn.paths;if(n){for((e=i._jsvto)&&(i=e),f=i.length;f&&""+(r=i[--f])!==r;);r&&(!u.tag||u.tag.tagCtx.args.length)?(r=i[f]=r.split("^").join("."),n.to=r.charAt(0)==="."?[[o=i[f-1],r.slice(1)],t]:[u._ctxCb(i[0])||[s,i[0]],t],e&&o&&(n.to[0][0]=u._ctxCb(o,s))):n.to=[[],t]}}function br(n){var u,f,t=this,e=t.linkCtx,o=t.tagCtx.view;return t.disposed&&it("Removed tag"),n===i&&(n=r._tag(t,o,o.tmpl,t.currentCtxs?t.currentCtxs():t.tagCtxs,!0)),n+""===n&&(f=t._.inline?c:e.attr||ot(t.parentElem,!0),u=sr(n,e,f,t)),ct(t,t.tagCtx),u||t}function lt(n){for(var e,o,h,t,s,r,u,c=[],a=n.length,f=a;f--;)c.push(n[f]);for(f=a;f--;)if(t=c[f],t.parentNode){if(u=t._jsvBnd)for(u=u.slice(1).split("&"),t._jsvBnd="",o=u.length;o--;)at(u[o],t._jsvLnkdEl,t);if(s=l(si(t)+(t._dfr||""),!0,su))for(e=0,h=s.length;e<h;e++)r=s[e],r.ch==="_"?(r=y[r.id])&&r.data!==i&&r.parent.removeViews(r._.key,i,!0):at(r.id)}}function at(n,i,r){var c,l,f,o,s,a,v,y,e=h[n];if(i)r===i.linkedElem[0]&&(delete r._jsvLnkdEl,delete i.linkedElem);else if(e){for(c in e.bnd)o=e.bnd[c],s=".obs"+e.cbId,t.isArray(o)?t([o]).off(wt+s).off(ki+s):t(o).off(ki+s),delete e.bnd[c];if(l=e.linkCtx){if(f=l.tag){if(a=f.tagCtxs)for(v=a.length;v--;)(y=a[v].map)&&y.unmap();f.onDispose&&f.onDispose();f._elCnt||(f._prv&&f._prv.parentNode.removeChild(f._prv),f._nxt&&f._nxt.parentNode.removeChild(f._nxt));f.disposed=!0}delete l.view._.bnds[n]}delete h[n];delete u._cbBnds[e.cbId]}}function ai(n,r){return n===i?(b&&(t(b).off(di,et),b=i),n=!0,v.removeViews(),lt(e.body.getElementsByTagName("*"))):r&&(r=r.jquery?r:t(r),n===!0?r.each(function(){for(var n;(n=p(this,!0))&&n.parent;)n.parent.removeViews(n._.key,i,!0);lt(this.getElementsByTagName("*"))}):n===i&&lt(r)),r}function kr(n,t){return ai(this,n,t)}function bu(n){return n=n||t.view(),function(t,i){var f,u,e=[i];if(n&&t){if(t._jsvOb)return t._jsvOb.call(n.tmpl,i,n,r);if(t.charAt(0)==="~")return t.slice(0,4)==="~tag"&&(u=n.ctx,t.charAt(4)==="."&&(f=t.slice(5).split("."),u=u.tag),f)?u?[u,f.join("."),i]:[]:(t=t.slice(1).split("."),(i=n.hlp(t.shift()))&&(t.length&&e.unshift(t.join(".")),e.unshift(i)),i?e:[]);if(t.charAt(0)==="#")return t==="#data"?[]:[n,t.replace(eu,""),i]}}}function ku(n){return n.type===dt?n[w]:n.value}function vi(n,t,i,r,u,f){var v,c,p,o,b,a,e,w=0,k=n===t;if(n){for(p=l(n)||[],v=0,c=p.length;v<c;v++){if(o=p[v],a=o.id,a===r&&o.ch===u)if(f)c=0;else break;k||(b=o.ch==="_"?y[a]:h[a].linkCtx.tag,o.open?b._prv=t:o.close&&(b._nxt=t));w+=a.length+2}w&&n.setAttribute(s,n.getAttribute(s).slice(w));e=t?t.getAttribute(s):i._dfr;(c=e.indexOf("/"+r+u)+1)&&(e=p._tkns.slice(0,w)+e.slice(c+(f?-1:r.length+1)));e&&(t?t.setAttribute(s,e):i._dfr=e)}else i._dfr=ht(i._dfr,"#"+r+u),f||t||(i._dfr=ht(i._dfr,"/"+r+u))}function du(n,i,r,u){switch(u.change){case"set":for(var f=i.length;f--;)if(i[f].key===u.path)break;f===-1?u.path&&t.observable(i).insert({key:u.path,prop:u.value}):u.value===null?(delete n[u.path],t.observable(i).remove(f)):t.observable(i[f]).setProperty("prop",u.value)}}function gu(n,i,r,u){var f;switch(u.change){case"set":u.path==="prop"?t.observable(n).setProperty(r.target.key,u.value):(t.observable(n).setProperty(u.oldValue,null),delete n[u.oldValue],t.observable(n).setProperty(u.value,r.target.prop));break;case"remove":f=u.items[0];t.observable(n).setProperty(f.key,null);delete n[f.key];break;case"insert":f=u.items[0];f.key&&t.observable(n).setProperty(f.key,f.prop)}}function nf(n,t,i){return i.indexOf(".")<0&&t[n]}var vt="JsViews requires ",yt,b,p,g,yi,pt,nt,pi,wi,bi,a,tt,o,e=n.document,r=t.views,u=r.sub,f=r.settings,k=u.extend,v=u.View(i,"top"),rt=t.isFunction,dr=r.templates,gr=r.converters,d=t.observable,ut=d.observe,s="data-jsv",ki=u.propChng=u.propChng||"propertyChange",wt=u.arrChng=u.arrChng||"arrayChange",tf=u._cbBnds=u._cbBnds||{},di="change.jsv",bt="onBeforeChange",kt="onAfterChange",nu="onAfterCreate",w="checked",dt="checkbox",ft="radio",gi='"><\/script>',nr='<script type="jsv',gt="script,["+s+"]",c="html",ni={value:"val",input:"val",html:c,text:"text"},tr={from:"value",to:"value"},tu=t.cleanData,iu=f.delimiters,it=u.error,ir=u.syntaxError,ru=/<(?!script)(\w+)(?:[^>]*(on\w+)\s*=)?[^>]*>/,uu=/['"\\]/g,rr=e.createDocumentFragment(),ti=e.querySelector,ii={ol:1,ul:1,table:1,tbody:1,thead:1,tfoot:1,tr:1,colgroup:1,dl:1,select:1,optgroup:1,svg:1,svg_ns:1},fu={tr:"table"},ri={br:1,img:1,input:1,hr:1,area:1,base:1,col:1,link:1,meta:1,command:1,embed:1,keygen:1,param:1,source:1,track:1,wbr:1},ur={},y={0:v},h={},fr=1,eu=/^#(view\.?)?/,ou=/(^|(\/>)|<\/(\w+)>|>|)(\s*)([#\/]\d+[_^])`(\s*)(<\w+(?=[\s\/>]))?|\s*(?:(<\w+(?=[\s\/>]))|<\/(\w+)>(\s*)|(\/>)\s*)/g,er=/(#)()(\d+)(_)/g,su=/(#)()(\d+)([_^])/g,hu=/(?:(#)|(\/))(\d+)(_)/g,cu=/(#)()(\d+)(\^)/g,lu=/(?:(#)|(\/))(\d+)([_^])([-+@\d]+)?/g;if(!t)throw vt+"jQuery";if(!t.views)throw vt+"JsRender";if(!t.observable)throw vt+"jquery.observable";t.link||(u.onStoreItem=function(n,i,r){r&&n===dr&&(r.link=lr,r.unlink=kr,i&&(t.link[i]=function(){return lr.apply(r,arguments)},t.unlink[i]=function(){return kr.apply(r,arguments)}))},(f.delimiters=function(){var n=iu.apply(r,arguments);return yi=n[0],pt=n[1],nt=n[2],pi=n[3],wi=n[4],g=new RegExp("(?:^|\\s*)([\\w-]*)(\\"+wi+")?(\\"+pt+u.rTag+"\\"+nt+")","g"),this})(),u.viewInfos=l,yt={addViews:function(n,t,i){var u,o,r=this,f=t.length,e=r.views;if(!r._.useKey&&f&&(i=r.tmpl)&&(o=e.length+f,cr(r,n,i,e,t,r.ctx)!==!1))for(u=n+f;u<o;u++)d(e[u]).setProperty("index",u);return r},removeViews:function(n,r,u){function o(n){var s,h,c,e,o,l,r=f[n];if(r&&r.link){if(s=r._.id,u||(l=r.nodes()),r.removeViews(i,i,!0),r.data=i,e=r._prv,o=r._nxt,c=r.parentElem,u||(r._elCnt&&vi(e,o,c,s,"_"),t(l).remove()),!r._elCnt)try{e.parentNode.removeChild(e);o.parentNode.removeChild(o)}catch(a){}ui(r);for(h in r._.bnds)at(h);delete y[s]}}var e,l,s,h=this,c=!h._.useKey,f=h.views;if(c&&(s=f.length),n===i)if(c){for(e=s;e--;)o(e);h.views=[]}else{for(l in f)o(l);h.views={}}else if(r===i&&(c?r=1:(o(n),delete f[n])),c&&r){for(e=n+r;e-->n;)o(e);if(f.splice(n,r),s=f.length)while(n<s)d(f[n]).setProperty("index",n++)}return this},refresh:function(n){var t=this,i=t.parent;return i&&(cr(t,t.index,t.tmpl,i.views,t.data,n,!0),ui(t)),t},nodes:ci,contents:hi,childTags:li,link:pu},gr.merge=function(n){var t,i=this.linkCtx._val||"",r=this.tagCtx.props.toggle;return r&&(t=r.replace(/[\\^$.|?*+()[{]/g,"\\$&"),t="(\\s(?="+t+"$)|(\\s)|^)("+t+"(\\s|$))",i=i.replace(new RegExp(t),"$2"),n=i+(n?(i&&" ")+r:"")),n},r.tags("on",{attr:"none",onAfterLink:function(n,r){var o=this,s=t(r.elem),f=n.args,u=n.props.data,e=f.pop(),h=f[1]||null,c=n.props.context;if(u=u!==i?u:null,e&&e.call)s.on(f[0]||"click",h,u,function(n){e.call(c||o.leaf,n,{change:n.type,view:r.view,linkCtx:r})})},onAfterBind:function(n){this.leaf=n.leaf},flow:!0}),k(r.tags["for"],{onArrayChange:function(n,t){var i,r=this,u=t.change;if(r.tagCtxs[1]&&(u==="insert"&&n.target.length===t.items.length||u==="remove"&&!n.target.length||u==="refresh"&&!t.oldItems.length!=!n.target.length))r.refresh();else for(i in r._.arrVws)i=r._.arrVws[i],i.data===n.target&&i._.onArrayChange.apply(i,arguments);n.done=!0},onAfterLink:function(){for(var u,o,i,f,e=this,r=e._ars||{},s=e.tagCtxs,c=s.length,h=e.selected||0,n=0;n<=h;n++)u=s[n],f=u.map?u.map.tgt:u.args.length?u.args[0]:u.view.data,(i=r[n])&&f!==i[0]&&(ut(i[0],i[1],!0),delete r[n]),!r[n]&&t.isArray(f)&&(ut(f,o=function(n,t){e.onArrayChange(n,t)}),r[n]=[f,o]);for(n=h+1;n<c;n++)(i=r[n])&&(ut(i[0],i[1],!0),delete r[n]);e._ars=r},onDispose:function(){var n,t=this;for(n in t._ars)ut(t._ars[n][0],t._ars[n][1],!0)}}),r.tags({props:t.extend({},r.tags["for"],u.DataMap(r.tags.props.getTgt,du,gu,i,nf))}),k(t,{view:r.view=p=function(n,r,u){r!==!!r&&(u=r,r=i);var f,o,h,c,w,s,b,a,p=0,k=e.body;if(n&&n!==k&&v._.useKey>1&&(n=""+n===n?t(n)[0]:n.jquery?n[0]:n,n))if(r){for(a=ti?n.querySelectorAll(gt):t(gt,n).get(),s=a.length,h=0;h<s;h++)for(b=a[h],o=l(b,i,er),c=0,w=o.length;c<w;c++)if(f=o[c],(f=y[f.id])&&(f=f&&u?f.get(!0,u):f,f))return f}else while(n){if(o=l(n,i,hu))for(s=o.length;s--;)if(f=o[s],f.open){if(p<1)return f=y[f.id],f&&u?f.get(u):f||v;p--}else p++;n=n.previousSibling||n.parentNode}return r?i:v},link:r.link=oi,unlink:r.unlink=ai,cleanData:function(n){n.length&&(lt(n),tu.apply(t,arguments))}}),r.utility={validate:function(n){try{v.link(i,e.createElement("div"),i,i,n,i,i,1)}catch(t){return t.message}}},k(t.fn,{link:function(n,t,i,r,u,f,e){return oi(n,this,t,i,r,u,f,e)},unlink:function(n){return ai(n,this)},view:function(n){return p(this[0],n)}}),k(v,{tmpl:{links:{},tags:{}}}),k(v,yt),v._.onRender=fi,f({wrapMap:o={option:[1,"<select multiple='multiple'>","<\/select>"],legend:[1,"<fieldset>","<\/fieldset>"],area:[1,"<map>","<\/map>"],param:[1,"<object>","<\/object>"],thead:[1,"<table>","<\/table>"],tr:[2,"<table><tbody>","<\/tbody><\/table>"],td:[3,"<table><tbody><tr>","<\/tr><\/tbody><\/table>"],col:[2,"<table><tbody><\/tbody><colgroup>","<\/colgroup><\/table>"],svg_ns:[1,"<svg>","<\/svg>"],div:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","<\/div>"]},linkAttr:a="data-link",merge:{input:{from:ku,to:"value"},textarea:tr,select:tr,optgroup:{to:"label"}},jsrDbgMode:f.debugMode,debugMode:function(t){f.jsrDbgMode(t);t?n._jsv={views:y,bindings:h}:delete n._jsv},jsv:function(){f.debugMode(f._dbgMode);a=f.linkAttr;tt=gt+",["+a+"]";bi=f.noDomLevel0;o.optgroup=o.option;o.tbody=o.tfoot=o.colgroup=o.caption=o.thead;o.th=o.td}}))}(this,this.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{html:{ajax:{item:"index.php"},errors:{malform:"Error!",fail:"Error!",ajax:"No Data!"}},namespace:".observer",stacks:{},defaults:{path:null}},active:{stack:{value:null},paths:{},folders:{},files:{},edit:{value:null}},queue:0,edit:null,initialise:function(t){if(this.set(t),!n.views)return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.store();this.assets();this.requests();this.defaults()},store:function(){n(document).trigger("observer:before:register",[this.options.stacks]);n.each(this.options.stacks,n.proxy(function(t,i){this.active.paths[t]=n.observable({path:i.path});this.active.folders[t]=n.observable([]);this.active.files[t]=n.observable([])},this));this.active.stack=n.observable(this.active.stack);this.active.edit=n.observable(this.active.edit);this.options.stacks=n.observable(this.options.stacks);n(document).trigger("observer:after:register",[this.options.stacks])},assets:function(){n(document).trigger("arkobserver:before:assets");var t=this;n.views.helpers({isChildFolder:function(n,i,r){var u=new RegExp(t.escape(t.options.html.ds+i)+"$");return n!=r&&n.replace(u,"")==r?!0:!1},bytes:function(t,i,r){var t=t,i=i?i:"auto",r=r?parseInt(r):2,f=["B","KB","MB","GB","TB","PB"],u,e;return t?(u=Math.floor(Math.log(t)/Math.log(1024)),i!=="auto"&&n.inArray(i,f)!=-1&&(u=n.inArray(i,f)),e=t/Math.pow(1024,u),parseFloat(e.toFixed(r))+" "+f[u]):0},date:function(n,i,r){return(i=typeof i!="undefined"?i:t.options.html.date,r=typeof r!="undefined"?r:t.options.html.blank,typeof moment=="function"&&n&&n!=="0"&&i)?moment.unix(n).format(i):r},previous:function(n,t){return t[n-1]},next:function(n,t){return t[n+1]}});n.views.tags({reverse:function(t){var i=[];return n.each(t,n.proxy(function(n,t){t.data&&t.events||i.push(this.tagCtx.render(t))},this)),i.reverse().join("\n")},alphabetise:function(t){var i=[];return n.each(t,n.proxy(function(n,t){t.data&&t.events||i.push({key:n,item:t})},this)),i=i.sort(function(n,t){return n.key>t.key?1:-1}),n.map(i,n.proxy(function(n,t){return this.tagCtx.render({i:t,key:n.key,item:n.item})},this)).join("\n")},chronologise:function(t){var i=[],r=this.tagCtx.props.index||null,u=this.tagCtx.props.direction||"asc";return n.each(t,n.proxy(function(n,t){t.data&&t.events||i.push({key:t[r],item:t})},this)),r&&(i=i.sort(function(n,t){return u=="asc"?n.key>t.key?1:-1:n.key<t.key?1:-1})),n.map(i,n.proxy(function(n,t){return this.tagCtx.render({i:t,key:n.key,items:i,item:n.item})},this)).join("\n")},debug:function(n){var t=this.tagCtx.props,i=t.message||"Debug: ";console.log(i,n)}});n(document).trigger("arkobserver:after:assets")},requests:function(){n(document).on("observer:request:all",n.proxy(function(){return this.options.stacks.data()},this));n(document).on("observer:request:item",n.proxy(function(n,t){var i=this.options.stacks.data(),r,u;if(t.stack&&t.path&&i.hasOwnProperty(t.stack))switch(t.type){case"folder":if(r=t.item?t.path+this.options.html.ds+t.item:t.path,i[t.stack].items.hasOwnProperty(r))return u=i[t.stack].items[r],t.load&&!u.loaded&&this.item(t.stack,r),u;break;case"file":if(t.item&&i[t.stack].items.hasOwnProperty(t.path)&&i[t.stack].items[t.path].items.hasOwnProperty(t.item))return i[t.stack].items[t.path].items[t.item]}return!1},this));n(document).on("observer:request:load",n.proxy(function(t,i){var r=this.options.stacks.data();if(i.stack&&i.path&&r.hasOwnProperty(i.stack)){var u=i.item?i.path+this.options.html.ds+i.item:i.path,o={branch:i.branch?i.branch:!0},f={name:"observer:request:loaded",options:i.options?i.options:{}},e=r[i.stack].items.hasOwnProperty(u)?r[i.stack].items[u]:!1;e&&e.loaded?n(document).triggerHandler(f.name,f.options):this.item(i.stack,u,o,f)}},this));n(document).on("observer:request:active",n.proxy(function(t,i){var r;switch(i.type){default:case"stack":return i.value&&this.active.stack.setProperty("value",i.value),this.active.stack.data();case"path":if(this.active.paths.hasOwnProperty(i.stack)){if(i.value&&i.value!=this.active.paths[i.stack].data().path){var u=n(document).triggerHandler("observer:request:item",{type:"folder",stack:i.stack,path:i.value}),f={branch:i.branch?i.branch:!1},e={name:"observer:request:active",options:{type:"path",stack:i.stack,value:i.value}};u&&u.loaded?(this.active.folders[i.stack].refresh([]),this.active.files[i.stack].refresh([]),this.active.paths[i.stack].setProperty("path",i.value)):this.item(i.stack,i.value,f,e)}return this.active.paths[i.stack].data()}return i.stack=="all"?this.active.paths:"";case"folders":return this.active.folders.hasOwnProperty(i.stack)?(i.value&&(n.isArray(i.value)?this.active.folders[i.stack].refresh(i.value):(r=n.inArray(i.value,this.active.folders[i.stack].data()),r===-1?this.active.folders[i.stack].insert(i.value):this.active.folders[i.stack].remove(r))),this.active.folders[i.stack].data()):"";case"files":return this.active.files.hasOwnProperty(i.stack)?(i.value&&(n.isArray(i.value)?this.active.files[i.stack].refresh(i.value):(r=n.inArray(i.value,this.active.files[i.stack].data()),r===-1?this.active.files[i.stack].insert(i.value):this.active.files[i.stack].remove(r))),this.active.files[i.stack].data()):"";case"edit":return(i.value||n.type(i.value)==="null")&&this.active.edit.setProperty("value",i.value),this.active.edit.data()}},this));n(document).on("observer:request:validate",n.proxy(function(t,i){var u,r,f;switch(i.type){default:case"stack":return this.options.stacks.data().hasOwnProperty(i.value);case"path":return u=i.value.replace(/^(\/|\s)+/,"").replace(/(\/|\s)+$/,""),r=this.options.stacks.data(),r.hasOwnProperty(i.stack)&&r[i.stack].items.hasOwnProperty(u);case"basepath":return r=this.options.stacks.data(),r.hasOwnProperty(i.stack)&&i.value.indexOf(r[i.stack].path)===0;case"file":return(r=this.options.stacks.data(),f=n(document).triggerHandler("observer:request:key",{value:i.value}),!n(document).triggerHandler("observer:request:validate",{type:"path",stack:i.stack,value:i.path}))?!1:r[i.stack].items[i.path].items.hasOwnProperty(f)}},this));n(document).on("observer:request:rename",n.proxy(function(t,i){switch(i.type){case"title":return this.options.stacks.data().hasOwnProperty(i.stack)?(this.options.stacks.setProperty(i.stack+".title",i.value),!0):!1;case"subtitle":return this.options.stacks.data().hasOwnProperty(i.stack)?(this.options.stacks.setProperty(i.stack+".subtitle",i.value),!0):!1;case"folder":return!1;case"file":return n.observable(this.options.stacks.data()[i.stack].items[i.path].items[i.oldname]).setProperty("name",i.newname),!0}return!1},this));n(document).on("observer:request:update",n.proxy(function(t,i){var r,u;switch(i.type){case"folder":return r=i.item?i.path+this.options.html.ds+i.item:i.path,n.observable(this.options.stacks.data()[i.stack].items[r]).setProperty(i.key,i.value),!0;case"file":return u=n(document).triggerHandler("observer:request:key",{value:i.item}),n.observable(this.options.stacks.data()[i.stack].items[i.path].items[u]).setProperty(i.key,i.value),!0}return!1},this));n(document).on("observer:request:key",n.proxy(function(n,t){return t.value.replace(/\./g,"")},this));n(document).on("observer:request:add",n.proxy(function(t,i){if(i.type&&i.stack&&i.path&&i.item)switch(i.type){case"folder":return n.observable(this.options.stacks.data()[i.stack].items).setProperty(i.path,i.item),!0;case"file":return i.name&&this.options.stacks.data()[i.stack].items.hasOwnProperty(i.path)?(n.observable(this.options.stacks.data()[i.stack].items[i.path].items).setProperty(i.name,i.item),!0):!1}return!1},this))},defaults:function(){n(document).trigger("observer:before:defaults");this.options.defaults.stack&&this.options.defaults.path&&window.setTimeout(n.proxy(function(){jQuery(document).triggerHandler("observer:request:active",{type:"path",stack:this.options.defaults.stack,value:this.options.defaults.path})},this),50);n(document).trigger("observer:after:defaults")},item:function(t,i,r,u){var r,u,a;if(n(document).trigger("observer:before:item",[t,i,r]),this.options.html.ajax.item&&t&&i)if(typeof r=="undefined"&&(r={}),typeof u=="undefined"&&(u=!1),this.edit||(this.edit=n(document).triggerHandler("edit:request:params")),r.branch=r.branch?r.branch:!1,r.branch){var v=i.split(this.options.html.ds),h=[],c="",o={},f="",l=!1,e=u,s="observer:internal:item."+n.guid;if(r.branch=!1,e){n(document).on(s,n.proxy(function(t,i){i.i===this.queue&&(window.setTimeout(function(){n(document).triggerHandler(i.callback,i.options)},0),n(document).off(s),this.queue=0)},this));a={i:this.queue,callback:e.name,options:e.options?e.options:{}};u={name:s,options:a}}while(c=v.shift())h.push(c),f=h.join(this.options.html.ds),o=n(document).triggerHandler("observer:request:item",{type:"folder",stack:t,path:f,load:!1}),l=n(document).triggerHandler("observer:request:validate",{type:"basepath",stack:t,value:f}),!l||o&&o.loaded||(u&&(this.queue++,u.options.i=this.queue),this._item(t,f,r,u))}else this._item(t,i,r,u);else this.message(this.options.html.errors.ajax,"error",{wink:"slower"}),this.debug("item","Item Failed as the Necessary Data Could Not Found.");n(document).trigger("observer:after:item",[t,i,r])},_item:function(t,i,r,u){var f=this,e=this.edit;e.stack=t;e.path=i;e.branch=+r.branch;n.ajax({type:"post",dataType:"json",url:this.options.html.ajax.item,callback:u,data:e}).done(function(r){r&&typeof r=="object"&&r.hasOwnProperty(i)?(n.each(r,function(u,f){var e=n(document).triggerHandler("observer:request:item",{type:"folder",stack:t,path:u,load:!1});e?e.loaded||n.each(r[u],function(r,u){r==="items"?n.each(u,function(r,u){n(document).triggerHandler("observer:request:add",{type:"file",stack:t,path:i,name:r,item:u})}):n(document).triggerHandler("observer:request:update",{type:"folder",stack:t,path:i,key:r,value:u})}):n(document).triggerHandler("observer:request:add",{type:"folder",stack:t,path:u,item:f})}),this.callback&&this.callback.name&&this.callback.options&&n(document).triggerHandler(this.callback.name,this.callback.options)):(f.message(f.options.html.errors.malform,"error",{wink:"slower"}),f.debug("item","Item Ajax Call Returned Malformed Data."))}).fail(function(){f.message(f.options.html.errors.fail,"error",{wink:"slower"});f.debug("item","Item Ajax Call Failed.")})}});n.fn.observer=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{control:"[data-stack-control]",values:{stack:'[data-stack-control="stack"]',refresh:'[data-stack-control="refresh"]'}},data:{control:"data-stack-control",value:"data-stack-value",values:{stack:"stack",refresh:"refresh",path:"path",explorer:"explorer",breadcrumb:"breadcrumb"}},html:{},namespace:".stack",active:null,animate:100},el:{root:null,stacks:{all:{}},controls:{all:{}}},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),!n.views)return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.register();this.links();this.requests();this.controls();this.addControlEvents();this.setDefault()},register:function(){n(document).trigger("stack:before:register");this.el.stacks.all=this.el.root.find(this.options.css.stack);this.el.stacks.all.each(n.proxy(function(t,i){var r=n(i).attr(this.options.data.stack);r&&(this.el.stacks.hasOwnProperty(r)||(this.el.stacks[r]=[]),this.el.stacks[r].push(i))},this));n(document).trigger("stack:after:register",[this.el.stacks])},links:function(){var t=n(document).triggerHandler("observer:request:active",{type:"stack"}),i=n(document).triggerHandler("observer:request:active",{type:"edit"});n.observe(t,"*",n.proxy(function(n){this.switchStack(n.target.value)},this))},requests:function(){n(document).on("stack:request:toggle",n.proxy(function(t,i){i.type=i.type||"disable";i.stack=n.isArray(i.stack)?i.stack:[i.stack];i.stack.length&&this.toggleStack(i.type,i.stack)},this));n(document).on("stack:request:solo",n.proxy(function(){this.toggleStack("disable")},this));n(document).on("stack:request:unsolo",n.proxy(function(){this.toggleStack("enable")},this))},controls:function(){n(document).trigger("stack:before:controls");this.el.controls.all=this.el.root.find(this.options.css.control);n.each(this.options.data.values,n.proxy(function(n,t){this.el.controls[t]=[]},this));this.el.controls.all.each(n.proxy(function(t,i){var r=n(i).attr(this.options.data.control);r&&(this.el.controls.hasOwnProperty(r)?this.el.controls[r].push(i):this.debug("controls","Stack Control Does Not Exist"))},this));n(document).trigger("stack:after:controls",[this.el.controls])},addControlEvents:function(){n(document).trigger("stack:before:event",[this.options.data.values.stack]);this.el.root.on("click"+this.options.namespace,this.options.css.values.stack,{options:this.options},function(t){var i=n(this).attr(t.data.options.data.value),r=n(document).triggerHandler("observer:request:active",{type:"stack"});r.value!=i&&n(document).triggerHandler("observer:request:active",{type:"stack",value:i})});n(document).trigger("stack:after:event",[this.options.data.values.stack,this.el.controls])},switchStack:function(t){n(document).trigger("stack:before:switch",[t]);this.el.stacks.hasOwnProperty(t)?(n.each(this.el.stacks,n.proxy(function(i){i===t?i!=="all"&&n.each(this.el.stacks[i],n.proxy(function(t,i){n(i).show(this.options.animate?this.options.animate:null)},this)):n.each(this.el.stacks[i],function(t,i){n(i).hide()})},this)),this.el.controls.hasOwnProperty(this.options.data.values.stack)&&n.each(this.el.controls[this.options.data.values.stack],n.proxy(function(i,r){n(r).attr(this.options.data.value)===t&&(n(r).trigger("click"),typeof n(r).button=="function"&&n(r).button("toggle"))},this))):this.debug("switchStack","Stack Not Found");n(document).trigger("stack:after:switch",[t])},toggleStack:function(t,i){n(document).trigger("stack:before:toggle",[stack,this.el.controls]);var r=n.type(i)!=="array"?!0:!1;this.el.controls.hasOwnProperty(this.options.data.values.stack)&&n.each(this.el.controls[this.options.data.values.stack],n.proxy(function(u,f){(r||n.inArray(n(f).attr(this.options.data.value),i)!==-1)&&(t=="disable"?n(f).attr("disabled","disabled"):n(f).removeAttr("disabled"))},this));n(document).trigger("stack:after:toggle",[stack,this.el.controls])},setDefault:function(){n(document).trigger("stack:before:default",[this.options.active]);this.options.active&&n(document).triggerHandler("observer:request:active",{type:"stack",value:this.options.active});n(document).trigger("stack:after:default",[this.options.active])}});n.fn.stack=function(n){return new t(n)}})(window.jQuery);
(function(n){n.fn.fxFlash=function(t){return t=n.extend({speed:150,amount:3},t),this.fadeIn(t.speed).fadeOut(t.speed).fadeIn(t.speed).fadeOut(t.speed).fadeIn(t.speed).fadeOut(t.speed).fadeIn(t.speed),this};n.fn.fxWiggle=function(t,i){i=n.extend({degrees:["2","4","2","0","-2","-4","-2","0"],delay:35,limit:null,randomStart:!0,onWiggle:function(){},onWiggleStart:function(){},onWiggleStop:function(){}},i);var r={wiggle:function(t,u){u===undefined&&(u=i.randomStart?Math.floor(Math.random()*i.degrees.length):0);n(t).hasClass("wiggling")||n(t).addClass("wiggling");var f=i.degrees[u];if(n(t).css({"-webkit-transform":"rotate("+f+"deg)","-moz-transform":"rotate("+f+"deg)","-ms-transform":"rotate("+f+"deg)","-o-transform":"rotate("+f+"deg)","-sand-transform":"rotate("+f+"deg)",transform:"rotate("+f+"deg)"}),u===i.degrees.length-1){u=0;n(t).data("wiggles")===undefined?n(t).data("wiggles",1):n(t).data("wiggles",n(t).data("wiggles")+1);i.onWiggle(t)}if(i.limit&&n(t).data("wiggles")==i.limit)return r.stop(t);t.timeout=setTimeout(function(){r.wiggle(t,u+1)},i.delay)},stop:function(t){n(t).data("wiggles",0);n(t).css({"-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)","-o-transform":"rotate(0deg)","-sand-transform":"rotate(0deg)",transform:"rotate(0deg)"});n(t).hasClass("wiggling")&&n(t).removeClass("wiggling");clearTimeout(t.timeout);t.timeout=null;i.onWiggleStop(t)},isWiggling:function(n){return n.timeout?!0:!1}};return t==="isWiggling"&&this.length===1?r.isWiggling(this[0]):(this.each(function(){if(t!=="start"&&t!==undefined||this.timeout)t==="stop"&&r.stop(this);else{r.wiggle(this);i.onWiggleStart(this)}}),this)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{control:'[data-action="resize"]',type:"[data-type]",value:'[data-action-value="resize"]'},data:{control:"data-action",type:"data-type",value:"data-action-value",resize:"data-resize-"},html:{},namespace:".resizer",active:null,types:[],permission:null},el:{root:null,controls:null,values:null},initialise:function(t){this.set(t);this.el.root=n(this.options.css.root);this.el.controls=this.el.root.find(this.options.css.control);this.el.values=this.el.root.find(this.options.css.value);this.addControlEvents();this.setDefault()},addControlEvents:function(){if(n(document).trigger("arkresize:before:add",[this.el.controls]),this.permission(this.options.permission))this.el.root.on("click"+this.options.namespace,this.options.css.control,{self:this},function(t){var i=n(this).attr(t.data.self.options.data.type);i&&i!==t.data.self.options.active&&(t.data.self.options.active=i,t.data.self.switchLayout())});n(document).trigger("arkresize:after:add",[this.el.controls])},setDefault:function(){n(document).trigger("arkresize:before:default",[this.options.active]);this.options.active&&(this.el.controls.each(n.proxy(function(t,i){n(i).attr(this.options.data.type)===this.options.active&&n(i).addClass(this.options.css.bootstrap.active.value)},this)),this.switchLayout(this.options.active));n(document).trigger("arkresize:after:default",[this.options.active])},switchLayout:function(){n(document).trigger("arkresize:before:switch",[this.options.active,this.el.values]);this.el.values.each(n.proxy(function(t,i){var r=n(i).attr(this.options.data.resize+this.options.active);r&&(n(i).removeClass(),n(i).addClass(r))},this));n(document).trigger("arkresize:after:switch",[this.options.active,this.el.values])}});n.fn.resizer=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{breadcrumb:"#ark-breadcrumb",path:"[data-stack-control]",template:"#tmpl-breadcrumb"},data:{path:"data-path"},html:{},namespace:".breadcrumb",fullpath:!0},el:{root:null,breadcrumb:null,stacks:null},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),this.el.breadcrumb=this.el.root.find(this.options.css.breadcrumb),this.el.stacks=this.el.breadcrumb.find(this.options.css.stack),n.views){if(!this.el.stacks.length)return this.debug("initialise","No Breadcrumb Stacks"),!1}else return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.assets();this.register()},assets:function(){n(document).trigger("arkbreadcrumb:before:assets");var t=this;n.views.helpers({canBreadcrumb:function(){if(this.data.name){var n=this.data.key,i=this.ctx.root.base.length,r=this.data.name,u=this.ctx.root.base[n];return!(!t.options.fullpath&&r==u&&n+1!==i)}return!1},isDisabledBreadcrumb:function(n){if(n)return!0;var i=this.data.count,t=this.data.key,r=this.ctx.root.base.length,u=this.data.name,f=this.ctx.root.base[t];return u==f?t+1!==r:t+1==i}});n.views.tags({breadcrumb:{render:function(){var i=this.ctx.root.active.path.split(t.options.html.ds),r=[],u=[];return n.each(i,n.proxy(function(n,f){r.push(i[n]);u.push(this.tagCtx.render({key:n,name:f,path:r.join(t.options.html.ds),count:i.length}))},this)),u.join("\n")},linked:!1,onAfterLink:function(){this.linked||(n.observe(this.ctx.root.active,"path",n.proxy(function(){this.refresh()},this)),this.linked=!0)}}});n(document).trigger("arkbreadcrumb:after:assets")},register:function(){n(document).trigger("arkbreadcrumb:before:register");var i=n(document).triggerHandler("observer:request:all"),t=n.templates(this.options.css.template);t?this.el.stacks.each(n.proxy(function(r,u){var f=n(u).attr(this.options.data.stack),e=i[f].path.split(this.options.html.ds),o=n(document).triggerHandler("observer:request:active",{type:"path",stack:f}),s=n(document).triggerHandler("observer:request:active",{type:"edit"});n(u).link(t,{stack:f,base:e,active:o,file:s});n(u).on("click"+this.options.namespace,this.options.css.path,{stack:f,path:this.options.data.path},function(t){n(document).triggerHandler("observer:request:active",{type:"path",stack:t.data.stack,value:n(this).attr(t.data.path)})})},this)):this.debug("register","Could Not Find Template");n(document).trigger("arkbreadcrumb:after:register")}});n.fn.breadcrumb=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{explorer:"#ark-explorer",overlay:".overlay",selected:"selected",folder:".folder",file:".file",toggle:".toggle",path:"[data-stack-control]",select:"[data-select]",templates:{root:"#tmpl-explorer",tree:"#tmpl-explorer-tree"}},data:{control:"data-stack-control",path:"data-path",select:"data-select"},html:{},namespace:".explorer",scroll:{all:"",one:""},root:!0},el:{root:null,explorer:null,overlay:null,stacks:{}},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),this.el.explorer=this.el.root.find(this.options.css.explorer),this.el.overlay=this.el.explorer.find(this.options.css.overlay),n.each(this.el.explorer.find(this.options.css.stack),n.proxy(function(t,i){this.el.stacks[n(i).attr(this.options.data.stack)]=i},this)),n.views){if(n.isEmptyObject(this.el.stacks))return this.debug("initialise","No Explorer Stacks"),!1}else return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.assets();this.register();this.requests()},assets:function(){n(document).trigger("arkexplorer:before:assets");var t=this;n.views.helpers({canRenderFolder:function(){return this.ctx.isinit&&!this.ctx.root.showroot?!1:!0},isAutoExpanded:function(){return this.ctx.isinit&&!this.ctx.root.showroot?!0:!1}});n.views.tags({tree:{init:function(i){i.view.data.key&&(i.view.data.path=i.view.data.key);this.data=i.view.data;this.data.isinit=i.props.init;this.data.showroot=t.options.root;this.data.paths=this.ctx.root.paths;this.data.isinit&&n(document).triggerHandler("observer:request:update",{type:"folder",stack:this.data.name,path:this.data.path,key:"expanded",value:!0})},onAfterLink:function(){},template:t.options.css.templates.tree,dataBoundOnly:!0}});n(document).trigger("arkexplorer:after:assets")},register:function(){n(document).trigger("arkexplorer:before:register");var t=n(document).triggerHandler("observer:request:all"),i=n.templates(this.options.css.templates.root);i?n.each(this.el.stacks,n.proxy(function(r,u){var f=n(document).triggerHandler("observer:request:active",{type:"path",stack:r}),e=n(document).triggerHandler("observer:request:active",{type:"folders",stack:r}),o=n(document).triggerHandler("observer:request:active",{type:"files",stack:r}),s=n(document).triggerHandler("observer:request:active",{type:"edit"});n(u).link(i,{name:r,stack:t[r].items,path:t[r].path,active:f});this.links(u,{stack:r,folders:e,files:o,active:f,file:s})},this)):this.debug("register","Could Not Find Template");n(document).trigger("arkexplorer:after:register")},links:function(t,i){var r=this;n(t).on("click"+this.options.namespace,this.options.css.path,function(){n(document).triggerHandler("observer:request:active",{type:"path",stack:i.stack,value:n(this).attr(r.options.data.path)})});n(t).on("click"+this.options.namespace,this.options.css.toggle,{options:this.options},function(t,u){var f=n(this).attr(t.data.options.data.path),e=u&&u.direction?u.direction:"";r.expand(i.stack,f,e)});n(t).on("dblclick"+this.options.namespace,this.options.css.edit,{edit:this.options.data.edit.value,path:i.active},function(t){n(document).triggerHandler("edit:request:file",{file:n(this).data(t.data.edit),stack:i.stack,path:t.data.path.path})});n(t).on("click"+this.options.namespace,this.options.css.select+this.options.css.file,function(){var t=n(this).attr(r.options.data.path);t&&t!=i.active.path&&n(document).triggerHandler("observer:request:active",{type:"path",stack:i.stack,value:t});n(this).toggleClass(r.options.css.selected);n(document).triggerHandler("observer:request:active",{type:"files",stack:i.stack,value:n(this).attr(r.options.data.select)})});n.observe(i.folders,n.proxy(function(n){this.select(i.stack,i.active.path,n.target,"folders")},this));n.observe(i.files,n.proxy(function(n){this.select(i.stack,i.active.path,n.target,"files")},this));n.observe(i.active,"path",n.proxy(function(){this.open(i.stack,i.active.path)},this));n.observe(i.file,"*",n.proxy(function(n){n.target.value?this.el.overlay.fadeIn():this.el.overlay.fadeOut()},this))},requests:function(){n(document).on("explorer:request:rescroll",n.proxy(function(t,i){var r;(this.options.scroll.all||this.options.scroll.one)&&(r=typeof i=="object"&&i.stack?n(this.options.scroll.one.replace(this.options.html.sprintf,i.stack)):n(this.options.scroll.all),r.nanoScroller())},this));n(document).on("explorer:request:scroll",n.proxy(function(){},this))},select:function(t,i,r,u){var f=u=="files"?this.options.css.select+this.options.css.file:this.options.css.select+this.options.css.path;n(this.el.stacks[t]).find(f).each(n.proxy(function(t,f){var e=n(f).attr(this.options.data.path),o=u=="folders"?e.replace(this.options.html.ds+n(f).attr(this.options.data.select),""):e,o=u=="folders"&&e==i?"":o;o==i&&(n.inArray(n(f).attr(this.options.data.select),r)!=-1?n(f).addClass(this.options.css.selected):n(f).removeClass(this.options.css.selected))},this))},open:function(t,i,r){r=n.isArray(r)?r:[];n(this.el.stacks[t]).find(this.options.css.path).each(n.proxy(function(u,f){var e=n(f).attr(this.options.data.path),o,s;n.inArray(e,r)===-1&&i.indexOf(e)===0&&(r.push(e),o=n(f).parents(this.options.css.folder).get(0),s=o?n(o).find(this.options.css.toggle):!1,s&&(n(s).trigger("click",{direction:"open"}),e!=i&&this.open(t,i,r)))},this))},expand:function(t,i,r){var f=n(document).triggerHandler("observer:request:item",{type:"folder",stack:t,path:i,load:!0}),u=typeof f.expanded!="undefined"?f.expanded:!1;if((!r||(r!=="open"||!u)&&(r!=="close"||u))&&(n(document).triggerHandler("observer:request:update",{type:"folder",stack:t,path:i,key:"expanded",value:!u}),n(document).triggerHandler("explorer:request:rescroll",{stack:t}),!u)){var o=n(document).triggerHandler("observer:request:active",{type:"folders",stack:t}),s=n(document).triggerHandler("observer:request:active",{type:"files",stack:t}),e=n(document).triggerHandler("observer:request:active",{type:"path",stack:t});this.select(t,e.path,o,"folders");this.select(t,e.path,s,"files")}}});n.fn.explorer=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{title:"#ark-title",template:"#tmpl-title"},data:{},html:{},namespace:".title"},el:{root:null,title:null,stacks:null},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),this.el.title=this.el.root.find(this.options.css.title),this.el.stacks=this.el.title.find(this.options.css.stack),n.views){if(!this.el.stacks.length)return this.debug("initialise","No Title Stacks"),!1}else return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.register()},register:function(){n(document).trigger("arktitle:before:register");var i=n(document).triggerHandler("observer:request:all"),r=n(document).triggerHandler("observer:request:active",{type:"edit"}),t=n.templates(this.options.css.template);t?this.el.stacks.each(n.proxy(function(u,f){var e=n(f).attr(this.options.data.stack),o=n(document).triggerHandler("observer:request:active",{type:"folders",stack:e}),s=n(document).triggerHandler("observer:request:active",{type:"files",stack:e});n(f).link(t,{stack:i[e],folders:o,files:s,file:r})},this)):this.debug("register","Could Not Find Template");n(document).trigger("arktitle:after:register")}});n.fn.title=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{selected:"selected",back:{value:"back",css:".back"},preview:".folder .image",folder:".folder",file:".file",control:"[data-stack]",view:"[data-view]",path:"[data-stack-control]",select:"[data-select]",edit:"[data-edit]",bubble:"[data-select] [data-bubble]",action:"[data-action]",actions:{skip:{value:"skip",css:"[data-skip]"},check:{value:"check",css:'[data-action="check"]'},edit:{value:"edit",css:'[data-action="edit"]'},copy:{value:"copy",css:'[data-action="copy"]'},move:{value:"move",css:'[data-action="move"]'},remove:{value:"remove",css:'[data-action="remove"]'},rename:{value:"rename",css:'[data-action="rename"]',parent:".rename"},save:{value:"save",css:'[data-action="save"]'},cancel:{value:"cancel",css:'[data-action="cancel"]'}},form:{form:"#form-list",stack:"#form-list-stack",path:"#form-list-path",item:"#form-list-item",action:"#form-list-action",extra:"#form-list-extra"},templates:{root:"#tmpl-content",stack:"#tmpl-content-%s-stack",back:"#tmpl-content-%s-back",folder:"#tmpl-content-%s-folder",file:"#tmpl-content-%s-file",actions:"#tmpl-content-%s-actions",preview:"#tmpl-content-%s-folderpreview"}},data:{view:"data-view",path:"data-path",select:"data-select",skip:"data-skip",action:"data-action",nu:{value:"new",data:"data-new"},old:{value:"old",data:"data-old"}},html:{move:"New Path:",ajax:"&ajax=1",messages:{removeconfirm:"Proceed?",renamepartial:"Complete!"},errors:{invalidpath:"Invalid Path!",renameerror:"Rename Failed!",renameempty:"No Name!",renamesame:"No Change!"}},namespace:".list",confirm:{remove:!0}},el:{root:null,content:null,stacks:null,form:{}},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),this.el.content=this.el.root.find(this.options.css.content),this.el.stacks=this.el.content.find(this.options.css.stack),this.el.form.form=this.el.root.find(this.options.css.form.form),this.el.form.form&&(this.el.form.stack=this.el.form.form.find(this.options.css.form.stack),this.el.form.path=this.el.form.form.find(this.options.css.form.path),this.el.form.item=this.el.form.form.find(this.options.css.form.item),this.el.form.action=this.el.form.form.find(this.options.css.form.action),this.el.form.extra=this.el.form.form.find(this.options.css.form.extra)),n.views){if(!this.el.stacks.length)return this.debug("initialise","No Breadcrumb Stacks"),!1}else return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.assets();this.register();this.requests()},assets:function(){n(document).trigger("arklist:before:assets");var t=this;n.views.helpers({getContentTemplate:function(i){return i=i?i:"root",t.options.css.templates.hasOwnProperty(i)?n.templates(t.options.css.templates[i].replace(t.options.html.sprintf,this.ctx.root.view)):null},fileTooltip:function(n,t){return t?"<strong>"+n+"<\/strong><br/> "+t.x+" x "+t.y:"<strong>"+n+"<\/strong>"},rename:function(i,r){var s=i.target,f=n(i.target).parents(t.options.css.actions.rename.parent),h=n(i.target).data(t.options.data.key.value),o=r.oldValue,c=r.value,u,e;return s&&f.length?(u=f.find(t.options.css.actions.save.css),e=f.find(t.options.css.actions.cancel.css),u&&e?(u.data(t.options.data.key.value,h),u.data(t.options.data.old.value,o),u.data(t.options.data.nu.value,c),e.data(t.options.data.old.value,o)):t.debug("assets","Rename Save/Cancel Button Missing.")):t.debug("assets","Required Rename Elements Missing, Continuing Will Fail."),!1}},n.templates(this.options.css.templates.root));n.views.tags({svg:function(t){var i=!1,r=!1;return(n.each(t,n.proxy(function(t,u){if(n.type(u.size)=="object")return i=u,r=this.tagCtx.props.folder+"-"+Math.random().toString(16).slice(2),!1},this)),i)?this.tagCtx.render({id:r,name:i.name}):""},back:{render:function(){var n=this.ctx.root.active.path,i=n?n.substr(0,n.lastIndexOf(t.options.html.ds)):"";return this.tagCtx.render({back:i})},linked:!1,onAfterLink:function(){this.linked||(n.observe(this.ctx.root.active,"path",n.proxy(function(){this.disposed||this.refresh()},this)),this.linked=!0)}},rename:{render:function(){return typeof this.rename=="undefined"&&(this.rename={active:!1},n.observable(this.rename)),this.tagCtx.render({rename:this.rename})},onAfterLink:function(){this.contents().on("click"+t.options.namespace,t.options.css.actions.rename.css,n.proxy(function(){return t.permission("ark.action.rename")?(n.observable(this.rename).setProperty("active",!0),!1):(t.message(t.options.html.errors.permission,"error",{wink:"slow"}),t.debug("action","The User Does Not Have Sufficient Privileges to Rename a File."),!1)},this));this.contents().on("click"+t.options.namespace,t.options.css.actions.save.css+","+t.options.css.actions.cancel.css,n.proxy(function(i){var r=n(i.target),s=r.data(t.options.data.key.value),f=r.data(t.options.data.old.value),u=r.data(t.options.data.nu.value);if(r.attr(t.options.data.action)==t.options.css.actions.save.value)if(f&&!u)t.message(t.options.html.errors.renameempty,"warning"),t.debug("assets","The Rename Action Failed Due to the Name Being Empty.");else if(f!=u&&f&&u){var e=n(document).triggerHandler("observer:request:active",{type:"stack"}),o=n(document).triggerHandler("observer:request:active",{type:"path",stack:e.value}),h={stack:e.value,active:o,ajax:!0,name:f,extra:u,action:t.options.css.actions.rename.value};result=t.action(r,h);result.status?(n(document).triggerHandler("observer:request:rename",{type:"file",stack:e.value,path:o.path,oldname:s,newname:u}),result.messages&&result.messages.length?n.each(result.messages,function(n,i){t.message(i.message,i.type?i.type:"info")}):t.message(t.options.html.messages.renamepartial,"success"),t.debug("assets","The Rename Action Was Successfully Executed.","info")):(result.messages&&result.messages.length?n.each(result.messages,function(n,i){t.message(i.message,i.type?i.type:"info")}):t.message(t.options.html.errors.renameerror),t.debug("assets","The Rename Action Failed During the Action Logic/Ajax Call."))}else t.message(t.options.html.errors.renamesame,"warning"),t.debug("assets","The Rename Action Failed Due to the Name Not Being Altered.");else t.message(t.options.html.errors.cancel,"info"),t.debug("assets","The Rename Action Was Cancelled by the User or Insufficient Data Found on the Action Button.");return n.observable(this.rename).setProperty("active",!1),!1},this))}}});n(document).trigger("arklist:after:assets")},register:function(){n(document).trigger("arklist:before:register");var t=n(document).triggerHandler("observer:request:all"),i=n.templates(this.options.css.templates.root);i?this.el.stacks.each(n.proxy(function(r,u){var f=n(u).attr(this.options.data.stack),o=t[f].path,e=n(document).triggerHandler("observer:request:active",{type:"path",stack:f}),s=n(document).triggerHandler("observer:request:active",{type:"folders",stack:f}),h=n(document).triggerHandler("observer:request:active",{type:"files",stack:f});n(u).find(this.options.css.view).each(n.proxy(function(r,u){var s=n(u).attr(this.options.data.view);n(u).link(i,{stack:t[f].items,name:f,view:s,base:o,active:e})},this));this.links(u,{stack:f,active:e,folders:s,files:h})},this)):this.debug("register","Could Not Find Template");n(document).trigger("arklist:after:register")},links:function(t,i){n(t).on("click"+this.options.namespace,this.options.css.select,{options:this.options},function(t){n(this).toggleClass(t.data.options.css.selected);var r=n(this).attr(t.data.options.data.path)?"folders":"files";n(document).triggerHandler("observer:request:active",{type:r,stack:i.stack,value:n(this).attr(t.data.options.data.select)})});n(t).on("dblclick"+this.options.namespace,this.options.css.path,{options:this.options},function(t){n(document).triggerHandler("observer:request:active",{type:"path",stack:i.stack,value:n(this).attr(t.data.options.data.path)})});n(t).on("singleTap"+this.options.namespace,this.options.css.path,{options:this.options},function(){n(this).trigger("dblclick")});n(t).on("doubleTap"+this.options.namespace,this.options.css.folder,{options:this.options},function(){n(this).trigger("click")});n(t).on("dblclick"+this.options.namespace,this.options.css.edit,{edit:this.options.data.edit.value,path:i.active},function(t){n(document).triggerHandler("edit:request:file",{file:n(this).data(t.data.edit),stack:i.stack,path:t.data.path.path})});n(t).on("doubleTap"+this.options.namespace,this.options.css.edit,function(){n(this).trigger("dblclick")});n(t).on("click"+this.options.namespace,this.options.css.bubble,function(n){n.stopPropagation()});n(t).on("click"+this.options.namespace,this.options.css.action,{self:this},function(n){n.data.self.action(this,i)});n(t).on("tap"+this.options.namespace,this.options.css.action,function(){n(this).trigger("click")});n.observe(i.folders,i.files,n.proxy(function(){this.select(t,i.folders,i.files)},this))},requests:function(){n(document).on("list:request:actions",n.proxy(function(n,t){if(t&&typeof t=="object"){if(t.action==="data")return this.options.data.action;if(this.options.css.actions.hasOwnProperty(t.action))return this.options.css.actions[t.action]}return this.options.css.actions},this))},select:function(t,i,r){n(document).trigger("arklist:before:select",[t,i,r]);n(t).find(this.options.css.select).each(n.proxy(function(t,u){var f=n(u).attr(this.options.data.path)?i:r;n.inArray(n(u).attr(this.options.data.select),f)!=-1?n(u).addClass(this.options.css.selected):n(u).removeClass(this.options.css.selected)},this));n(document).trigger("arklist:after:select",[t,i,r])},action:function(t,i){var o,f,s;if(i=n.extend(n(document).triggerHandler("list:before:action",{form:this.el.form,el:t,options:n.extend({},i)}),i),i.skip||n(t).attr(this.options.data.skip))return!1;var u=i.name||n(t).attr(this.options.data.name),r=i.action||n(t).attr(this.options.data.action),e=!0;if(n.each(this.el.form,n.proxy(function(t,i){if(!i||!n(i).get(0))return this.message(this.options.html.errors.form),this.debug("action","Some of the SubAction Form Elements Are Missing."),e=!1},this)),e)if(i.stack&&i.active.path)if(u&&r){if(this.options.css.actions.hasOwnProperty(r)&&!this.permission("ark.action."+r))return this.message(this.options.html.errors.permission,"error",{wink:"slow"}),this.debug("action",'The User Does Not Have Sufficient Privileges to Perform the "'+r+'" Action.'),!1;this.el.form.stack.val(i.stack);this.el.form.path.val(i.active.path);this.el.form.item.val(u);switch(r){default:return this.message(this.options.html.errors.action),this.debug("action","The Action Does Not Exist/Not Plumbed in."),!1;case this.options.css.actions.check.value:return!1;case this.options.css.actions.edit.value:return this.options.version.pro?(this.message(this.options.html.messages.feature.plugin,"info",{wink:"slow"}),this.debug("action","The Edit Action is Disabled.")):(this.message(this.options.html.messages.feature.upgrade,"info",{wink:"slow"}),this.debug("action","The Edit Action is a Professional Only Feature.")),!1;case this.options.css.actions.copy.value:this.el.form.action.val(this.options.css.actions.copy.value);break;case this.options.css.actions.move.value:if(o=this.prompt(this.options.html.move,this.el.form.path.val(),i.stack),!o)return!1;this.el.form.extra.val(o);this.el.form.action.val(this.options.css.actions.move.value);break;case this.options.css.actions.remove.value:if(f=this.options.html.messages.removeconfirm.replace(this.options.html.sprintf,u),this.options.confirm.remove&&!confirm(f))return this.message(this.options.html.errors.cancel,"info"),this.debug("action","Delete Process Not Confirmed by User."),!1;this.el.form.action.val(this.options.css.actions.remove.value);break;case this.options.css.actions.rename.value:if(!i.extra)return!1;this.el.form.extra.val(i.extra);this.el.form.action.val(this.options.css.actions.rename.value)}if(i.ajax)return this.ajaxAction();this.el.form.form.submit()}else f=this.options.html.errors.action,s=u?"The Action Could Not be Found on the Element.":"The File Name Could Not be Found on the Element.",this.message(f),this.debug("action",s);else this.message(this.options.html.errors.path),this.debug("action","The Observer Active Stack Path Could Not be Found.");else this.message(this.options.html.errors.form),this.debug("action","Some of the SubAction Form Elements Are Missing.");n(document).trigger("list:after:action",{form:this.el.form,el:t,options:i})},prompt:function(t,i,r){var u=prompt(t,i);if(n.type(u)=="null")return this.message(this.options.html.errors.cancel,"info"),this.debug("action","The Move Action Was Cancelled by the User.","info"),!1;if(u){if(!n(document).triggerHandler("observer:request:validate",{type:"path",stack:r,value:u}))return this.message(this.options.html.errors.invalidpath,"alert"),this.debug("action","The Path Does Not Exist or is Not in the Stack."),this.prompt(t,u,r)}else return this.message(this.options.html.errors.path,"alert"),this.debug("action","The Path Entered by the User is Empty."),this.prompt(t,i,r);return u},ajaxAction:function(t){n(document).trigger("arklist:before:ajax",[this.el.form]);t=t||{};var i=this,r={status:!1,messages:[]},u=t.async||!1;return n.ajax({type:"post",dataType:"json",async:u,url:this.el.form.form.attr("action")+this.options.html.ajax,data:this.el.form.form.serialize()}).done(function(n){n&&typeof n=="object"?(r=n,n.status||i.debug("ajaxAction","Rename Ajax Call Returned a Failed Status.")):i.debug("ajaxAction","Rename Ajax Call Returned Malformed Data.")}).fail(function(){i.debug("ajaxAction","Rename Ajax Call Failed.")}),n.each(r.messages,function(n,t){t.type=t.type==="message"?"success":t.type}),n(document).trigger("arklist:after:ajax",[this.el.form]),r}});n.fn.list=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{contenttopbar:"#ark-contenttop",editbar:"#ark-editbar",actionbar:"#ark-actions",subactionbar:"#ark-subactions",editactionbar:"#ark-edit-actions",preview:{container:"#ark-edit-preview",holder:".preview",preview:"*",loading:".loading",failed:".failed"},settings:{container:"#ark-edit-settings",fieldset:".fieldset",group:".row",field:".field",lists:"select",combos:"div.combobox",stacks:"[data-stack]"},action:"[data-action]",actions:{save:{value:"save",css:'[data-action="save"]'},exit:{value:"exit",css:'[data-action="exit"]'},cancel:{value:"cancel",css:'[data-action="cancel"]'},browse:{value:"browse",css:'[data-action="browse"]'},insert:{value:"insert",css:'[data-action="insert"]'}},templates:{root:"#tmpl-edit",actions:"#tmpl-edit-actions",preview:"#tmpl-edit-preview",settings:"#tmpl-edit-settings",subactions:"#tmpl-edit-subactions"}},data:{wild:"*",group:"data-customgroup",action:"data-action"},html:{messages:{save:"Saved!"},errors:{nofile:"No File!",noparent:"No Parent!",filelost:"No File!"}},namespace:".edit",enabled:!0,wait:!1,quick:!1,edit:{editor:null,field:null,stack:null,path:null,file:null,callback:null},xml:{},permission:{insert:null,settings:null},animate:1e3},el:{root:null,contenttop:null,editbar:null,actions:null,subactions:null,editactions:null,content:null,edit:null,preview:null,settings:null,lists:null,combos:null,stacks:null,controls:null},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),this.el.contenttop=this.el.root.find(this.options.css.contenttopbar),this.el.editbar=this.el.root.find(this.options.css.editbar),this.el.actions=this.el.root.find(this.options.css.actionbar),this.el.subactions=this.el.root.find(this.options.css.subactionbar),this.el.content=this.el.root.find(this.options.css.content),this.el.edit=this.el.root.find(this.options.css.editbox),!n.views)return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;if(this.requests(),!this.options.enabled)return this.debug("initialise",'"Edit Mode" is Disabled.',"info"),!1;this.loader();this.assets();this.setDefault()},loader:function(){n(document).trigger("arkedit:before:loader");n(document).on("edit:request:file",n.proxy(function(t,i){if(i.file){if(i.stack&&i.path&&(n(document).triggerHandler("observer:request:active",{type:"stack",value:i.stack}),n(document).triggerHandler("observer:request:active",{type:"path",stack:i.stack,value:i.path})),n(document).triggerHandler("observer:request:active",{type:"edit",value:i.file}),this.options.quick)return n(document).triggerHandler("edit:request:save"),!0;if(this.el.content.length&&this.el.edit.length){var r=n(document).triggerHandler("observer:request:active",{type:"stack"});return n(document).triggerHandler("observer:request:active",{type:"files",stack:r.value,value:[]}),this.el.contenttop.slideUp(this.options.animate),this.el.content.slideUp(this.options.animate,n.proxy(function(){this.el.editbar.slideDown(this.options.animate);this.el.actions.slideUp(this.options.animate);this.el.subactions.slideUp(this.options.animate);this.register();this.elements();this.addEditEvents();this.el.edit.slideDown(this.options.animate)},this)),!0}}else this.message(this.options.html.errors.data,"error",{wink:"slower"}),this.debug("loader","Insufficient File Data Provided for the Edit Mode to Intiate.");return!1},this));n(document).on("edit:request:save",n.proxy(function(n){var t=this.insert(n);return t?(this.message(this.options.html.messages.save,"success"),this.debug("loader","Edit Mode Saved & Exited.","info"),window.close(),!0):!1},this));n(document).on("edit:request:exit",n.proxy(function(){return window.close()},this));n(document).on("edit:request:close",n.proxy(function(n){return this.unload(n)?(this.message(this.options.html.errors.cancel,"info"),this.debug("loader","Edit Mode Cancelled by User.","info"),!0):!1},this));n(document).on("edit:request:browse",n.proxy(function(n){return this.unload(n)?(this.debug("loader","Edit Mode Closed by User.","info"),!0):!1},this));n(document).on("edit:request:preview:open",n.proxy(function(){var t=this.el.preview.find(this.options.css.preview.holder),i=this.el.preview.find(this.options.css.preview.loading);i.slideUp(this.options.animate,n.proxy(function(){t.slideDown(this.options.animate)},this))},this));n(document).on("edit:request:preview:close",n.proxy(function(){var t=this.el.preview.find(this.options.css.preview.failed),i=this.el.preview.find(this.options.css.preview.loading);i.slideUp(this.options.animate,n.proxy(function(){t.slideDown(this.options.animate)},this))},this));n(document).trigger("arkedit:after:loader")},requests:function(){n(document).on("edit:request:params",n.proxy(function(){return this.options.edit},this));n(document).on("edit:request:state",n.proxy(function(){return this.options.enabled},this))},assets:function(){n(document).trigger("arkedit:before:assets");var t=this;n.views.helpers({getTemplate:function(i){return t.options.css.templates.hasOwnProperty(i)?n.templates(t.options.css.templates[i]):null},preview:function(i){var r;if(i){var u=n(document).triggerHandler("observer:request:active",{type:"stack"}),f=n(document).triggerHandler("observer:request:active",{type:"path",stack:u.value}),e=t.toURL(t.options.html.url+f.path+t.options.html.ds+i),o={stack:u.value,path:e,name:i};r=n(document).triggerHandler("edit:request:preview:html",o)||"";r||(r=n("<span>").addClass(t.options.css.hide.value).get(0).outerHTML,n(document).delay(0).queue(function(n){if(t.el.preview){var i=t.el.preview.find(t.options.css.preview.holder);i.find(t.options.css.preview.preview).trigger("error")}n()}))}return r},icon:function(t){var i=n(document).triggerHandler("observer:request:active",{type:"stack"}),r=n(document).triggerHandler("edit:request:icon",{stack:i.value});return r||t}},n.templates(this.options.css.templates.root));n.views.converters({defaults:function(t){var i=this.linkCtx?n(this.linkCtx.elem).val():"";return t||i||""},listdefaults:function(i){var r=n(this.linkCtx.elem);if(n.type(i)==="array"&&r.is("select")){var f=r.find("option"),e=n.map(f,function(n){return n.value}),u=r;r.find("optgroup").length&&($group=n('<optgroup label="'+(r.attr(t.options.data.group)||"")+'"><\/optgroup>'),r.append($group),u=$group);n.each(i,function(t,i){n.inArray(i,e)===-1&&u.append("<option>"+i+"<\/option>")})}return this.linkCtx.view.getRsc("converters","defaults").call(this,i)}},n.templates(this.options.css.templates.root));typeof n.fn.callable!="function"&&(n.fn.callable=n.proxy(function(n){return this.isCallable(n)},this));typeof n.fn.attributes!="function"&&(n.fn.attribs=n.proxy(function(t){var i={};return n.each(t.attributes,function(n,t){i[t.name]=t.value}),i},this));n(document).trigger("arkedit:after:assets")},setDefault:function(){if(n(document).trigger("arkedit:before:default",[this.options.edit]),this.options.edit.stack&&this.options.edit.path&&this.options.edit.file){var t=n(document).triggerHandler("observer:request:validate",{type:"path",stack:this.options.edit.stack,value:this.options.edit.path}),i=n(document).triggerHandler("observer:request:validate",{type:"file",stack:this.options.edit.stack,path:this.options.edit.path,value:this.options.edit.file});n(document).triggerHandler("stack:request:solo");t?i?this.options.wait||this.options.quick?this.options.quick&&this.highlight("file",this.options.edit.stack,this.options.edit.path,this.options.edit.file):n(document).triggerHandler("edit:request:file",{file:this.options.edit.file,stack:this.options.edit.stack,path:this.options.edit.path}):(this.message(this.options.html.errors.nofile,"error",{wink:"slower"}),this.debug("setDefault","The Stack Information is Available but the Passed File Does not Exist in the Stack Path.")):(this.message(this.options.html.errors.invalid,"error",{wink:"slower"}),this.debug("setDefault","The Passed Stack & Path Data is Invalid."))}else this.options.edit.stack&&this.options.edit.editor?n(document).triggerHandler("stack:request:solo"):this.options.edit.file&&(this.message(this.options.html.errors.path,"error",{wink:"slower"}),this.debug("setDefault","The Passed Stack & Path Data is Incomplete/Missing."));n(document).trigger("arkedit:after:default",[this.options.edit])},register:function(){var t;if(n(document).trigger("arkedit:before:register"),t=n.templates(this.options.css.templates.root),t){var i=n(document).triggerHandler("observer:request:active",{type:"stack"}),r=n(document).triggerHandler("observer:request:active",{type:"path",stack:i.value}),u=n(document).triggerHandler("observer:request:active",{type:"edit"}),f=this.attributes(i.value);try{n(this.el.edit).link(t,{path:r,file:u,info:f})}catch(e){this.debug("register",'Register Failed With: "'+e.message+'"')}}else this.debug("register","Could Not Find Template");n(document).trigger("arkedit:after:register")},elements:function(){n(document).trigger("edit:before:elements",[this.el]);this.el.editactions=this.el.edit.find(this.options.css.editactionbar);this.el.controls=this.el.edit.find(this.options.css.action);this.el.preview=this.el.edit.find(this.options.css.preview.container);this.el.settings=this.el.edit.find(this.options.css.settings.container);this.el.fieldsets=this.el.settings.find(this.options.css.settings.fieldset);this.el.groups=this.el.settings.find(this.options.css.settings.group);this.el.lists=this.el.settings.find(this.options.css.settings.lists);this.el.combos=this.el.settings.find(this.options.css.settings.combos);this.el.stacks=this.el.settings.find(this.options.css.settings.stacks);n(document).trigger("edit:after:elements",[this.el])},addEditEvents:function(){var t,i,r;n(document).trigger("arkedit:before:event");t=n(document).triggerHandler("observer:request:active",{type:"stack"});n.fn.chosen&&(this.el.lists.chosen({disable_search_threshold:10,width:"100%"}),this.el.lists.each(n.proxy(function(t,i){var r=n(i).data(this.options.data.value.value);r&&(n(i).val(r),n(i).trigger("liszt:updated"),n(i).trigger("chosen:updated"))},this)));n.fn.ComboTransform&&this.el.combos.ComboTransform({updateList:!0});this.el.controls.on("click"+this.options.namespace,{options:this.options},function(t){switch(n(this).attr(t.data.options.data.action)){case t.data.options.css.actions.exit.value:n(document).triggerHandler("edit:request:exit");break;case t.data.options.css.actions.cancel.value:n(document).triggerHandler("edit:request:close");break;case t.data.options.css.actions.save.value:n(document).triggerHandler("edit:request:save");break;case t.data.options.css.actions.browse.value:n(document).triggerHandler("edit:request:browse");break;case t.data.options.css.actions.insert.value:n(document).triggerHandler("edit:request:save")}});if(this.el.stacks.each(n.proxy(function(i,r){var u=n(r).attr(this.options.data.stack),f=n(r).find(this.options.css.settings.field);u&&u!=t.value&&(n(r).addClass(this.options.css.hide.value),f&&f.prop("disabled",!0))},this)),this.el.fieldsets.each(n.proxy(function(t,i){var u=n(i).find(this.options.css.settings.group),r=!0;u.each(n.proxy(function(t,i){n(i).hasClass(this.options.css.hide.value)||(r=!1)},this));r&&n(i).addClass(this.options.css.hide.value)},this)),this.el.editactions.find(this.options.css.stack).each(n.proxy(function(i,r){var u=n(r).attr(this.options.data.stack);u&&u!=t.value&&n(r).addClass(this.options.css.hide.value)},this)),this.el.preview.length){i=n(document).triggerHandler("edit:request:preview:event",{stack:t.value})||"load";r=this.el.preview.find(this.options.css.preview.holder);r.find(this.options.css.preview.preview).on(i+this.options.namespace,n.proxy(function(){n(document).triggerHandler("edit:request:preview:open")},this)).on("error"+this.options.namespace,n.proxy(function(){n(document).triggerHandler("edit:request:preview:close")},this))}n(document).trigger("arkedit:after:event",[this.el.lists,this.el.controls])},insert:function(t){var f=n(document).triggerHandler("arkedit:before:insert",{caller:t}),r,u;if(f&&f.isImmediatePropagationStopped())return!1;var e=this.isCallable(this.options.edit.callback),o=!1,i=n(document).triggerHandler("observer:request:active",{type:"stack"}),s=n(document).triggerHandler("observer:request:active",{type:"path",stack:i.value}),h=n(document).triggerHandler("observer:request:active",{type:"edit"}),c=this.toURL(s.path+this.options.html.ds+h.value);return e?(r={},this.permission(this.options.permission.settings)&&!this.options.quick&&(r=this.form(i.value)),u=n(document).triggerHandler("edit:request:build",{stack:i.value,options:this.options.edit,attributes:r,path:c}),u?(e[this.options.edit.callback](u,this.options.edit.field),o=!0):(this.message(this.options.html.errors.filelost,"error",{wink:"slow"}),this.debug("insert","Either The Parent Window Could not be Found or Reference to the Original Editor File Was Lost."))):(this.message(this.options.html.errors.noparent,"error",{wink:"slow"}),this.debug("insert",'Either The Parent Window Could not be Found or the "Insert" Function Could not be Called.')),n(document).trigger("arkedit:after:insert"),o},unload:function(t){var i=n(document).triggerHandler("arkedit:before:unload",{caller:t});return i&&i.isImmediatePropagationStopped()?!1:this.el.content.length&&this.el.edit.length?(this.el.editbar.slideUp(this.options.animate),this.el.edit.slideUp(this.options.animate,n.proxy(function(){n(document).triggerHandler("observer:request:active",{type:"edit",value:null});this.el.contenttop.slideDown(this.options.animate);this.el.actions.slideDown(this.options.animate);this.el.subactions.slideDown(this.options.animate);this.el.content.slideDown(this.options.animate);this.el.edit.empty()},this)),!0):(n(document).trigger("arkedit:after:unload"),!1)},isCallable:function(t){return(n(document).trigger("arkedit:before:callable"),window.opener&&(!t||t&&typeof window.opener[t]=="function"))?window.opener:(n(document).trigger("arkedit:after:callable"),!1)},attributes:function(t){var r=n(document).triggerHandler("edit:request:attributes",{stack:t,options:this.options.edit}),i={};return r&&n.each(this.options.xml,n.proxy(function(u,f){var o=r.hasOwnProperty(f.attribute)?r[f.attribute]:!1,e,s;if(o||f.attribute.indexOf(this.options.data.wild)!==-1){i[f.fieldname]="";switch(f.converter){case"full":i[f.fieldname]=o;break;case"list-regex":case"list-full":e=[];n.each(f.options,function(n,t){t&&o.indexOf(t)!==-1&&e.push(t)});switch(e.length){case 0:break;case 1:i[f.fieldname]=e.shift();break;default:i[f.fieldname]=e.reduce(function(n,t){return n.length>t.length?n:t})}break;case"attr-regex":e=[];s=this.toArray(f.omissions);n.each(r,n.proxy(function(t,i){if(t.indexOf(f.attribute.replace(this.options.data.wild,""))===0&&n.inArray(t,s)===-1){var r=i?t+'="'+i+'"':t;e.push(r)}},this));e.length&&(i[f.fieldname]=e);break;default:i[f.fieldname]=n(document).triggerHandler("edit:request:converter",{stack:t.value,field:f,attribute:o})}}},this)),i},form:function(t){var r=this.fields(this.el.settings,{groups:!1}),i=n(document).triggerHandler("edit:request:attributes",{stack:t,options:this.options.edit}),u=n.extend({},this.options.xml);return i&&(n.each(u,function(n,f){if(!f.stack||f.stack&&f.stack===t)switch(f.converter){case"full":i[f.attribute]=r[f.fieldname];delete u[n]}}),n.each(u,n.proxy(function(u,f){var e,o,s;if(!f.stack||f.stack&&f.stack===t){e=r[f.attribute]||"";switch(f.converter){case"list-regex":n.each(f.options,n.proxy(function(n,t){if(t&&e.indexOf(t)!==-1){var i="(^|"+f.separator+")"+this.escape(t)+"+(?=$|"+f.separator+")";e=e.replace(new RegExp(i,"g"),"")}},this));o=this.trim(e,f.separator);i[f.attribute]=(o?o+f.separator:"")+r[f.fieldname];break;case"list-full":n.each(f.options,n.proxy(function(n,t){t&&e.indexOf(t)!==-1&&(e=e.replace(t,""))},this));o=this.trim(e,f.separator);i[f.attribute]=(o?o+f.separator:"")+r[f.fieldname];break;case"attr-regex":n.each(i,n.proxy(function(n){n.indexOf(f.attribute.replace(this.options.data.wild,""))===0&&(i[n]="")},this));s=(typeof r[u]=="string"?[r[u]]:r[u])||[];n.each(s,function(n,t){var r=t.split('="');i[r[0]]=r[1]?r[1].replace('"',""):""});break;default:i[f.attribute]=n(document).triggerHandler("edit:request:unconverter",{stack:t,field:f,attribute:e})}r[f.attribute]=i[f.attribute]}},this))),i}});n.fn.edit=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{content:"#ark-content",stack:"[data-stack]",view:"[data-view]",thumbnail:"[data-thumbnail]",container:"[data-container]",loading:".loading",names:{loading:"loading",failed:"failed"}},data:{view:"data-view",thumbnail:"data-thumbnail",path:"data-path",file:"data-file",size:"data-size",target:"data-target"},html:{icon:"icon-",ajax:"index.php",unknown:"unknown"},namespace:".thumbnail",batch:5,refresh:!1,cache:!0},separator:".",tmp:[],extra:null,el:{root:null,content:null,stacks:null,thumbnails:{queue:null,pending:null,processed:null}},initialise:function(t){this.set(t);this.el.root=n(this.options.css.root);this.el.content=this.el.root.find(this.options.css.content);this.el.stacks=this.el.content.find(this.options.css.stack);this.el.thumbnails.queue=this.el.content.find(this.options.css.thumbnail);this.el.thumbnails.pending={};this.el.thumbnails.processed={};this.refresh();this.process();this.register();this.requests()},process:function(){n(document).trigger("arkthumbnail:before:process");this.extra=n(document).triggerHandler("edit:request:params");this.el.thumbnails.queue.each(n.proxy(function(t,i){var r=this.key(i),f=this.cache(r),e=r.split(this.separator)[0],u;f?this.render(i,f):(u={stack:e,key:r},n.each(this.options.data,function(t,r){typeof r=="string"&&n(i).attr(r)&&(u[t]=n(i).attr(r))}),this.tmp.push(u),this.el.thumbnails.pending[r]=i,(t+1)%this.options.batch&&this.el.thumbnails.queue.length!=t+1||(this.fire(),this.tmp=[]))},this));n(document).trigger("arkthumbnail:after:process",[this.el.thumbnails])},fire:function(){if(n(document).trigger("arkthumbnail:before:fire",[this.tmp]),this.options.html.ajax&&this.tmp.length){var t=this,i=this.extra;i.thumbs=this.tmp;n.ajax({type:"post",dataType:"json",url:this.options.html.ajax,items:this.tmp,data:i}).done(function(i){i&&i.length?n.each(i,function(n,i){var r=t.el.thumbnails.pending[i.key];delete t.el.thumbnails.pending[i.key];t.el.thumbnails.processed[i.key]=r;r&&i.key&&i.path?(t.cache(i.key,i.path),t.render(r,i.path)):r?(t.state(r,"failed"),t.debug("fire","Thumbnail Could Not be Loaded.")):i.key&&t.el.thumbnails.processed.hasOwnProperty(i.key)?t.debug("fire",'Thumbnail: "'+i.path+'" Has Already Been Loaded.',"info"):t.debug("fire",'Thumbnail: "'+i.key+'" Could Not be Loaded.')}):(n.each(this.items,function(n,i){t.el.thumbnails.pending.hasOwnProperty(i.key)&&(t.state(t.el.thumbnails.pending[i.key],"failed"),t.el.thumbnails.processed[i.key]=t.el.thumbnails.pending[i.key],delete t.el.thumbnails.pending[i.key])}),t.debug("fire","Thumbnails Could Not be Loaded."))}).fail(function(){n.each(this.items,function(n,i){t.el.thumbnails.pending.hasOwnProperty(i.key)&&(t.state(t.el.thumbnails.pending[i.key],"failed"),t.el.thumbnails.processed[i.key]=t.el.thumbnails.pending[i.key],delete t.el.thumbnails.pending[i.key])});t.debug("fire","Failed to Retrieve Thumbnails.")})}else this.debug("fire","Invalid Information Required to Load Thumbnails.");n(document).trigger("arkthumbnail:after:fire",[this.tmp])},render:function(t,i){var r,u,f;n(document).trigger("arkthumbnail:before:render",[t,i]);this.state(t,"rendering");switch(n(t).attr(this.options.data.thumbnail)){default:case"all":i.indexOf(this.options.html.icon)===0&&n(t).attr(this.options.data.target)=="src"&&(r=n("<i>",{"data-target":"class",id:n(t).attr("id")}).addClass(i).addClass(n(t).attr("class")),u=["thumbnail","link"],r.attr("title",n(t).attr("title")),n.each(n(t).data(),n.proxy(function(t,i){n.inArray(t,u)===-1&&n.type(i)==="string"&&r.attr(this.options.data.data+t,i)},this)),n(t).replaceWith(r),t=r);break;case"thumbnail":break;case"icon":}f=n(t).attr(this.options.data.target)?n(t).attr(this.options.data.target):"src";n(t).attr(f,i);n(document).trigger("arkthumbnail:after:render",[t,i])},state:function(t,i){if(n(document).trigger("arkthumbnail:before:status",[t,i]),t&&i){var r=n(t).closest(this.options.css.container);switch(i){case"rendering":n(t).removeClass(this.options.css.names.loading);r.length&&n(r).removeClass(this.options.css.names.loading);break;case"failed":n(t).addClass(this.options.css.names.failed).removeClass(this.options.css.names.loading);r.length&&n(r).addClass(this.options.css.names.failed).removeClass(this.options.css.names.loading)}}n(document).trigger("arkthumbnail:after:status",[t,i])},cache:function(t,i){if(n(document).trigger("arkthumbnail:before:cache",[t,i]),!this.options.cache)return!1;if(t)if(typeof sessionStorage!="undefined")try{return i&&(sessionStorage[t]=i),sessionStorage[t]}catch(r){this.debug("cache","Unable to Store Path")}else this.debug("cache","Session Storage Not Supported");else this.debug("cache","Invalid Information Required to Temporarily Store the Thumbnail");n(document).trigger("arkthumbnail:after:cache",[t,i])},refresh:function(){this.options.refresh&&this.clear()},rename:function(t,i){if(n(document).trigger("arkthumbnail:before:rename",[t]),t&&i)if(typeof sessionStorage!="undefined")try{sessionStorage.setItem(i,sessionStorage.getItem(t));sessionStorage.removeItem(t)}catch(r){this.debug("rename",'Unable to Rename Thumbnail Cache Key From "'+t+'" to "'+i+'"')}else this.debug("rename","Session Storage Not Supported");else this.debug("rename",'Unable to Rename Thumbnail Cache Key From "'+t+'" to "'+i+'"');n(document).trigger("arkthumbnail:after:rename",[t])},register:function(){n(document).trigger("arkthumbnail:before:register");var t=n(document).triggerHandler("observer:request:all");this.el.stacks.each(n.proxy(function(t,i){var r=n(i).attr(this.options.data.stack),u=n(document).triggerHandler("observer:request:active",{type:"path",stack:r});this.links(i,{i:t,active:u})},this));n(document).trigger("arkthumbnail:after:register")},links:function(t,i){if(n.observe(i.active,"path",function(){window.setTimeout(function(){n(document).triggerHandler("thumbnail:request:requeue",{element:t})},0)}),!i.i)n(document).on("observer:request:rename",n.proxy(function(t,i){if(i.type==="file"){var r=this.search(i.stack,null,i.path,i.oldname);n.each(r,n.proxy(function(n,t){this.rename(t,t.replace(this.separator+i.oldname,this.separator+i.newname))},this))}},this))},requests:function(){n(document).on("thumbnail:request:requeue",n.proxy(function(t,i){i.force&&n(document).triggerHandler("thumbnail:request:clear",i);this.el.thumbnails.queue=n(i.element).find(this.options.css.thumbnail);this.process()},this));n(document).on("thumbnail:request:clear",n.proxy(function(t,i){var r=[];i.element&&n(i.element).find(this.options.css.thumbnail).each(n.proxy(function(n,t){r.push(this.key(t))},this));this.clear(r)},this))},key:function(t){var i=n(t).attr(this.options.data.stack),r=n(t).parents(this.options.css.view).attr(this.options.data.view),u=n(t).attr(this.options.data.path),f=n(t).attr(this.options.data.file);return i||(i=n(t).parents(this.options.css.stack).attr(this.options.data.stack)),this._key(i,r,u,f)},_key:function(n,t,i,r,u){var f=[];return f.push(n?n:this.options.html.unknown),f.push(t?t:this.options.html.unknown),f.push(i?i:this.options.html.unknown),f.push(r?r:this.options.html.unknown),f.join(u?u:this.separator)},search:function(n,t,i,r){var n="("+(n&&n.length&&n!==this.options.html.unknown?this.escape(n):"[\\S]+")+")",t="("+(t&&t.length&&t!==this.options.html.unknown?this.escape(t):"[\\S]+")+")",i="("+(i&&i.length&&i!==this.options.html.unknown?this.escape(i):"[\\S]+")+")",r="("+(r&&r.length&&r!==this.options.html.unknown?this.escape(r):"[\\S]+")+")",e=this._key(n,t,i,r,"\\"+this.separator),f=[],u;if(typeof sessionStorage!="undefined")try{for(u=0;u<sessionStorage.length;u++)sessionStorage.key(u).match(new RegExp(e,"ig"))&&f.push(sessionStorage.key(u))}catch(o){this.debug("find","Unable to Search for Cached Thumbnail Keys")}else this.debug("find","Session Storage Not Supported");return f},clear:function(t){if(typeof sessionStorage!="undefined")try{t&&t.length?n.each(t,function(n,t){sessionStorage.getItem(t)&&sessionStorage.removeItem(t)}):sessionStorage.clear()}catch(i){this.debug("refresh","Unable to Clear Cache")}else this.debug("refresh","Session Storage Not Supported")}});n.fn.thumbnail=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{stack:"images",allowempty:!0},initialise:function(n){this.set(n);this.requests()},requests:function(){n(document).on("edit:request:attributes",n.proxy(function(t,i){if(i.stack===this.options.stack){var r=n(document).triggerHandler("edit:request:element",{stack:i.stack,options:i.options});return r?n.fn.attribs(r):{}}},this));n(document).on("edit:request:element",n.proxy(function(t,i){if(i.stack===this.options.stack&&i.options&&i.options.field){var r=n.fn.callable("jGetEditorSelectedImage");return r?r.jGetEditorSelectedImage(i.options.field):!1}},this));n(document).on("edit:request:preview:html",n.proxy(function(t,i){if(i.stack===this.options.stack&&i.path)return n("<img>",{src:this.namespace(i.path),title:i.name,alt:i.name}).get(0).outerHTML},this));n(document).on("edit:request:build",n.proxy(function(t,i){if(i.stack===this.options.stack&&typeof i.attributes=="object"){var r=n("<img>");return i.attributes.src=this.namespace(i.path||i.attributes.src),n.each(i.attributes,n.proxy(function(n,t){(this.options.allowempty||!this.options.allowempty&&t)&&r.attr(n,t)},this)),r.get(0).outerHTML}},this))},namespace:function(n,t){var i;switch(t){case"timestamp":i="t="+(new Date).getTime();break;default:case"id":i="i="+this.id({length:3,special:"",alpha:""})}return n?n+"?"+i:n}});n.fn.arkstackimages=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{icon:"film"},stack:"videos",allowempty:!1,eventname:"canplay canplaythrough"},initialise:function(n){this.set(n);this.requests()},requests:function(){n(document).on("edit:request:attributes",n.proxy(function(t,i){if(i.stack===this.options.stack){var r=n(document).triggerHandler("edit:request:element",{stack:i.stack,options:i.options});return r?n.fn.attribs(r):{}}},this));n(document).on("edit:request:element",n.proxy(function(t,i){if(i.stack===this.options.stack&&i.options&&i.options.field){var r=n.fn.callable("jGetEditorSelectedImage");return r?r.jGetEditorSelectedImage(i.options.field):!1}},this));n(document).on("edit:request:icon",n.proxy(function(n,t){if(t.stack===this.options.stack)return this.options.css.icon},this));n(document).on("edit:request:preview:html",n.proxy(function(t,i){if(i.stack===this.options.stack&&i.path)return n("<video>",{src:i.path,controls:"controls",preload:"auto"}).get(0).outerHTML},this));n(document).on("edit:request:preview:event",n.proxy(function(n,t){if(t.stack===this.options.stack)return this.options.eventname},this));n(document).on("edit:request:build",n.proxy(function(t,i){if(i.stack===this.options.stack&&typeof i.attributes=="object"){var r=n("<video>");return i.attributes.src=i.path||i.attributes.src,i.attributes.nosupport&&(r.text(i.attributes.nosupport),delete i.attributes.nosupport),n.each(i.attributes,n.proxy(function(n,t){(this.options.allowempty||!this.options.allowempty&&t)&&r.attr(n,t)},this)),r.get(0).outerHTML}},this))}});n.fn.arkstackvideos=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{icon:"file4"},stack:"documents",allowempty:!0,support:[{ext:"swf",mime:"application/x-shockwave-flash",browsers:[]},{ext:"pdf",mime:"application/pdf",browsers:["mozilla"]},{ext:"txt",mime:"text/plain",browsers:["mozilla","msie"]},{ext:"xml",mime:"text/xml",browsers:["mozilla"]},{ext:"html",mime:"text/html",browsers:["mozilla","msie"]}]},initialise:function(n){this.set(n);this.requests()},requests:function(){n(document).on("edit:request:attributes",n.proxy(function(t,i){if(i.stack===this.options.stack){var r=n(document).triggerHandler("edit:request:element",{stack:i.stack,options:i.options});return r?n.fn.attribs(r):{}}},this));n(document).on("edit:request:element",n.proxy(function(t,i){if(i.stack===this.options.stack&&i.options&&i.options.field){var r=n.fn.callable("jGetEditorSelectedLink");return r?r.jGetEditorSelectedLink(i.options.field):!1}},this));n(document).on("edit:request:html",n.proxy(function(t,i){if(i.stack===this.options.stack&&i.options&&i.options.field){var r=n.fn.callable("jGetEditorSelectedImage");return r?r.jGetEditorSelectedImage(i.options.field):!1}},this));n(document).on("edit:request:text",n.proxy(function(t,i){if(i.stack===this.options.stack&&i.options&&i.options.field){var r=n.fn.callable("jGetEditorSelectedText");return r?r.jGetEditorSelectedText(i.options.field):!1}},this));n(document).on("edit:request:preview:html",n.proxy(function(t,i){var u;if(i.stack===this.options.stack&&i.path){var f=this.browser("browser"),e=this.extension(i.path),r="";if(n.each(this.options.support,function(t,i){if(i.ext===e&&n.inArray(f,i.browsers)!==-1)return r=i.mime,!1}),r)return u="jQuery( document ).triggerHandler( 'edit:request:preview:open' )",n("<object>",{type:r,onload:u}).attr("data",i.path).get(0).outerHTML}},this));n(document).on("edit:request:icon",n.proxy(function(n,t){if(t.stack===this.options.stack)return this.options.css.icon},this));n(document).on("edit:request:build",n.proxy(function(t,i){var u;if(i.stack===this.options.stack){var f=n(document).triggerHandler("edit:request:element",{stack:i.stack,options:i.options}),e=n(document).triggerHandler("edit:request:html",{stack:i.stack,options:i.options}),o=n(document).triggerHandler("edit:request:text",{stack:i.stack,options:i.options}),r=f||e||o;if(typeof i.attributes=="object")return u=n("<a>"),i.attributes.href=i.path||i.attributes.href,n.each(i.attributes,n.proxy(function(n,t){(this.options.allowempty||!this.options.allowempty&&t)&&u.attr(n,t)},this)),typeof r=="object"?n(r).prop("tagName")==="A"?u.html(n(r).html()):u.html(n(r)):typeof r=="string"&&r?u.html(r):i.path&&u.html(i.path),u.get(0).outerHTML}},this))}});n.fn.arkstackdocuments=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{icon:"volume-high"},stack:"audios",allowempty:!1,eventname:"canplay canplaythrough"},initialise:function(n){this.set(n);this.requests()},requests:function(){n(document).on("edit:request:attributes",n.proxy(function(t,i){if(i.stack===this.options.stack){var r=n(document).triggerHandler("edit:request:element",{stack:i.stack,options:i.options});return r?n.fn.attribs(r):{}}},this));n(document).on("edit:request:element",n.proxy(function(t,i){if(i.stack===this.options.stack&&i.options&&i.options.field){var r=n.fn.callable("jGetEditorSelectedImage");return r?r.jGetEditorSelectedImage(i.options.field):!1}},this));n(document).on("edit:request:icon",n.proxy(function(n,t){if(t.stack===this.options.stack)return this.options.css.icon},this));n(document).on("edit:request:preview:html",n.proxy(function(t,i){if(i.stack===this.options.stack&&i.path)return n("<audio>",{src:i.path,controls:"controls",preload:"auto"}).get(0).outerHTML},this));n(document).on("edit:request:preview:event",n.proxy(function(n,t){if(t.stack===this.options.stack)return this.options.eventname},this));n(document).on("edit:request:build",n.proxy(function(t,i){if(i.stack===this.options.stack&&typeof i.attributes=="object"){var r=n("<audio>");return i.attributes.src=i.path||i.attributes.src,i.attributes.nosupport&&(r.text(i.attributes.nosupport),delete i.attributes.nosupport),n.each(i.attributes,n.proxy(function(n,t){(this.options.allowempty||!this.options.allowempty&&t)&&r.attr(n,t)},this)),r.get(0).outerHTML}},this))}});n.fn.arkstackaudios=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{stack:'[data-stack="search"]',control:'[data-action="search"]',toggle:'[data-action-value="toggle"]',preloader:'[data-action-value="preloader"]',field:'[data-action-value="search"]',clearer:'[data-action-value="clear"]',back:".back",path:"[data-stack-control]",templates:{root:"#tmpl-content-search-stack",back:"#tmpl-content-search-back",folder:"#tmpl-content-search-folder",file:"#tmpl-content-search-file"}},data:{path:"data-path",select:"data-select-control"},html:{ajax:"index.php",count:"folders : %s, files : %s",highlight:'<span class="highlight">$1<\/span>',errors:{malform:"Error!",fail:"Error!",ajax:"No Data!"}},view:{name:null,before:null,after:null,revert:!0},stack:"search",title:"search",namespace:".arksearch",permission:null,animate:300},active:{bar:!1,window:!1},stack:{value:null},results:{term:null,folders:[],files:[]},cache:{},searching:!1,uniqueid:"",el:{root:null,controls:null,toggle:null,preloader:null,field:null,clearer:null},initialise:function(t){if(this.set(t),!this.permission(this.options.permission))return this.debug("initialise","Insufficient Search Permissions"),!1;if(this.el.root=n(this.options.css.root),this.el.stack=n(this.options.css.stack),this.el.controls=this.el.root.find(this.options.css.control),this.el.toggle=this.el.root.find(this.options.css.toggle).first(),this.el.preloader=this.el.root.find(this.options.css.preloader).first(),this.el.field=this.el.root.find(this.options.css.field).first(),this.el.clearer=this.el.root.find(this.options.css.clearer).first(),!n.views)return this.debug("initialise","Dependent Classes Not Found"),!1;this.addControlEvents();this.setDefault();this.assets();this.register();this.links();this.requests()},addControlEvents:function(){n(document).trigger("arksearch:before:add",[this.el.controls]);this.el.root.on("click"+this.options.namespace,this.options.css.toggle,n.proxy(function(){this.active.bar?n(document).triggerHandler("search:request:bar",{direction:"close"}):n(document).triggerHandler("search:request:bar",{direction:"open"})},this));this.el.root.on("click"+this.options.namespace,this.options.css.clearer,{options:this.options},function(t){var i=n(this).siblings(t.data.options.css.field),r=i.val();n(document).triggerHandler("search:request:clear");n(document).triggerHandler("search:request:window",{direction:"close"});r?i.val("").focus():n(document).triggerHandler("search:request:bar",{direction:"close"})});this.el.root.on("keyup"+this.options.namespace,this.options.css.field,n.proxy(function(t){var i=n(t.target).val();t.which&&i?(n(document).triggerHandler("search:request:window",{direction:"open"}),n(document).triggerHandler("search:request:title",{text:i}),n(document).triggerHandler("search:request:find",{text:i})):(n(document).triggerHandler("search:request:clear"),n(document).triggerHandler("search:request:window",{direction:"close"}),t.which||this.debug("addControlEvents","Invalid Search Key Entered"))},this));this.el.root.on("blur"+this.options.namespace,this.options.css.field,function(t){n(t.target).val()||n(document).triggerHandler("search:request:bar",{direction:"close"})});this.el.stack.on("click"+this.options.namespace,this.options.css.back,function(){n(document).triggerHandler("search:request:bar",{direction:"close"});n(document).triggerHandler("search:request:window",{direction:"close"})});this.el.stack.on("click"+this.options.namespace,this.options.css.path,{self:this,options:this.options},function(t){t.data.self.uniqueid=t.data.self.id();var i=n(this).attr(t.data.options.data.stack),r=n(this).attr(t.data.options.data.path),u=n(this).attr(t.data.options.data.name),f=n(this).attr(t.data.options.data.select),e={stack:i,path:r,item:u,type:f,uniqueid:t.data.self.uniqueid};n(document).triggerHandler("observer:request:load",{stack:i,path:r,options:e})});n(document).trigger("arksearch:after:add",[this.el.controls])},setDefault:function(){n(document).trigger("arksearch:before:default",[this.el.field]);this.el.field.hide().val("");this.options.view.before=n(document).triggerHandler("arkcollapse:request:value",{group:this.options.view.name});this.options.view.before||(this.options.view.before=this.options.view.after);n(document).trigger("arksearch:after:default",[this.el.field])},assets:function(){n(document).trigger("arksearch:before:assets");var t=this;n.views.helpers({getTemplate:function(i){return t.options.css.templates.hasOwnProperty(i)?n.templates(t.options.css.templates[i]):null},search:function(n,i){var r=new RegExp("("+t.escape(i)+")","gi");return n.replace(r,t.options.html.highlight)}},n.templates(this.options.css.templates.root));n(document).trigger("arksearch:after:assets")},register:function(){n(document).trigger("arksearch:before:register");var t=n.templates(this.options.css.templates.root);t?this.el.stack.link(t,{stack:this.stack,results:this.results}):this.debug("register","Could Not Find Template");n(document).trigger("arksearch:after:register")},links:function(){var t=n(document).triggerHandler("observer:request:active",{type:"stack"});n.observe(t,"*",n.proxy(function(t,i){i.value===this.options.stack?(n(document).triggerHandler("search:request:bar",{direction:"open"}),n(document).triggerHandler("search:request:window",{direction:"open"}),n.observable(this.stack).setProperty("value",i.oldValue)):n(document).triggerHandler("search:request:window",{direction:"close"})},this))},requests:function(){n(document).on("search:request:bar",n.proxy(function(t,i){if(i.direction!=="open"||this.active.bar)i.direction==="close"&&this.active.bar&&(this.el.field.hide(this.options.animate),this.el.clearer.hide(),this.preloader("off"),this.active.bar=!1);else{var r=this.options;this.el.field.show(this.options.animate,function(){var t=n(this).siblings(r.css.clearer);t&&t.fadeIn(r.animate)});this.el.field.focus();this.active.bar=!0}},this));n(document).on("search:request:window",n.proxy(function(t,i){if(i.direction!=="open"||this.active.window)i.direction==="close"&&this.active.window&&(n(document).triggerHandler("observer:request:active",{type:"stack",value:this.stack.value}),n(document).triggerHandler("arkcollapse:request:toggle",{value:this.options.view.before,group:this.options.view.name}),n(document).triggerHandler("arkcollapse:request:state",{type:"on",group:this.options.view.name}),n(document).triggerHandler("upload:request:state",{type:"on"}),n(document).triggerHandler("newfolder:request:state",{type:"on"}),this.active.window=!1);else{var r=n(document).triggerHandler("observer:request:active",{type:"stack"});n(document).triggerHandler("observer:request:active",{type:"stack",value:this.options.stack});n(document).triggerHandler("arkcollapse:request:toggle",{value:this.options.view.after,group:this.options.view.name});n(document).triggerHandler("arkcollapse:request:state",{type:"off",group:this.options.view.name});n(document).triggerHandler("upload:request:state",{type:"off"});n(document).triggerHandler("newfolder:request:state",{type:"off"});this.active.window=!0}},this));n(document).on("search:request:find",n.proxy(function(t,i){if(this.options.html.ajax&&this.stack.value&&i.text){if(this.searching&&typeof this.searching.abort!="undefined"&&this.searching.abort(),this.cache.hasOwnProperty(this.stack.value)||(this.cache[this.stack.value]={}),this.cache[this.stack.value].hasOwnProperty(i.text)){this.apply(i.text,this.cache[this.stack.value][i.text]);return}var r=this;this.searching=n.ajax({type:"post",dataType:"json",url:this.options.html.ajax,data:{stack:this.stack.value,text:i.text},beforeSend:function(){r.preloader("on")}}).done(function(n){r.searching=!1;r.preloader("off");n&&typeof n=="object"?(r.cache[r.stack.value][i.text]=n,r.apply(i.text,n)):(r.message(r.options.html.errors.malform,"error",{wink:"slower"}),r.debug("requests","Search Ajax Call Returned Malformed Data."))}).fail(function(n){r.searching=!1;r.preloader("off");n.statusText!=="abort"&&(r.message(r.options.html.errors.fail,"error",{wink:"slower"}),r.debug("requests","Search Ajax Call Failed."))})}else this.message(this.options.html.errors.ajax,"error",{wink:"slower"}),this.debug("request","Search Failed as the Necessary Data Could Not Found.")},this));n(document).on("search:request:apply",n.proxy(function(n,t){this.apply(t.text,t.results)},this));n(document).on("search:request:clear",n.proxy(function(){n(document).triggerHandler("search:request:title");n(document).triggerHandler("observer:request:rename",{type:"subtitle",stack:this.options.stack,value:null});n.observable(this.results).setProperty("term","");n.observable(this.results.folders).refresh([]);n.observable(this.results.files).refresh([])},this));n(document).on("observer:request:loaded",n.proxy(function(t,i){i.uniqueid===this.uniqueid&&(n(document).triggerHandler("search:request:link",i),this.uniqueid="")},this));n(document).on("search:request:link",n.proxy(function(t,i){if(i.type&&i.stack&&i.path&&i.item){n(document).triggerHandler("observer:request:active",{type:"stack",value:i.stack});n(document).triggerHandler("observer:request:active",{type:"path",stack:i.stack,value:i.path});var r={scrollbar:!0};this.options.view.revert&&(r.view=this.options.view.before);this.highlight(i.type,i.stack,i.path,i.item,r)}},this));n(document).on("search:request:title",n.proxy(function(t,i){var r=this.options.title;i&&i.text&&(r+=this.options.html.dash+this.options.html.quote.replace(this.options.html.sprintf,i.text));n(document).triggerHandler("observer:request:rename",{type:"title",stack:this.options.stack,value:r})},this))},apply:function(t,i){n(document).trigger("arksearch:before:apply",[t,i]);n.observable(this.results).setProperty("term",t);n.isArray(i.folders)?n.observable(this.results.folders).refresh(i.folders):n.observable(this.results.folders).refresh([]);n.isArray(i.files)?n.observable(this.results.files).refresh(i.files):n.observable(this.results.files).refresh([]);var r=this.options.html.count.replace(this.options.html.sprintf,i.count.folders).replace(this.options.html.sprintf,i.count.files);n(document).triggerHandler("observer:request:rename",{type:"subtitle",stack:this.options.stack,value:r});n(document).triggerHandler("thumbnail:request:requeue",{element:this.el.stack});n(document).trigger("arksearch:after:apply",[t,i])},preloader:function(t){n(document).trigger("arksearch:before:preloader",[t]);t==="on"?(this.el.toggle.hide(),this.el.preloader.show()):(this.el.toggle.show(),this.el.preloader.hide());n(document).trigger("arksearch:after:preloader",[t])}});n.fn.arkstacksearch=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{editactionbar:"#ark-edit-actions",preview:{container:"#ark-edit-preview",holder:".preview",preview:"img"},control:"#ctrl-editactions",yes:{value:"btn",selector:".btn"},radius:{value:"radius",selector:".radius"}},data:{action:"data-edit-action"},html:{ajax:"index.php",glue:"x",percent:"%",auto:"auto",icons:{lock:"",error:""},messages:{confirm:"Continue?"},errors:{stack:"No Image!",noedit:"No Edit!",malform:"Error Saving!",fail:"Save Failed!",resize:{big:"Too Large!",small:"Too Small!",invalid:"Invalid!"},ajax:"No Data!"},yes:"Yes"},canvas:{bg:"#ffffff",height:"",handle:{size:null,colour:null,border:null,overlay:null}},enabled:!0,crops:[],resizes:[],scroller:!0,confirm:!0,stack:"images",permission:null,namespace:".imageediting"},edit:null,scroller:null,editor:null,flags:{isSaved:!0,isConfirmed:!1,confirmedCallback:""},el:{root:null,edit:null,editactions:null,controls:null,preview:null,holder:null,image:null},initialise:function(t){if(this.set(t),!this.permission(this.options.permission))return this.debug("initialise","Insufficient Edit Permissions"),!1;if(this.el.root=n(this.options.css.root),this.el.edit=this.el.root.find(this.options.css.editbox),!Darkroom)return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.loader();this.addEditEvents()},loader:function(){n(document).on("edit:request:preview:open",n.proxy(function(){var t=n(document).triggerHandler("observer:request:active",{type:"stack"});t.value===this.options.stack&&(this.elements(),this.setup())},this));n(document).on("edit:request:browse edit:request:close",n.proxy(function(){var t=n(document).triggerHandler("observer:request:active",{type:"stack"});t.value===this.options.stack&&this.unload()},this))},addEditEvents:function(){n(document).on("list:before:action",n.proxy(function(t,i){var r=i.options.name||n(i.el).attr(this.options.data.name),u=i.options.action||n(i.el).attr(n(document).triggerHandler("list:request:actions",{action:"data"})),f=n(document).triggerHandler("list:request:actions",{action:"edit"});if(u===f.value)return i.options.skip=!0,i.options.stack===this.options.stack?n(document).triggerHandler("edit:request:state")?n(document).triggerHandler("edit:request:file",{file:r,stack:i.options.stack,path:i.options.active.path}):(this.message(this.options.html.errors.noedit,"info",{wink:"slow"}),this.debug("addFormEvents","The Edit Mode is Currently Disabled.")):(this.message(this.options.html.errors.stack),this.debug("addFormEvents","Edit Mode is Currently For Images Only.")),i.options},this));n(document).on("edit:request:confirm:yes edit:request:confirm:no",n.proxy(function(t){t.type.indexOf("yes")!==-1&&this.flags.confirmedCallback?(this.flags.isConfirmed=!0,n(document).trigger(this.flags.confirmedCallback)):this.flags.isConfirmed=!1},this));n(document).on("arkedit:before:insert arkedit:before:unload",n.proxy(function(n,t){if(this.options.confirm&&!this.flags.isSaved&&!this.flags.isConfirmed){t.caller&&(this.flags.confirmedCallback=t.caller.type);var i={yes:{css:this.options.css.yes.value,text:this.options.html.yes,callback:"edit:request:confirm:yes"},no:{callback:"edit:request:confirm:no"}};return this.confirmbox(this.options.html.messages.confirm,null,i),n.stopImmediatePropagation(),n}},this))},elements:function(){this.el.editactions=this.el.edit.find(this.options.css.editactionbar);this.el.controls=this.el.editactions.find(this.options.css.control);this.el.preview=this.el.edit.find(this.options.css.preview.container);this.el.holder=this.el.preview.find(this.options.css.preview.holder);this.el.image=this.el.preview.find(this.options.css.preview.preview)},setup:function(){var t=this,i,r;this.options.canvas.height&&this.el.holder.css("max-height",this.options.canvas.height+"px");this.options.scroller&&typeof n.Kinetic=="function"&&(this.scroller=this.el.holder.kinetic());i=function(){};i.prototype.createButton=function(i){var f=i.action||i.image,u=null;return f&&(i.refresh&&(t.el.controls=t.el.editactions.find(t.options.css.control)),t.el.controls.each(function(e,o){if(n(o).attr(t.options.data.action)===f)return u=new r(o),u.hide(i.hide),u.disable(i.disabled),!1})),u};r=function(t){this.element=n(t)};r.prototype={addEventListener:function(n,t){this.element.on(n,t)},active:function(n){this.element.toggleClass(t.options.css.bootstrap.active.value,n?!0:!1)},hide:function(n){this.element.toggleClass(t.options.css.bootstrap.hide.value,n?!0:!1)},disable:function(n){this.element.attr("disabled",n?!0:!1)}};this.editor=new Darkroom(this.el.image.get(0),{minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,backgroundColor:t.options.canvas.bg,base:t,action:null,plugins:{save:{callback:function(){t.save(this)}},crop:{cropCallback:function(){this.darkroom.getPlugin("cropcustomiser").cropCallback()},okCallback:function(){this.darkroom.getPlugin("cropcustomiser").okCallback()}},cropdimensions:{glue:t.options.html.glue,lock:t.options.html.icons.lock},cropcustomiser:{handle:{size:t.options.canvas.handle.size,colour:t.options.canvas.handle.colour,border:t.options.canvas.handle.border}},croppresets:{glue:t.options.html.glue,presets:t.options.crops,action:t.options.data.action},resize:{handle:{size:t.options.canvas.handle.size,colour:t.options.canvas.handle.colour,border:t.options.canvas.handle.border,overlay:t.options.canvas.handle.overlay}},resizedimensions:{glue:t.options.html.glue,error:t.options.html.icons.error},resizepresets:{glue:{px:t.options.html.glue,pc:t.options.html.percent,a:t.options.html.auto},presets:t.options.resizes,action:t.options.data.action,messages:{big:t.options.html.errors.resize.big,small:t.options.html.errors.resize.small,invalid:t.options.html.errors.resize.invalid}}},initDOM:function(){n(this.toolbar.element).remove();this.toolbar.createButtonGroup=function(){return new i}},init:function(){}});this.editor.snapshotImage=function(){return this.canvas.toDataURL()};this.editor.action=function(n){this.options.action=n||null;n?this.dispatchEvent("action:open"):this.dispatchEvent("action:close")}},unload:function(){this.editor&&(!this.options.confirm||this.options.confirm&&(this.flags.isSaved||this.flags.isConfirmed))&&(this.editor.selfDestroy(),this.editor=null,this.flags.isSaved=!0,this.flags.isConfirmed=!1,this.flags.confirmedCallback="")},save:function(){var t,i;this.editor.dispatchEvent("save:before");var u=this.editor.snapshotImage(),r=n(document).triggerHandler("observer:request:active",{type:"stack"}),e=n(document).triggerHandler("observer:request:active",{type:"path",stack:r.value}),f=n(document).triggerHandler("observer:request:active",{type:"edit"});this.options.html.ajax&&r.value&&e.path&&f.value&&u&&u!=="data:,"?(this.edit||(this.edit=n(document).triggerHandler("edit:request:params")),t=this,i=this.edit,i.stack=r.value,i.path=e.path,i.file=f.value,i.image=u,n.ajax({type:"post",dataType:"json",url:this.options.html.ajax,data:i,beforeSend:function(){t.preloader("on")}}).done(function(i){if(t.preloader("off"),i&&typeof i=="object")if(i.status)t.message(i.message,"success"),n(document).triggerHandler("thumbnail:request:requeue",{element:t.find(r.value,f.value),force:!0}),t.editor.dispatchEvent("save:after");else{var u=i.message?i.message:t.options.html.errors.fail;t.message(u,"error",{wink:"slower"});t.debug("requests","Save Ajax Call Failed.")}else t.message(t.options.html.errors.malform,"error",{wink:"slower"}),t.debug("requests","Save Ajax Call Returned Malformed Data.")}).fail(function(){t.preloader("off");t.message(t.options.html.errors.fail,"error",{wink:"slower"});t.debug("requests","Save Ajax Call Failed.")})):(this.message(this.options.html.errors.ajax,"error",{wink:"slower"}),this.debug("request","Save Failed as the Necessary Data Could Not Found."))}});n.fn.imageediting=function(n){return new t(n)}})(window.jQuery);
/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */
var fabric=fabric||{version:"1.5.0"};typeof exports!="undefined"&&(exports.fabric=fabric);typeof document!="undefined"&&typeof window!="undefined"?(fabric.document=document,fabric.window=window,window.fabric=fabric):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head><\/head><body><\/body><\/html>"),fabric.window=fabric.document.createWindow?fabric.document.createWindow():fabric.document.parentWindow);fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined";fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"];fabric.DPI=96;fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",function(){function n(n,t){this.__eventListeners[n]&&(t?fabric.util.removeFromArray(this.__eventListeners[n],t):this.__eventListeners[n].length=0)}function t(n,t){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var i in n)this.on(i,n[i]);else this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(t);return this}function i(t,i){if(this.__eventListeners){if(arguments.length===0)this.__eventListeners={};else if(arguments.length===1&&typeof arguments[0]=="object")for(var r in t)n.call(this,r,t[r]);else n.call(this,t,i);return this}}function r(n,t){var i,r,u;if(this.__eventListeners&&(i=this.__eventListeners[n],i)){for(r=0,u=i.length;r<u;r++)i[r].call(this,t||{});return this}}fabric.Observable={observe:t,stopObserving:i,fire:r,on:t,off:i,trigger:r}}();fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var n=0,t=arguments.length;n<t;n++)this._onObjectAdded(arguments[n]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(n,t,i){var r=this.getObjects();return i?r[t]=n:r.splice(t,0,n),this._onObjectAdded(n),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){for(var i=this.getObjects(),t,n=0,r=arguments.length;n<r;n++)t=i.indexOf(arguments[n]),t!==-1&&(i.splice(t,1),this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(n,t){for(var i=this.getObjects(),r=i.length;r--;)n.call(t,i[r],r,i);return this},getObjects:function(n){return typeof n=="undefined"?this._objects:this._objects.filter(function(t){return t.type===n})},item:function(n){return this.getObjects()[n]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(n){return this.getObjects().indexOf(n)>-1},complexity:function(){return this.getObjects().reduce(function(n,t){return n+(t.complexity?t.complexity():0)},0)}},function(n){var i=Math.sqrt,r=Math.atan2,t=Math.PI/180;fabric.util={removeFromArray:function(n,t){var i=n.indexOf(t);return i!==-1&&n.splice(i,1),n},getRandomInt:function(n,t){return Math.floor(Math.random()*(t-n+1))+n},degreesToRadians:function(n){return n*t},radiansToDegrees:function(n){return n/t},rotatePoint:function(n,t,i){var r=Math.sin(i),u=Math.cos(i),f,e;return n.subtractEquals(t),f=n.x*u-n.y*r,e=n.x*r+n.y*u,new fabric.Point(f,e).addEquals(t)},transformPoint:function(n,t,i){return i?new fabric.Point(t[0]*n.x+t[2]*n.y,t[1]*n.x+t[3]*n.y):new fabric.Point(t[0]*n.x+t[2]*n.y+t[4],t[1]*n.x+t[3]*n.y+t[5])},invertTransform:function(n){var t=n.slice(),i=1/(n[0]*n[3]-n[1]*n[2]),r;return t=[i*n[3],-i*n[1],-i*n[2],i*n[0],0,0],r=fabric.util.transformPoint({x:n[4],y:n[5]},t),t[4]=-r.x,t[5]=-r.y,t},toFixed:function(n,t){return parseFloat(Number(n).toFixed(t))},parseUnit:function(n,t){var r=/\D{0,2}$/.exec(n),i=parseFloat(n);t||(t=fabric.Text.DEFAULT_SVG_FONT_SIZE);switch(r[0]){case"mm":return i*fabric.DPI/25.4;case"cm":return i*fabric.DPI/2.54;case"in":return i*fabric.DPI;case"pt":return i*fabric.DPI/72;case"pc":return i*fabric.DPI/6;case"em":return i*t;default:return i}},falseFunction:function(){return!1},getKlass:function(n,t){return n=fabric.util.string.camelize(n.charAt(0).toUpperCase()+n.slice(1)),fabric.util.resolveNamespace(t)[n]},resolveNamespace:function(t){var i;if(!t)return fabric;var u=t.split("."),f=u.length,r=n||fabric.window;for(i=0;i<f;++i)r=r[u[i]];return r},loadImage:function(n,t,i,r){if(!n){t&&t.call(i,n);return}var u=fabric.util.createImage();u.onload=function(){t&&t.call(i,u);u=u.onload=u.onerror=null};u.onerror=function(){fabric.log("Error loading "+u.src);t&&t.call(i,null,!0);u=u.onload=u.onerror=null};n.indexOf("data")!==0&&typeof r!="undefined"&&(u.crossOrigin=r);u.src=n},enlivenObjects:function(n,t,i,r){function f(){++o===e&&t&&t(u)}n=n||[];var u=[],o=0,e=n.length;if(!e){t&&t(u);return}n.forEach(function(n,t){if(!n||!n.type){f();return}var e=fabric.util.getKlass(n.type,i);e.async?e.fromObject(n,function(i,e){e||(u[t]=i,r&&r(n,u[t]));f()}):(u[t]=e.fromObject(n),r&&r(n,u[t]),f())})},groupSVGElements:function(n,t,i){var r;return r=new fabric.PathGroup(n,t),typeof i!="undefined"&&r.setSourcePath(i),r},populateWithProperties:function(n,t,i){if(i&&Object.prototype.toString.call(i)==="[object Array]")for(var r=0,u=i.length;r<u;r++)i[r]in n&&(t[i[r]]=n[i[r]])},drawDashedLine:function(n,t,u,f,e,o){var s=f-t,h=e-u,c=i(s*s+h*h),a=r(h,s),v=o.length,y=0,l=!0;for(n.save(),n.translate(t,u),n.moveTo(0,0),n.rotate(a),t=0;c>t;)t+=o[y++%v],t>c&&(t=c),n[l?"lineTo":"moveTo"](t,0),l=!l;n.restore()},createCanvasElement:function(n){return n||(n=fabric.document.createElement("canvas")),n.getContext||typeof G_vmlCanvasManager=="undefined"||G_vmlCanvasManager.initElement(n),n},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(n){for(var t=n.prototype,r=t.stateProperties.length;r--;){var i=t.stateProperties[r],u=i.charAt(0).toUpperCase()+i.slice(1),f="set"+u,e="get"+u;t[e]||(t[e]=function(n){return new Function('return this.get("'+n+'")')}(i));t[f]||(t[f]=function(n){return new Function("value",'return this.set("'+n+'", value)')}(i))}},clipContext:function(n,t){t.save();t.beginPath();n.clipTo(t);t.clip()},multiplyTransformMatrices:function(n,t){return[n[0]*t[0]+n[2]*t[1],n[1]*t[0]+n[3]*t[1],n[0]*t[2]+n[2]*t[3],n[1]*t[2]+n[3]*t[3],n[0]*t[4]+n[2]*t[5]+n[4],n[1]*t[4]+n[3]*t[5]+n[5]]},getFunctionBody:function(n){return(String(n).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(n,t,i,r){var u,f,e,o,s;for(r>0&&(t>r?t-=r:t=0,i>r?i-=r:i=0),u=!0,f=n.getImageData(t,i,r*2||1,r*2||1),e=3,o=f.data.length;e<o;e+=4)if(s=f.data[e],u=s<=0,u===!1)break;return f=null,u}}}(typeof exports!="undefined"?exports:this),function(){function u(n,i,u,e,s,h,c){var rt=r.call(arguments),et,y;if(t[rt])return t[rt];var nt=Math.PI,ht=c*nt/180,p=Math.sin(ht),w=Math.cos(ht),ct=0,lt=0;u=Math.abs(u);e=Math.abs(e);var l=-w*n*.5-p*i*.5,a=-w*i*.5+p*n*.5,tt=u*u,it=e*e,at=a*a,vt=l*l,ut=tt*it-tt*at-it*vt,ft=0;ut<0?(et=Math.sqrt(1-ut/(tt*it)),u*=et,e*=et):ft=(s===h?-1:1)*Math.sqrt(ut/(tt*at+it*vt));var b=ft*u*a/e,k=-ft*e*l/u,pt=w*b-p*k+n*.5,wt=p*b+w*k+i*.5,ot=f(1,0,(l-b)/u,(a-k)/e),v=f((l-b)/u,(a-k)/e,(-l-b)/u,(-a-k)/e);h===0&&v>0?v-=2*nt:h===1&&v<0&&(v+=2*nt);var yt=Math.ceil(Math.abs(v/nt*2)),d=[],g=v/yt,bt=8/3*Math.sin(g/4)*Math.sin(g/4)/Math.sin(g/2),st=ot+g;for(y=0;y<yt;y++)d[y]=o(ot,st,w,p,u,e,pt,wt,bt,ct,lt),ct=d[y][4],lt=d[y][5],ot=st,st+=g;return t[rt]=d,d}function o(t,i,u,f,e,o,s,h,c,l,a){var v=r.call(arguments);if(n[v])return n[v];var w=Math.cos(t),b=Math.sin(t),y=Math.cos(i),p=Math.sin(i),k=u*e*y-f*o*p+s,d=f*e*y+u*o*p+h,g=l+c*(-u*e*b-f*o*w),nt=a+c*(-f*e*b+u*o*w),tt=k+c*(u*e*p+f*o*y),it=d+c*(f*e*p-u*o*y);return n[v]=[g,nt,tt,it,k,d],n[v]}function f(n,t,i,r){var u=Math.atan2(t,n),f=Math.atan2(r,i);return f>=u?f-u:2*Math.PI-(u-f)}function e(n,t,u,f,e,o,s,h){var tt=r.call(arguments),nt,st,ht,p,b,l,ut;if(i[tt])return i[tt];var ct=Math.sqrt,ft=Math.min,et=Math.max,ot=Math.abs,w=[],a=[[],[]],y,v,k,c,d,g,it,rt;for(v=6*n-12*u+6*e,y=-3*n+9*u-9*e+3*s,k=3*u-3*n,nt=0;nt<2;++nt){if(nt>0&&(v=6*t-12*f+6*o,y=-3*t+9*f-9*o+3*h,k=3*f-3*t),ot(y)<1e-12){if(ot(v)<1e-12)continue;c=-k/v;0<c&&c<1&&w.push(c);continue}(it=v*v-4*k*y,it<0)||(rt=ct(it),d=(-v+rt)/(2*y),0<d&&d<1&&w.push(d),g=(-v-rt)/(2*y),0<g&&g<1&&w.push(g))}for(p=w.length,b=p;p--;)c=w[p],l=1-c,st=l*l*l*n+3*l*l*c*u+3*l*c*c*e+c*c*c*s,a[0][p]=st,ht=l*l*l*t+3*l*l*c*f+3*l*c*c*o+c*c*c*h,a[1][p]=ht;return a[0][b]=n,a[1][b]=t,a[0][b+1]=s,a[1][b+1]=h,ut=[{x:ft.apply(null,a[0]),y:ft.apply(null,a[1])},{x:et.apply(null,a[0]),y:et.apply(null,a[1])}],i[tt]=ut,ut}var t={},n={},i={},r=Array.prototype.join;fabric.util.drawArc=function(n,t,i,r){for(var s=r[0],h=r[1],c=r[2],l=r[3],a=r[4],v=r[5],y=r[6],e=[[],[],[],[]],o=u(v-t,y-i,s,h,l,a,c),f=0,p=o.length;f<p;f++)e[f][0]=o[f][0]+t,e[f][1]=o[f][1]+i,e[f][2]=o[f][2]+t,e[f][3]=o[f][3]+i,e[f][4]=o[f][4]+t,e[f][5]=o[f][5]+i,n.bezierCurveTo.apply(n,e[f])};fabric.util.getBoundsOfArc=function(n,t,i,r,f,o,s,h,c){for(var w=0,b=0,y=[],p=[],a=u(h-n,c-t,i,r,o,s,f),v=[[],[]],l=0,k=a.length;l<k;l++)y=e(w,b,a[l][0],a[l][1],a[l][2],a[l][3],a[l][4],a[l][5]),v[0].x=y[0].x+n,v[0].y=y[0].y+t,v[1].x=y[1].x+n,v[1].y=y[1].y+t,p.push(v[0]),p.push(v[1]),w=a[l][4],b=a[l][5];return p};fabric.util.getBoundsOfCurve=e}(),function(){function i(n,i){for(var u=t.call(arguments,2),f=[],r=0,e=n.length;r<e;r++)f[r]=u.length?n[r][i].apply(n[r],u):n[r][i].call(n[r]);return f}function r(t,i){return n(t,i,function(n,t){return n>=t})}function u(t,i){return n(t,i,function(n,t){return n<t})}function n(n,t,i){if(n&&n.length!==0){var r=n.length-1,u=t?n[r][t]:n[r];if(t)while(r--)i(n[r][t],u)&&(u=n[r][t]);else while(r--)i(n[r],u)&&(u=n[r]);return u}}var t=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(n){var u,r,t,i;if(this===void 0||this===null)throw new TypeError;if((u=Object(this),r=u.length>>>0,r===0)||(t=0,arguments.length>0&&(t=Number(arguments[1]),t!==t?t=0:t!==0&&t!==Number.POSITIVE_INFINITY&&t!==Number.NEGATIVE_INFINITY&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=r))return-1;for(i=t>=0?t:Math.max(r-Math.abs(t),0);i<r;i++)if(i in u&&u[i]===n)return i;return-1});Array.prototype.forEach||(Array.prototype.forEach=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)i in this&&n.call(t,this[i],i,this)});Array.prototype.map||(Array.prototype.map=function(n,t){for(var r=[],i=0,u=this.length>>>0;i<u;i++)i in this&&(r[i]=n.call(t,this[i],i,this));return r});Array.prototype.every||(Array.prototype.every=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)if(i in this&&!n.call(t,this[i],i,this))return!1;return!0});Array.prototype.some||(Array.prototype.some=function(n,t){for(var i=0,r=this.length>>>0;i<r;i++)if(i in this&&n.call(t,this[i],i,this))return!0;return!1});Array.prototype.filter||(Array.prototype.filter=function(n,t){for(var u=[],r,i=0,f=this.length>>>0;i<f;i++)i in this&&(r=this[i],n.call(t,r,i,this)&&u.push(r));return u});Array.prototype.reduce||(Array.prototype.reduce=function(n){var r=this.length>>>0,t=0,i;if(arguments.length>1)i=arguments[1];else do{if(t in this){i=this[t++];break}if(++t>=r)throw new TypeError;}while(1);for(;t<r;t++)t in this&&(i=n.call(null,i,this[t],t,this));return i});fabric.util.array={invoke:i,min:u,max:r}}(),function(){function n(n,t){for(var i in t)n[i]=t[i];return n}function t(t){return n({},t)}fabric.util.object={extend:n,clone:t}}(),function(){function n(n){return n.replace(/-+(.)?/g,function(n,t){return t?t.toUpperCase():""})}function t(n,t){return n.charAt(0).toUpperCase()+(t?n.slice(1):n.slice(1).toLowerCase())}function i(n){return n.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")});fabric.util.string={camelize:n,capitalize:t,escapeXml:i}}(),function(){var t=Array.prototype.slice,i=Function.prototype.apply,n=function(){};Function.prototype.bind||(Function.prototype.bind=function(r){var f=this,e=t.call(arguments,1),u;return u=e.length?function(){return i.call(f,this instanceof n?this:r,e.concat(t.call(arguments)))}:function(){return i.call(f,this instanceof n?this:r,arguments)},n.prototype=this.prototype,u.prototype=new n,u})}(),function(){function t(){}function f(t){var i=this.constructor.superclass.prototype[t];return arguments.length>1?i.apply(this,n.call(arguments,1)):i.call(this)}function e(){function r(){this.initialize.apply(this,arguments)}var e=null,o=n.call(arguments,0),s,h;for(typeof o[0]=="function"&&(e=o.shift()),r.superclass=e,r.subclasses=[],e&&(t.prototype=e.prototype,r.prototype=new t,e.subclasses.push(r)),s=0,h=o.length;s<h;s++)u(r,o[s],e);return r.prototype.initialize||(r.prototype.initialize=i),r.prototype.constructor=r,r.prototype.callSuper=f,r}var n=Array.prototype.slice,i=function(){},r=function(){for(var n in{toString:1})if(n==="toString")return!1;return!0}(),u=function(n,t,i){for(var u in t)n.prototype[u]=u in n.prototype&&typeof n.prototype[u]=="function"&&(t[u]+"").indexOf("callSuper")>-1?function(n){return function(){var u=this.constructor.superclass,r;return this.constructor.superclass=i,r=t[n].apply(this,arguments),this.constructor.superclass=u,n!=="initialize"?r:void 0}}(u):t[u],r&&(t.toString!==Object.prototype.toString&&(n.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(n.prototype.valueOf=t.valueOf))};fabric.util.createClass=e}(),function(){function i(n){for(var i=Array.prototype.slice.call(arguments,1),r,u=i.length,t=0;t<u;t++)if(r=typeof n[i[t]],!/^(?:function|object|unknown)$/.test(r))return!1;return!0}function a(n,t){return{handler:t,wrappedHandler:v(n,t)}}function v(n,t){return function(i){t.call(h(n),i||fabric.window.event)}}function y(t,i){return function(r){var f,u,e;if(n[t]&&n[t][i])for(f=n[t][i],u=0,e=f.length;u<e;u++)f[u].call(this,r||fabric.window.event)}}function b(n,t){n||(n=fabric.window.event);var r=n.target||(typeof n.srcElement!==e?n.srcElement:null),i=fabric.util.getScrollLeftTop(r,t);return{x:o(n)+i.left,y:s(n)+i.top}}function l(n,t,i){var r=n.type==="touchend"?"changedTouches":"touches";return n[r]&&n[r][0]?n[r][0][t]-(n[r][0][t]-n[r][0][i])||n[i]:n[i]}var e="unknown",h,c,r=function(){var n=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+n++)}}(),o,s;(function(){var n={};h=function(t){return n[t]};c=function(t,i){n[t]=i}})();var p=i(fabric.document.documentElement,"addEventListener","removeEventListener")&&i(fabric.window,"addEventListener","removeEventListener"),w=i(fabric.document.documentElement,"attachEvent","detachEvent")&&i(fabric.window,"attachEvent","detachEvent"),t={},n={},u,f;p?(u=function(n,t,i){n.addEventListener(t,i,!1)},f=function(n,t,i){n.removeEventListener(t,i,!1)}):w?(u=function(n,i,u){var f=r(n),e;c(f,n);t[f]||(t[f]={});t[f][i]||(t[f][i]=[]);e=a(f,u);t[f][i].push(e);n.attachEvent("on"+i,e.wrappedHandler)},f=function(n,i,u){var f=r(n),o,e,s;if(t[f]&&t[f][i])for(e=0,s=t[f][i].length;e<s;e++)o=t[f][i][e],o&&o.handler===u&&(n.detachEvent("on"+i,o.wrappedHandler),t[f][i][e]=null)}):(u=function(t,i,u){var f=r(t),e;n[f]||(n[f]={});n[f][i]||(n[f][i]=[],e=t["on"+i],e&&n[f][i].push(e),t["on"+i]=y(f,i));n[f][i].push(u)},f=function(t,i,u){var o=r(t),e,f,s;if(n[o]&&n[o][i])for(e=n[o][i],f=0,s=e.length;f<s;f++)e[f]===u&&e.splice(f,1)});fabric.util.addListener=u;fabric.util.removeListener=f;o=function(n){return typeof n.clientX!==e?n.clientX:0};s=function(n){return typeof n.clientY!==e?n.clientY:0};fabric.isTouchSupported&&(o=function(n){return l(n,"pageX","clientX")},s=function(n){return l(n,"pageY","clientY")});fabric.util.getPointer=b;fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function r(t,i){var u=t.style,r,f;if(!u)return t;if(typeof i=="string")return t.style.cssText+=";"+i,i.indexOf("opacity")>-1?n(t,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(r in i)r==="opacity"?n(t,i[r]):(f=r==="float"||r==="cssFloat"?typeof u.styleFloat=="undefined"?"cssFloat":"styleFloat":r,u[f]=i[r]);return t}var t=fabric.document.createElement("div"),u=typeof t.style.opacity=="string",f=typeof t.style.filter=="string",i=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,n=function(n){return n};u?n=function(n,t){return n.style.opacity=t,n}:f&&(n=function(n,t){var r=n.style;return n.currentStyle&&!n.currentStyle.hasLayout&&(r.zoom=1),i.test(r.filter)?(t=t>=.9999?"":"alpha(opacity="+t*100+")",r.filter=r.filter.replace(i,t)):r.filter+=" alpha(opacity="+t*100+")",n});fabric.util.setStyle=r}(),function(){function f(n){return typeof n=="string"?fabric.document.getElementById(n):n}function r(n,t){var r=fabric.document.createElement(n);for(var i in t)i==="class"?r.className=t[i]:i==="for"?r.htmlFor=t[i]:r.setAttribute(i,t[i]);return r}function e(n,t){n&&(" "+n.className+" ").indexOf(" "+t+" ")===-1&&(n.className+=(n.className?" ":"")+t)}function o(n,t,i){return typeof t=="string"&&(t=r(t,i)),n.parentNode&&n.parentNode.replaceChild(t,n),t.appendChild(n),t}function s(n,t){for(var u,i=0,r=0,e=fabric.document.documentElement,o=fabric.document.body||{scrollLeft:0,scrollTop:0},f=n;n&&n.parentNode&&!u;)n=n.parentNode,n.nodeType===1&&fabric.util.getElementStyle(n,"position")==="fixed"&&(u=n),n.nodeType===1&&f!==t&&fabric.util.getElementStyle(n,"position")==="absolute"?(i=0,r=0):n===fabric.document?(i=o.scrollLeft||e.scrollLeft||0,r=o.scrollTop||e.scrollTop||0):(i+=n.scrollLeft||0,r+=n.scrollTop||0);return{left:i,top:r}}function h(n){var i,o=n&&n.ownerDocument,r={left:0,top:0},u={left:0,top:0},f,s={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"},e;if(!o)return{left:0,top:0};for(e in s)u[s[e]]+=parseInt(t(n,e),10)||0;return i=o.documentElement,typeof n.getBoundingClientRect!="undefined"&&(r=n.getBoundingClientRect()),f=fabric.util.getScrollLeftTop(n,null),{left:r.left+f.left-(i.clientLeft||0)+u.left,top:r.top+f.top-(i.clientTop||0)+u.top}}var u=Array.prototype.slice,i,n=function(n){return u.call(n,0)},t;try{i=n(fabric.document.childNodes)instanceof Array}catch(c){}i||(n=function(n){for(var i=new Array(n.length),t=n.length;t--;)i[t]=n[t];return i});t=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(n,t){var i=fabric.document.defaultView.getComputedStyle(n,null);return i?i[t]:undefined}:function(n,t){var i=n.style[t];return!i&&n.currentStyle&&(i=n.currentStyle[t]),i},function(){function i(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=fabric.util.falseFunction),t?n.style[t]="none":typeof n.unselectable=="string"&&(n.unselectable="on"),n}function r(n){return typeof n.onselectstart!="undefined"&&(n.onselectstart=null),t?n.style[t]="":typeof n.unselectable=="string"&&(n.unselectable=""),n}var n=fabric.document.documentElement.style,t="userSelect"in n?"userSelect":"MozUserSelect"in n?"MozUserSelect":"WebkitUserSelect"in n?"WebkitUserSelect":"KhtmlUserSelect"in n?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=i;fabric.util.makeElementSelectable=r}(),function(){function n(n,t){var u=fabric.document.getElementsByTagName("head")[0],i=fabric.document.createElement("script"),r=!0;i.onload=i.onreadystatechange=function(n){if(r){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;r=!1;t(n||fabric.window.event);i=i.onload=i.onreadystatechange=null}};i.src=n;u.appendChild(i)}fabric.util.getScript=n}();fabric.util.getById=f;fabric.util.toArray=n;fabric.util.makeElement=r;fabric.util.addClass=e;fabric.util.wrapElement=o;fabric.util.getScrollLeftTop=s;fabric.util.getElementOffset=h;fabric.util.getElementStyle=t}(),function(){function n(n,t){return n+(/\?/.test(n)?"&":"?")+t}function i(){}function r(r,u){u||(u={});var e=u.method?u.method.toUpperCase():"GET",s=u.onComplete||function(){},f=t(),o;return f.onreadystatechange=function(){f.readyState===4&&(s(f),f.onreadystatechange=i)},e==="GET"&&(o=null,typeof u.parameters=="string"&&(r=n(r,u.parameters))),f.open(e,r,!0),(e==="POST"||e==="PUT")&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.send(o),f}var t=function(){for(var i,n=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],t=n.length;t--;)try{if(i=n[t](),i)return n[t]}catch(r){}}();fabric.util.request=r}();fabric.log=function(){};fabric.warn=function(){};typeof console!="undefined"&&["log","warn"].forEach(function(n){typeof console[n]!="undefined"&&typeof console[n].apply=="function"&&(fabric[n]=function(){return console[n].apply(console,arguments)})}),function(){function t(t){n(function(i){t||(t={});var u=i||+new Date,f=t.duration||500,e=u+f,r,s=t.onChange||function(){},h=t.abort||function(){return!1},c=t.easing||function(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t},o="startValue"in t?t.startValue:0,l="endValue"in t?t.endValue:100,a=t.byValue||l-o;t.onStart&&t.onStart(),function v(i){r=i||+new Date;var l=r>e?f:r-u;if(h()){t.onComplete&&t.onComplete();return}if(s(c(l,o,a,f)),r>e){t.onComplete&&t.onComplete();return}n(v)}(u)})}function n(){return i.apply(fabric.window,arguments)}var i=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(n){fabric.window.setTimeout(n,1e3/60)};fabric.util.animate=t;fabric.util.requestAnimFrame=n}(),function(){function n(n,t,i,r){return n<Math.abs(t)?(n=t,r=i/4):r=i/(2*Math.PI)*Math.asin(t/n),{a:n,c:t,p:i,s:r}}function i(n,t,i){return n.a*Math.pow(2,10*(t-=1))*Math.sin((t*i-n.s)*2*Math.PI/n.p)}function u(n,t,i,r){return i*((n=n/r-1)*n*n+1)+t}function f(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n*n+t:i/2*((n-=2)*n*n+2)+t}function e(n,t,i,r){return i*(n/=r)*n*n*n+t}function o(n,t,i,r){return-i*((n=n/r-1)*n*n*n-1)+t}function s(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n*n*n+t:-i/2*((n-=2)*n*n*n-2)+t}function h(n,t,i,r){return i*(n/=r)*n*n*n*n+t}function c(n,t,i,r){return i*((n=n/r-1)*n*n*n*n+1)+t}function l(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n*n*n*n+t:i/2*((n-=2)*n*n*n*n+2)+t}function a(n,t,i,r){return-i*Math.cos(n/r*(Math.PI/2))+i+t}function v(n,t,i,r){return i*Math.sin(n/r*(Math.PI/2))+t}function y(n,t,i,r){return-i/2*(Math.cos(Math.PI*n/r)-1)+t}function p(n,t,i,r){return n===0?t:i*Math.pow(2,10*(n/r-1))+t}function w(n,t,i,r){return n===r?t+i:i*(-Math.pow(2,-10*n/r)+1)+t}function b(n,t,i,r){return n===0?t:n===r?t+i:(n/=r/2,n<1)?i/2*Math.pow(2,10*(n-1))+t:i/2*(-Math.pow(2,-10*--n)+2)+t}function k(n,t,i,r){return-i*(Math.sqrt(1-(n/=r)*n)-1)+t}function d(n,t,i,r){return i*Math.sqrt(1-(n=n/r-1)*n)+t}function g(n,t,i,r){return(n/=r/2,n<1)?-i/2*(Math.sqrt(1-n*n)-1)+t:i/2*(Math.sqrt(1-(n-=2)*n)+1)+t}function nt(t,r,u,f){var e=0,s=u,o;return t===0?r:(t/=f,t===1)?r+u:(e||(e=f*.3),o=n(s,u,e,1.70158),-i(o,t,f)+r)}function tt(t,i,r,u){var e=0,o=r,f;return t===0?i:(t/=u,t===1)?i+r:(e||(e=u*.3),f=n(o,r,e,1.70158),f.a*Math.pow(2,-10*t)*Math.sin((t*u-f.s)*2*Math.PI/f.p)+f.c+i)}function it(t,r,u,f){var o=0,s=u,e;return t===0?r:(t/=f/2,t===2)?r+u:(o||(o=f*.3*1.5),e=n(s,u,o,1.70158),t<1)?-.5*i(e,t,f)+r:e.a*Math.pow(2,-10*(t-=1))*Math.sin((t*f-e.s)*2*Math.PI/e.p)*.5+e.c+r}function rt(n,t,i,r,u){return u===undefined&&(u=1.70158),i*(n/=r)*n*((u+1)*n-u)+t}function ut(n,t,i,r,u){return u===undefined&&(u=1.70158),i*((n=n/r-1)*n*((u+1)*n+u)+1)+t}function ft(n,t,i,r,u){return(u===undefined&&(u=1.70158),n/=r/2,n<1)?i/2*n*n*(((u*=1.525)+1)*n-u)+t:i/2*((n-=2)*n*(((u*=1.525)+1)*n+u)+2)+t}function r(n,i,r,u){return r-t(u-n,0,r,u)+i}function t(n,t,i,r){return(n/=r)<1/2.75?i*7.5625*n*n+t:n<2/2.75?i*(7.5625*(n-=1.5/2.75)*n+.75)+t:n<2.5/2.75?i*(7.5625*(n-=2.25/2.75)*n+.9375)+t:i*(7.5625*(n-=2.625/2.75)*n+.984375)+t}function et(n,i,u,f){return n<f/2?r(n*2,0,u,f)*.5+i:t(n*2-f,0,u,f)*.5+u*.5+i}fabric.util.ease={easeInQuad:function(n,t,i,r){return i*(n/=r)*n+t},easeOutQuad:function(n,t,i,r){return-i*(n/=r)*(n-2)+t},easeInOutQuad:function(n,t,i,r){return(n/=r/2,n<1)?i/2*n*n+t:-i/2*(--n*(n-2)-1)+t},easeInCubic:function(n,t,i,r){return i*(n/=r)*n*n+t},easeOutCubic:u,easeInOutCubic:f,easeInQuart:e,easeOutQuart:o,easeInOutQuart:s,easeInQuint:h,easeOutQuint:c,easeInOutQuint:l,easeInSine:a,easeOutSine:v,easeInOutSine:y,easeInExpo:p,easeOutExpo:w,easeInOutExpo:b,easeInCirc:k,easeOutCirc:d,easeInOutCirc:g,easeInElastic:nt,easeOutElastic:tt,easeInOutElastic:it,easeInBack:rt,easeOutBack:ut,easeInOutBack:ft,easeInBounce:r,easeOutBounce:t,easeInOutBounce:et}}(),function(n){"use strict";function u(n){return n in h?h[n]:n}function f(n,r,u,f){var o=Object.prototype.toString.call(r)==="[object Array]",e;return(n==="fill"||n==="stroke")&&r==="none"?r="":n==="strokeDashArray"?r=r.replace(/,/g," ").split(/\s+/).map(function(n){return parseFloat(n)}):n==="transformMatrix"?r=u&&u.transformMatrix?b(u.transformMatrix,t.parseTransformAttribute(r)):t.parseTransformAttribute(r):n==="visible"?(r=r==="none"||r==="hidden"?!1:!0,u&&u.visible===!1&&(r=!1)):n==="originX"?r=r==="start"?"left":r==="end"?"right":"center":e=o?r.map(i):i(r,f),!o&&isNaN(e)?r:e}function k(n){var i,r;for(i in o)n[i]&&typeof n[o[i]]!="undefined"&&n[i].indexOf("url(")!==0&&(r=new t.Color(n[i]),n[i]=r.setAlpha(w(r.getAlpha()*n[o[i]],2)).toRgba());return n}function d(n,t){var i,r;n.replace(/;$/,"").split(";").forEach(function(n){var e=n.split(":");i=u(e[0].trim().toLowerCase());r=f(i,e[1].trim());t[i]=r})}function g(n,t){var i,e;for(var r in n)typeof n[r]!="undefined"&&(i=u(r.toLowerCase()),e=f(i,n[r]),t[i]=e)}function nt(n,i){var f={},r,u;for(r in t.cssRules[i])if(tt(n,r.split(" ")))for(u in t.cssRules[i][r])f[u]=t.cssRules[i][r][u];return f}function tt(n,t){var i,r=!0;return i=c(n,t.pop()),i&&t.length&&(r=it(n,t)),i&&r&&t.length===0}function it(n,t){for(var i,r=!0;n.parentNode&&n.parentNode.nodeType===1&&t.length;)r&&(i=t.pop()),n=n.parentNode,r=c(n,i);return t.length===0}function c(n,t){var e=n.nodeName,r=n.getAttribute("class"),f=n.getAttribute("id"),i,u;if(i=new RegExp("^"+e,"i"),t=t.replace(i,""),f&&t.length&&(i=new RegExp("#"+f+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"")),r&&t.length)for(r=r.split(" "),u=r.length;u--;)i=new RegExp("\\."+r[u]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(i,"");return t.length===0}function rt(n){for(var e=n.getElementsByTagName("use"),t;e.length;){for(var i=e[0],h=i.getAttribute("xlink:href").substr(1),c=i.getAttribute("x")||0,l=i.getAttribute("y")||0,r=n.getElementById(h).cloneNode(!0),u=(r.getAttribute("transform")||"")+" translate("+c+", "+l+")",o,f=0,s=i.attributes,a=s.length;f<a;f++)(t=s.item(f),t.nodeName!=="x"&&t.nodeName!=="y"&&t.nodeName!=="xlink:href")&&(t.nodeName==="transform"?u=t.nodeValue+" "+u:r.setAttribute(t.nodeName,t.nodeValue));r.setAttribute("transform",u);r.setAttribute("instantiated_by_use","1");r.removeAttribute("id");o=i.parentNode;o.replaceChild(r,i)}}function l(n,t,i){var r=n.getAttribute("viewBox"),u=1,f=1,h=0,c=0,l,a,o,e;if(r&&(r=r.match(s)))h=-parseFloat(r[1]),c=-parseFloat(r[2]),l=parseFloat(r[3]),a=parseFloat(r[4]);else return;if(t&&t!==l&&(u=t/l),i&&i!==a&&(f=i/a),f=u=u>f?f:u,u!==1||f!==1||h!==0||c!==0){if(o=" matrix("+u+" 0 0 "+f+" "+h*u+" "+c*f+") ",n.tagName==="svg"){for(e=n.ownerDocument.createElement("g");n.firstChild!=null;)e.appendChild(n.firstChild);n.appendChild(e)}else e=n,o=e.getAttribute("transform")+o;e.setAttribute("transform",o)}}function ut(n){var i=n.objects,r=n.options;return i=i.map(function(n){return t[y(n.type)].fromObject(n)}),{objects:i,options:r}}function a(n,t,i){t[i]&&t[i].toSVG&&n.push('<pattern x="0" y="0" id="',i,'Pattern" ','width="',t[i].source.width,'" height="',t[i].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',t[i].source.width,'" height="',t[i].source.height,'" xlink:href="',t[i].source.src,'"><\/image><\/pattern>')}var t=n.fabric||(n.fabric={}),r=t.util.object.extend,y=t.util.string.capitalize,p=t.util.object.clone,w=t.util.toFixed,i=t.util.parseUnit,b=t.util.multiplyTransformMatrices,h={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},o={stroke:"strokeOpacity",fill:"fillOpacity"},s,e,v;t.cssRules={};t.gradientDefs={};t.parseTransformAttribute=function(){function f(n,t){var i=t[0];n[0]=Math.cos(i);n[1]=Math.sin(i);n[2]=-Math.sin(i);n[3]=Math.cos(i)}function e(n,t){var i=t[0],r=t.length===2?t[1]:t[0];n[0]=i;n[3]=r}function o(n,i){n[2]=Math.tan(t.util.degreesToRadians(i[0]))}function s(n,i){n[1]=Math.tan(t.util.degreesToRadians(i[0]))}function h(n,t){n[4]=t[0];t.length===2&&(n[5]=t[1])}var u=[1,0,0,1,0,0],n=t.reNum,i="(?:\\s+,?\\s*|,\\s*)",c="(?:(skewX)\\s*\\(\\s*("+n+")\\s*\\))",l="(?:(skewY)\\s*\\(\\s*("+n+")\\s*\\))",a="(?:(rotate)\\s*\\(\\s*("+n+")(?:"+i+"("+n+")"+i+"("+n+"))?\\s*\\))",v="(?:(scale)\\s*\\(\\s*("+n+")(?:"+i+"("+n+"))?\\s*\\))",y="(?:(translate)\\s*\\(\\s*("+n+")(?:"+i+"("+n+"))?\\s*\\))",p="(?:(matrix)\\s*\\(\\s*("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")"+i+"("+n+")\\s*\\))",r="(?:"+p+"|"+y+"|"+v+"|"+a+"|"+c+"|"+l+")",w="(?:"+r+"(?:"+i+r+")*)",b="^\\s*(?:"+w+"?)\\s*$",k=new RegExp(b),d=new RegExp(r,"g");return function(n){var i=u.concat(),c=[],l;if(!n||n&&!k.test(n))return i;for(n.replace(d,function(n){var a=new RegExp(r).exec(n).filter(function(n){return n!==""&&n!=null}),v=a[1],l=a.slice(2).map(parseFloat);switch(v){case"translate":h(i,l);break;case"rotate":l[0]=t.util.degreesToRadians(l[0]);f(i,l);break;case"scale":e(i,l);break;case"skewX":o(i,l);break;case"skewY":s(i,l);break;case"matrix":i=l}c.push(i.concat());i=u.concat()}),l=c[0];c.length>1;)c.shift(),l=t.util.multiplyTransformMatrices(l,c[0]);return l}}();s=new RegExp("^\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*,?\\s*("+t.reNum+"+)\\s*$");t.parseSVGDocument=function(){function u(n,t){while(n&&(n=n.parentNode))if(t.test(n.nodeName)&&!n.getAttribute("instantiated_by_use"))return!0;return!1}var n=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,r=/^(symbol|image|marker|pattern|view)$/;return function(f,e,o){var c,h,k,y,nt,w,d;if(f){rt(f);var tt=new Date,b=t.Object.__uid++,a,v,g=!1;if(f.getAttribute("width")&&f.getAttribute("width")!=="100%"&&(a=i(f.getAttribute("width"))),f.getAttribute("height")&&f.getAttribute("height")!=="100%"&&(v=i(f.getAttribute("height"))),a&&v||(c=f.getAttribute("viewBox"),c&&(c=c.match(s))?(a=parseFloat(c[3]),v=parseFloat(c[4])):g=!0),l(f,a,v),h=t.util.toArray(f.getElementsByTagName("*")),h.length===0&&t.isLikelyNode){for(h=f.selectNodes('//*[name(.)!="svg"]'),k=[],y=0,nt=h.length;y<nt;y++)k[y]=h[y];h=k}if(w=h.filter(function(t){return r.test(t.tagName)&&l(t,0,0),n.test(t.tagName)&&!u(t,/^(?:pattern|defs|symbol)$/)}),!w||w&&!w.length){e&&e([],{});return}d={width:a,height:v,svgUid:b,toBeParsed:g};t.gradientDefs[b]=t.getGradientDefs(f);t.cssRules[b]=t.getCSSRules(f);t.parseElements(w,function(n){t.documentParsingTime=new Date-tt;e&&e(n,d)},p(d),o)}}}();e={has:function(n,t){t(!1)},get:function(){},set:function(){}};v=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+t.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+t.reNum+"))?\\s+(.*)");r(t,{parseFontDeclaration:function(n,t){var r=n.match(v);if(r){var e=r[1],u=r[3],o=r[4],f=r[5],s=r[6];e&&(t.fontStyle=e);u&&(t.fontWeight=isNaN(parseFloat(u))?u:parseFloat(u));o&&(t.fontSize=i(o));s&&(t.fontFamily=s);f&&(t.lineHeight=f==="normal"?1:f)}},getGradientDefs:function(n){var o=n.getElementsByTagName("linearGradient"),s=n.getElementsByTagName("radialGradient"),t,i,u=0,r,h,f=[],e={},c={},l;for(f.length=o.length+s.length,i=o.length;i--;)f[u++]=o[i];for(i=s.length;i--;)f[u++]=s[i];while(u--)t=f[u],h=t.getAttribute("xlink:href"),r=t.getAttribute("id"),h&&(c[r]=h.substr(1)),e[r]=t;for(r in c)for(l=e[c[r]].cloneNode(!0),t=e[r];l.firstChild;)t.appendChild(l.firstChild);return e},parseAttributes:function(n,i,e){var h,s,c,o;if(n)return s={},typeof e=="undefined"&&(e=n.getAttribute("svgUid")),n.parentNode&&/^symbol|[g|a]$/i.test(n.parentNode.nodeName)&&(s=t.parseAttributes(n.parentNode,i,e)),c=s&&s.fontSize||n.getAttribute("font-size")||t.Text.DEFAULT_SVG_FONT_SIZE,o=i.reduce(function(t,i){return h=n.getAttribute(i),h&&(i=u(i),h=f(i,h,s,c),t[i]=h),t},{}),o=r(o,r(nt(n,e),t.parseStyleAttribute(n))),o.font&&t.parseFontDeclaration(o.font,o),k(r(s,o))},parseElements:function(n,i,r,u){new t.ElementsParser(n,i,r,u).parse()},parseStyleAttribute:function(n){var t={},i=n.getAttribute("style");return i?(typeof i=="string"?d(i,t):g(i,t),t):t},parsePointsAttribute:function(n){if(!n)return null;n=n.replace(/,/g," ").trim();n=n.split(/\s+/);for(var i=[],t=0,r=n.length;t<r;t+=2)i.push({x:parseFloat(n[t]),y:parseFloat(n[t+1])});return i},getCSSRules:function(n){for(var i,o=n.getElementsByTagName("style"),s={},r,e=0,h=o.length;e<h;e++)(i=o[e].textContent,i=i.replace(/\/\*[\s\S]*?\*\//g,""),i.trim()!=="")&&(r=i.match(/[^{]*\{[\s\S]*?\}/g),r=r.map(function(n){return n.trim()}),r.forEach(function(n){for(var e=n.match(/([\s\S]*?)\s*\{([^}]*)\}/),o={},l=e[2].trim(),h=l.replace(/;$/,"").split(/\s*;\s*/),i=0,a=h.length;i<a;i++){var r=h[i].split(/\s*:\s*/),c=u(r[0]),v=f(c,r[1],r[0]);o[c]=v}n=e[1];n.split(",").forEach(function(n){(n=n.replace(/^svg/i,"").trim(),n!=="")&&(s[n]=t.util.object.clone(o))})}));return s},loadSVGFromURL:function(n,i,r){function u(u){var f=u.responseXML;(f&&!f.documentElement&&t.window.ActiveXObject&&u.responseText&&(f=new ActiveXObject("Microsoft.XMLDOM"),f.async="false",f.loadXML(u.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))),f&&f.documentElement)&&t.parseSVGDocument(f.documentElement,function(r,u){e.set(n,{objects:t.util.array.invoke(r,"toObject"),options:u});i(r,u)},r)}n=n.replace(/^\n\s*/,"").trim();e.has(n,function(r){r?e.get(n,function(n){var t=ut(n);i(t.objects,t.options)}):new t.util.request(n,{method:"get",onComplete:u})})},loadSVGFromString:function(n,i,r){var u,f;n=n.trim();typeof DOMParser!="undefined"?(f=new DOMParser,f&&f.parseFromString&&(u=f.parseFromString(n,"text/xml"))):t.window.ActiveXObject&&(u=new ActiveXObject("Microsoft.XMLDOM"),u.async="false",u.loadXML(n.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));t.parseSVGDocument(u.documentElement,function(n,t){i(n,t)},r)},createSVGFontFacesMarkup:function(n){for(var i="",t=0,r=n.length;t<r;t++)n[t].type==="text"&&n[t].path&&(i+=["@font-face {","font-family: ",n[t].fontFamily,"; ","src: url('",n[t].path,"')","}"].join(""));return i&&(i=['<style type="text/css">',"<![CDATA[",i,"]\]>","<\/style>"].join("")),i},createSVGRefElementsMarkup:function(n){var t=[];return a(t,n,"backgroundColor"),a(t,n,"overlayColor"),t.join("")}})}(typeof exports!="undefined"?exports:this);fabric.ElementsParser=function(n,t,i,r){this.elements=n;this.callback=t;this.options=i;this.reviver=r;this.svgUid=i&&i.svgUid||0};fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};fabric.ElementsParser.prototype.createObjects=function(){for(var n=0,t=this.elements.length;n<t;n++)this.elements[n].setAttribute("svgUid",this.svgUid),function(n,t){setTimeout(function(){n.createObject(n.elements[t],t)},0)}(this,n)};fabric.ElementsParser.prototype.createObject=function(n,t){var i=fabric[fabric.util.string.capitalize(n.tagName)];if(i&&i.fromElement)try{this._createObject(i,n,t)}catch(r){fabric.log(r)}else this.checkIfDone()};fabric.ElementsParser.prototype._createObject=function(n,t,i){if(n.async)n.fromElement(t,this.createCallback(i,t),this.options);else{var r=n.fromElement(t,this.options);this.resolveGradient(r,"fill");this.resolveGradient(r,"stroke");this.reviver&&this.reviver(t,r);this.instances[i]=r;this.checkIfDone()}};fabric.ElementsParser.prototype.createCallback=function(n,t){var i=this;return function(r){i.resolveGradient(r,"fill");i.resolveGradient(r,"stroke");i.reviver&&i.reviver(t,r);i.instances[n]=r;i.checkIfDone()}};fabric.ElementsParser.prototype.resolveGradient=function(n,t){var i=n.get(t),r;/^url\(/.test(i)&&(r=i.slice(5,i.length-1),fabric.gradientDefs[this.svgUid][r]&&n.set(t,fabric.Gradient.fromElement(fabric.gradientDefs[this.svgUid][r],n)))};fabric.ElementsParser.prototype.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(n){return n!=null}),this.callback(this.instances))},function(n){"use strict";function t(n,t){this.x=n;this.y=t}var i=n.fabric||(n.fabric={});if(i.Point){i.warn("fabric.Point is already defined");return}i.Point=t;t.prototype={constructor:t,add:function(n){return new t(this.x+n.x,this.y+n.y)},addEquals:function(n){return this.x+=n.x,this.y+=n.y,this},scalarAdd:function(n){return new t(this.x+n,this.y+n)},scalarAddEquals:function(n){return this.x+=n,this.y+=n,this},subtract:function(n){return new t(this.x-n.x,this.y-n.y)},subtractEquals:function(n){return this.x-=n.x,this.y-=n.y,this},scalarSubtract:function(n){return new t(this.x-n,this.y-n)},scalarSubtractEquals:function(n){return this.x-=n,this.y-=n,this},multiply:function(n){return new t(this.x*n,this.y*n)},multiplyEquals:function(n){return this.x*=n,this.y*=n,this},divide:function(n){return new t(this.x/n,this.y/n)},divideEquals:function(n){return this.x/=n,this.y/=n,this},eq:function(n){return this.x===n.x&&this.y===n.y},lt:function(n){return this.x<n.x&&this.y<n.y},lte:function(n){return this.x<=n.x&&this.y<=n.y},gt:function(n){return this.x>n.x&&this.y>n.y},gte:function(n){return this.x>=n.x&&this.y>=n.y},lerp:function(n,i){return new t(this.x+(n.x-this.x)*i,this.y+(n.y-this.y)*i)},distanceFrom:function(n){var t=this.x-n.x,i=this.y-n.y;return Math.sqrt(t*t+i*i)},midPointFrom:function(n){return new t(this.x+(n.x-this.x)/2,this.y+(n.y-this.y)/2)},min:function(n){return new t(Math.min(this.x,n.x),Math.min(this.y,n.y))},max:function(n){return new t(Math.max(this.x,n.x),Math.max(this.y,n.y))},toString:function(){return this.x+","+this.y},setXY:function(n,t){this.x=n;this.y=t},setFromPoint:function(n){this.x=n.x;this.y=n.y},swap:function(n){var t=this.x,i=this.y;this.x=n.x;this.y=n.y;n.x=t;n.y=i}}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function t(n){this.status=n;this.points=[]}var i=n.fabric||(n.fabric={});if(i.Intersection){i.warn("fabric.Intersection is already defined");return}i.Intersection=t;i.Intersection.prototype={appendPoint:function(n){this.points.push(n)},appendPoints:function(n){this.points=this.points.concat(n)}};i.Intersection.intersectLineLine=function(n,r,u,f){var e,c=(f.x-u.x)*(n.y-u.y)-(f.y-u.y)*(n.x-u.x),l=(r.x-n.x)*(n.y-u.y)-(r.y-n.y)*(n.x-u.x),s=(f.y-u.y)*(r.x-n.x)-(f.x-u.x)*(r.y-n.y),o,h;return s!==0?(o=c/s,h=l/s,0<=o&&o<=1&&0<=h&&h<=1?(e=new t("Intersection"),e.points.push(new i.Point(n.x+o*(r.x-n.x),n.y+o*(r.y-n.y)))):e=new t):e=c===0||l===0?new t("Coincident"):new t("Parallel"),e};i.Intersection.intersectLinePolygon=function(n,i,r){for(var u=new t,e=r.length,f=0;f<e;f++){var o=r[f],s=r[(f+1)%e],h=t.intersectLineLine(n,i,o,s);u.appendPoints(h.points)}return u.points.length>0&&(u.status="Intersection"),u};i.Intersection.intersectPolygonPolygon=function(n,i){for(var r=new t,f=n.length,u=0;u<f;u++){var e=n[u],o=n[(u+1)%f],s=t.intersectLinePolygon(e,o,i);r.appendPoints(s.points)}return r.points.length>0&&(r.status="Intersection"),r};i.Intersection.intersectPolygonRectangle=function(n,r,u){var e=r.min(u),o=r.max(u),s=new i.Point(o.x,e.y),h=new i.Point(e.x,o.y),c=t.intersectLinePolygon(e,s,n),l=t.intersectLinePolygon(s,o,n),a=t.intersectLinePolygon(o,h,n),v=t.intersectLinePolygon(h,e,n),f=new t;return f.appendPoints(c.points),f.appendPoints(l.points),f.appendPoints(a.points),f.appendPoints(v.points),f.points.length>0&&(f.status="Intersection"),f}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function t(n){n?this._tryParsingColor(n):this.setSource([0,0,0,1])}function r(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n}var i=n.fabric||(n.fabric={});if(i.Color){i.warn("fabric.Color is already defined.");return}i.Color=t;i.Color.prototype={_tryParsingColor:function(n){var i;if(n in t.colorNameMap&&(n=t.colorNameMap[n]),n==="transparent"){this.setSource([255,255,255,0]);return}i=t.sourceFromHex(n);i||(i=t.sourceFromRgb(n));i||(i=t.sourceFromHsl(n));i&&this.setSource(i)},_rgbToHsl:function(n,t,r){var f,s,h,u,e,o;if(n/=255,t/=255,r/=255,u=i.util.array.max([n,t,r]),e=i.util.array.min([n,t,r]),h=(u+e)/2,u===e)f=s=0;else{o=u-e;s=h>.5?o/(2-u-e):o/(u+e);switch(u){case n:f=(t-r)/o+(t<r?6:0);break;case t:f=(r-n)/o+2;break;case r:f=(n-t)/o+4}f/=6}return[Math.round(f*360),Math.round(s*100),Math.round(h*100)]},getSource:function(){return this._source},setSource:function(n){this._source=n},toRgb:function(){var n=this.getSource();return"rgb("+n[0]+","+n[1]+","+n[2]+")"},toRgba:function(){var n=this.getSource();return"rgba("+n[0]+","+n[1]+","+n[2]+","+n[3]+")"},toHsl:function(){var n=this.getSource(),t=this._rgbToHsl(n[0],n[1],n[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var n=this.getSource(),t=this._rgbToHsl(n[0],n[1],n[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+n[3]+")"},toHex:function(){var r=this.getSource(),n,t,i;return n=r[0].toString(16),n=n.length===1?"0"+n:n,t=r[1].toString(16),t=t.length===1?"0"+t:t,i=r[2].toString(16),i=i.length===1?"0"+i:i,n.toUpperCase()+t.toUpperCase()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(n){var t=this.getSource();return t[3]=n,this.setSource(t),this},toGrayscale:function(){var n=this.getSource(),t=parseInt((n[0]*.3+n[1]*.59+n[2]*.11).toFixed(0),10),i=n[3];return this.setSource([t,t,t,i]),this},toBlackWhite:function(n){var i=this.getSource(),t=(i[0]*.3+i[1]*.59+i[2]*.11).toFixed(0),r=i[3];return n=n||127,t=Number(t)<Number(n)?0:255,this.setSource([t,t,t,r]),this},overlayWith:function(n){var i;n instanceof t||(n=new t(n));var r=[],f=this.getAlpha(),u=.5,e=this.getSource(),o=n.getSource();for(i=0;i<3;i++)r.push(Math.round(e[i]*(1-u)+o[i]*u));return r[3]=f,this.setSource(r),this}};i.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;i.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;i.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;i.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};i.Color.fromRgb=function(n){return t.fromSource(t.sourceFromRgb(n))};i.Color.sourceFromRgb=function(n){var i=n.match(t.reRGBa);if(i){var r=parseInt(i[1],10)/(/%$/.test(i[1])?100:1)*(/%$/.test(i[1])?255:1),u=parseInt(i[2],10)/(/%$/.test(i[2])?100:1)*(/%$/.test(i[2])?255:1),f=parseInt(i[3],10)/(/%$/.test(i[3])?100:1)*(/%$/.test(i[3])?255:1);return[parseInt(r,10),parseInt(u,10),parseInt(f,10),i[4]?parseFloat(i[4]):1]}};i.Color.fromRgba=t.fromRgb;i.Color.fromHsl=function(n){return t.fromSource(t.sourceFromHsl(n))};i.Color.sourceFromHsl=function(n){var i=n.match(t.reHSLa),f,o;if(i){var s=(parseFloat(i[1])%360+360)%360/360,e=parseFloat(i[2])/(/%$/.test(i[2])?100:1),u=parseFloat(i[3])/(/%$/.test(i[3])?100:1),h,c,l;return e===0?h=c=l=u:(f=u<=.5?u*(e+1):u+e-u*e,o=u*2-f,h=r(o,f,s+1/3),c=r(o,f,s),l=r(o,f,s-1/3)),[Math.round(h*255),Math.round(c*255),Math.round(l*255),i[4]?parseFloat(i[4]):1]}};i.Color.fromHsla=t.fromHsl;i.Color.fromHex=function(n){return t.fromSource(t.sourceFromHex(n))};i.Color.sourceFromHex=function(n){if(n.match(t.reHex)){var i=n.slice(n.indexOf("#")+1),r=i.length===3,u=r?i.charAt(0)+i.charAt(0):i.substring(0,2),f=r?i.charAt(1)+i.charAt(1):i.substring(2,4),e=r?i.charAt(2)+i.charAt(2):i.substring(4,6);return[parseInt(u,16),parseInt(f,16),parseInt(e,16),1]}};i.Color.fromSource=function(n){var i=new t;return i.setSource(n),i}}(typeof exports!="undefined"?exports:this),function(){function t(n){var e=n.getAttribute("style"),t=n.getAttribute("offset"),r,o,i,u,f;if(t=parseFloat(t)/(/%$/.test(t)?100:1),t=t<0?0:t>1?1:t,e)for(u=e.split(/\s*;\s*/),u[u.length-1]===""&&u.pop(),f=u.length;f--;){var s=u[f].split(/\s*:\s*/),h=s[0].trim(),c=s[1].trim();h==="stop-color"?r=c:h==="stop-opacity"&&(i=c)}return r||(r=n.getAttribute("stop-color")||"rgb(0,0,0)"),i||(i=n.getAttribute("stop-opacity")),r=new fabric.Color(r),o=r.getAlpha(),i=isNaN(parseFloat(i))?1:parseFloat(i),i*=o,{offset:t,color:r.toRgb(),opacity:i}}function i(n){return{x1:n.getAttribute("x1")||0,y1:n.getAttribute("y1")||0,x2:n.getAttribute("x2")||"100%",y2:n.getAttribute("y2")||0}}function r(n){return{x1:n.getAttribute("fx")||n.getAttribute("cx")||"50%",y1:n.getAttribute("fy")||n.getAttribute("cy")||"50%",r1:0,x2:n.getAttribute("cx")||"50%",y2:n.getAttribute("cy")||"50%",r2:n.getAttribute("r")||"50%"}}function n(n,t,i){var o,e=0,u=1,s="",r,f;for(r in t)o=parseFloat(t[r],10),u=typeof t[r]=="string"&&/^\d+%$/.test(t[r])?.01:1,r==="x1"||r==="x2"||r==="r2"?(u*=i==="objectBoundingBox"?n.width:1,e=i==="objectBoundingBox"?n.left||0:0):(r==="y1"||r==="y2")&&(u*=i==="objectBoundingBox"?n.height:1,e=i==="objectBoundingBox"?n.top||0:0),t[r]=o*u+e;return n.type==="ellipse"&&t.r2!==null&&i==="objectBoundingBox"&&n.rx!==n.ry&&(f=n.ry/n.rx,s=" scale(1, "+f+")",t.y1&&(t.y1/=f),t.y2&&(t.y2/=f)),s}fabric.Gradient=fabric.util.createClass({offsetX:0,offsetY:0,initialize:function(n){n||(n={});var t={};this.id=fabric.Object.__uid++;this.type=n.type||"linear";t={x1:n.coords.x1||0,y1:n.coords.y1||0,x2:n.coords.x2||0,y2:n.coords.y2||0};this.type==="radial"&&(t.r1=n.coords.r1||0,t.r2=n.coords.r2||0);this.coords=t;this.colorStops=n.colorStops.slice();n.gradientTransform&&(this.gradientTransform=n.gradientTransform);this.offsetX=n.offsetX||this.offsetX;this.offsetY=n.offsetY||this.offsetY},addColorStop:function(n){var t,i;for(t in n)i=new fabric.Color(n[t]),this.colorStops.push({offset:t,color:i.toRgb(),opacity:i.getAlpha()});return this},toObject:function(){return{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(n){var t=fabric.util.object.clone(this.coords),u,f,i,r;if(this.colorStops.sort(function(n,t){return n.offset-t.offset}),!(n.group&&n.group.type==="path-group"))for(i in t)i==="x1"||i==="x2"||i==="r2"?t[i]+=this.offsetX-n.width/2:(i==="y1"||i==="y2")&&(t[i]+=this.offsetY-n.height/2);for(f='id="SVGID_'+this.id+'" gradientUnits="userSpaceOnUse"',this.gradientTransform&&(f+=' gradientTransform="matrix('+this.gradientTransform.join(" ")+')" '),this.type==="linear"?u=["<linearGradient ",f,' x1="',t.x1,'" y1="',t.y1,'" x2="',t.x2,'" y2="',t.y2,'">\n']:this.type==="radial"&&(u=["<radialGradient ",f,' cx="',t.x2,'" cy="',t.y2,'" r="',t.r2,'" fx="',t.x1,'" fy="',t.y1,'">\n']),r=0;r<this.colorStops.length;r++)u.push("<stop ",'offset="',this.colorStops[r].offset*100+"%",'" style="stop-color:',this.colorStops[r].color,this.colorStops[r].opacity!=null?";stop-opacity: "+this.colorStops[r].opacity:";",'"/>\n');return u.push(this.type==="linear"?"<\/linearGradient>\n":"<\/radialGradient>\n"),u.join("")},toLive:function(n,t){var f,r,i=fabric.util.object.clone(this.coords),u,o;if(this.type){if(t.group&&t.group.type==="path-group")for(r in i)r==="x1"||r==="x2"?i[r]+=-this.offsetX+t.width/2:(r==="y1"||r==="y2")&&(i[r]+=-this.offsetY+t.height/2);if(t.type==="text"||t.type==="i-text")for(r in i)r==="x1"||r==="x2"?i[r]-=t.width/2:(r==="y1"||r==="y2")&&(i[r]-=t.height/2);for(this.type==="linear"?f=n.createLinearGradient(i.x1,i.y1,i.x2,i.y2):this.type==="radial"&&(f=n.createRadialGradient(i.x1,i.y1,i.r1,i.x2,i.y2,i.r2)),u=0,o=this.colorStops.length;u<o;u++){var e=this.colorStops[u].color,s=this.colorStops[u].opacity,h=this.colorStops[u].offset;typeof s!="undefined"&&(e=new fabric.Color(e).setAlpha(s).toRgba());f.addColorStop(parseFloat(h),e)}return f}}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(u,f){var l=u.getElementsByTagName("stop"),o=u.nodeName==="linearGradient"?"linear":"radial",y=u.getAttribute("gradientUnits")||"objectBoundingBox",a=u.getAttribute("gradientTransform"),v=[],e={},s,h,c;for(o==="linear"?e=i(u):o==="radial"&&(e=r(u)),h=l.length;h--;)v.push(t(l[h]));return s=n(f,e,y),c=new fabric.Gradient({type:o,coords:e,colorStops:v,offsetX:-f.left,offsetY:-f.top}),(a||s!=="")&&(c.gradientTransform=fabric.parseTransformAttribute((a||"")+s)),c},forObject:function(t,i){return i||(i={}),n(t,i.coords,"userSpaceOnUse"),new fabric.Gradient(i)}})}();fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(n){if(n||(n={}),this.id=fabric.Object.__uid++,n.source)if(typeof n.source=="string")if(typeof fabric.util.getFunctionBody(n.source)!="undefined")this.source=new Function(fabric.util.getFunctionBody(n.source));else{var t=this;this.source=fabric.util.createImage();fabric.util.loadImage(n.source,function(n){t.source=n})}else this.source=n.source;n.repeat&&(this.repeat=n.repeat);n.offsetX&&(this.offsetX=n.offsetX);n.offsetY&&(this.offsetY=n.offsetY)},toObject:function(){var n;return typeof this.source=="function"?n=String(this.source):typeof this.source.src=="string"&&(n=this.source.src),{source:n,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(n){var t=typeof this.source=="function"?this.source():this.source,r=t.width/n.getWidth(),u=t.height/n.getHeight(),f=this.offsetX/n.getWidth(),e=this.offsetY/n.getHeight(),i="";return(this.repeat==="repeat-x"||this.repeat==="no-repeat")&&(u=1),(this.repeat==="repeat-y"||this.repeat==="no-repeat")&&(r=1),t.src?i=t.src:t.toDataURL&&(i=t.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+f+'" y="'+e+'" width="'+r+'" height="'+u+'">\n<image x="0" y="0" width="'+t.width+'" height="'+t.height+'" xlink:href="'+i+'"><\/image>\n<\/pattern>\n'},toLive:function(n){var t=typeof this.source=="function"?this.source():this.source;return t?typeof t.src!="undefined"&&(!t.complete||t.naturalWidth===0||t.naturalHeight===0)?"":n.createPattern(t,this.repeat):""}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.toFixed;if(t.Shadow){t.warn("fabric.Shadow is already defined.");return}t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(n){typeof n=="string"&&(n=this._parseShadow(n));for(var i in n)this[i]=n[i];this.id=t.Object.__uid++},_parseShadow:function(n){var r=n.trim(),i=t.Shadow.reOffsetsAndBlur.exec(r)||[],u=r.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:u.trim(),offsetX:parseInt(i[1],10)||0,offsetY:parseInt(i[2],10)||0,blur:parseInt(i[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(n){var u="SourceAlpha",t=40,r=40;return n&&(n.fill===this.color||n.stroke===this.color)&&(u="SourceGraphic"),n.width&&n.height&&(t=i(Math.abs(this.offsetX/n.getWidth()),2)*100+20,r=i(Math.abs(this.offsetY/n.getHeight()),2)*100+20),'<filter id="SVGID_'+this.id+'" y="-'+r+'%" height="'+(100+2*r)+'%" x="-'+t+'%" width="'+(100+2*t)+'%" >\n\t<feGaussianBlur in="'+u+'" stdDeviation="'+i(this.blur?this.blur/2:0,3)+'" result="blurOut"><\/feGaussianBlur>\n\t<feColorMatrix result="matrixOut" in="blurOut" type="matrix" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 0.30 0" ><\/feColorMatrix >\n\t<feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"><\/feOffset>\n\t<feMerge>\n\t\t<feMergeNode><\/feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"><\/feMergeNode>\n\t<\/feMerge>\n<\/filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var n={},i=t.Shadow.prototype;return this.color!==i.color&&(n.color=this.color),this.blur!==i.blur&&(n.blur=this.blur),this.offsetX!==i.offsetX&&(n.offsetX=this.offsetX),this.offsetY!==i.offsetY&&(n.offsetY=this.offsetY),n}});t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/}(typeof exports!="undefined"?exports:this),function(){"use strict";if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var n=fabric.util.object.extend,r=fabric.util.getElementOffset,t=fabric.util.removeFromArray,i=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(n,t){t||(t={});this._initStatic(n,t);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,preserveObjectStacking:!1,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(n,t){this._objects=[];this._createLowerCanvas(n);this._initOptions(t);this._setImageSmoothing();t.overlayImage&&this.setOverlayImage(t.overlayImage,this.renderAll.bind(this));t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,this.renderAll.bind(this));t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,this.renderAll.bind(this));t.overlayColor&&this.setOverlayColor(t.overlayColor,this.renderAll.bind(this));this.calcOffset()},calcOffset:function(){return this._offset=r(this.lowerCanvasEl),this},setOverlayImage:function(n,t,i){return this.__setBgOverlayImage("overlayImage",n,t,i)},setBackgroundImage:function(n,t,i){return this.__setBgOverlayImage("backgroundImage",n,t,i)},setOverlayColor:function(n,t){return this.__setBgOverlayColor("overlayColor",n,t)},setBackgroundColor:function(n,t){return this.__setBgOverlayColor("backgroundColor",n,t)},_setImageSmoothing:function(){var n=this.getContext();n.imageSmoothingEnabled=this.imageSmoothingEnabled;n.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;n.mozImageSmoothingEnabled=this.imageSmoothingEnabled;n.msImageSmoothingEnabled=this.imageSmoothingEnabled;n.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(n,t,i,r){return typeof t=="string"?fabric.util.loadImage(t,function(t){this[n]=new fabric.Image(t,r);i&&i()},this,r&&r.crossOrigin):(r&&t.setOptions(r),this[n]=t,i&&i()),this},__setBgOverlayColor:function(n,t,i){if(t&&t.source){var r=this;fabric.util.loadImage(t.source,function(u){r[n]=new fabric.Pattern({source:u,repeat:t.repeat,offsetX:t.offsetX,offsetY:t.offsetY});i&&i()})}else this[n]=t,i&&i();return this},_createCanvasElement:function(){var n=fabric.document.createElement("canvas");if(n.style||(n.style={}),!n)throw i;return this._initCanvasElement(n),n},_initCanvasElement:function(n){if(fabric.util.createCanvasElement(n),typeof n.getContext=="undefined")throw i;},_initOptions:function(n){for(var t in n)this[t]=n[t];(this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style)&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(n){this.lowerCanvasEl=fabric.util.getById(n)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl);this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(n,t){return this.setDimensions({width:n},t)},setHeight:function(n,t){return this.setDimensions({height:n},t)},setDimensions:function(n,t){var r,i;t=t||{};for(i in n)r=n[i],t.cssOnly||(this._setBackstoreDimension(i,n[i]),r+="px"),t.backstoreOnly||this._setCssDimension(i,r);return t.cssOnly||this.renderAll(),this.calcOffset(),this},_setBackstoreDimension:function(n,t){return this.lowerCanvasEl[n]=t,this.upperCanvasEl&&(this.upperCanvasEl[n]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[n]=t),this[n]=t,this},_setCssDimension:function(n,t){return this.lowerCanvasEl.style[n]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[n]=t),this.wrapperEl&&(this.wrapperEl.style[n]=t),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(n){var i=this.getActiveGroup(),t,r;for(this.viewportTransform=n,this.renderAll(),t=0,r=this._objects.length;t<r;t++)this._objects[t].setCoords();return i&&i.setCoords(),this},zoomToPoint:function(n,t){var u=n,r,i,f;for(n=fabric.util.transformPoint(n,fabric.util.invertTransform(this.viewportTransform)),this.viewportTransform[0]=t,this.viewportTransform[3]=t,r=fabric.util.transformPoint(n,this.viewportTransform),this.viewportTransform[4]+=u.x-r.x,this.viewportTransform[5]+=u.y-r.y,this.renderAll(),i=0,f=this._objects.length;i<f;i++)this._objects[i].setCoords();return this},setZoom:function(n){return this.zoomToPoint(new fabric.Point(0,0),n),this},absolutePan:function(n){this.viewportTransform[4]=-n.x;this.viewportTransform[5]=-n.y;this.renderAll();for(var t=0,i=this._objects.length;t<i;t++)this._objects[t].setCoords();return this},relativePan:function(n){return this.absolutePan(new fabric.Point(-n.x-this.viewportTransform[4],-n.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(n,t){if(t){n.save();var i=this.viewportTransform;n.transform(i[0],i[1],i[2],i[3],i[4],i[5]);this._shouldRenderObject(t)&&t.render(n);n.restore();this.controlsAboveOverlay||t._renderControls(n)}},_shouldRenderObject:function(n){return n?n!==this.getActiveGroup()||!this.preserveObjectStacking:!1},_onObjectAdded:function(n){this.stateful&&n.setupState();n.canvas=this;n.setCoords();this.fire("object:added",{target:n});n.fire("added")},_onObjectRemoved:function(n){this.getActiveObject()===n&&(this.fire("before:selection:cleared",{target:n}),this._discardActiveObject(),this.fire("selection:cleared"));this.fire("object:removed",{target:n});n.fire("removed")},clearContext:function(n){return n.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(n){var t=this[n===!0&&this.interactive?"contextTop":"contextContainer"],i=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),n||this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),this._renderObjects(t,i),this._renderActiveGroup(t,i),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render"),this},_renderObjects:function(n,t){var i,r;if(!t||this.preserveObjectStacking)for(i=0,r=this._objects.length;i<r;++i)this._draw(n,this._objects[i]);else for(i=0,r=this._objects.length;i<r;++i)this._objects[i]&&!t.contains(this._objects[i])&&this._draw(n,this._objects[i])},_renderActiveGroup:function(n,t){if(t){var i=[];this.forEachObject(function(n){t.contains(n)&&i.push(n)});t._set("objects",i);this._draw(n,t)}},_renderBackground:function(n){this.backgroundColor&&(n.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(n):this.backgroundColor,n.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height));this.backgroundImage&&this._draw(n,this.backgroundImage)},_renderOverlay:function(n){this.overlayColor&&(n.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(n):this.overlayColor,n.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height));this.overlayImage&&this._draw(n,this.overlayImage)},renderTop:function(){var n=this.contextTop||this.contextContainer,t;return this.clearContext(n),this.selection&&this._groupSelector&&this._drawSelection(),t=this.getActiveGroup(),t&&t.render(n),this._renderOverlay(n),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(n){return this._centerObject(n,new fabric.Point(this.getCenter().left,n.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(n){return this._centerObject(n,new fabric.Point(n.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(n){var t=this.getCenter();return this._centerObject(n,new fabric.Point(t.left,t.top)),this.renderAll(),this},_centerObject:function(n,t){return n.setPositionByOrigin(t,"center","center"),this},toDatalessJSON:function(n){return this.toDatalessObject(n)},toObject:function(n){return this._toObjectMethod("toObject",n)},toDatalessObject:function(n){return this._toObjectMethod("toDatalessObject",n)},_toObjectMethod:function(t,i){var r={objects:this._toObjects(t,i)};return n(r,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,r,i),r},_toObjects:function(n,t){return this.getObjects().map(function(i){return this._toObject(i,n,t)},this)},_toObject:function(n,t,i){var r,u,f;return this.includeDefaultValues||(r=n.includeDefaultValues,n.includeDefaultValues=!1),u=this._realizeGroupTransformOnObject(n),f=n[t](i),this.includeDefaultValues||(n.includeDefaultValues=r),this._unwindGroupTransformOnObject(n,u),f},_realizeGroupTransformOnObject:function(n){var t;return n.group&&n.group===this.getActiveGroup()?(t={},["angle","flipX","flipY","height","left","scaleX","scaleY","top","width"].forEach(function(i){t[i]=n[i]}),this.getActiveGroup().realizeTransform(n),t):null},_unwindGroupTransformOnObject:function(n,t){t&&n.set(t)},__serializeBgOverlay:function(){var n={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(n.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(n.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(n.overlayImage=this.overlayImage.toObject()),n},svgViewportTransformation:!0,toSVG:function(n,t){n||(n={});var i=[];return this._setSVGPreamble(i,n),this._setSVGHeader(i,n),this._setSVGBgOverlayColor(i,"backgroundColor"),this._setSVGBgOverlayImage(i,"backgroundImage"),this._setSVGObjects(i,t),this._setSVGBgOverlayColor(i,"overlayColor"),this._setSVGBgOverlayImage(i,"overlayImage"),i.push("<\/svg>"),i.join("")},_setSVGPreamble:function(n,t){t.suppressPreamble||n.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(n,t){var i,r,u;t.viewBox?(i=t.viewBox.width,r=t.viewBox.height):(i=this.width,r=this.height,this.svgViewportTransformation||(u=this.viewportTransform,i/=u[0],r/=u[3]));n.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',i,'" ','height="',r,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,t.viewBox?'viewBox="'+t.viewBox.x+" "+t.viewBox.y+" "+t.viewBox.width+" "+t.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"<\/desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"<\/defs>")},_setSVGObjects:function(n,t){for(var i,f,r=0,u=this.getObjects(),e=u.length;r<e;r++)i=u[r],f=this._realizeGroupTransformOnObject(i),n.push(i.toSVG(t)),this._unwindGroupTransformOnObject(i,f)},_setSVGBgOverlayImage:function(n,t){this[t]&&this[t].toSVG&&n.push(this[t].toSVG())},_setSVGBgOverlayColor:function(n,t){this[t]&&this[t].source?n.push('<rect x="',this[t].offsetX,'" y="',this[t].offsetY,'" ','width="',this[t].repeat==="repeat-y"||this[t].repeat==="no-repeat"?this[t].source.width:this.width,'" height="',this[t].repeat==="repeat-x"||this[t].repeat==="no-repeat"?this[t].source.height:this.height,'" fill="url(#'+t+'Pattern)"',"><\/rect>"):this[t]&&t==="overlayColor"&&n.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[t],'"',"><\/rect>")},sendToBack:function(n){return t(this._objects,n),this._objects.unshift(n),this.renderAll&&this.renderAll()},bringToFront:function(n){return t(this._objects,n),this._objects.push(n),this.renderAll&&this.renderAll()},sendBackwards:function(n,i){var r=this._objects.indexOf(n),u;return r!==0&&(u=this._findNewLowerIndex(n,r,i),t(this._objects,n),this._objects.splice(u,0,n),this.renderAll&&this.renderAll()),this},_findNewLowerIndex:function(n,t,i){var u,r,f;if(i){for(u=t,r=t-1;r>=0;--r)if(f=n.intersectsWithObject(this._objects[r])||n.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(n),f){u=r;break}}else u=t-1;return u},bringForward:function(n,i){var r=this._objects.indexOf(n),u;return r!==this._objects.length-1&&(u=this._findNewUpperIndex(n,r,i),t(this._objects,n),this._objects.splice(u,0,n),this.renderAll&&this.renderAll()),this},_findNewUpperIndex:function(n,t,i){var u,r,f;if(i){for(u=t,r=t+1;r<this._objects.length;++r)if(f=n.intersectsWithObject(this._objects[r])||n.isContainedWithinObject(this._objects[r])||this._objects[r].isContainedWithinObject(n),f){u=r;break}}else u=t+1;return u},moveTo:function(n,i){return t(this._objects,n),this._objects.splice(i,0,n),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});n(fabric.StaticCanvas.prototype,fabric.Observable);n(fabric.StaticCanvas.prototype,fabric.Collection);n(fabric.StaticCanvas.prototype,fabric.DataURLExporter);n(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(n){var t=fabric.util.createCanvasElement(),i;if(!t||!t.getContext||(i=t.getContext("2d"),!i))return null;switch(n){case"getImageData":return typeof i.getImageData!="undefined";case"setLineDash":return typeof i.setLineDash!="undefined";case"toDataURL":return typeof t.toDataURL!="undefined";case"toDataURLWithQuality":try{return t.toDataURL("image/jpeg",0),!0}catch(r){}return!1;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeDashArray:null,setShadow:function(n){return this.shadow=new fabric.Shadow(n),this},_setBrushStyles:function(){var n=this.canvas.contextTop;n.strokeStyle=this.color;n.lineWidth=this.width;n.lineCap=this.strokeLineCap;n.lineJoin=this.strokeLineJoin;this.strokeDashArray&&fabric.StaticCanvas.supports("setLineDash")&&n.setLineDash(this.strokeDashArray)},_setShadow:function(){if(this.shadow){var n=this.canvas.contextTop;n.shadowColor=this.shadow.color;n.shadowBlur=this.shadow.blur;n.shadowOffsetX=this.shadow.offsetX;n.shadowOffsetY=this.shadow.offsetY}},_resetShadow:function(){var n=this.canvas.contextTop;n.shadowColor="";n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0}}),function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(n){this.canvas=n;this._points=[]},onMouseDown:function(n){this._prepareForDrawing(n);this._captureDrawingPath(n);this._render()},onMouseMove:function(n){this._captureDrawingPath(n);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(n){var t=new fabric.Point(n.x,n.y);this._reset();this._addPoint(t);this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(n){this._points.push(n)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(n){var t=new fabric.Point(n.x,n.y);this._addPoint(t)},_render:function(){var t=this.canvas.contextTop,i=this.canvas.viewportTransform,n=this._points[0],r=this._points[1],u,e,f;for(t.save(),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),t.beginPath(),this._points.length===2&&n.x===r.x&&n.y===r.y&&(n.x-=.5,r.x+=.5),t.moveTo(n.x,n.y),u=1,e=this._points.length;u<e;u++)f=n.midPointFrom(r),t.quadraticCurveTo(n.x,n.y,f.x,f.y),n=this._points[u],r=this._points[u+1];t.lineTo(n.x,n.y);t.stroke();t.restore()},convertPointsToSVGPath:function(n){var r=[],i=new fabric.Point(n[0].x,n[0].y),f=new fabric.Point(n[1].x,n[1].y),t,e,u;for(r.push("M ",n[0].x," ",n[0].y," "),t=1,e=n.length;t<e;t++)u=i.midPointFrom(f),r.push("Q ",i.x," ",i.y," ",u.x," ",u.y," "),i=new fabric.Point(n[t].x,n[t].y),t+1<n.length&&(f=new fabric.Point(n[t+1].x,n[t+1].y));return r.push("L ",i.x," ",i.y," "),r},createPath:function(n){var t=new fabric.Path(n,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray,originX:"center",originY:"center"});return this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t},_finalizeAndAddPath:function(){var i=this.canvas.contextTop,t,n;if(i.closePath(),t=this.convertPointsToSVGPath(this._points).join(""),t==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}n=this.createPath(t);this.canvas.add(n);n.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:n})}})}();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(n){this.canvas=n;this.points=[]},drawDot:function(n){var r=this.addPoint(n),t=this.canvas.contextTop,i=this.canvas.viewportTransform;t.save();t.transform(i[0],i[1],i[2],i[3],i[4],i[5]);t.fillStyle=r.fill;t.beginPath();t.arc(r.x,r.y,r.radius,0,Math.PI*2,!1);t.closePath();t.fill();t.restore()},onMouseDown:function(n){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(n)},onMouseMove:function(n){this.drawDot(n)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove,r,t,f,n,u,i;for(this.canvas.renderOnAddRemove=!1,r=[],t=0,f=this.points.length;t<f;t++)n=this.points[t],u=new fabric.Circle({radius:n.radius,left:n.x,top:n.y,originX:"center",originY:"center",fill:n.fill}),this.shadow&&u.setShadow(this.shadow),r.push(u);i=new fabric.Group(r,{originX:"center",originY:"center"});i.canvas=this.canvas;this.canvas.add(i);this.canvas.fire("path:created",{path:i});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},addPoint:function(n){var t=new fabric.Point(n.x,n.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,r=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return t.radius=i,t.fill=r,this.points.push(t),t}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(n){this.canvas=n;this.sprayChunks=[]},onMouseDown:function(n){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(n);this.render()},onMouseMove:function(n){this.addSprayChunk(n);this.render()},onMouseUp:function(){var s=this.canvas.renderOnAddRemove,i,r,e,t,n,o,f,u;for(this.canvas.renderOnAddRemove=!1,i=[],r=0,e=this.sprayChunks.length;r<e;r++)for(t=this.sprayChunks[r],n=0,o=t.length;n<o;n++)f=new fabric.Rect({width:t[n].width,height:t[n].width,left:t[n].x+1,top:t[n].y+1,originX:"center",originY:"center",fill:this.color}),this.shadow&&f.setShadow(this.shadow),i.push(f);this.optimizeOverlapping&&(i=this._getOptimizedRects(i));u=new fabric.Group(i,{originX:"center",originY:"center"});u.canvas=this.canvas;this.canvas.add(u);this.canvas.fire("path:created",{path:u});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=s;this.canvas.renderAll()},_getOptimizedRects:function(n){for(var u,r={},t,i=0,f=n.length;i<f;i++)t=n[i].left+""+n[i].top,r[t]||(r[t]=n[i]);u=[];for(t in r)u.push(r[t]);return u},render:function(){var i=this.canvas.contextTop,n,r,u,t;for(i.fillStyle=this.color,n=this.canvas.viewportTransform,i.save(),i.transform(n[0],n[1],n[2],n[3],n[4],n[5]),r=0,u=this.sprayChunkPoints.length;r<u;r++)t=this.sprayChunkPoints[r],typeof t.opacity!="undefined"&&(i.globalAlpha=t.opacity),i.fillRect(t.x,t.y,t.width,t.width);i.restore()},addSprayChunk:function(n){var u,f,e,t,r,i;for(this.sprayChunkPoints=[],t=this.width/2,r=0;r<this.density;r++)u=fabric.util.getRandomInt(n.x-t,n.x+t),f=fabric.util.getRandomInt(n.y-t,n.y+t),e=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth,i=new fabric.Point(u,f),i.width=e,this.randomOpacity&&(i.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(i);this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var t=20,i=fabric.document.createElement("canvas"),n=i.getContext("2d");return i.width=i.height=t+5,n.fillStyle=this.color,n.beginPath(),n.arc(t/2,t/2,t/2,0,Math.PI*2,!1),n.closePath(),n.fill(),i},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(n){var t=this.callSuper("createPath",n);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),t}}),function(){var u=fabric.util.getPointer,f=fabric.util.degreesToRadians,e=fabric.util.radiansToDegrees,r=Math.atan2,n=Math.abs,t=.5,i;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(n,t){t||(t={});this._initStatic(n,t);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(n){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,left:t.original.left,top:t.original.top});this._shouldCenterTransform(n,t.target)?t.action==="rotate"?this._setOriginToCenter(t.target):(t.originX!=="center"&&(t.mouseXSign=t.originX==="right"?-1:1),t.originY!=="center"&&(t.mouseYSign=t.originY==="bottom"?-1:1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(n,t){var i=this.getPointer(n,!0),r=this._normalizePointer(t,i);return t.containsPoint(r)||t._findTargetCorner(i)},_normalizePointer:function(n,t){var r=this.getActiveGroup(),u=t.x,f=t.y,e=r&&n.type!=="group"&&r.contains(n),i;return e&&(i=new fabric.Point(r.left,r.top),i=fabric.util.transformPoint(i,this.viewportTransform,!0),u-=i.x,f-=i.y),{x:u,y:f}},isTargetTransparent:function(n,t,i){var u=n.hasBorders,f=n.transparentCorners,r;return n.hasBorders=n.transparentCorners=!1,this._draw(this.contextCache,n),n.hasBorders=u,n.transparentCorners=f,r=fabric.util.isTransparent(this.contextCache,t,i,this.targetFindTolerance),this.clearContext(this.contextCache),r},_shouldClearSelection:function(n,t){var i=this.getActiveGroup(),r=this.getActiveObject();return!t||t&&i&&!i.contains(t)&&i!==t&&!n.shiftKey||t&&!t.evented||t&&!t.selectable&&r&&r!==t},_shouldCenterTransform:function(n,t){if(t){var i=this._currentTransform,r;return i.action==="scale"||i.action==="scaleX"||i.action==="scaleY"?r=this.centeredScaling||t.centeredScaling:i.action==="rotate"&&(r=this.centeredRotation||t.centeredRotation),r?!n.altKey:n.altKey}},_getOriginFromCorner:function(n,t){var i={x:n.originX,y:n.originY};return t==="ml"||t==="tl"||t==="bl"?i.x="right":(t==="mr"||t==="tr"||t==="br")&&(i.x="left"),t==="tl"||t==="mt"||t==="tr"?i.y="bottom":(t==="bl"||t==="mb"||t==="br")&&(i.y="top"),i},_getActionFromCorner:function(n,t){var i="drag";return t&&(i=t==="ml"||t==="mr"?"scaleX":t==="mt"||t==="mb"?"scaleY":t==="mtr"?"rotate":"scale"),i},_setupCurrentTransform:function(n,t){if(t){var i=this.getPointer(n),u=t._findTargetCorner(this.getPointer(n,!0)),e=this._getActionFromCorner(t,u),r=this._getOriginFromCorner(t,u);this._currentTransform={target:t,action:e,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:i.x-t.left,offsetY:i.y-t.top,originX:r.x,originY:r.y,ex:i.x,ey:i.y,left:t.left,top:t.top,theta:f(t.angle),width:t.width*t.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:t.left,top:t.top,scaleX:t.scaleX,scaleY:t.scaleY,originX:r.x,originY:r.y};this._resetCurrentTransform(n)}},_translateObject:function(n,t){var i=this._currentTransform.target;i.get("lockMovementX")||i.set("left",n-this._currentTransform.offsetX);i.get("lockMovementY")||i.set("top",t-this._currentTransform.offsetY)},_scaleObject:function(n,t,i){var r=this._currentTransform,u=r.target,e=u.get("lockScalingX"),o=u.get("lockScalingY"),h=u.get("lockScalingFlip"),s,f;e&&o||(s=u.translateToOriginPoint(u.getCenterPoint(),r.originX,r.originY),f=u.toLocalPoint(new fabric.Point(n,t),r.originX,r.originY),this._setLocalMouse(f,r),this._setObjectScale(f,r,e,o,i,h),u.setPositionByOrigin(s,r.originX,r.originY))},_setObjectScale:function(n,t,i,r,u,f){var e=t.target,o=!1,s=!1,h=e.stroke?e.strokeWidth:0;t.newScaleX=n.x/(e.width+h/2);t.newScaleY=n.y/(e.height+h/2);f&&t.newScaleX<=0&&t.newScaleX<e.scaleX&&(o=!0);f&&t.newScaleY<=0&&t.newScaleY<e.scaleY&&(s=!0);u!=="equally"||i||r?u?u!=="x"||e.get("lockUniScaling")?u!=="y"||e.get("lockUniScaling")||s||r||e.set("scaleY",t.newScaleY):o||i||e.set("scaleX",t.newScaleX):(o||i||e.set("scaleX",t.newScaleX),s||r||e.set("scaleY",t.newScaleY)):o||s||this._scaleObjectEqually(n,e,t);o||s||this._flipObject(t,u)},_scaleObjectEqually:function(n,t,i){var r=n.y+n.x,u=t.stroke?t.strokeWidth:0,f=(t.height+u/2)*i.original.scaleY+(t.width+u/2)*i.original.scaleX;i.newScaleX=i.original.scaleX*r/f;i.newScaleY=i.original.scaleY*r/f;t.set("scaleX",i.newScaleX);t.set("scaleY",i.newScaleY)},_flipObject:function(n,t){n.newScaleX<0&&t!=="y"&&(n.originX==="left"?n.originX="right":n.originX==="right"&&(n.originX="left"));n.newScaleY<0&&t!=="x"&&(n.originY==="top"?n.originY="bottom":n.originY==="bottom"&&(n.originY="top"))},_setLocalMouse:function(t,i){var r=i.target;i.originX==="right"?t.x*=-1:i.originX==="center"&&(t.x*=i.mouseXSign*2,t.x<0&&(i.mouseXSign=-i.mouseXSign));i.originY==="bottom"?t.y*=-1:i.originY==="center"&&(t.y*=i.mouseYSign*2,t.y<0&&(i.mouseYSign=-i.mouseYSign));n(t.x)>r.padding?t.x<0?t.x+=r.padding:t.x-=r.padding:t.x=0;n(t.y)>r.padding?t.y<0?t.y+=r.padding:t.y-=r.padding:t.y=0},_rotateObject:function(n,t){var i=this._currentTransform;if(!i.target.get("lockRotation")){var f=r(i.ey-i.top,i.ex-i.left),o=r(t-i.top,n-i.left),u=e(o-f+i.theta);u<0&&(u=360+u);i.target.angle=u%360}},setCursor:function(n){this.upperCanvasEl.style.cursor=n},_resetObjectTransform:function(n){n.scaleX=1;n.scaleY=1;n.setAngle(0)},_drawSelection:function(){var i=this.contextTop,f=this._groupSelector,s=f.left,h=f.top,e=n(s),o=n(h),r,u;i.fillStyle=this.selectionColor;i.fillRect(f.ex-(s>0?0:-s),f.ey-(h>0?0:-h),e,o);i.lineWidth=this.selectionLineWidth;i.strokeStyle=this.selectionBorderColor;this.selectionDashArray.length>1?(r=f.ex+t-(s>0?0:e),u=f.ey+t-(h>0?0:o),i.beginPath(),fabric.util.drawDashedLine(i,r,u,r+e,u,this.selectionDashArray),fabric.util.drawDashedLine(i,r,u+o-1,r+e,u+o-1,this.selectionDashArray),fabric.util.drawDashedLine(i,r,u,r,u+o,this.selectionDashArray),fabric.util.drawDashedLine(i,r+e-1,u,r+e-1,u+o,this.selectionDashArray),i.closePath(),i.stroke()):i.strokeRect(f.ex+t-(s>0?0:e),f.ey+t-(h>0?0:o),e,o)},_isLastRenderedObject:function(n){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(n,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(n,!0))},findTarget:function(n,t){var i,r;if(!this.skipTargetFind)return this._isLastRenderedObject(n)?this.lastRenderedObjectWithControlsAboveOverlay:(i=this.getActiveGroup(),i&&!t&&this.containsPoint(n,i))?i:(r=this._searchPossibleTargets(n),this._fireOverOutEvents(r),r)},_fireOverOutEvents:function(n){n?this._hoveredTarget!==n&&(this.fire("mouse:over",{target:n}),n.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=n):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(n,t,i){if(t&&t.visible&&t.evented&&this.containsPoint(n,t))if((this.perPixelTargetFind||t.perPixelTargetFind)&&!t.isEditing){var r=this.isTargetTransparent(t,i.x,i.y);if(!r)return!0}else return!0},_searchPossibleTargets:function(n){for(var i,r=this.getPointer(n,!0),t=this._objects.length;t--;)if(!this._objects[t].group&&this._checkTarget(n,this._objects[t],r)){this.relatedTarget=this._objects[t];i=this._objects[t];break}return i},getPointer:function(n,t,i){i||(i=this.upperCanvasEl);var f=u(n,i),r=i.getBoundingClientRect(),e=r.width||0,o=r.height||0,s;return e&&o||("top"in r&&"bottom"in r&&(o=Math.abs(r.top-r.bottom)),"right"in r&&"left"in r&&(e=Math.abs(r.right-r.left))),this.calcOffset(),f.x=f.x-this._offset.left,f.y=f.y-this._offset.top,t||(f=fabric.util.transformPoint(f,fabric.util.invertTransform(this.viewportTransform))),s=e===0||o===0?{width:1,height:1}:{width:i.width/e,height:i.height/o},{x:f.x*s.width,y:f.y*s.height}},_createUpperCanvas:function(){var n=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+n);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(n){var t=this.getWidth()||n.width,i=this.getHeight()||n.height;fabric.util.setStyle(n,{position:"absolute",width:t+"px",height:i+"px",left:0,top:0});n.width=t;n.height=i;fabric.util.makeElementUnselectable(n)},_copyCanvasStyle:function(n,t){t.style.cssText=n.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(n){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=n;n.set("active",!0)},setActiveObject:function(n,t){return this._setActiveObject(n),this.renderAll(),this.fire("object:selected",{target:n,e:t}),n.fire("selected",{e:t}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1);this._activeObject=null},discardActiveObject:function(n){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:n}),this},_setActiveGroup:function(n){this._activeGroup=n;n&&n.set("active",!0)},setActiveGroup:function(n,t){return this._setActiveGroup(n),n&&(this.fire("object:selected",{target:n,e:t}),n.fire("selected",{e:t})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var n=this.getActiveGroup();n&&n.destroy();this.setActiveGroup(null)},discardActiveGroup:function(n){return this._discardActiveGroup(),this.fire("selection:cleared",{e:n}),this},deactivateAll:function(){for(var t=this.getObjects(),n=0,i=t.length;n<i;n++)t[n].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(n){var t=this.getActiveGroup()||this.getActiveObject();return t&&this.fire("before:selection:cleared",{target:t,e:n}),this.deactivateAll(),t&&this.fire("selection:cleared",{e:n}),this},drawControls:function(n){var t=this.getActiveGroup();t?this._drawGroupControls(n,t):this._drawObjectsControls(n)},_drawGroupControls:function(n,t){t._renderControls(n)},_drawObjectsControls:function(n){for(var t=0,i=this._objects.length;t<i;++t)this._objects[t]&&this._objects[t].active&&(this._objects[t]._renderControls(n),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[t])}});for(i in fabric.StaticCanvas)i!=="prototype"&&(fabric.Canvas[i]=fabric.StaticCanvas[i]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){});fabric.Element=fabric.Canvas}(),function(){var i={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},n=fabric.util.addListener,t=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents();n(fabric.window,"resize",this._onResize);n(this.upperCanvasEl,"mousedown",this._onMouseDown);n(this.upperCanvasEl,"mousemove",this._onMouseMove);n(this.upperCanvasEl,"mousewheel",this._onMouseWheel);n(this.upperCanvasEl,"touchstart",this._onMouseDown);n(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof eventjs!="undefined"&&"add"in eventjs&&(eventjs.add(this.upperCanvasEl,"gesture",this._onGesture),eventjs.add(this.upperCanvasEl,"drag",this._onDrag),eventjs.add(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.add(this.upperCanvasEl,"shake",this._onShake),eventjs.add(this.upperCanvasEl,"longpress",this._onLongPress))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onLongPress=this._onLongPress.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){t(fabric.window,"resize",this._onResize);t(this.upperCanvasEl,"mousedown",this._onMouseDown);t(this.upperCanvasEl,"mousemove",this._onMouseMove);t(this.upperCanvasEl,"mousewheel",this._onMouseWheel);t(this.upperCanvasEl,"touchstart",this._onMouseDown);t(this.upperCanvasEl,"touchmove",this._onMouseMove);typeof eventjs!="undefined"&&"remove"in eventjs&&(eventjs.remove(this.upperCanvasEl,"gesture",this._onGesture),eventjs.remove(this.upperCanvasEl,"drag",this._onDrag),eventjs.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs.remove(this.upperCanvasEl,"shake",this._onShake),eventjs.remove(this.upperCanvasEl,"longpress",this._onLongPress))},_onGesture:function(n,t){this.__onTransformGesture&&this.__onTransformGesture(n,t)},_onDrag:function(n,t){this.__onDrag&&this.__onDrag(n,t)},_onMouseWheel:function(n,t){this.__onMouseWheel&&this.__onMouseWheel(n,t)},_onOrientationChange:function(n,t){this.__onOrientationChange&&this.__onOrientationChange(n,t)},_onShake:function(n,t){this.__onShake&&this.__onShake(n,t)},_onLongPress:function(n,t){this.__onLongPress&&this.__onLongPress(n,t)},_onMouseDown:function(i){this.__onMouseDown(i);n(fabric.document,"touchend",this._onMouseUp);n(fabric.document,"touchmove",this._onMouseMove);t(this.upperCanvasEl,"mousemove",this._onMouseMove);t(this.upperCanvasEl,"touchmove",this._onMouseMove);i.type==="touchstart"?t(this.upperCanvasEl,"mousedown",this._onMouseDown):(n(fabric.document,"mouseup",this._onMouseUp),n(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(i){if(this.__onMouseUp(i),t(fabric.document,"mouseup",this._onMouseUp),t(fabric.document,"touchend",this._onMouseUp),t(fabric.document,"mousemove",this._onMouseMove),t(fabric.document,"touchmove",this._onMouseMove),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"touchmove",this._onMouseMove),i.type==="touchend"){var r=this;setTimeout(function(){n(r.upperCanvasEl,"mousedown",r._onMouseDown)},400)}},_onMouseMove:function(n){!this.allowTouchScrolling&&n.preventDefault&&n.preventDefault();this.__onMouseMove(n)},_onResize:function(){this.calcOffset()},_shouldRender:function(n,t){var i=this.getActiveGroup()||this.getActiveObject();return!!(n&&(n.isMoving||n!==i)||!n&&!!i||!n&&!i&&!this._groupSelector||t&&this._previousPointer&&this.selection&&(t.x!==this._previousPointer.x||t.y!==this._previousPointer.y))},__onMouseUp:function(n){var t,i;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(n);return}this._currentTransform?(this._finalizeCurrentTransform(),t=this._currentTransform.target):t=this.findTarget(n,!0);i=this._shouldRender(t,this.getPointer(n));this._maybeGroupObjects(n);t&&(t.isMoving=!1);i&&this.renderAll();this._handleCursorAndEvent(n,t)},_handleCursorAndEvent:function(n,t){this._setCursorFromEvent(n,t);var i=this;setTimeout(function(){i._setCursorFromEvent(n,t)},50);this.fire("mouse:up",{target:t,e:n});t&&t.fire("mouseup",{e:n})},_finalizeCurrentTransform:function(){var t=this._currentTransform,n=t.target;n._scaling&&(n._scaling=!1);n.setCoords();this.stateful&&n.hasStateChanged()&&(this.fire("object:modified",{target:n}),n.fire("modified"));this._restoreOriginXY(n)},_restoreOriginXY:function(n){if(this._previousOriginX&&this._previousOriginY){var t=n.translateToOriginPoint(n.getCenterPoint(),this._previousOriginX,this._previousOriginY);n.originX=this._previousOriginX;n.originY=this._previousOriginY;n.left=t.x;n.top=t.y;this._previousOriginX=null;this._previousOriginY=null}},_onMouseDownInDrawingMode:function(n){var i,r,t;this._isCurrentlyDrawing=!0;this.discardActiveObject(n).renderAll();this.clipTo&&fabric.util.clipContext(this,this.contextTop);i=fabric.util.invertTransform(this.viewportTransform);r=fabric.util.transformPoint(this.getPointer(n,!0),i);this.freeDrawingBrush.onMouseDown(r);this.fire("mouse:down",{e:n});t=this.findTarget(n);typeof t!="undefined"&&t.fire("mousedown",{e:n,target:t})},_onMouseMoveInDrawingMode:function(n){var i,r,t;if(this._isCurrentlyDrawing){i=fabric.util.invertTransform(this.viewportTransform);r=fabric.util.transformPoint(this.getPointer(n,!0),i);this.freeDrawingBrush.onMouseMove(r)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:n});t=this.findTarget(n);typeof t!="undefined"&&t.fire("mousemove",{e:n,target:t})},_onMouseUpInDrawingMode:function(n){this._isCurrentlyDrawing=!1;this.clipTo&&this.contextTop.restore();this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:n});var t=this.findTarget(n);typeof t!="undefined"&&t.fire("mouseup",{e:n,target:t})},__onMouseDown:function(n){var f="which"in n?n.which===1:n.button===1,t,i,u,r;if(f||fabric.isTouchSupported){if(this.isDrawingMode){this._onMouseDownInDrawingMode(n);return}this._currentTransform||(t=this.findTarget(n),i=this.getPointer(n,!0),this._previousPointer=i,u=this._shouldRender(t,i),r=this._shouldGroup(n,t),this._shouldClearSelection(n,t)?this._clearSelection(n,t,i):r&&(this._handleGrouping(n,t),t=this.getActiveGroup()),t&&t.selectable&&!r&&(this._beforeTransform(n,t),this._setupCurrentTransform(n,t)),u&&this.renderAll(),this.fire("mouse:down",{target:t,e:n}),t&&t.fire("mousedown",{e:n}))}},_beforeTransform:function(n,t){if(this.stateful&&t.saveState(),t._findTargetCorner(this.getPointer(n)))this.onBeforeScaleRotate(t);t!==this.getActiveGroup()&&t!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(t,n))},_clearSelection:function(n,t,i){this.deactivateAllWithDispatch(n);t&&t.selectable?this.setActiveObject(t,n):this.selection&&(this._groupSelector={ex:i.x,ey:i.y,top:0,left:0})},_setOriginToCenter:function(n){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var t=n.getCenterPoint();n.originX="center";n.originY="center";n.left=t.x;n.top=t.y;this._currentTransform.left=n.left;this._currentTransform.top=n.top},_setCenterToOrigin:function(n){var t=n.translateToOriginPoint(n.getCenterPoint(),this._previousOriginX,this._previousOriginY);n.originX=this._previousOriginX;n.originY=this._previousOriginY;n.left=t.x;n.top=t.y;this._previousOriginX=null;this._previousOriginY=null},__onMouseMove:function(n){var t,r,i;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(n);return}typeof n.touches!="undefined"&&n.touches.length>1||(i=this._groupSelector,i?(r=this.getPointer(n,!0),i.left=r.x-i.ex,i.top=r.y-i.ey,this.renderTop()):this._currentTransform?this._transformObject(n):(t=this.findTarget(n),t&&(!t||t.selectable)?this._setCursorFromEvent(n,t):this.setCursor(this.defaultCursor)),this.fire("mouse:move",{target:t,e:n}),t&&t.fire("mousemove",{e:n}))},_transformObject:function(n){var i=this.getPointer(n),t=this._currentTransform;t.reset=!1;t.target.isMoving=!0;this._beforeScaleTransform(n,t);this._performTransformAction(n,t,i);this.renderAll()},_performTransformAction:function(n,t,i){var r=i.x,u=i.y,f=t.target,e=t.action;e==="rotate"?(this._rotateObject(r,u),this._fire("rotating",f,n)):e==="scale"?(this._onScale(n,t,r,u),this._fire("scaling",f,n)):e==="scaleX"?(this._scaleObject(r,u,"x"),this._fire("scaling",f,n)):e==="scaleY"?(this._scaleObject(r,u,"y"),this._fire("scaling",f,n)):(this._translateObject(r,u),this._fire("moving",f,n),this.setCursor(this.moveCursor))},_fire:function(n,t,i){this.fire("object:"+n,{target:t,e:i});t.fire(n,{e:i})},_beforeScaleTransform:function(n,t){if(t.action==="scale"||t.action==="scaleX"||t.action==="scaleY"){var i=this._shouldCenterTransform(n,t.target);(i&&(t.originX!=="center"||t.originY!=="center")||!i&&t.originX==="center"&&t.originY==="center")&&(this._resetCurrentTransform(n),t.reset=!0)}},_onScale:function(n,t,i,r){(n.shiftKey||this.uniScaleTransform)&&!t.target.get("lockUniScaling")?(t.currentAction="scale",this._scaleObject(i,r)):(t.reset||t.currentAction!=="scale"||this._resetCurrentTransform(n,t.target),t.currentAction="scaleEqually",this._scaleObject(i,r,"equally"))},_setCursorFromEvent:function(n,t){if(t&&t.selectable){var i=this.getActiveGroup(),r=t._findTargetCorner&&(!i||!i.contains(t))&&t._findTargetCorner(this.getPointer(n,!0));r?this._setCornerCursor(r,t):this.setCursor(t.hoverCursor||this.hoverCursor)}else return this.setCursor(this.defaultCursor),!1;return!0},_setCornerCursor:function(n,t){if(n in i)this.setCursor(this._getRotatedCornerCursor(n,t));else if(n==="mtr"&&t.hasRotatingPoint)this.setCursor(this.rotationCursor);else return this.setCursor(this.defaultCursor),!1},_getRotatedCornerCursor:function(n,t){var r=Math.round(t.getAngle()%360/45);return r<0&&(r+=8),r+=i[n],r%=8,this.cursorMap[r]}})}(),function(){var n=Math.min,t=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(n,t){var i=this.getActiveObject();return n.shiftKey&&(this.getActiveGroup()||i&&i!==t)&&this.selection},_handleGrouping:function(n,t){(t!==this.getActiveGroup()||(t=this.findTarget(n,!0),t&&!t.isType("group")))&&(this.getActiveGroup()?this._updateActiveGroup(t,n):this._createActiveGroup(t,n),this._activeGroup&&this._activeGroup.saveCoords())},_updateActiveGroup:function(n,t){var i=this.getActiveGroup();if(i.contains(n)){if(i.removeWithUpdate(n),this._resetObjectTransform(i),n.set("active",!1),i.size()===1){this.discardActiveGroup(t);this.setActiveObject(i.item(0));return}}else i.addWithUpdate(n),this._resetObjectTransform(i);this.fire("selection:created",{target:i,e:t});i.set("active",!0)},_createActiveGroup:function(n,t){if(this._activeObject&&n!==this._activeObject){var i=this._createGroup(n);i.addWithUpdate();this.setActiveGroup(i);this._activeObject=null;this.fire("selection:created",{target:i,e:t})}n.set("active",!0)},_createGroup:function(n){var t=this.getObjects(),i=t.indexOf(this._activeObject)<t.indexOf(n),r=i?[this._activeObject,n]:[n,this._activeObject];return new fabric.Group(r,{canvas:this})},_groupSelectedObjects:function(n){var t=this._collectObjects();t.length===1?this.setActiveObject(t[0],n):t.length>1&&(t=new fabric.Group(t.reverse(),{canvas:this}),t.addWithUpdate(),this.setActiveGroup(t,n),t.saveCoords(),this.fire("selection:created",{target:t}),this.renderAll())},_collectObjects:function(){for(var h=[],i,r=this._groupSelector.ex,u=this._groupSelector.ey,f=r+this._groupSelector.left,e=u+this._groupSelector.top,o=new fabric.Point(n(r,f),n(u,e)),s=new fabric.Point(t(r,f),t(u,e)),l=r===f&&u===e,c=this._objects.length;c--;)if((i=this._objects[c],i&&i.selectable&&i.visible)&&(i.intersectsWithRect(o,s)||i.isContainedWithinRect(o,s)||i.containsPoint(o)||i.containsPoint(s))&&(i.set("active",!0),h.push(i),l))break;return h},_maybeGroupObjects:function(n){this.selection&&this._groupSelector&&this._groupSelectedObjects(n);var t=this.getActiveGroup();t&&(t.setObjectsCoords().setCoords(),t.isMoving=!1,this.setCursor(this.defaultCursor));this._groupSelector=null;this._currentTransform=null}})}();fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(n){n||(n={});var t=n.format||"png",i=n.quality||1,r=n.multiplier||1,u={left:n.left,top:n.top,width:n.width,height:n.height};return r!==1?this.__toDataURLWithMultiplier(t,i,u,r):this.__toDataURL(t,i,u)},__toDataURL:function(n,t,i){var u,r,f;return this.renderAll(!0),u=this.upperCanvasEl||this.lowerCanvasEl,r=this.__getCroppedCanvas(u,i),n==="jpg"&&(n="jpeg"),f=fabric.StaticCanvas.supports("toDataURLWithQuality")?(r||u).toDataURL("image/"+n,t):(r||u).toDataURL("image/"+n),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),r&&(r=null),f},__getCroppedCanvas:function(n,t){var i,r,u="left"in t||"top"in t||"width"in t||"height"in t;return u&&(i=fabric.util.createCanvasElement(),r=i.getContext("2d"),i.width=t.width||this.width,i.height=t.height||this.height,r.drawImage(n,-t.left||0,-t.top||0)),i},__toDataURLWithMultiplier:function(n,t,i,r){var f=this.getWidth(),e=this.getHeight(),s=f*r,h=e*r,o=this.getActiveObject(),u=this.getActiveGroup(),c=this.contextTop||this.contextContainer,l;return r>1&&this.setWidth(s).setHeight(h),c.scale(r,r),i.left&&(i.left*=r),i.top&&(i.top*=r),i.width?i.width*=r:r<1&&(i.width=s),i.height?i.height*=r:r<1&&(i.height=h),u?this._tempRemoveBordersControlsFromGroup(u):o&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0),l=this.__toDataURL(n,t,i),this.width=f,this.height=e,c.scale(1/r,1/r),this.setWidth(f).setHeight(e),u?this._restoreBordersControlsOnGroup(u):o&&this.setActiveObject&&this.setActiveObject(o),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),l},toDataURLWithMultiplier:function(n,t,i){return this.toDataURL({format:n,multiplier:t,quality:i})},_tempRemoveBordersControlsFromGroup:function(n){n.origHasControls=n.hasControls;n.origBorderColor=n.borderColor;n.hasControls=!0;n.borderColor="rgba(0,0,0,0)";n.forEachObject(function(n){n.origBorderColor=n.borderColor;n.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(n){n.hideControls=n.origHideControls;n.borderColor=n.origBorderColor;n.forEachObject(function(n){n.borderColor=n.origBorderColor;delete n.origBorderColor})}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(n,t,i){return this.loadFromJSON(n,t,i)},loadFromJSON:function(n,t,i){var r,u;if(n)return r=typeof n=="string"?JSON.parse(n):n,this.clear(),u=this,this._enlivenObjects(r.objects,function(){u._setBgOverlay(r,t)},i),this},_setBgOverlay:function(n,t){var u=this,i={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1},r;if(!n.backgroundImage&&!n.overlayImage&&!n.background&&!n.overlay){t&&t();return}r=function(){i.backgroundImage&&i.overlayImage&&i.backgroundColor&&i.overlayColor&&(u.renderAll(),t&&t())};this.__setBgOverlay("backgroundImage",n.backgroundImage,i,r);this.__setBgOverlay("overlayImage",n.overlayImage,i,r);this.__setBgOverlay("backgroundColor",n.background,i,r);this.__setBgOverlay("overlayColor",n.overlay,i,r);r()},__setBgOverlay:function(n,t,i,r){var u=this;if(!t){i[n]=!0;return}n==="backgroundImage"||n==="overlayImage"?fabric.Image.fromObject(t,function(t){u[n]=t;i[n]=!0;r&&r()}):this["set"+fabric.util.string.capitalize(n,!0)](t,function(){i[n]=!0;r&&r()})},_enlivenObjects:function(n,t,i){var r=this,u;if(!n||n.length===0){t&&t();return}u=this.renderOnAddRemove;this.renderOnAddRemove=!1;fabric.util.enlivenObjects(n,function(n){n.forEach(function(n,t){r.insertAt(n,t,!0)});r.renderOnAddRemove=u;t&&t()},null,i)},_toDataURL:function(n,t){this.clone(function(i){t(i.toDataURL(n))})},_toDataURLWithMultiplier:function(n,t,i){this.clone(function(r){i(r.toDataURLWithMultiplier(n,t))})},clone:function(n,t){var i=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(t){t.loadFromJSON(i,function(){n&&n(t)})})},cloneWithoutData:function(n){var i=fabric.document.createElement("canvas"),t;i.width=this.getWidth();i.height=this.getHeight();t=new fabric.Canvas(i);t.clipTo=this.clipTo;this.backgroundImage?(t.setBackgroundImage(this.backgroundImage.src,function(){t.renderAll();n&&n(t)}),t.backgroundImageOpacity=this.backgroundImageOpacity,t.backgroundImageStretch=this.backgroundImageStretch):n&&n(t)}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),u=t.util.object.extend,i=t.util.toFixed,f=t.util.string.capitalize,r=t.util.degreesToRadians,e=t.StaticCanvas.supports("setLineDash");t.Object||(t.Object=t.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockScalingFlip:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule globalCompositeOperation shadow clipTo visible backgroundColor".split(" "),initialize:function(n){n&&this.setOptions(n)},_initGradient:function(n){!n.fill||!n.fill.colorStops||n.fill instanceof t.Gradient||this.set("fill",new t.Gradient(n.fill))},_initPattern:function(n){!n.fill||!n.fill.source||n.fill instanceof t.Pattern||this.set("fill",new t.Pattern(n.fill));!n.stroke||!n.stroke.source||n.stroke instanceof t.Pattern||this.set("stroke",new t.Pattern(n.stroke))},_initClipping:function(n){if(n.clipTo&&typeof n.clipTo=="string"){var i=t.util.getFunctionBody(n.clipTo);typeof i!="undefined"&&(this.clipTo=new Function("ctx",i))}},setOptions:function(n){for(var t in n)this.set(t,n[t]);this._initGradient(n);this._initPattern(n);this._initClipping(n)},transform:function(n,t){var i=t?this._getLeftTopCoords():this.getCenterPoint();n.translate(i.x,i.y);n.rotate(r(this.angle));n.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(n){var r=t.Object.NUM_FRACTION_DIGITS,u={type:this.type,originX:this.originX,originY:this.originY,left:i(this.left,r),top:i(this.top,r),width:i(this.width,r),height:i(this.height,r),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,r),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:i(this.strokeMiterLimit,r),scaleX:i(this.scaleX,r),scaleY:i(this.scaleY,r),angle:i(this.getAngle(),r),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,r),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,globalCompositeOperation:this.globalCompositeOperation};return this.includeDefaultValues||(u=this._removeDefaultValues(u)),t.util.populateWithProperties(this,u,n),u},toDatalessObject:function(n){return this.toObject(n)},_removeDefaultValues:function(n){var i=t.util.getKlass(n.type).prototype,r=i.stateProperties;return r.forEach(function(t){n[t]===i[t]&&delete n[t]}),n},toString:function(){return"#<fabric."+f(this.type)+">"},get:function(n){return this[n]},_setObject:function(n){for(var t in n)this._set(t,n[t])},set:function(n,t){return typeof n=="object"?this._setObject(n):typeof t=="function"&&n!=="clipTo"?this._set(n,t(this.get(n))):this._set(n,t),this},_set:function(n,r){var u=n==="scaleX"||n==="scaleY";return u&&(r=this._constrainScale(r)),n==="scaleX"&&r<0?(this.flipX=!this.flipX,r*=-1):n==="scaleY"&&r<0?(this.flipY=!this.flipY,r*=-1):n==="width"||n==="height"?this.minScaleLimit=i(Math.min(.1,1/Math.max(this.width,this.height)),2):n!=="shadow"||!r||r instanceof t.Shadow||(r=new t.Shadow(r)),this[n]=r,this},toggle:function(n){var t=this.get(n);return typeof t=="boolean"&&this.set(n,!t),this},setSourcePath:function(n){return this.sourcePath=n,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(n,i){(this.width!==0||this.height!==0)&&this.visible&&(n.save(),this._setupCompositeOperation(n),i||this.transform(n),this._setStrokeStyles(n),this._setFillStyles(n),this.transformMatrix&&n.transform.apply(n,this.transformMatrix),this._setOpacity(n),this._setShadow(n),this.clipTo&&t.util.clipContext(this,n),this._render(n,i),this.clipTo&&n.restore(),this._removeShadow(n),this._restoreCompositeOperation(n),n.restore())},_setOpacity:function(n){this.group&&this.group._setOpacity(n);n.globalAlpha*=this.opacity},_setStrokeStyles:function(n){this.stroke&&(n.lineWidth=this.strokeWidth,n.lineCap=this.strokeLineCap,n.lineJoin=this.strokeLineJoin,n.miterLimit=this.strokeMiterLimit,n.strokeStyle=this.stroke.toLive?this.stroke.toLive(n,this):this.stroke)},_setFillStyles:function(n){this.fill&&(n.fillStyle=this.fill.toLive?this.fill.toLive(n,this):this.fill)},_renderControls:function(n,i){var f,u;this.active&&!i&&(f=this.getViewportTransform(),n.save(),this.group&&(u=t.util.transformPoint(this.group.getCenterPoint(),f),n.translate(u.x,u.y),n.rotate(r(this.group.angle))),u=t.util.transformPoint(this.getCenterPoint(),f,null!=this.group),this.group&&(u.x*=this.group.scaleX,u.y*=this.group.scaleY),n.translate(u.x,u.y),n.rotate(r(this.angle)),this.drawBorders(n),this.drawControls(n),n.restore())},_setShadow:function(n){if(this.shadow){var t=this.canvas&&this.canvas.viewportTransform[0]||1,i=this.canvas&&this.canvas.viewportTransform[3]||1;n.shadowColor=this.shadow.color;n.shadowBlur=this.shadow.blur*(t+i)*(this.scaleX+this.scaleY)/4;n.shadowOffsetX=this.shadow.offsetX*t*this.scaleX;n.shadowOffsetY=this.shadow.offsetY*i*this.scaleY}},_removeShadow:function(n){this.shadow&&(n.shadowColor="",n.shadowBlur=n.shadowOffsetX=n.shadowOffsetY=0)},_renderFill:function(n){if(this.fill){if(n.save(),this.fill.gradientTransform){var t=this.fill.gradientTransform;n.transform.apply(n,t)}this.fill.toLive&&n.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0);this.fillRule==="evenodd"?n.fill("evenodd"):n.fill();n.restore();this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n)}},_renderStroke:function(n){if(this.stroke&&this.strokeWidth!==0){if(n.save(),this.strokeDashArray)1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e?(n.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(n)):this._renderDashedStroke&&this._renderDashedStroke(n),n.stroke();else{if(this.stroke.gradientTransform){var t=this.stroke.gradientTransform;n.transform.apply(n,t)}this._stroke?this._stroke(n):n.stroke()}this._removeShadow(n);n.restore()}},clone:function(n,i){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(i),n):new t.Object(this.toObject(i))},cloneAsImage:function(n){var i=this.toDataURL();return t.util.loadImage(i,function(i){n&&n(new t.Image(i))}),this},toDataURL:function(n){var i,u,r,f,e,o;return n||(n={}),i=t.util.createCanvasElement(),u=this.getBoundingRect(),i.width=u.width,i.height=u.height,t.util.wrapElement(i,"div"),r=new t.StaticCanvas(i),n.format==="jpg"&&(n.format="jpeg"),n.format==="jpeg"&&(r.backgroundColor="#fff"),f={active:this.get("active"),left:this.getLeft(),top:this.getTop()},this.set("active",!1),this.setPositionByOrigin(new t.Point(i.width/2,i.height/2),"center","center"),e=this.canvas,r.add(this),o=r.toDataURL(n),this.set(f).setCoords(),this.canvas=e,r.dispose(),r=null,o},isType:function(n){return this.type===n},complexity:function(){return 0},toJSON:function(n){return this.toObject(n)},setGradient:function(n,i){var r,u,f;i||(i={});r={colorStops:[]};r.type=i.type||(i.r1||i.r2?"radial":"linear");r.coords={x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2};(i.r1||i.r2)&&(r.coords.r1=i.r1,r.coords.r2=i.r2);for(u in i.colorStops)f=new t.Color(i.colorStops[u]),r.colorStops.push({offset:u,color:f.toRgb(),opacity:f.getAlpha()});return this.set(n,t.Gradient.forObject(this,r))},setPatternFill:function(n){return this.set("fill",new t.Pattern(n))},setShadow:function(n){return this.set("shadow",n?new t.Shadow(n):null)},setColor:function(n){return this.set("fill",n),this},setAngle:function(n){var t=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",n),t&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(n,t){t=t||this.canvas.getPointer(n);var i=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:t.x-i.x,y:t.y-i.y}},_setupCompositeOperation:function(n){this.globalCompositeOperation&&(this._prevGlobalCompositeOperation=n.globalCompositeOperation,n.globalCompositeOperation=this.globalCompositeOperation)},_restoreCompositeOperation:function(n){this.globalCompositeOperation&&this._prevGlobalCompositeOperation&&(n.globalCompositeOperation=this._prevGlobalCompositeOperation)}}),t.util.createAccessors(t.Object),t.Object.prototype.rotate=t.Object.prototype.setAngle,u(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object.__uid=0)}(typeof exports!="undefined"?exports:this),function(){var n=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(t,i,r){var f=t.x,e=t.y,u=this.stroke?this.strokeWidth:0;return i==="left"?f=t.x+(this.getWidth()+u*this.scaleX)/2:i==="right"&&(f=t.x-(this.getWidth()+u*this.scaleX)/2),r==="top"?e=t.y+(this.getHeight()+u*this.scaleY)/2:r==="bottom"&&(e=t.y-(this.getHeight()+u*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(f,e),t,n(this.angle))},translateToOriginPoint:function(t,i,r){var f=t.x,e=t.y,u=this.stroke?this.strokeWidth:0;return i==="left"?f=t.x-(this.getWidth()+u*this.scaleX)/2:i==="right"&&(f=t.x+(this.getWidth()+u*this.scaleX)/2),r==="top"?e=t.y-(this.getHeight()+u*this.scaleY)/2:r==="bottom"&&(e=t.y+(this.getHeight()+u*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(f,e),t,n(this.angle))},getCenterPoint:function(){var n=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(n,this.originX,this.originY)},getPointByOrigin:function(n,t){var i=this.getCenterPoint();return this.translateToOriginPoint(i,n,t)},toLocalPoint:function(t,i,r){var u=this.getCenterPoint(),f=this.stroke?this.strokeWidth:0,e,o;return i&&r?(e=i==="left"?u.x-(this.getWidth()+f*this.scaleX)/2:i==="right"?u.x+(this.getWidth()+f*this.scaleX)/2:u.x,o=r==="top"?u.y-(this.getHeight()+f*this.scaleY)/2:r==="bottom"?u.y+(this.getHeight()+f*this.scaleY)/2:u.y):(e=this.left,o=this.top),fabric.util.rotatePoint(new fabric.Point(t.x,t.y),u,-n(this.angle)).subtractEquals(new fabric.Point(e,o))},setPositionByOrigin:function(n,t,i){var u=this.translateToCenterPoint(n,t,i),r=this.translateToOriginPoint(u,this.originX,this.originY);this.set("left",r.x);this.set("top",r.y)},adjustPosition:function(t){var i=n(this.angle),r=this.getWidth()/2,u=Math.cos(i)*r,f=Math.sin(i)*r,e=this.getWidth(),o=Math.cos(i)*e,s=Math.sin(i)*e;this.originX==="center"&&t==="left"||this.originX==="right"&&t==="center"?(this.left-=u,this.top-=f):this.originX==="left"&&t==="center"||this.originX==="center"&&t==="right"?(this.left+=u,this.top+=f):this.originX==="left"&&t==="right"?(this.left+=o,this.top+=s):this.originX==="right"&&t==="left"&&(this.left-=o,this.top-=s);this.setCoords();this.originX=t},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var n=this.getCenterPoint();this.originX="center";this.originY="center";this.left=n.x;this.top=n.y},_resetOrigin:function(){var n=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=n.x;this.top=n.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var n=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(n,t){var i=this.oCoords,r=new fabric.Point(i.tl.x,i.tl.y),u=new fabric.Point(i.tr.x,i.tr.y),f=new fabric.Point(i.bl.x,i.bl.y),e=new fabric.Point(i.br.x,i.br.y),o=fabric.Intersection.intersectPolygonRectangle([r,u,e,f],n,t);return o.status==="Intersection"},intersectsWithObject:function(n){function r(n){return{tl:new fabric.Point(n.tl.x,n.tl.y),tr:new fabric.Point(n.tr.x,n.tr.y),bl:new fabric.Point(n.bl.x,n.bl.y),br:new fabric.Point(n.br.x,n.br.y)}}var t=r(this.oCoords),i=r(n.oCoords),u=fabric.Intersection.intersectPolygonPolygon([t.tl,t.tr,t.br,t.bl],[i.tl,i.tr,i.br,i.bl]);return u.status==="Intersection"},isContainedWithinObject:function(n){var t=n.getBoundingRect(),i=new fabric.Point(t.left,t.top),r=new fabric.Point(t.left+t.width,t.top+t.height);return this.isContainedWithinRect(i,r)},isContainedWithinRect:function(n,t){var i=this.getBoundingRect();return i.left>=n.x&&i.left+i.width<=t.x&&i.top>=n.y&&i.top+i.height<=t.y},containsPoint:function(n){var i=this._getImageLines(this.oCoords),t=this._findCrossPoints(n,i);return t!==0&&t%2==1},_getImageLines:function(n){return{topline:{o:n.tl,d:n.tr},rightline:{o:n.tr,d:n.br},bottomline:{o:n.br,d:n.bl},leftline:{o:n.bl,d:n.tl}}},_findCrossPoints:function(n,t){var r,f,e,s,u,h,o=0,i;for(var c in t)if((i=t[c],!(i.o.y<n.y)||!(i.d.y<n.y))&&(!(i.o.y>=n.y)||!(i.d.y>=n.y))&&(i.o.x===i.d.x&&i.o.x>=n.x?(u=i.o.x,h=n.y):(r=0,f=(i.d.y-i.o.y)/(i.d.x-i.o.x),e=n.y-r*n.x,s=i.o.y-f*i.o.x,u=-(e-s)/(r-f),h=e+r*u),u>=n.x&&(o+=1),o===2))break;return o},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var n=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],t=fabric.util.array.min(n),u=fabric.util.array.max(n),f=Math.abs(t-u),i=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],r=fabric.util.array.min(i),e=fabric.util.array.max(i),o=Math.abs(r-e);return{left:t,top:r,width:f,height:o}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(n){return Math.abs(n)<this.minScaleLimit?n<0?-this.minScaleLimit:this.minScaleLimit:n},scale:function(n){return n=this._constrainScale(n),n<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,n*=-1),this.scaleX=n,this.scaleY=n,this.setCoords(),this},scaleToWidth:function(n){var t=this.getBoundingRectWidth()/this.getWidth();return this.scale(n/this.width/t)},scaleToHeight:function(n){var t=this.getBoundingRectHeight()/this.getHeight();return this.scale(n/this.height/t)},setCoords:function(){var s=n(this.angle),d=this.getViewportTransform(),h=function(n){return fabric.util.transformPoint(n,d)},p=this._calculateCurrentDimensions(!1),t=p.x,c=p.y;t<0&&(t=Math.abs(t));var w=Math.sqrt(Math.pow(t/2,2)+Math.pow(c/2,2)),b=Math.atan(isFinite(c/t)?c/t:0),g=Math.cos(b+s)*w,nt=Math.sin(b+s)*w,l=Math.sin(s),a=Math.cos(s),k=this.getCenterPoint(),i=new fabric.Point(t,c),r=new fabric.Point(k.x-g,k.y-nt),v=new fabric.Point(r.x+i.x*a,r.y+i.x*l),u=h(new fabric.Point(r.x-i.y*l,r.y+i.y*a)),f=h(new fabric.Point(v.x-i.y*l,v.y+i.y*a)),e=h(r),o=h(v),tt=new fabric.Point((e.x+u.x)/2,(e.y+u.y)/2),y=new fabric.Point((o.x+e.x)/2,(o.y+e.y)/2),it=new fabric.Point((f.x+o.x)/2,(f.y+o.y)/2),rt=new fabric.Point((f.x+u.x)/2,(f.y+u.y)/2),ut=new fabric.Point(y.x+l*this.rotatingPointOffset,y.y-a*this.rotatingPointOffset);return this.oCoords={tl:e,tr:o,br:f,bl:u,ml:tt,mt:y,mr:it,mb:rt,mtr:ut},this._setCornerCoords&&this._setCornerCoords(),this}})}();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(n){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,n):this.canvas.sendBackwards(this,n),this},bringForward:function(n){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,n):this.canvas.bringForward(this,n),this},moveTo:function(n){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,n):this.canvas.moveTo(this,n),this}});fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var n=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",t=this.fillRule,i=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",r=this.strokeWidth?this.strokeWidth:"0",u=this.strokeDashArray?this.strokeDashArray.join(" "):"",f=this.strokeLineCap?this.strokeLineCap:"butt",e=this.strokeLineJoin?this.strokeLineJoin:"miter",o=this.strokeMiterLimit?this.strokeMiterLimit:"4",s=typeof this.opacity!="undefined"?this.opacity:"1",h=this.visible?"":" visibility: hidden;",c=this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",i,"; ","stroke-width: ",r,"; ","stroke-dasharray: ",u,"; ","stroke-linecap: ",f,"; ","stroke-linejoin: ",e,"; ","stroke-miterlimit: ",o,"; ","fill: ",n,"; ","fill-rule: ",t,"; ","opacity: ",s,";",c,h].join("")},getSvgTransform:function(){if(this.group&&this.group.type==="path-group")return"";var t=fabric.util.toFixed,r=this.getAngle(),n=!this.canvas||this.canvas.svgViewportTransformation?this.getViewportTransform():[1,0,0,1,0,0],u=fabric.util.transformPoint(this.getCenterPoint(),n),i=fabric.Object.NUM_FRACTION_DIGITS,f=this.type==="path-group"?"":"translate("+t(u.x,i)+" "+t(u.y,i)+")",e=r!==0?" rotate("+t(r,i)+")":"",o=this.scaleX===1&&this.scaleY===1&&n[0]===1&&n[3]===1?"":" scale("+t(this.scaleX*n[0],i)+" "+t(this.scaleY*n[3],i)+")",s=this.type==="path-group"?this.width*n[0]:0,h=this.flipX?" matrix(-1 0 0 1 "+s+" 0) ":"",c=this.type==="path-group"?this.height*n[3]:0,l=this.flipY?" matrix(1 0 0 -1 0 "+c+")":"";return[f,e,o,h,l].join("")},getSvgTransformMatrix:function(){return this.transformMatrix?" matrix("+this.transformMatrix.join(" ")+") ":""},_createBaseSVGMarkup:function(){var n=[];return this.fill&&this.fill.toLive&&n.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&n.push(this.stroke.toSVG(this,!1)),this.shadow&&n.push(this.shadow.toSVG(this)),n}});fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(n){return this.get(n)!==this.originalState[n]},this)},saveState:function(n){return this.stateProperties.forEach(function(n){this.originalState[n]=this.get(n)},this),n&&n.stateProperties&&n.stateProperties.forEach(function(n){this.originalState[n]=this.get(n)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var n=fabric.util.degreesToRadians,t=function(){return typeof G_vmlCanvasManager!="undefined"};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(n){var r,u,i,f,t;if(!this.hasControls||!this.active)return!1;r=n.x;u=n.y;for(t in this.oCoords)if(this.isControlVisible(t)&&(t!=="mtr"||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||t!=="mt"&&t!=="mr"&&t!=="mb"&&t!=="ml")&&(f=this._getImageLines(this.oCoords[t].corner),i=this._findCrossPoints({x:r,y:u},f),i!==0&&i%2==1))return this.__corner=t,t;return!1},_setCornerCoords:function(){var r=this.oCoords,o=n(45-this.angle),s=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,u=s*Math.cos(o),f=s*Math.sin(o),t,i;for(var e in r)t=r[e].x,i=r[e].y,r[e].corner={tl:{x:t-f,y:i-u},tr:{x:t+u,y:i-f},bl:{x:t-u,y:i+f},br:{x:t+f,y:i+u}}},_calculateCurrentDimensions:function(n){var s=this.getViewportTransform(),r=this.strokeWidth,t=this.width,i=this.height,e=this.strokeLineCap==="round"||this.strokeLineCap==="square",u=this.type==="line"&&this.width===0,f=this.type==="line"&&this.height===0,o=u||f,h=e&&f||!o,c=e&&u||!o;return(u?t=r:f&&(i=r),h&&(t+=t<0?-r:r),c&&(i+=i<0?-r:r),t=t*this.scaleX+2*this.padding,i=i*this.scaleY+2*this.padding,n)?fabric.util.transformPoint(new fabric.Point(t,i),s,!0):{x:t,y:i}},drawBorders:function(n){var r;if(!this.hasBorders)return this;n.save();n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;n.strokeStyle=this.borderColor;n.lineWidth=1/this.borderScaleFactor;var u=this._calculateCurrentDimensions(!0),i=u.x,t=u.y;return this.group&&(i=i*this.group.scaleX,t=t*this.group.scaleY),n.strokeRect(~~-(i/2)-.5,~~-(t/2)-.5,~~i+1,~~t+1),this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls&&(r=-t/2,n.beginPath(),n.moveTo(0,r),n.lineTo(0,r-this.rotatingPointOffset),n.closePath(),n.stroke()),n.restore(),this},drawControls:function(n){if(!this.hasControls)return this;var o=this._calculateCurrentDimensions(!0),f=o.x,e=o.y,i=-(f/2),r=-(e/2),t=this.cornerSize/2,u=this.transparentCorners?"strokeRect":"fillRect";return n.save(),n.lineWidth=1,n.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,n.strokeStyle=n.fillStyle=this.cornerColor,this._drawControl("tl",n,u,i-t,r-t),this._drawControl("tr",n,u,i+f-t,r-t),this._drawControl("bl",n,u,i-t,r+e-t),this._drawControl("br",n,u,i+f-t,r+e-t),this.get("lockUniScaling")||(this._drawControl("mt",n,u,i+f/2-t,r-t),this._drawControl("mb",n,u,i+f/2-t,r+e-t),this._drawControl("mr",n,u,i+f-t,r+e/2-t),this._drawControl("ml",n,u,i-t,r+e/2-t)),this.hasRotatingPoint&&this._drawControl("mtr",n,u,i+f/2-t,r-this.rotatingPointOffset-t),n.restore(),this},_drawControl:function(n,i,r,u,f){if(this.isControlVisible(n)){var e=this.cornerSize;t()||this.transparentCorners||i.clearRect(u,f,e,e);i[r](u,f,e,e)}},isControlVisible:function(n){return this._getControlsVisibility()[n]},setControlVisible:function(n,t){return this._getControlsVisibility()[n]=t,this},setControlsVisibility:function(n){n||(n={});for(var t in n)this.setControlVisible(t,n[t]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){n.set("left",t);f.renderAll();u()},onComplete:function(){n.setCoords();r()}}),this},fxCenterObjectV:function(n,t){t=t||{};var i=function(){},r=t.onComplete||i,u=t.onChange||i,f=this;return fabric.util.animate({startValue:n.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){n.set("top",t);f.renderAll();u()},onComplete:function(){n.setCoords();r()}}),this},fxRemove:function(n,t){t=t||{};var i=function(){},u=t.onComplete||i,f=t.onChange||i,r=this;return fabric.util.animate({startValue:n.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){n.set("active",!1)},onChange:function(t){n.set("opacity",t);r.renderAll();f()},onComplete:function(){r.remove(n);u()}}),this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){var i,n,u,t,r;if(arguments[0]&&typeof arguments[0]=="object"){i=[];for(n in arguments[0])i.push(n);for(t=0,r=i.length;t<r;t++)n=i[t],u=t!==r-1,this._animate(n,arguments[0][n],arguments[1],u)}else this._animate.apply(this,arguments);return this},_animate:function(n,t,i,r){var f=this,u,e;t=t.toString();i=i?fabric.util.object.clone(i):{};~n.indexOf(".")&&(u=n.split("."));e=u?this.get(u[0])[u[1]]:this.get(n);"from"in i||(i.from=e);t=~t.indexOf("=")?e+parseFloat(t.replace("=","")):parseFloat(t);fabric.util.animate({startValue:i.from,endValue:t,byValue:i.by,easing:i.easing,duration:i.duration,abort:i.abort&&function(){return i.abort.call(f)},onChange:function(t){(u?f[u[0]][u[1]]=t:f.set(n,t),r)||i.onChange&&i.onChange()},onComplete:function(){r||(f.setCoords(),i.onComplete&&i.onComplete())}})}}),function(n){"use strict";function r(n,t){var u=n.origin,i=n.axis1,r=n.axis2,f=n.dimension,e=t.nearest,o=t.center,s=t.farthest;return function(){switch(this.get(u)){case e:return Math.min(this.get(i),this.get(r));case o:return Math.min(this.get(i),this.get(r))+.5*this.get(f);case s:return Math.max(this.get(i),this.get(r))}}}var t=n.fabric||(n.fabric={}),i=t.util.object.extend,u={x1:1,x2:1,y1:1,y2:1},f=t.StaticCanvas.supports("setLineDash");if(t.Line){t.warn("fabric.Line is already defined");return}t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(n,t){t=t||{};n||(n=[0,0,0,0]);this.callSuper("initialize",t);this.set("x1",n[0]);this.set("y1",n[1]);this.set("x2",n[2]);this.set("y2",n[3]);this._setWidthHeight(t)},_setWidthHeight:function(n){n||(n={});this.width=Math.abs(this.x2-this.x1);this.height=Math.abs(this.y2-this.y1);this.left="left"in n?n.left:this._getLeftToOriginX();this.top="top"in n?n.top:this._getTopToOriginY()},_set:function(n,t){return this.callSuper("_set",n,t),typeof u[n]!="undefined"&&this._setWidthHeight(),this},_getLeftToOriginX:r({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:r({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(n,t){var r,i,u;n.beginPath();t&&(r=this.getCenterPoint(),n.translate(r.x-this.strokeWidth/2,r.y-this.strokeWidth/2));(!this.strokeDashArray||this.strokeDashArray&&f)&&(i=this.calcLinePoints(),n.moveTo(i.x1,i.y1),n.lineTo(i.x2,i.y2));n.lineWidth=this.strokeWidth;u=n.strokeStyle;n.strokeStyle=this.stroke||n.fillStyle;this.stroke&&this._renderStroke(n);n.strokeStyle=u},_renderDashedStroke:function(n){var i=this.calcLinePoints();n.beginPath();t.util.drawDashedLine(n,i.x1,i.y1,i.x2,i.y2,this.strokeDashArray);n.closePath()},toObject:function(n){return i(this.callSuper("toObject",n),this.calcLinePoints())},calcLinePoints:function(){var n=this.x1<=this.x2?-1:1,t=this.y1<=this.y2?-1:1,i=n*this.width*.5,r=t*this.height*.5,u=n*this.width*-.5,f=t*this.height*-.5;return{x1:i,x2:u,y1:r,y2:f}},toSVG:function(n){var i=this._createBaseSVGMarkup(),t={x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};return this.group&&this.group.type==="path-group"||(t=this.calcLinePoints()),i.push("<line ",'x1="',t.x1,'" y1="',t.y1,'" x2="',t.x2,'" y2="',t.y2,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),n?n(i.join("")):i.join("")},complexity:function(){return 1}});t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" "));t.Line.fromElement=function(n,r){var u=t.parseAttributes(n,t.Line.ATTRIBUTE_NAMES),f=[u.x1||0,u.y1||0,u.x2||0,u.y2||0];return new t.Line(f,i(u,r))};t.Line.fromObject=function(n){var i=[n.x1,n.y1,n.x2,n.y2];return new t.Line(i,n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";function u(n){return"radius"in n&&n.radius>=0}var t=n.fabric||(n.fabric={}),i=Math.PI,r=t.util.object.extend;if(t.Circle){t.warn("fabric.Circle is already defined.");return}t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,startAngle:0,endAngle:i*2,initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("radius",n.radius||0);this.startAngle=n.startAngle||this.startAngle;this.endAngle=n.endAngle||this.endAngle},_set:function(n,t){return this.callSuper("_set",n,t),n==="radius"&&this.setRadius(t),this},toObject:function(n){return r(this.callSuper("toObject",n),{radius:this.get("radius"),startAngle:this.startAngle,endAngle:this.endAngle})},toSVG:function(n){var t=this._createBaseSVGMarkup(),r=0,u=0,f=(this.endAngle-this.startAngle)%(2*i);if(f===0)this.group&&this.group.type==="path-group"&&(r=this.left+this.radius,u=this.top+this.radius),t.push("<circle ",'cx="'+r+'" cy="'+u+'" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n');else{var e=Math.cos(this.startAngle)*this.radius,o=Math.sin(this.startAngle)*this.radius,s=Math.cos(this.endAngle)*this.radius,h=Math.sin(this.endAngle)*this.radius,c=f>i?"1":"0";t.push('<path d="M '+e+" "+o," A "+this.radius+" "+this.radius," 0 ",+c+" 1"," "+s+" "+h,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n')}return n?n(t.join("")):t.join("")},_render:function(n,t){n.beginPath();n.arc(t?this.left+this.radius:0,t?this.top+this.radius:0,this.radius,this.startAngle,this.endAngle,!1);this._renderFill(n);this._renderStroke(n)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(n){this.radius=n;this.set("width",n*2).set("height",n*2)},complexity:function(){return 1}});t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" "));t.Circle.fromElement=function(n,i){var f,e;if(i||(i={}),f=t.parseAttributes(n,t.Circle.ATTRIBUTE_NAMES),!u(f))throw new Error("value of `r` attribute is required and can not be negative");return f.left=f.left||0,f.top=f.top||0,e=new t.Circle(r(f,i)),e.left-=e.radius,e.top-=e.radius,e};t.Circle.fromObject=function(n){return new t.Circle(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});if(t.Triangle){t.warn("fabric.Triangle is already defined");return}t.Triangle=t.util.createClass(t.Object,{type:"triangle",initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("width",n.width||100).set("height",n.height||100)},_render:function(n){var i=this.width/2,t=this.height/2;n.beginPath();n.moveTo(-i,t);n.lineTo(0,-t);n.lineTo(i,t);n.closePath();this._renderFill(n);this._renderStroke(n)},_renderDashedStroke:function(n){var r=this.width/2,i=this.height/2;n.beginPath();t.util.drawDashedLine(n,-r,i,0,-i,this.strokeDashArray);t.util.drawDashedLine(n,0,-i,r,i,this.strokeDashArray);t.util.drawDashedLine(n,r,i,-r,i,this.strokeDashArray);n.closePath()},toSVG:function(n){var t=this._createBaseSVGMarkup(),r=this.width/2,i=this.height/2,u=[-r+" "+i,"0 "+-i,r+" "+i].join(",");return t.push("<polygon ",'points="',u,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),n?n(t.join("")):t.join("")},complexity:function(){return 1}});t.Triangle.fromObject=function(n){return new t.Triangle(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),r=Math.PI*2,i=t.util.object.extend;if(t.Ellipse){t.warn("fabric.Ellipse is already defined.");return}t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,initialize:function(n){n=n||{};this.callSuper("initialize",n);this.set("rx",n.rx||0);this.set("ry",n.ry||0)},_set:function(n,t){this.callSuper("_set",n,t);switch(n){case"rx":this.rx=t;this.set("width",t*2);break;case"ry":this.ry=t;this.set("height",t*2)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(n){return i(this.callSuper("toObject",n),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(n){var t=this._createBaseSVGMarkup(),i=0,r=0;return this.group&&this.group.type==="path-group"&&(i=this.left+this.rx,r=this.top+this.ry),t.push("<ellipse ",'cx="',i,'" cy="',r,'" ','rx="',this.rx,'" ry="',this.ry,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),n?n(t.join("")):t.join("")},_render:function(n,t){n.beginPath();n.save();n.transform(1,0,0,this.ry/this.rx,0,0);n.arc(t?this.left+this.rx:0,t?(this.top+this.ry)*this.rx/this.ry:0,this.rx,0,r,!1);n.restore();this._renderFill(n);this._renderStroke(n)},complexity:function(){return 1}});t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" "));t.Ellipse.fromElement=function(n,r){var u,f;return r||(r={}),u=t.parseAttributes(n,t.Ellipse.ATTRIBUTE_NAMES),u.left=u.left||0,u.top=u.top||0,f=new t.Ellipse(i(u,r)),f.top-=f.ry,f.left-=f.rx,f};t.Ellipse.fromObject=function(n){return new t.Ellipse(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),r=t.util.object.extend,i;if(t.Rect){console.warn("fabric.Rect is already defined");return}i=t.Object.prototype.stateProperties.concat();i.push("rx","ry","x","y");t.Rect=t.util.createClass(t.Object,{stateProperties:i,type:"rect",rx:0,ry:0,strokeDashArray:null,initialize:function(n){n=n||{};this.callSuper("initialize",n);this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(n,t){if(this.width===1&&this.height===1){n.fillRect(0,0,1,1);return}var u=this.rx?Math.min(this.rx,this.width/2):0,f=this.ry?Math.min(this.ry,this.height/2):0,e=this.width,o=this.height,i=t?this.left:-this.width/2,r=t?this.top:-this.height/2,h=u!==0||f!==0,s=1-.5522847498;n.beginPath();n.moveTo(i+u,r);n.lineTo(i+e-u,r);h&&n.bezierCurveTo(i+e-s*u,r,i+e,r+s*f,i+e,r+f);n.lineTo(i+e,r+o-f);h&&n.bezierCurveTo(i+e,r+o-s*f,i+e-s*u,r+o,i+e-u,r+o);n.lineTo(i+u,r+o);h&&n.bezierCurveTo(i+s*u,r+o,i,r+o-s*f,i,r+o-f);n.lineTo(i,r+f);h&&n.bezierCurveTo(i,r+s*f,i+s*u,r,i+u,r);n.closePath();this._renderFill(n);this._renderStroke(n)},_renderDashedStroke:function(n){var i=-this.width/2,r=-this.height/2,u=this.width,f=this.height;n.beginPath();t.util.drawDashedLine(n,i,r,i+u,r,this.strokeDashArray);t.util.drawDashedLine(n,i+u,r,i+u,r+f,this.strokeDashArray);t.util.drawDashedLine(n,i+u,r+f,i,r+f,this.strokeDashArray);t.util.drawDashedLine(n,i,r+f,i,r,this.strokeDashArray);n.closePath()},toObject:function(n){var t=r(this.callSuper("toObject",n),{rx:this.get("rx")||0,ry:this.get("ry")||0});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(n){var t=this._createBaseSVGMarkup(),i=this.left,r=this.top;return this.group&&this.group.type==="path-group"||(i=-this.width/2,r=-this.height/2),t.push("<rect ",'x="',i,'" y="',r,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'"/>\n'),n?n(t.join("")):t.join("")},complexity:function(){return 1}});t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));t.Rect.fromElement=function(n,i){var u,f;return n?(i=i||{},u=t.parseAttributes(n,t.Rect.ATTRIBUTE_NAMES),u.left=u.left||0,u.top=u.top||0,f=new t.Rect(r(i?t.util.object.clone(i):{},u)),f.visible=f.width>0&&f.height>0,f):null};t.Rect.fromObject=function(n){return new t.Rect(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});if(t.Polyline){t.warn("fabric.Polyline is already defined");return}t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,minX:0,minY:0,initialize:function(n,i){return t.Polygon.prototype.initialize.call(this,n,i)},_calcDimensions:function(){return t.Polygon.prototype._calcDimensions.call(this)},_applyPointOffset:function(){return t.Polygon.prototype._applyPointOffset.call(this)},toObject:function(n){return t.Polygon.prototype.toObject.call(this,n)},toSVG:function(n){return t.Polygon.prototype.toSVG.call(this,n)},_render:function(n){t.Polygon.prototype.commonRender.call(this,n)&&(this._renderFill(n),this._renderStroke(n))},_renderDashedStroke:function(n){var r,u,i,f;for(n.beginPath(),i=0,f=this.points.length;i<f;i++)r=this.points[i],u=this.points[i+1]||r,t.util.drawDashedLine(n,r.x,r.y,u.x,u.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}});t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat();t.Polyline.fromElement=function(n,i){if(!n)return null;i||(i={});var r=t.parsePointsAttribute(n.getAttribute("points")),u=t.parseAttributes(n,t.Polyline.ATTRIBUTE_NAMES);return new t.Polyline(r,t.util.object.extend(u,i))};t.Polyline.fromObject=function(n){var i=n.points;return new t.Polyline(i,n,!0)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.min,u=t.util.array.max,f=t.util.toFixed;if(t.Polygon){t.warn("fabric.Polygon is already defined");return}t.Polygon=t.util.createClass(t.Object,{type:"polygon",points:null,minX:0,minY:0,initialize:function(n,t){t=t||{};this.points=n||[];this.callSuper("initialize",t);this._calcDimensions();"top"in t||(this.top=this.minY);"left"in t||(this.left=this.minX)},_calcDimensions:function(){var n=this.points,t=r(n,"x"),i=r(n,"y"),f=u(n,"x"),e=u(n,"y");this.width=f-t||0;this.height=e-i||0;this.minX=t||0;this.minY=i||0},_applyPointOffset:function(){this.points.forEach(function(n){n.x-=this.minX+this.width/2;n.y-=this.minY+this.height/2},this)},toObject:function(n){return i(this.callSuper("toObject",n),{points:this.points.concat()})},toSVG:function(n){for(var r=[],i=this._createBaseSVGMarkup(),t=0,u=this.points.length;t<u;t++)r.push(f(this.points[t].x,2),",",f(this.points[t].y,2)," ");return i.push("<",this.type," ",'points="',r.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform()," ",this.getSvgTransformMatrix(),'"/>\n'),n?n(i.join("")):i.join("")},_render:function(n){this.commonRender(n)&&(this._renderFill(n),(this.stroke||this.strokeDashArray)&&(n.closePath(),this._renderStroke(n)))},commonRender:function(n){var i,r=this.points.length,t;if(!r||isNaN(this.points[r-1].y))return!1;for(n.beginPath(),this._applyPointOffset&&(this.group&&this.group.type==="path-group"||this._applyPointOffset(),this._applyPointOffset=null),n.moveTo(this.points[0].x,this.points[0].y),t=0;t<r;t++)i=this.points[t],n.lineTo(i.x,i.y);return!0},_renderDashedStroke:function(n){t.Polyline.prototype._renderDashedStroke.call(this,n);n.closePath()},complexity:function(){return this.points.length}});t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat();t.Polygon.fromElement=function(n,r){if(!n)return null;r||(r={});var u=t.parsePointsAttribute(n.getAttribute("points")),f=t.parseAttributes(n,t.Polygon.ATTRIBUTE_NAMES);return new t.Polygon(u,i(f,r))};t.Polygon.fromObject=function(n){return new t.Polygon(n.points,n,!0)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.array.min,r=t.util.array.max,u=t.util.object.extend,e=Object.prototype.toString,f=t.util.drawArc,o={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},s={m:"l",M:"L"};if(t.Path){t.warn("fabric.Path is already defined");return}t.Path=t.util.createClass(t.Object,{type:"path",path:null,minX:0,minY:0,initialize:function(n,t){if(t=t||{},this.setOptions(t),!n)throw new Error("`path` argument is required");var i=e.call(n)==="[object Array]";(this.path=i?n:n.match&&n.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi),this.path)&&(i||(this.path=this._parsePath()),this._setPositionDimensions(),t.sourcePath&&this.setSourcePath(t.sourcePath))},_setPositionDimensions:function(){var n=this._parseDimensions();this.minX=n.left;this.minY=n.top;this.width=n.width;this.height=n.height;n.left+=this.originX==="center"?this.width/2:this.originX==="right"?this.width:0;n.top+=this.originY==="center"?this.height/2:this.originY==="bottom"?this.height:0;this.top=this.top||n.top;this.left=this.left||n.left;this.pathOffset=this.pathOffset||{x:this.minX+this.width/2,y:this.minY+this.height/2}},_render:function(n){var t,l=null,v=0,y=0,i=0,r=0,o=0,s=0,h,c,u=-this.pathOffset.x,e=-this.pathOffset.y,a,p;for(this.group&&this.group.type==="path-group"&&(u=0,e=0),n.beginPath(),a=0,p=this.path.length;a<p;++a){t=this.path[a];switch(t[0]){case"l":i+=t[1];r+=t[2];n.lineTo(i+u,r+e);break;case"L":i=t[1];r=t[2];n.lineTo(i+u,r+e);break;case"h":i+=t[1];n.lineTo(i+u,r+e);break;case"H":i=t[1];n.lineTo(i+u,r+e);break;case"v":r+=t[1];n.lineTo(i+u,r+e);break;case"V":r=t[1];n.lineTo(i+u,r+e);break;case"m":i+=t[1];r+=t[2];v=i;y=r;n.moveTo(i+u,r+e);break;case"M":i=t[1];r=t[2];v=i;y=r;n.moveTo(i+u,r+e);break;case"c":h=i+t[5];c=r+t[6];o=i+t[3];s=r+t[4];n.bezierCurveTo(i+t[1]+u,r+t[2]+e,o+u,s+e,h+u,c+e);i=h;r=c;break;case"C":i=t[5];r=t[6];o=t[3];s=t[4];n.bezierCurveTo(t[1]+u,t[2]+e,o+u,s+e,i+u,r+e);break;case"s":h=i+t[3];c=r+t[4];l[0].match(/[CcSs]/)===null?(o=i,s=r):(o=2*i-o,s=2*r-s);n.bezierCurveTo(o+u,s+e,i+t[1]+u,r+t[2]+e,h+u,c+e);o=i+t[1];s=r+t[2];i=h;r=c;break;case"S":h=t[3];c=t[4];l[0].match(/[CcSs]/)===null?(o=i,s=r):(o=2*i-o,s=2*r-s);n.bezierCurveTo(o+u,s+e,t[1]+u,t[2]+e,h+u,c+e);i=h;r=c;o=t[1];s=t[2];break;case"q":h=i+t[3];c=r+t[4];o=i+t[1];s=r+t[2];n.quadraticCurveTo(o+u,s+e,h+u,c+e);i=h;r=c;break;case"Q":h=t[3];c=t[4];n.quadraticCurveTo(t[1]+u,t[2]+e,h+u,c+e);i=h;r=c;o=t[1];s=t[2];break;case"t":h=i+t[1];c=r+t[2];l[0].match(/[QqTt]/)===null?(o=i,s=r):(o=2*i-o,s=2*r-s);n.quadraticCurveTo(o+u,s+e,h+u,c+e);i=h;r=c;break;case"T":h=t[1];c=t[2];l[0].match(/[QqTt]/)===null?(o=i,s=r):(o=2*i-o,s=2*r-s);n.quadraticCurveTo(o+u,s+e,h+u,c+e);i=h;r=c;break;case"a":f(n,i+u,r+e,[t[1],t[2],t[3],t[4],t[5],t[6]+i+u,t[7]+r+e]);i+=t[6];r+=t[7];break;case"A":f(n,i+u,r+e,[t[1],t[2],t[3],t[4],t[5],t[6]+u,t[7]+e]);i=t[6];r=t[7];break;case"z":case"Z":i=v;r=y;n.closePath()}l=t}this._renderFill(n);this._renderStroke(n)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(n){var t=u(this.callSuper("toObject",n),{path:this.path.map(function(n){return n.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(t.sourcePath=this.sourcePath),this.transformMatrix&&(t.transformMatrix=this.transformMatrix),t},toDatalessObject:function(n){var t=this.toObject(n);return this.sourcePath&&(t.path=this.sourcePath),delete t.sourcePath,t},toSVG:function(n){for(var f,r=[],t=this._createBaseSVGMarkup(),u="",i=0,e=this.path.length;i<e;i++)r.push(this.path[i].join(" "));return f=r.join(" "),this.group&&this.group.type==="path-group"||(u=" translate("+-this.pathOffset.x+", "+-this.pathOffset.y+") "),t.push("<path ",'d="',f,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),u,this.getSvgTransformMatrix(),'" stroke-linecap="round" ',"/>\n"),n?n(t.join("")):t.join("")},complexity:function(){return this.path.length},_parsePath:function(){for(var u,y,i,p,f=[],r=[],e,h,w=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,a,v,c=0,n,b=this.path.length;c<b;c++){for(e=this.path[c],v=e.slice(1).trim(),r.length=0;a=w.exec(v);)r.push(a[0]);for(n=[e.charAt(0)],u=0,y=r.length;u<y;u++)h=parseFloat(r[u]),isNaN(h)||n.push(h);var t=n[0],l=o[t.toLowerCase()],k=s[t]||t;if(n.length-1>l)for(i=1,p=n.length;i<p;i+=l)f.push([t].concat(n.slice(i,i+l))),t=k;else f.push(n)}return f},_parseDimensions:function(){for(var a=[],v=[],n,l=null,y=0,p=0,u=0,f=0,e=0,o=0,h,c,s,w=0,d=this.path.length;w<d;++w){n=this.path[w];switch(n[0]){case"l":u+=n[1];f+=n[2];s=[];break;case"L":u=n[1];f=n[2];s=[];break;case"h":u+=n[1];s=[];break;case"H":u=n[1];s=[];break;case"v":f+=n[1];s=[];break;case"V":f=n[1];s=[];break;case"m":u+=n[1];f+=n[2];y=u;p=f;s=[];break;case"M":u=n[1];f=n[2];y=u;p=f;s=[];break;case"c":h=u+n[5];c=f+n[6];e=u+n[3];o=f+n[4];s=t.util.getBoundsOfCurve(u,f,u+n[1],f+n[2],e,o,h,c);u=h;f=c;break;case"C":u=n[5];f=n[6];e=n[3];o=n[4];s=t.util.getBoundsOfCurve(u,f,n[1],n[2],e,o,u,f);break;case"s":h=u+n[3];c=f+n[4];l[0].match(/[CcSs]/)===null?(e=u,o=f):(e=2*u-e,o=2*f-o);s=t.util.getBoundsOfCurve(u,f,e,o,u+n[1],f+n[2],h,c);e=u+n[1];o=f+n[2];u=h;f=c;break;case"S":h=n[3];c=n[4];l[0].match(/[CcSs]/)===null?(e=u,o=f):(e=2*u-e,o=2*f-o);s=t.util.getBoundsOfCurve(u,f,e,o,n[1],n[2],h,c);u=h;f=c;e=n[1];o=n[2];break;case"q":h=u+n[3];c=f+n[4];e=u+n[1];o=f+n[2];s=t.util.getBoundsOfCurve(u,f,e,o,e,o,h,c);u=h;f=c;break;case"Q":e=n[1];o=n[2];s=t.util.getBoundsOfCurve(u,f,e,o,e,o,n[3],n[4]);u=n[3];f=n[4];break;case"t":h=u+n[1];c=f+n[2];l[0].match(/[QqTt]/)===null?(e=u,o=f):(e=2*u-e,o=2*f-o);s=t.util.getBoundsOfCurve(u,f,e,o,e,o,h,c);u=h;f=c;break;case"T":h=n[1];c=n[2];l[0].match(/[QqTt]/)===null?(e=u,o=f):(e=2*u-e,o=2*f-o);s=t.util.getBoundsOfCurve(u,f,e,o,e,o,h,c);u=h;f=c;break;case"a":s=t.util.getBoundsOfArc(u,f,n[1],n[2],n[3],n[4],n[5],n[6]+u,n[7]+f);u+=n[6];f+=n[7];break;case"A":s=t.util.getBoundsOfArc(u,f,n[1],n[2],n[3],n[4],n[5],n[6],n[7]);u=n[6];f=n[7];break;case"z":case"Z":u=y;f=p}l=n;s.forEach(function(n){a.push(n.x);v.push(n.y)});a.push(u);v.push(f)}var b=i(a),k=i(v),g=r(a),nt=r(v),tt=g-b,it=nt-k;return{left:b,top:k,width:tt,height:it}}});t.Path.fromObject=function(n,i){typeof n.path=="string"?t.loadSVGFromURL(n.path,function(r){var u=r[0],f=n.path;delete n.path;t.util.object.extend(u,n);u.setSourcePath(f);i(u)}):i(new t.Path(n.path,n))};t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]);t.Path.fromElement=function(n,i,r){var f=t.parseAttributes(n,t.Path.ATTRIBUTE_NAMES);i&&i(new t.Path(f.d,u(f,r)))};t.Path.async=!0}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend,r=t.util.array.invoke,u=t.Object.prototype.toObject;if(t.PathGroup){t.warn("fabric.PathGroup is already defined");return}t.PathGroup=t.util.createClass(t.Path,{type:"path-group",fill:"",initialize:function(n,t){t=t||{};this.paths=n||[];for(var i=this.paths.length;i--;)this.paths[i].group=this;t.toBeParsed&&(this.parseDimensionsFromPaths(t),delete t.toBeParsed);this.setOptions(t);this.setCoords();t.sourcePath&&this.setSourcePath(t.sourcePath)},parseDimensionsFromPaths:function(n){for(var u,f,r,s=[],h=[],i,e,o,c=this.transformMatrix,l=this.paths.length;l--;)for(i=this.paths[l],e=i.height+i.strokeWidth,o=i.width+i.strokeWidth,f=[{x:i.left,y:i.top},{x:i.left+o,y:i.top},{x:i.left,y:i.top+e},{x:i.left+o,y:i.top+e}],u=0;u<f.length;u++)r=f[u],c&&(r=t.util.transformPoint(r,c,!1)),s.push(r.x),h.push(r.y);n.width=Math.max.apply(null,s);n.height=Math.max.apply(null,h)},render:function(n){if(this.visible){n.save();this.transformMatrix&&n.transform.apply(n,this.transformMatrix);this.transform(n);this._setShadow(n);this.clipTo&&t.util.clipContext(this,n);n.translate(-this.width/2,-this.height/2);for(var i=0,r=this.paths.length;i<r;++i)this.paths[i].render(n,!0);this.clipTo&&n.restore();this._removeShadow(n);n.restore()}},_set:function(n,t){if(n==="fill"&&t&&this.isSameColor())for(var i=this.paths.length;i--;)this.paths[i]._set(n,t);return this.callSuper("_set",n,t)},toObject:function(n){var t=i(u.call(this,n),{paths:r(this.getObjects(),"toObject",n)});return this.sourcePath&&(t.sourcePath=this.sourcePath),t},toDatalessObject:function(n){var t=this.toObject(n);return this.sourcePath&&(t.paths=this.sourcePath),t},toSVG:function(n){for(var r=this.getObjects(),u=this.getPointByOrigin("left","top"),f="translate("+u.x+" "+u.y+")",t=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransformMatrix(),f,this.getSvgTransform(),'" ',">\n"],i=0,e=r.length;i<e;i++)t.push(r[i].toSVG(n));return t.push("<\/g>\n"),n?n(t.join("")):t.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var n=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(t){return(t.get("fill")||"").toLowerCase()===n})},complexity:function(){return this.paths.reduce(function(n,t){return n+(t&&t.complexity?t.complexity():0)},0)},getObjects:function(){return this.paths}});t.PathGroup.fromObject=function(n,i){typeof n.paths=="string"?t.loadSVGFromURL(n.paths,function(r){var f=n.paths,u;delete n.paths;u=t.util.groupSVGElements(r,n,f);i(u)}):t.util.enlivenObjects(n.paths,function(r){delete n.paths;i(new t.PathGroup(r,n))})};t.PathGroup.async=!0}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),f=t.util.object.extend,i=t.util.array.min,r=t.util.array.max,e=t.util.array.invoke,u;t.Group||(u={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0},t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",initialize:function(n,t){t=t||{};this._objects=n||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;this.originalState={};this.callSuper("initialize");t.originX&&(this.originX=t.originX);t.originY&&(this.originY=t.originY);this._calcBounds();this._updateObjectsCoords();this.callSuper("initialize",t);this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(n){var t=n.getLeft(),i=n.getTop(),r=this.getCenterPoint();n.set({originalLeft:t,originalTop:i,left:t-r.x,top:i-r.y});n.setCoords();n.__origHasControls=n.hasControls;n.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(n){return this._restoreObjectsState(),n&&(this._objects.push(n),n.group=this),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(n){n.set("active",!0);n.group=this},removeWithUpdate:function(n){return this._moveFlippedObject(n),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(n),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(n){n.group=this},_onObjectRemoved:function(n){delete n.group;n.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(n,t){if(n in this.delegatedProperties)for(var i=this._objects.length;i--;)this._objects[i].set(n,t);this.callSuper("_set",n,t)},toObject:function(n){return f(this.callSuper("toObject",n),{objects:e(this._objects,"toObject",n)})},render:function(n){if(this.visible){n.save();this.clipTo&&t.util.clipContext(this,n);this.transform(n);for(var i=0,r=this._objects.length;i<r;i++)this._renderObject(this._objects[i],n);this.clipTo&&n.restore();n.restore()}},_renderControls:function(n,t){this.callSuper("_renderControls",n,t);for(var i=0,r=this._objects.length;i<r;i++)this._objects[i]._renderControls(n)},_renderObject:function(n,t){var i=n.hasRotatingPoint;n.visible&&(n.hasRotatingPoint=!1,n.render(t),n.hasRotatingPoint=i)},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(n){return this._moveFlippedObject(n),this._setObjectPosition(n),n},_moveFlippedObject:function(n){var i=n.get("originX"),r=n.get("originY"),u=n.getCenterPoint(),t;return n.set({originX:"center",originY:"center",left:u.x,top:u.y}),this._toggleFlipping(n),t=n.getPointByOrigin(i,r),n.set({originX:i,originY:r,left:t.x,top:t.y}),this},_toggleFlipping:function(n){this.flipX&&(n.toggle("flipX"),n.set("left",-n.get("left")),n.setAngle(-n.getAngle()));this.flipY&&(n.toggle("flipY"),n.set("top",-n.get("top")),n.setAngle(-n.getAngle()))},_restoreObjectState:function(n){return this._setObjectPosition(n),n.setCoords(),n.hasControls=n.__origHasControls,delete n.__origHasControls,n.set("active",!1),n.setCoords(),delete n.group,this},_setObjectPosition:function(n){var t=this.getCenterPoint(),i=this._getRotatedLeftTop(n);n.set({angle:n.getAngle()+this.getAngle(),left:t.x+i.left,top:t.y+i.top,scaleX:n.get("scaleX")*this.get("scaleX"),scaleY:n.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(n){var t=this.getAngle()*(Math.PI/180);return{left:-Math.sin(t)*n.getTop()*this.get("scaleY")+Math.cos(t)*n.getLeft()*this.get("scaleX"),top:Math.cos(t)*n.getTop()*this.get("scaleY")+Math.sin(t)*n.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(n){n.setCoords()}),this},_calcBounds:function(n){for(var i,f=[],e=[],t,r,o=["tr","br","bl","tl"],u=0,s=this._objects.length;u<s;++u)for(t=this._objects[u],t.setCoords(),i=0;i<o.length;i++)r=o[i],f.push(t.oCoords[r].x),e.push(t.oCoords[r].y);this.set(this._getBounds(f,e,n))},_getBounds:function(n,u,f){var s=t.util.invertTransform(this.getViewportTransform()),o=t.util.transformPoint(new t.Point(i(n),i(u)),s),h=t.util.transformPoint(new t.Point(r(n),r(u)),s),e={width:h.x-o.x||0,height:h.y-o.y||0};return f||(e.left=o.x||0,e.top=o.y||0,this.originX==="center"&&(e.left+=e.width/2),this.originX==="right"&&(e.left+=e.width),this.originY==="center"&&(e.top+=e.height/2),this.originY==="bottom"&&(e.top+=e.height)),e},toSVG:function(n){for(var t=["<g ",'transform="',this.getSvgTransform(),'">\n'],i=0,r=this._objects.length;i<r;i++)t.push(this._objects[i].toSVG(n));return t.push("<\/g>\n"),n?n(t.join("")):t.join("")},get:function(n){if(n in u){if(this[n])return this[n];for(var t=0,i=this._objects.length;t<i;t++)if(this._objects[t][n])return!0;return!1}return n in this.delegatedProperties?this._objects[0]&&this._objects[0].get(n):this[n]}}),t.Group.fromObject=function(n,i){t.util.enlivenObjects(n.objects,function(r){delete n.objects;i&&i(new t.Group(r,n))})},t.Group.async=!0)}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=fabric.util.object.extend;if(n.fabric||(n.fabric={}),n.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",alignX:"none",alignY:"none",meetOrSlice:"meet",_lastScaleX:1,_lastScaleY:1,initialize:function(n,t){t||(t={});this.filters=[];this.resizeFilters=[];this.callSuper("initialize",t);this._initElement(n,t);this._initConfig(t);t.filters&&(this.filters=t.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(n,t,i){return this._element=n,this._originalElement=n,this._initConfig(i),this.filters.length!==0?this.applyFilters(t):t&&t(),this},setCrossOrigin:function(n){return this.crossOrigin=n,this._element.crossOrigin=n,this},getOriginalSize:function(){var n=this.getElement();return{width:n.width,height:n.height}},_stroke:function(n){n.save();this._setStrokeStyles(n);n.beginPath();n.strokeRect(-this.width/2,-this.height/2,this.width,this.height);n.closePath();n.restore()},_renderDashedStroke:function(n){var t=-this.width/2,i=-this.height/2,r=this.width,u=this.height;n.save();this._setStrokeStyles(n);n.beginPath();fabric.util.drawDashedLine(n,t,i,t+r,i,this.strokeDashArray);fabric.util.drawDashedLine(n,t+r,i,t+r,i+u,this.strokeDashArray);fabric.util.drawDashedLine(n,t+r,i+u,t,i+u,this.strokeDashArray);fabric.util.drawDashedLine(n,t,i+u,t,i,this.strokeDashArray);n.closePath();n.restore()},toObject:function(n){return t(this.callSuper("toObject",n),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(n){return n&&n.toObject()}),crossOrigin:this.crossOrigin,alignX:this.alignX,alignY:this.alignY,meetOrSlice:this.meetOrSlice})},toSVG:function(n){var t=[],i=-this.width/2,r=-this.height/2,u="none",f;return this.group&&this.group.type==="path-group"&&(i=this.left,r=this.top),this.alignX!=="none"&&this.alignY!=="none"&&(u="x"+this.alignX+"Y"+this.alignY+" "+this.meetOrSlice),t.push('<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n','<image xlink:href="',this.getSvgSrc(),'" x="',i,'" y="',r,'" style="',this.getSvgStyles(),'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="',u,'"',"><\/image>\n"),(this.stroke||this.strokeDashArray)&&(f=this.fill,this.fill=null,t.push("<rect ",'x="',i,'" y="',r,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'),this.fill=f),t.push("<\/g>\n"),n?n(t.join("")):t.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},setSrc:function(n,t,i){fabric.util.loadImage(n,function(n){return this.setElement(n,t,i)},this,i&&i.crossOrigin)},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(n,t){this.constructor.fromObject(this.toObject(t),n)},applyFilters:function(n,t,i,r){if(t=t||this.filters,i=i||this._originalElement,i){var o=i,u=fabric.util.createCanvasElement(),f=fabric.util.createImage(),e=this;return(u.width=o.width,u.height=o.height,u.getContext("2d").drawImage(o,0,0,o.width,o.height),t.length===0)?(this._element=i,n&&n(),u):(t.forEach(function(n){n&&n.applyTo(u,n.scaleX||e.scaleX,n.scaleY||e.scaleY);!r&&n&&n.type==="Resize"&&(e.width*=n.scaleX,e.height*=n.scaleY)}),f.width=u.width,f.height=u.height,fabric.isLikelyNode?(f.src=u.toBuffer(undefined,fabric.Image.pngCompression),e._element=f,r||(e._filteredEl=f),n&&n()):(f.onload=function(){e._element=f;r||(e._filteredEl=f);n&&n();f.onload=u=o=null},f.src=u.toDataURL("image/png")),u)}},_render:function(n,t){var u,f,i=this._findMargins(),r;u=t?this.left:-this.width/2;f=t?this.top:-this.height/2;this.meetOrSlice==="slice"&&(n.beginPath(),n.rect(u,f,this.width,this.height),n.clip());this.isMoving===!1&&this.resizeFilters.length&&this._needsResize()?(this._lastScaleX=this.scaleX,this._lastScaleY=this.scaleY,r=this.applyFilters(null,this.resizeFilters,this._filteredEl||this._originalElement,!0)):r=this._element;r&&n.drawImage(r,u+i.marginX,f+i.marginY,i.width,i.height);this._renderStroke(n)},_needsResize:function(){return this.scaleX!==this._lastScaleX||this.scaleY!==this._lastScaleY},_findMargins:function(){var n=this.width,t=this.height,i,r,u=0,f=0;return(this.alignX!=="none"||this.alignY!=="none")&&(i=[this.width/this._element.width,this.height/this._element.height],r=this.meetOrSlice==="meet"?Math.min.apply(null,i):Math.max.apply(null,i),n=this._element.width*r,t=this._element.height*r,this.alignX==="Mid"&&(u=(this.width-n)/2),this.alignX==="Max"&&(u=this.width-n),this.alignY==="Mid"&&(f=(this.height-t)/2),this.alignY==="Max"&&(f=this.height-t)),{width:n,height:t,marginX:u,marginY:f}},_resetWidthHeight:function(){var n=this.getElement();this.set("width",n.width);this.set("height",n.height)},_initElement:function(n){this.setElement(fabric.util.getById(n));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(n){n||(n={});this.setOptions(n);this._setWidthHeight(n);this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(n,t){n.filters&&n.filters.length?fabric.util.enlivenObjects(n.filters,function(n){t&&t(n)},"fabric.Image.filters"):t&&t()},_setWidthHeight:function(n){this.width="width"in n?n.width:this.getElement()?this.getElement().width||0:0;this.height="height"in n?n.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(n,t){fabric.util.loadImage(n.src,function(i){fabric.Image.prototype._initFilters.call(n,n,function(r){n.filters=r||[];var u=new fabric.Image(i,n);t&&t(u)})},null,n.crossOrigin)};fabric.Image.fromURL=function(n,t,i){fabric.util.loadImage(n,function(n){t&&t(new fabric.Image(n,i))},null,i&&i.crossOrigin)};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href".split(" "));fabric.Image.fromElement=function(n,i,r){var u=fabric.parseAttributes(n,fabric.Image.ATTRIBUTE_NAMES),f="xMidYMid",e="meet",s,h,o;u.preserveAspectRatio&&(o=u.preserveAspectRatio.split(" "));o&&o.length&&(e=o.pop(),e!=="meet"&&e!=="slice"?(f=e,e="meet"):o.length&&(f=o.pop()));s=f!=="none"?f.slice(1,4):"none";h=f!=="none"?f.slice(5,8):"none";u.alignX=s;u.alignY=h;u.meetOrSlice=e;fabric.Image.fromURL(u["xlink:href"],i,t(r?fabric.util.object.clone(r):{},u))};fabric.Image.async=!0;fabric.Image.pngCompression=1}(typeof exports!="undefined"?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var n=this.getAngle()%360;return n>0?Math.round((n-1)/90)*90:Math.round(n/90)*90},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(n){n=n||{};var i=function(){},r=n.onComplete||i,u=n.onChange||i,t=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(n){t.setAngle(n);u()},onComplete:function(){t.setCoords();r()},onStart:function(){t.set("active",!1)}}),this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(n){return n.straighten(),this.renderAll(),this},fxStraightenObject:function(n){return n.fxStraighten({onChange:this.renderAll.bind(this)}),this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",initialize:function(n){n&&this.setOptions(n)},setOptions:function(n){for(var t in n)this[t]=n[t]},toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Brightness=t.util.createClass(t.Image.filters.BaseFilter,{type:"Brightness",initialize:function(n){n=n||{};this.brightness=n.brightness||0},applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,r=this.brightness,t=0,e=i.length;t<e;t+=4)i[t]+=r,i[t+1]+=r,i[t+2]+=r;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{brightness:this.brightness})}});t.Image.filters.Brightness.fromObject=function(n){return new t.Image.filters.Brightness(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Convolute=t.util.createClass(t.Image.filters.BaseFilter,{type:"Convolute",initialize:function(n){n=n||{};this.opaque=n.opaque;this.matrix=n.matrix||[0,0,0,0,1,0,0,0,0];var i=t.util.createCanvasElement();this.tmpCtx=i.getContext("2d")},_createImageData:function(n,t){return this.tmpCtx.createImageData(n,t)},applyTo:function(n){for(var t,i,r,l,a,u,f,b=this.matrix,k=n.getContext("2d"),v=k.getImageData(0,0,n.width,n.height),e=Math.round(Math.sqrt(b.length)),d=Math.floor(e/2),o=v.data,y=v.width,g=v.height,p=y,nt=g,tt=this._createImageData(p,nt),s=tt.data,ft=this.opaque?1:0,h=0;h<nt;h++)for(t=0;t<p;t++){var et=h,ot=t,c=(h*p+t)*4,it=0,rt=0,ut=0,w=0;for(i=0;i<e;i++)for(r=0;r<e;r++)(l=et+i-d,a=ot+r-d,l<0||l>g||a<0||a>y)||(u=(l*y+a)*4,f=b[i*e+r],it+=o[u]*f,rt+=o[u+1]*f,ut+=o[u+2]*f,w+=o[u+3]*f);s[c]=it;s[c+1]=rt;s[c+2]=ut;s[c+3]=w+ft*(255-w)}k.putImageData(tt,0,0)},toObject:function(){return i(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});t.Image.filters.Convolute.fromObject=function(n){return new t.Image.filters.Convolute(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.GradientTransparency=t.util.createClass(t.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(n){n=n||{};this.threshold=n.threshold||100},applyTo:function(n){for(var r=n.getContext("2d"),u=r.getImageData(0,0,n.width,n.height),i=u.data,e=this.threshold,f=i.length,t=0,o=i.length;t<o;t+=4)i[t+3]=e+255*(f-t)/f;r.putImageData(u,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold})}});t.Image.filters.GradientTransparency.fromObject=function(n){return new t.Image.filters.GradientTransparency(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Grayscale=t.util.createClass(t.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(n){for(var f=n.getContext("2d"),r=f.getImageData(0,0,n.width,n.height),i=r.data,e=r.width*r.height*4,t=0,u;t<e;)u=(i[t]+i[t+1]+i[t+2])/3,i[t]=u,i[t+1]=u,i[t+2]=u,t+=4;f.putImageData(r,0,0)}});t.Image.filters.Grayscale.fromObject=function(){return new t.Image.filters.Grayscale}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Invert=t.util.createClass(t.Image.filters.BaseFilter,{type:"Invert",applyTo:function(n){for(var r=n.getContext("2d"),u=r.getImageData(0,0,n.width,n.height),i=u.data,f=i.length,t=0;t<f;t+=4)i[t]=255-i[t],i[t+1]=255-i[t+1],i[t+2]=255-i[t+2];r.putImageData(u,0,0)}});t.Image.filters.Invert.fromObject=function(){return new t.Image.filters.Invert}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Mask=t.util.createClass(t.Image.filters.BaseFilter,{type:"Mask",initialize:function(n){n=n||{};this.mask=n.mask;this.channel=[0,1,2,3].indexOf(n.channel)>-1?n.channel:0},applyTo:function(n){var o,s;if(this.mask){var e=n.getContext("2d"),u=e.getImageData(0,0,n.width,n.height),h=u.data,i=this.mask.getElement(),f=t.util.createCanvasElement(),c=this.channel,r,l=u.width*u.height*4;for(f.width=i.width,f.height=i.height,f.getContext("2d").drawImage(i,0,0,i.width,i.height),o=f.getContext("2d").getImageData(0,0,i.width,i.height),s=o.data,r=0;r<l;r+=4)h[r+3]=s[r+c];e.putImageData(u,0,0)}},toObject:function(){return i(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});t.Image.filters.Mask.fromObject=function(n,i){t.util.loadImage(n.mask.src,function(r){n.mask=new t.Image(r,n.mask);i&&i(new t.Image.filters.Mask(n))})};t.Image.filters.Mask.async=!0}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Noise=t.util.createClass(t.Image.filters.BaseFilter,{type:"Noise",initialize:function(n){n=n||{};this.noise=n.noise||0},applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,e=this.noise,r,t=0,o=i.length;t<o;t+=4)r=(.5-Math.random())*e,i[t]+=r,i[t+1]+=r,i[t+2]+=r;u.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{noise:this.noise})}});t.Image.filters.Noise.fromObject=function(n){return new t.Image.filters.Noise(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Pixelate=t.util.createClass(t.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(n){n=n||{};this.blocksize=n.blocksize||4},applyTo:function(n){for(var h=n.getContext("2d"),f=h.getImageData(0,0,n.width,n.height),i=f.data,w=f.height,s=f.width,t,u,c,l,a,v,e,y,o,p,r=0;r<w;r+=this.blocksize)for(u=0;u<s;u+=this.blocksize)for(t=r*4*s+u*4,c=i[t],l=i[t+1],a=i[t+2],v=i[t+3],e=r,y=r+this.blocksize;e<y;e++)for(o=u,p=u+this.blocksize;o<p;o++)t=e*4*s+o*4,i[t]=c,i[t+1]=l,i[t+2]=a,i[t+3]=v;h.putImageData(f,0,0)},toObject:function(){return i(this.callSuper("toObject"),{blocksize:this.blocksize})}});t.Image.filters.Pixelate.fromObject=function(n){return new t.Image.filters.Pixelate(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.RemoveWhite=t.util.createClass(t.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(n){n=n||{};this.threshold=n.threshold||30;this.distance=n.distance||20},applyTo:function(n){for(var h=n.getContext("2d"),c=h.getImageData(0,0,n.width,n.height),i=c.data,l=this.threshold,e=this.distance,o=255-l,s=Math.abs,r,u,f,t=0,a=i.length;t<a;t+=4)r=i[t],u=i[t+1],f=i[t+2],r>o&&u>o&&f>o&&s(r-u)<e&&s(r-f)<e&&s(u-f)<e&&(i[t+3]=1);h.putImageData(c,0,0)},toObject:function(){return i(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});t.Image.filters.RemoveWhite.fromObject=function(n){return new t.Image.filters.RemoveWhite(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Sepia=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(n){for(var u=n.getContext("2d"),f=u.getImageData(0,0,n.width,n.height),i=f.data,e=i.length,r,t=0;t<e;t+=4)r=.3*i[t]+.59*i[t+1]+.11*i[t+2],i[t]=r+100,i[t+1]=r+50,i[t+2]=r+255;u.putImageData(f,0,0)}});t.Image.filters.Sepia.fromObject=function(){return new t.Image.filters.Sepia}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={});t.Image.filters.Sepia2=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(n){for(var e=n.getContext("2d"),o=e.getImageData(0,0,n.width,n.height),i=o.data,s=i.length,r,u,f,t=0;t<s;t+=4)r=i[t],u=i[t+1],f=i[t+2],i[t]=(r*.393+u*.769+f*.189)/1.351,i[t+1]=(r*.349+u*.686+f*.168)/1.203,i[t+2]=(r*.272+u*.534+f*.131)/2.14;e.putImageData(o,0,0)}});t.Image.filters.Sepia2.fromObject=function(){return new t.Image.filters.Sepia2}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Tint=t.util.createClass(t.Image.filters.BaseFilter,{type:"Tint",initialize:function(n){n=n||{};this.color=n.color||"#000000";this.opacity=typeof n.opacity!="undefined"?n.opacity:new t.Color(this.color).getAlpha()},applyTo:function(n){var e=n.getContext("2d"),o=e.getImageData(0,0,n.width,n.height),r=o.data,y=r.length,i,s,h,c,l,a,v,u,f;for(f=new t.Color(this.color).getSource(),s=f[0]*this.opacity,h=f[1]*this.opacity,c=f[2]*this.opacity,u=1-this.opacity,i=0;i<y;i+=4)l=r[i],a=r[i+1],v=r[i+2],r[i]=s+l*u,r[i+1]=h+a*u,r[i+2]=c+v*u;e.putImageData(o,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});t.Image.filters.Tint.fromObject=function(n){return new t.Image.filters.Tint(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),i=t.util.object.extend;t.Image.filters.Multiply=t.util.createClass(t.Image.filters.BaseFilter,{type:"Multiply",initialize:function(n){n=n||{};this.color=n.color||"#000000"},applyTo:function(n){for(var f=n.getContext("2d"),e=f.getImageData(0,0,n.width,n.height),r=e.data,o=r.length,u=new t.Color(this.color).getSource(),i=0;i<o;i+=4)r[i]*=u[0]/255,r[i+1]*=u[1]/255,r[i+2]*=u[2]/255;f.putImageData(e,0,0)},toObject:function(){return i(this.callSuper("toObject"),{color:this.color})}});t.Image.filters.Multiply.fromObject=function(n){return new t.Image.filters.Multiply(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric;t.Image.filters.Blend=t.util.createClass({type:"Blend",initialize:function(n){n=n||{};this.color=n.color||"#000";this.image=n.image||!1;this.mode=n.mode||"multiply";this.alpha=n.alpha||1},applyTo:function(n){var w=n.getContext("2d"),b=w.getImageData(0,0,n.width,n.height),r=b.data,u,f,e,o,s,h,v,y,p,c,k=!1,a,l,d,i,g;for(this.image?(k=!0,a=t.util.createCanvasElement(),a.width=this.image.width,a.height=this.image.height,l=new t.StaticCanvas(a),l.add(this.image),d=l.getContext("2d"),c=d.getImageData(0,0,l.width,l.height).data):(c=new t.Color(this.color).getSource(),u=c[0]*this.alpha,f=c[1]*this.alpha,e=c[2]*this.alpha),i=0,g=r.length;i<g;i+=4){o=r[i];s=r[i+1];h=r[i+2];k&&(u=c[i]*this.alpha,f=c[i+1]*this.alpha,e=c[i+2]*this.alpha);switch(this.mode){case"multiply":r[i]=o*u/255;r[i+1]=s*f/255;r[i+2]=h*e/255;break;case"screen":r[i]=1-(1-o)*(1-u);r[i+1]=1-(1-s)*(1-f);r[i+2]=1-(1-h)*(1-e);break;case"add":r[i]=Math.min(255,o+u);r[i+1]=Math.min(255,s+f);r[i+2]=Math.min(255,h+e);break;case"diff":case"difference":r[i]=Math.abs(o-u);r[i+1]=Math.abs(s-f);r[i+2]=Math.abs(h-e);break;case"subtract":v=o-u;y=s-f;p=h-e;r[i]=v<0?0:v;r[i+1]=y<0?0:y;r[i+2]=p<0?0:p;break;case"darken":r[i]=Math.min(o,u);r[i+1]=Math.min(s,f);r[i+2]=Math.min(h,e);break;case"lighten":r[i]=Math.max(o,u);r[i+1]=Math.max(s,f);r[i+2]=Math.max(h,e)}}w.putImageData(b,0,0)},toObject:function(){return{color:this.color,image:this.image,mode:this.mode,alpha:this.alpha}}});t.Image.filters.Blend.fromObject=function(n){return new t.Image.filters.Blend(n)}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var i=n.fabric||(n.fabric={}),e=Math.pow,t=Math.floor,o=Math.sqrt,r=Math.abs,u=Math.max,s=Math.round,h=Math.sin,f=Math.ceil;i.Image.filters.Resize=i.util.createClass(i.Image.filters.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:0,scaleY:0,lanczosLobes:3,applyTo:function(n,t,i){this.rcpScaleX=1/t;this.rcpScaleY=1/i;var r=n.width,u=n.height,f=s(r*t),e=s(u*i),o;this.resizeType==="sliceHack"&&(o=this.sliceByTwo(n,r,u,f,e));this.resizeType==="hermite"&&(o=this.hermiteFastResize(n,r,u,f,e));this.resizeType==="bilinear"&&(o=this.bilinearFiltering(n,r,u,f,e));this.resizeType==="lanczos"&&(o=this.lanczosResize(n,r,u,f,e));n.width=f;n.height=e;n.getContext("2d").putImageData(o,0,0)},sliceByTwo:function(n,r,f,e,o){var c=n.getContext("2d"),l,v=.5,y=.5,p=1,w=1,b=!1,k=!1,s=r,h=f,a=i.util.createCanvasElement(),d=a.getContext("2d");for(e=t(e),o=t(o),a.width=u(e,r),a.height=u(o,f),e>r&&(v=2,p=-1),o>f&&(y=2,w=-1),l=c.getImageData(0,0,r,f),n.width=u(e,r),n.height=u(o,f),c.putImageData(l,0,0);!b||!k;)r=s,f=h,e*p<t(s*v*p)?s=t(s*v):(s=e,b=!0),o*w<t(h*y*w)?h=t(h*y):(h=o,k=!0),l=c.getImageData(0,0,r,f),d.putImageData(l,0,0),c.clearRect(0,0,s,h),c.drawImage(a,0,0,r,f,0,0,s,h);return c.getImageData(0,0,e,o)},lanczosResize:function(n,i,u,s,c){function it(n){return function(t){if(t>n)return 0;if(t*=Math.PI,r(t)<1e-16)return 1;var i=t/n;return h(t)*h(i)/t/i}}function w(n){var st,h,b,f,ot,ct,lt,at,vt,it,ht,rt;for(l.x=(n+.5)*d,a.x=t(l.x),st=0;st<c;st++){for(l.y=(st+.5)*g,a.y=t(l.y),ot=0,ct=0,lt=0,at=0,vt=0,h=a.x-nt;h<=a.x+nt;h++)if(!(h<0)&&!(h>=i))for(it=t(1e3*r(h-l.x)),v[it]||(v[it]={}),rt=a.y-tt;rt<=a.y+tt;rt++)rt<0||rt>=u||(ht=t(1e3*r(rt-l.y)),v[it][ht]||(v[it][ht]=ut(o(e(it*ft,2)+e(ht*et,2))/1e3)),b=v[it][ht],b>0&&(f=(rt*i+h)*4,ot+=b,ct+=b*y[f],lt+=b*y[f+1],at+=b*y[f+2],vt+=b*y[f+3]));f=(st*s+n)*4;p[f]=ct/ot;p[f+1]=lt/ot;p[f+2]=at/ot;p[f+3]=vt/ot}return++n<s?w(n):k}var b=n.getContext("2d"),rt=b.getImageData(0,0,i,u),k=b.getImageData(0,0,s,c),y=rt.data,p=k.data,ut=it(this.lanczosLobes),d=this.rcpScaleX,g=this.rcpScaleY,ft=2/this.rcpScaleX,et=2/this.rcpScaleY,nt=f(d*this.lanczosLobes/2),tt=f(g*this.lanczosLobes/2),v={},l={},a={};return w(0)},bilinearFiltering:function(n,i,r,u,f){for(var p,w,b,k,v,y,s,h,c,e,d,ut=0,l,g=this.rcpScaleX,nt=this.rcpScaleY,tt=n.getContext("2d"),it=4*(i-1),ft=tt.getImageData(0,0,i,r),a=ft.data,rt=tt.getImageData(0,0,u,f),et=rt.data,o=0;o<f;o++)for(s=0;s<u;s++)for(v=t(g*s),y=t(nt*o),h=g*s-v,c=nt*o-y,l=4*(y*i+v),e=0;e<4;e++)p=a[l+e],w=a[l+4+e],b=a[l+it+e],k=a[l+it+4+e],d=p*(1-h)*(1-c)+w*h*(1-c)+b*c*(1-h)+k*h*c,et[ut++]=d;return rt},hermiteFastResize:function(n,i,u,e,s){for(var a,p,w,c,l,b=this.rcpScaleX,k=this.rcpScaleY,ht=f(b/2),ct=f(k/2),tt=n.getContext("2d"),lt=tt.getImageData(0,0,i,u),v=lt.data,it=tt.getImageData(0,0,e,s),d=it.data,y=0;y<s;y++)for(a=0;a<e;a++){var g=(a+y*e)*4,h=0,nt=0,rt=0,ut=0,ft=0,et=0,ot=0,at=(y+.5)*k;for(p=t(y*k);p<(y+1)*k;p++){var st=r(at-(p+.5))/ct,vt=(a+.5)*b,yt=st*st;for(w=t(a*b);w<(a+1)*b;w++)(c=r(vt-(w+.5))/ht,l=o(yt+c*c),l>1&&l<-1)||(h=2*l*l*l-3*l*l+1,h>0&&(c=4*(w+p*i),ot+=h*v[c+3],rt+=h,v[c+3]<255&&(h=h*v[c+3]/250),ut+=h*v[c],ft+=h*v[c+1],et+=h*v[c+2],nt+=h))}d[g]=ut/nt;d[g+1]=ft/nt;d[g+2]=et/nt;d[g+3]=ot/rt}return it},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaley:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}});i.Image.filters.Resize.fromObject=function(){return new i.Image.filters.Resize}}(typeof exports!="undefined"?exports:this),function(n){"use strict";var t=n.fabric||(n.fabric={}),u=t.util.object.extend,f=t.util.object.clone,i=t.util.toFixed,e=t.StaticCanvas.supports("setLineDash"),r;if(t.Text){t.warn("fabric.Text is already defined");return}r=t.Object.prototype.stateProperties.concat();r.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor");t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0,textAlign:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.16,textBackgroundColor:"",stateProperties:r,stroke:null,shadow:null,_fontSizeFraction:.25,_fontSizeMult:1.13,initialize:function(n,t){t=t||{};this.text=n;this.__skipDimension=!0;this.setOptions(t);this.__skipDimension=!1;this._initDimensions()},_initDimensions:function(n){if(!this.__skipDimension){n||(n=t.util.createCanvasElement().getContext("2d"),this._setTextStyles(n));this._textLines=this.text.split(this._reNewline);this._clearCache();var i=this.textAlign;this.textAlign="left";this.width=this._getTextWidth(n);this.textAlign=i;this.height=this._getTextHeight(n)}},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(n){this.clipTo&&t.util.clipContext(this,n);this._renderTextBackground(n);this._renderText(n);this._renderTextDecoration(n);this.clipTo&&n.restore()},_renderText:function(n){n.save();this._translateForTextAlign(n);this._setOpacity(n);this._setShadow(n);this._setupCompositeOperation(n);this._renderTextFill(n);this._renderTextStroke(n);this._restoreCompositeOperation(n);this._removeShadow(n);n.restore()},_translateForTextAlign:function(n){this.textAlign!=="left"&&this.textAlign!=="justify"&&n.translate(this.textAlign==="center"?this.width/2:this.width,0)},_setTextStyles:function(n){n.textBaseline="alphabetic";this.skipTextAlign||(n.textAlign=this.textAlign);n.font=this._getFontDeclaration()},_getTextHeight:function(){return this._textLines.length*this._getHeightOfLine()},_getTextWidth:function(n){for(var r,t=this._getLineWidth(n,0),i=1,u=this._textLines.length;i<u;i++)r=this._getLineWidth(n,i),r>t&&(t=r);return t},_renderChars:function(n,t,i,r,u){t[n](i,r,u)},_renderTextLine:function(n,t,i,r,u,f){var h,s,e,l;if(u-=this.fontSize*this._fontSizeFraction,this.textAlign!=="justify"){this._renderChars(n,t,i,r,u,f);return}if(h=this._getLineWidth(t,f),s=this.width,s>=h){var o=i.split(/\s+/),a=this._getWidthOfWords(t,i,f),v=s-a,y=o.length-1,p=v/y,c=0;for(e=0,l=o.length;e<l;e++)this._renderChars(n,t,o[e],r+c,u,f),c+=t.measureText(o[e]).width+p}else this._renderChars(n,t,i,r,u,f)},_getWidthOfWords:function(n,t){return n.measureText(t.replace(/\s+/g,"")).width},_getLeftOffset:function(){return-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(n){var i,t,u,r,f;if(this.fill||this._skipFillStrokeCheck){for(i=0,t=0,u=this._textLines.length;t<u;t++)r=this._getHeightOfLine(n,t),f=r/this.lineHeight,this._renderTextLine("fillText",n,this._textLines[t],this._getLeftOffset(),this._getTopOffset()+i+f,t),i+=r;this.shadow&&!this.shadow.affectStroke&&this._removeShadow(n)}},_renderTextStroke:function(n){var i,t,u,r,f;if(this.stroke&&this.strokeWidth!==0||this._skipFillStrokeCheck){for(i=0,n.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),e&&n.setLineDash(this.strokeDashArray)),n.beginPath(),t=0,u=this._textLines.length;t<u;t++)r=this._getHeightOfLine(n,t),f=r/this.lineHeight,this._renderTextLine("strokeText",n,this._textLines[t],this._getLeftOffset(),this._getTopOffset()+i+f,t),i+=r;n.closePath();n.restore()}},_getHeightOfLine:function(){return this.fontSize*this._fontSizeMult*this.lineHeight},_renderTextBackground:function(n){this._renderTextBoxBackground(n);this._renderTextLinesBackground(n)},_renderTextBoxBackground:function(n){this.backgroundColor&&(n.save(),n.fillStyle=this.backgroundColor,n.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),n.restore())},_renderTextLinesBackground:function(n){var r=0,e=this._getHeightOfLine(),t,u,i,f;if(this.textBackgroundColor){for(n.save(),n.fillStyle=this.textBackgroundColor,t=0,u=this._textLines.length;t<u;t++)this._textLines[t]!==""&&(i=this._getLineWidth(n,t),f=this._getLineLeftOffset(i),n.fillRect(this._getLeftOffset()+f,this._getTopOffset()+r,i,this.fontSize*this._fontSizeMult)),r+=e;n.restore()}},_getLineLeftOffset:function(n){return this.textAlign==="center"?(this.width-n)/2:this.textAlign==="right"?this.width-n:0},_clearCache:function(){this.__lineWidths=[];this.__lineHeights=[];this.__lineOffsets=[]},_shouldClearCache:function(){var t=!1;for(var n in this._dimensionAffectingProps)this["__"+n]!==this[n]&&(this["__"+n]=this[n],t=!0);return t},_getLineWidth:function(n,t){return this.__lineWidths[t]?this.__lineWidths[t]:(this.__lineWidths[t]=n.measureText(this._textLines[t]).width,this.__lineWidths[t])},_renderTextDecoration:function(n){function u(i){for(var e=0,f,s,u=0,o=t._textLines.length;u<o;u++){var h=t._getLineWidth(n,u),c=t._getLineLeftOffset(h),l=t._getHeightOfLine(n,u);for(f=0,s=i.length;f<s;f++)n.fillRect(t._getLeftOffset()+c,e+(t._fontSizeMult-1+i[f])*t.fontSize-r,h,t.fontSize/15);e+=l}}if(this.textDecoration){var r=this.height/2,t=this,i=[];this.textDecoration.indexOf("underline")>-1&&i.push(.85);this.textDecoration.indexOf("line-through")>-1&&i.push(.43);this.textDecoration.indexOf("overline")>-1&&i.push(-.12);i.length>0&&u(i)}},_getFontDeclaration:function(){return[t.isLikelyNode?this.fontWeight:this.fontStyle,t.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",t.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(n,t){this.visible&&(n.save(),this._setTextStyles(n),this._shouldClearCache()&&this._initDimensions(n),t||this.transform(n),this._setStrokeStyles(n),this._setFillStyles(n),this.transformMatrix&&n.transform.apply(n,this.transformMatrix),this.group&&this.group.type==="path-group"&&n.translate(this.left,this.top),this._render(n),n.restore())},toObject:function(n){var t=u(this.callSuper("toObject",n),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,textBackgroundColor:this.textBackgroundColor});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(n){var t=this._createBaseSVGMarkup(),i=this._getSVGLeftTopOffsets(this.ctx),r=this._getSVGTextAndBg(i.textTop,i.textLeft);return this._wrapSVGTextAndBg(t,r),n?n(t.join("")):t.join("")},_getSVGLeftTopOffsets:function(n){var t=this._getHeightOfLine(n,0),i=-this.width/2;return{textLeft:i+(this.group&&this.group.type==="path-group"?this.left:0),textTop:0+(this.group&&this.group.type==="path-group"?-this.top:0),lineTop:t}},_wrapSVGTextAndBg:function(n,t){n.push('\t<g transform="',this.getSvgTransform(),this.getSvgTransformMatrix(),'">\n',t.textBgRects.join(""),"\t\t<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" >',t.textSpans.join(""),"<\/text>\n","\t<\/g>\n")},_getSVGTextAndBg:function(n,t){var f=[],r=[],u=0,i,e;for(this._setSVGBg(r),i=0,e=this._textLines.length;i<e;i++)this.textBackgroundColor&&this._setSVGTextLineBg(r,i,t,n,u),this._setSVGTextLineText(i,f,u,t,n,r),u+=this._getHeightOfLine(this.ctx,i);return{textSpans:f,textBgRects:r}},_setSVGTextLineText:function(n,r,u,f,e){var o=this.fontSize*(this._fontSizeMult-this._fontSizeFraction)-e+u-this.height/2;r.push('<tspan x="',i(f+this._getLineLeftOffset(this.__lineWidths[n]),4),'" ','y="',i(o,4),'" ',this._getFillAttributes(this.fill),">",t.util.string.escapeXml(this._textLines[n]),"<\/tspan>")},_setSVGTextLineBg:function(n,t,r,u,f){n.push("\t\t<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',i(r+this._getLineLeftOffset(this.__lineWidths[t]),4),'" y="',i(f-this.height/2,4),'" width="',i(this.__lineWidths[t],4),'" height="',i(this._getHeightOfLine(this.ctx,t)/this.lineHeight,4),'"><\/rect>\n')},_setSVGBg:function(n){this.backgroundColor&&n.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',i(-this.width/2,4),'" y="',i(-this.height/2,4),'" width="',i(this.width,4),'" height="',i(this.height,4),'"><\/rect>\n')},_getFillAttributes:function(n){var i=n&&typeof n=="string"?new t.Color(n):"";return!i||!i.getSource()||i.getAlpha()===1?'fill="'+n+'"':'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_set:function(n,t){this.callSuper("_set",n,t);n in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}});t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" "));t.Text.DEFAULT_SVG_FONT_SIZE=16;t.Text.fromElement=function(n,i){var u;if(!n)return null;u=t.parseAttributes(n,t.Text.ATTRIBUTE_NAMES);i=t.util.object.extend(i?t.util.object.clone(i):{},u);i.top=i.top||0;i.left=i.left||0;"dx"in u&&(i.left+=u.dx);"dy"in u&&(i.top+=u.dy);"fontSize"in i||(i.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE);i.originX||(i.originX="left");var e=n.textContent.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),r=new t.Text(e,i),f=0;return r.originX==="left"&&(f=r.getWidth()/2),r.originX==="right"&&(f=-r.getWidth()/2),r.set({left:r.getLeft()+f,top:r.getTop()-r.getHeight()/2+r.fontSize*(.18+r._fontSizeFraction)}),r};t.Text.fromObject=function(n){return new t.Text(n.text,f(n))};t.util.createAccessors(t.Text)}(typeof exports!="undefined"?exports:this),function(){var n=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!1,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(n,t){this.styles=t?t.styles||{}:{};this.callSuper("initialize",n,t);this.initBehavior()},_clearCache:function(){this.callSuper("_clearCache");this.__maxFontHeights=[];this.__widthOfSpace=[]},isEmptyStyles:function(){var n,t,i,r;if(!this.styles)return!0;n=this.styles;for(t in n)for(i in n[t])for(r in n[t][i])return!1;return!0},setSelectionStart:function(n){n=Math.max(n,0);this.selectionStart!==n&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionStart=n);this._updateTextarea()},setSelectionEnd:function(n){n=Math.min(n,this.text.length);this.selectionEnd!==n&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this}),this.selectionEnd=n);this._updateTextarea()},getSelectionStyles:function(n,t){var u,i,r;if(arguments.length===2){for(u=[],i=n;i<t;i++)u.push(this.getSelectionStyles(i));return u}return(r=this.get2DCursorLocation(n),this.styles[r.lineIndex])?this.styles[r.lineIndex][r.charIndex]||{}:{}},setSelectionStyles:function(n){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,n);else for(var t=this.selectionStart;t<this.selectionEnd;t++)this._extendStyles(t,n);return this._clearCache(),this},_extendStyles:function(n,t){var i=this.get2DCursorLocation(n);this.styles[i.lineIndex]||(this.styles[i.lineIndex]={});this.styles[i.lineIndex][i.charIndex]||(this.styles[i.lineIndex][i.charIndex]={});fabric.util.object.extend(this.styles[i.lineIndex][i.charIndex],t)},_render:function(n){this.callSuper("_render",n);this.ctx=n;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(this.active){var i=this.text.split(""),t,n;this.canvas.contextTop?(n=this.canvas.contextTop,n.save(),n.transform.apply(n,this.canvas.viewportTransform),this.transform(n)):(n=this.ctx,n.save());this.selectionStart===this.selectionEnd?(t=this._getCursorBoundaries(i,"cursor"),this.renderCursor(t,n)):(t=this._getCursorBoundaries(i,"selection"),this.renderSelection(i,t,n));n.restore()}},get2DCursorLocation:function(n){typeof n=="undefined"&&(n=this.selectionStart);var i=this.text.slice(0,n),t=i.split(this._reNewline);return{lineIndex:t.length-1,charIndex:t[t.length-1].length}},getCurrentCharStyle:function(n,t){var i=this.styles[n]&&this.styles[n][t===0?0:t-1];return{fontSize:i&&i.fontSize||this.fontSize,fill:i&&i.fill||this.fill,textBackgroundColor:i&&i.textBackgroundColor||this.textBackgroundColor,textDecoration:i&&i.textDecoration||this.textDecoration,fontFamily:i&&i.fontFamily||this.fontFamily,fontWeight:i&&i.fontWeight||this.fontWeight,fontStyle:i&&i.fontStyle||this.fontStyle,stroke:i&&i.stroke||this.stroke,strokeWidth:i&&i.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(n,t){return this.styles[n]&&this.styles[n][t===0?0:t-1]&&this.styles[n][t===0?0:t-1].fontSize||this.fontSize},getCurrentCharColor:function(n,t){return this.styles[n]&&this.styles[n][t===0?0:t-1]&&this.styles[n][t===0?0:t-1].fill||this.cursorColor},_getCursorBoundaries:function(n,t){var r=Math.round(this._getLeftOffset()),u=this._getTopOffset(),i=this._getCursorBoundariesOffsets(n,t);return{left:r,top:u,leftOffset:i.left+i.lineLeft,topOffset:i.top}},_getCursorBoundariesOffsets:function(n,t){for(var o=0,i=0,r=0,f=0,e=0,u=0;u<this.selectionStart;u++)n[u]==="\n"?(e=0,f+=this._getHeightOfLine(this.ctx,i),i++,r=0):(e+=this._getWidthOfChar(this.ctx,n[u],i,r),r++),o=this._getCachedLineOffset(i);return t==="cursor"&&(f+=(1-this._fontSizeFraction)*this._getHeightOfLine(this.ctx,i)/this.lineHeight-this.getCurrentCharFontSize(i,r)*(1-this._fontSizeFraction)),{top:f,left:e,lineLeft:o}},_getCachedLineOffset:function(n){var t=this._getLineWidth(this.ctx,n);return this.__lineOffsets[n]||(this.__lineOffsets[n]=this._getLineLeftOffset(t))},renderCursor:function(n,t){var u=this.get2DCursorLocation(),i=u.lineIndex,r=u.charIndex,f=this.getCurrentCharFontSize(i,r),e=i===0&&r===0?this._getCachedLineOffset(i):n.leftOffset;t.fillStyle=this.getCurrentCharColor(i,r);t.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;t.fillRect(n.left+e,n.top+n.topOffset,this.cursorWidth/this.scaleX,f)},renderSelection:function(n,t,i){var r,u,y,f,p;i.fillStyle=this.selectionColor;var h=this.get2DCursorLocation(this.selectionStart),c=this.get2DCursorLocation(this.selectionEnd),l=h.lineIndex,e=c.lineIndex;for(r=l;r<=e;r++){var a=this._getCachedLineOffset(r)||0,v=this._getHeightOfLine(this.ctx,r),o=0,s=this._textLines[r];if(r===l)for(u=0,y=s.length;u<y;u++)u>=h.charIndex&&(r!==e||u<c.charIndex)&&(o+=this._getWidthOfChar(i,s[u],r,u)),u<h.charIndex&&(a+=this._getWidthOfChar(i,s[u],r,u));else if(r>l&&r<e)o+=this._getLineWidth(i,r)||5;else if(r===e)for(f=0,p=c.charIndex;f<p;f++)o+=this._getWidthOfChar(i,s[f],r,f);i.fillRect(t.left+a,t.top+t.topOffset,o,v);t.topOffset+=v}},_renderChars:function(n,t,i,r,u,f){var e,h,c;if(this.isEmptyStyles())return this._renderCharsFast(n,t,i,r,u);this.skipTextAlign=!0;r-=this.textAlign==="center"?this.width/2:this.textAlign==="right"?this.width:0;var l=this._getHeightOfLine(t,f),v=this._getCachedLineOffset(f),a=i.split(""),o,s="";for(r+=v||0,t.save(),u-=l/this.lineHeight*this._fontSizeFraction,e=0,h=a.length;e<=h;e++)o=o||this.getCurrentCharStyle(f,e),c=this.getCurrentCharStyle(f,e+1),(this._hasStyleChanged(o,c)||e===h)&&(this._renderChar(n,t,f,e-1,s,r,u,l),s="",o=c),s+=a[e];t.restore()},_renderCharsFast:function(n,t,i,r,u){this.skipTextAlign=!1;n==="fillText"&&this.fill&&this.callSuper("_renderChars",n,t,i,r,u);n==="strokeText"&&(this.stroke&&this.strokeWidth>0||this.skipFillStrokeCheck)&&this.callSuper("_renderChars",n,t,i,r,u)},_renderChar:function(n,t,i,r,u,f,e,o){var s,h,c,l=this._fontSizeFraction*o/this.lineHeight,a,v;this.styles&&this.styles[i]&&(s=this.styles[i][r])?(a=s.stroke||this.stroke,v=s.fill||this.fill,t.save(),h=this._applyCharStylesGetWidth(t,u,i,r,s),c=this._getHeightOfChar(t,u,i,r),v&&t.fillText(u,f,e),a&&t.strokeText(u,f,e),this._renderCharDecoration(t,s,f,e,l,h,c),t.restore(),t.translate(h,0)):(n==="strokeText"&&this.stroke&&t[n](u,f,e),n==="fillText"&&this.fill&&t[n](u,f,e),h=this._applyCharStylesGetWidth(t,u,i,r),this._renderCharDecoration(t,null,f,e,l,h,this.fontSize),t.translate(t.measureText(u).width,0))},_hasStyleChanged:function(n,t){return n.fill!==t.fill||n.fontSize!==t.fontSize||n.textBackgroundColor!==t.textBackgroundColor||n.textDecoration!==t.textDecoration||n.fontFamily!==t.fontFamily||n.fontWeight!==t.fontWeight||n.fontStyle!==t.fontStyle||n.stroke!==t.stroke||n.strokeWidth!==t.strokeWidth},_renderCharDecoration:function(n,t,i,r,u,f,e){var o=t?t.textDecoration||this.textDecoration:this.textDecoration;o&&(o.indexOf("underline")>-1&&n.fillRect(i,r+e/10,f,e/15),o.indexOf("line-through")>-1&&n.fillRect(i,r-e*(this._fontSizeFraction+this._fontSizeMult-1)+e/15,f,e/15),o.indexOf("overline")>-1&&n.fillRect(i,r-(this._fontSizeMult-this._fontSizeFraction)*e,f,e/15))},_renderTextLine:function(n,t,i,r,u,f){this.isEmptyStyles()||(u+=this.fontSize*(this._fontSizeFraction+.03));this.callSuper("_renderTextLine",n,t,i,r,u,f)},_renderTextDecoration:function(n){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",n)},_renderTextLinesBackground:function(n){var r,t,e,u,o,f,i,s,h;if(this.textBackgroundColor||this.styles){for(n.save(),this.textBackgroundColor&&(n.fillStyle=this.textBackgroundColor),r=0,t=0,e=this._textLines.length;t<e;t++){if(u=this._getHeightOfLine(n,t),this._textLines[t]===""){r+=u;continue}if(o=this._getLineWidth(n,t),f=this._getCachedLineOffset(t),this.textBackgroundColor&&(n.fillStyle=this.textBackgroundColor,n.fillRect(this._getLeftOffset()+f,this._getTopOffset()+r,o,u/this.lineHeight)),this.styles[t])for(i=0,s=this._textLines[t].length;i<s;i++)this.styles[t]&&this.styles[t][i]&&this.styles[t][i].textBackgroundColor&&(h=this._textLines[t][i],n.fillStyle=this.styles[t][i].textBackgroundColor,n.fillRect(this._getLeftOffset()+f+this._getWidthOfCharsAt(n,t,i),this._getTopOffset()+r,this._getWidthOfChar(n,h,t,i)+1,u/this.lineHeight));r+=u}n.restore()}},_getCacheProp:function(n,t){return n+t.fontFamily+t.fontSize+t.fontWeight+t.fontStyle+t.shadow},_applyCharStylesGetWidth:function(t,i,r,u,f){var e=f||this.styles[r]&&this.styles[r][u],o,s;return(e=e?n(e):{},this._applyFontStyles(e),o=this._getCacheProp(i,e),this.isEmptyStyles()&&this._charWidthsCache[o]&&this.caching)?this._charWidthsCache[o]:(typeof e.shadow=="string"&&(e.shadow=new fabric.Shadow(e.shadow)),s=e.fill||this.fill,t.fillStyle=s.toLive?s.toLive(t,this):s,e.stroke&&(t.strokeStyle=e.stroke&&e.stroke.toLive?e.stroke.toLive(t,this):e.stroke),t.lineWidth=e.strokeWidth||this.strokeWidth,t.font=this._getFontDeclaration.call(e),this._setShadow.call(e,t),!this.caching)?t.measureText(i).width:(this._charWidthsCache[o]||(this._charWidthsCache[o]=t.measureText(i).width),this._charWidthsCache[o])},_applyFontStyles:function(n){n.fontFamily||(n.fontFamily=this.fontFamily);n.fontSize||(n.fontSize=this.fontSize);n.fontWeight||(n.fontWeight=this.fontWeight);n.fontStyle||(n.fontStyle=this.fontStyle)},_getStyleDeclaration:function(t,i){return this.styles[t]&&this.styles[t][i]?n(this.styles[t][i]):{}},_getWidthOfChar:function(n,t,i,r){var u,f,e;return this.textAlign==="justify"&&/\s/.test(t)?this._getWidthOfSpace(n,i):(u=this._getStyleDeclaration(i,r),this._applyFontStyles(u),f=this._getCacheProp(t,u),this._charWidthsCache[f]&&this.caching)?this._charWidthsCache[f]:n?(n.save(),e=this._applyCharStylesGetWidth(n,t,i,r),n.restore(),e):void 0},_getHeightOfChar:function(n,t,i,r){return this.styles[i]&&this.styles[i][r]?this.styles[i][r].fontSize||this.fontSize:this.fontSize},_getHeightOfCharAt:function(n,t,i){var r=this._textLines[t][i];return this._getHeightOfChar(n,r,t,i)},_getWidthOfCharsAt:function(n,t,i){for(var u=0,f,r=0;r<i;r++)f=this._textLines[t][r],u+=this._getWidthOfChar(n,f,t,r);return u},_getLineWidth:function(n,t){return this.__lineWidths[t]?this.__lineWidths[t]:(this.__lineWidths[t]=this._getWidthOfCharsAt(n,t,this._textLines[t].length),this.__lineWidths[t])},_getWidthOfSpace:function(n,t){if(this.__widthOfSpace[t])return this.__widthOfSpace[t];var i=this._textLines[t],u=this._getWidthOfWords(n,i,t),f=this.width-u,e=i.length-i.replace(/\s+/g,"").length,r=f/e;return this.__widthOfSpace[t]=r,r},_getWidthOfWords:function(n,t,i){for(var u,f=0,r=0;r<t.length;r++)u=t[r],u.match(/\s/)||(f+=this._getWidthOfChar(n,u,i,r));return f},_getHeightOfLine:function(n,t){var u,i,r,e,f;if(this.__lineHeights[t])return this.__lineHeights[t];for(u=this._textLines[t],i=this._getHeightOfChar(n,u[0],t,0),r=1,e=u.length;r<e;r++)f=this._getHeightOfChar(n,u[r],t,r),f>i&&(i=f);return this.__maxFontHeights[t]=i,this.__lineHeights[t]=i*this.lineHeight*this._fontSizeMult,this.__lineHeights[t]},_getTextHeight:function(n){for(var i=0,t=0,r=this._textLines.length;t<r;t++)i+=this._getHeightOfLine(n,t);return i},_renderTextBoxBackground:function(n){this.backgroundColor&&(n.save(),n.fillStyle=this.backgroundColor,n.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),n.restore())},toObject:function(t){return fabric.util.object.extend(this.callSuper("toObject",t),{styles:n(this.styles)})}});fabric.IText.fromObject=function(t){return new fabric.IText(t.text,n(t))}}(),function(){var n=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initRemovedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var n=this;setTimeout(function(){n.selected=!0},100)})},initAddedHandler:function(){var n=this;this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers());n.canvas&&(n.canvas._iTextInstances=n.canvas._iTextInstances||[],n.canvas._iTextInstances.push(n))})},initRemovedHandler:function(){var n=this;this.on("removed",function(){n.canvas&&(n.canvas._iTextInstances=n.canvas._iTextInstances||[],fabric.util.removeFromArray(n.canvas._iTextInstances,n))})},_initCanvasHandlers:function(){var n=this;this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers(n.canvas)});this.canvas.on("mouse:up",function(){n.canvas._iTextInstances&&n.canvas._iTextInstances.forEach(function(n){n.__isMousedown=!1})});this.canvas.on("object:selected",function(){fabric.IText.prototype.exitEditingOnOthers(n.canvas)})},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(n,t,i,r){var u;return u={isAborted:!1,abort:function(){this.isAborted=!0}},n.animate("_currentCursorOpacity",t,{duration:i,onComplete:function(){u.isAborted||n[r]()},onChange:function(){n.canvas&&(n.canvas.clearContext(n.canvas.contextTop||n.ctx),n.renderCursorOrSelection())},abort:function(){return u.isAborted}}),u},_onTickComplete:function(){var n=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1);this._cursorTimeout1=setTimeout(function(){n._currentTickCompleteState=n._animateCursor(n,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(n){var t=this,i=n?0:this.cursorDelay;this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);this._currentCursorOpacity=1;this.canvas&&(this.canvas.clearContext(this.canvas.contextTop||this.ctx),this.renderCursorOrSelection());this._cursorTimeout2&&clearTimeout(this._cursorTimeout2);this._cursorTimeout2=setTimeout(function(){t._tick()},i)},abortCursorAnimation:function(){this._currentTickState&&this._currentTickState.abort();this._currentTickCompleteState&&this._currentTickCompleteState.abort();clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.clearContext(this.canvas.contextTop||this.ctx)},selectAll:function(){this.setSelectionStart(0);this.setSelectionEnd(this.text.length)},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(n){var i=0,t=n-1;if(this._reSpace.test(this.text.charAt(t)))while(this._reSpace.test(this.text.charAt(t)))i++,t--;while(/\S/.test(this.text.charAt(t))&&t>-1)i++,t--;return n-i},findWordBoundaryRight:function(n){var i=0,t=n;if(this._reSpace.test(this.text.charAt(t)))while(this._reSpace.test(this.text.charAt(t)))i++,t++;while(/\S/.test(this.text.charAt(t))&&t<this.text.length)i++,t++;return n+i},findLineBoundaryLeft:function(n){for(var i=0,t=n-1;!/\n/.test(this.text.charAt(t))&&t>-1;)i++,t--;return n-i},findLineBoundaryRight:function(n){for(var i=0,t=n;!/\n/.test(this.text.charAt(t))&&t<this.text.length;)i++,t++;return n+i},getNumNewLinesInSelectedText:function(){for(var r=this.getSelectedText(),t=0,n=0,i=r.split(""),u=i.length;n<u;n++)i[n]==="\n"&&t++;return t},searchWordBoundary:function(n,t){for(var i=this._reSpace.test(this.text.charAt(n))?n-1:n,r=this.text.charAt(i),u=/[ \n\.,;!\?\-]/;!u.test(r)&&i>0&&i<this.text.length;)i+=t,r=this.text.charAt(i);return u.test(r)&&r!=="\n"&&(i+=t===1?0:1),i},selectWord:function(n){var t=this.searchWordBoundary(n,-1),i=this.searchWordBoundary(n,1);this.setSelectionStart(t);this.setSelectionEnd(i)},selectLine:function(n){var t=this.findLineBoundaryLeft(n),i=this.findLineBoundaryRight(n);this.setSelectionStart(t);this.setSelectionEnd(i)},enterEditing:function(){if(!this.isEditing&&this.editable)return(this.canvas&&this.exitEditingOnOthers(this.canvas),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.fire("editing:entered"),!this.canvas)?this:(this.canvas.renderAll(),this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this)},exitEditingOnOthers:function(n){n._iTextInstances&&n._iTextInstances.forEach(function(n){n.selected=!1;n.isEditing&&n.exitEditing()})},initMouseMoveHandler:function(){var n=this;this.canvas.on("mouse:move",function(t){if(n.__isMousedown&&n.isEditing){var i=n.getSelectionStartFromPointer(t.e);i>=n.__selectionStartOnMouseDown?(n.setSelectionStart(n.__selectionStartOnMouseDown),n.setSelectionEnd(i)):(n.setSelectionStart(i),n.setSelectionEnd(n.__selectionStartOnMouseDown))}})},_setEditingProps:function(){this.hoverCursor="text";this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text");this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=!1;this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){this.hiddenTextarea&&(this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart,this.hiddenTextarea.selectionEnd=this.selectionEnd)},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){for(var n in this.styles)this._textLines[n]||delete this.styles[n]},_removeCharsFromTo:function(n,t){for(var i=t,u,f,r;i!==n;)u=this.get2DCursorLocation(i).charIndex,i--,f=this.get2DCursorLocation(i).charIndex,r=f>u,r?this.removeStyleObject(r,i+1):this.removeStyleObject(this.get2DCursorLocation(i).charIndex===0,i);this.text=this.text.slice(0,n)+this.text.slice(t);this._clearCache()},insertChars:function(n,t){var i=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+n+this.text.slice(this.selectionEnd);this.selectionStart===this.selectionEnd&&this.insertStyleObjects(n,i,t);this.setSelectionStart(this.selectionStart+n.length);this.setSelectionEnd(this.selectionStart);this._clearCache();this.canvas&&this.canvas.renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(t,i,r){var e,u,f;if(this.shiftLineStyles(t,1),this.styles[t+1]||(this.styles[t+1]={}),e=this.styles[t][i-1],u={},r)u[0]=n(e),this.styles[t+1]=u;else{for(f in this.styles[t])parseInt(f,10)>=i&&(u[parseInt(f,10)-i]=this.styles[t][f],delete this.styles[t][f]);this.styles[t+1]=u}this._clearCache()},insertCharStyleObject:function(t,i,r){var f=this.styles[t],e=n(f),o,u;i!==0||r||(i=1);for(o in e)u=parseInt(o,10),u>=i&&(f[u+1]=e[u]);this.styles[t][i]=r||n(f[i-1]);this._clearCache()},insertStyleObjects:function(n,t,i){var u=this.get2DCursorLocation(),r=u.lineIndex,f=u.charIndex;this.styles[r]||(this.styles[r]={});n==="\n"?this.insertNewlineStyleObject(r,f,t):i?this._insertStyles(this.copiedStyles):this.insertCharStyleObject(r,f)},_insertStyles:function(n){for(var t=0,i=n.length;t<i;t++){var r=this.get2DCursorLocation(this.selectionStart+t),u=r.lineIndex,f=r.charIndex;this.insertCharStyleObject(u,f,n[t])}},shiftLineStyles:function(t,i){var f=n(this.styles),u,r;for(u in this.styles)r=parseInt(u,10),r>t&&(this.styles[r+i]=f[r])},removeStyleObject:function(t,i){var h=this.get2DCursorLocation(i),r=h.lineIndex,e=h.charIndex,o,c,u,l,s,a,f;if(t){o=this._textLines[r-1];c=o?o.length:0;this.styles[r-1]||(this.styles[r-1]={});for(e in this.styles[r])this.styles[r-1][parseInt(e,10)+c]=this.styles[r][e];this.shiftLineStyles(r,-1)}else{u=this.styles[r];u&&(l=this.selectionStart===this.selectionEnd?-1:0,delete u[e+l]);s=n(u);for(a in s)f=parseInt(a,10),f>=e&&f!==0&&(u[f-1]=s[f],delete u[f])}},insertNewline:function(){this.insertChars("\n")}})}();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date;this.__lastLastClickTime=+new Date;this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(n){this.__newClickTime=+new Date;var t=this.canvas.getPointer(n.e);this.isTripleClick(t)?(this.fire("tripleclick",n),this._stopEvent(n.e)):this.isDoubleClick(t)&&(this.fire("dblclick",n),this._stopEvent(n.e));this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=t;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(n){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===n.x&&this.__lastPointer.y===n.y&&this.__lastIsEditing},isTripleClick:function(n){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===n.x&&this.__lastPointer.y===n.y},_stopEvent:function(n){n.preventDefault&&n.preventDefault();n.stopPropagation&&n.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(n){this.selectWord(this.getSelectionStartFromPointer(n.e))});this.on("tripleclick",function(n){this.selectLine(this.getSelectionStartFromPointer(n.e))})},initMousedownHandler:function(){this.on("mousedown",function(n){var t=this.canvas.getPointer(n.e);this.__mousedownX=t.x;this.__mousedownY=t.y;this.__isMousedown=!0;this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea);this.selected&&this.setCursorByClick(n.e);this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},_isObjectMoved:function(n){var t=this.canvas.getPointer(n);return this.__mousedownX!==t.x||this.__mousedownY!==t.y},initMouseupHandler:function(){this.on("mouseup",function(n){(this.__isMousedown=!1,this._isObjectMoved(n.e))||(this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0)})},setCursorByClick:function(n){var t=this.getSelectionStartFromPointer(n);n.shiftKey?t<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(t)):this.setSelectionEnd(t):(this.setSelectionStart(t),this.setSelectionEnd(t))},_getLocalRotatedPointer:function(n){var t=this.canvas.getPointer(n),i=new fabric.Point(t.x,t.y),r=new fabric.Point(this.left,this.top),u=fabric.util.rotatePoint(i,r,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(n,u)},getSelectionStartFromPointer:function(n){for(var c,l,r,f,a,u=this._getLocalRotatedPointer(n),o=0,i=0,s=0,h=0,v,e,t=0,y=this._textLines.length;t<y;t++){for(e=this._textLines[t].split(""),s+=this._getHeightOfLine(this.ctx,t)*this.scaleY,c=this._getLineWidth(this.ctx,t),l=this._getLineLeftOffset(c),i=l*this.scaleX,this.flipX&&(this._textLines[t]=e.reverse().join("")),r=0,f=e.length;r<f;r++){if(a=e[r],o=i,i+=this._getWidthOfChar(this.ctx,a,t,this.flipX?f-r:r)*this.scaleX,s<=u.y||i<=u.x){h++;continue}return this._getNewSelectionStartFromOffset(u,o,i,h+t,f)}if(u.y<s)return this._getNewSelectionStartFromOffset(u,o,i,h+t,f)}if(typeof v=="undefined")return this.text.length},_getNewSelectionStartFromOffset:function(n,t,i,r,u){var e=n.x-t,o=i-n.x,s=o>e?0:1,f=r+s;return this.flipX&&(f=u-f),f>this.text.length&&(f=this.text.length),f}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: fixed; bottom: 20px; left: 0px; opacity: 0; width: 0px; height: 0px; z-index: -999;";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",9:"exitEditing",27:"exitEditing",13:"insertNewline",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(n){if(this.isEditing){if(n.keyCode in this._keysMap)this[this._keysMap[n.keyCode]](n);else if(n.keyCode in this._ctrlKeysMap&&(n.ctrlKey||n.metaKey))this[this._ctrlKeysMap[n.keyCode]](n);else return;n.stopImmediatePropagation();n.preventDefault();this.canvas&&this.canvas.renderAll()}},forwardDelete:function(n){this.selectionStart===this.selectionEnd&&this.moveCursorRight(n);this.removeChars(n)},copy:function(n){var t=this.getSelectedText(),i=this._getClipboardData(n);i&&i.setData("text",t);this.copiedText=t;this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(n){var t=null,i=this._getClipboardData(n);t=i?i.getData("text"):this.copiedText;t&&this.insertChars(t,!0)},cut:function(n){this.selectionStart!==this.selectionEnd&&(this.copy(),this.removeChars(n))},_getClipboardData:function(n){return n&&(n.clipboardData||fabric.window.clipboardData)},onKeyPress:function(n){!this.isEditing||n.metaKey||n.ctrlKey||(n.which!==0&&this.insertChars(String.fromCharCode(n.which)),n.stopPropagation())},getDownCursorOffset:function(n,t){var r=t?this.selectionEnd:this.selectionStart,e,o,s=this.text.slice(0,r),h=this.text.slice(r),c=s.slice(s.lastIndexOf("\n")+1),p=h.match(/(.*)\n?/)[1],w=(h.match(/.*\n(.*)\n?/)||{})[1]||"",u=this.get2DCursorLocation(r),l,f,a,i,v,y;if(u.lineIndex===this._textLines.length-1||n.metaKey||n.keyCode===34)return this.text.length-r;for(l=this._getLineWidth(this.ctx,u.lineIndex),o=this._getLineLeftOffset(l),f=o,a=u.lineIndex,i=0,v=c.length;i<v;i++)e=c[i],f+=this._getWidthOfChar(this.ctx,e,a,i);return y=this._getIndexOnNextLine(u,w,f),p.length+1+y},_getIndexOnNextLine:function(n,t,i){for(var h,e,o=n.lineIndex+1,c=this._getLineWidth(this.ctx,o),l=this._getLineLeftOffset(c),u=l,f=0,s,r=0,a=t.length;r<a;r++)if(h=t[r],e=this._getWidthOfChar(this.ctx,h,o,r),u+=e,u>i){s=!0;var v=u-e,y=u,p=Math.abs(v-i),w=Math.abs(y-i);f=w<p?r+1:r;break}return s||(f=t.length),f},moveCursorDown:function(n){this.abortCursorAnimation();this._currentCursorOpacity=1;var t=this.getDownCursorOffset(n,this._selectionDirection==="right");n.shiftKey?this.moveCursorDownWithShift(t):this.moveCursorDownWithoutShift(t);this.initDelayedCursor()},moveCursorDownWithoutShift:function(n){this._selectionDirection="right";this.setSelectionStart(this.selectionStart+n);this.setSelectionEnd(this.selectionStart)},swapSelectionPoints:function(){var n=this.selectionEnd;this.setSelectionEnd(this.selectionStart);this.setSelectionStart(n)},moveCursorDownWithShift:function(n){this.selectionEnd===this.selectionStart&&(this._selectionDirection="right");this._selectionDirection==="right"?this.setSelectionEnd(this.selectionEnd+n):this.setSelectionStart(this.selectionStart+n);this.selectionEnd<this.selectionStart&&this._selectionDirection==="left"&&(this.swapSelectionPoints(),this._selectionDirection="right");this.selectionEnd>this.text.length&&this.setSelectionEnd(this.text.length)},getUpCursorOffset:function(n,t){var u=t?this.selectionEnd:this.selectionStart,r=this.get2DCursorLocation(u),i,c,l;if(r.lineIndex===0||n.metaKey||n.keyCode===33)return u;var f=this.text.slice(0,u),e=f.slice(f.lastIndexOf("\n")+1),o=(f.match(/\n?(.*)\n.*$/)||{})[1]||"",s,a=this._getLineWidth(this.ctx,r.lineIndex),v=this._getLineLeftOffset(a),h=v,y=r.lineIndex;for(i=0,c=e.length;i<c;i++)s=e[i],h+=this._getWidthOfChar(this.ctx,s,y,i);return l=this._getIndexOnPrevLine(r,o,h),o.length-l+e.length},_getIndexOnPrevLine:function(n,t,i){for(var h,e,o=n.lineIndex-1,c=this._getLineWidth(this.ctx,o),l=this._getLineLeftOffset(c),u=l,f=0,s,r=0,a=t.length;r<a;r++)if(h=t[r],e=this._getWidthOfChar(this.ctx,h,o,r),u+=e,u>i){s=!0;var v=u-e,y=u,p=Math.abs(v-i),w=Math.abs(y-i);f=w<p?r:r-1;break}return s||(f=t.length-1),f},moveCursorUp:function(n){this.abortCursorAnimation();this._currentCursorOpacity=1;var t=this.getUpCursorOffset(n,this._selectionDirection==="right");n.shiftKey?this.moveCursorUpWithShift(t):this.moveCursorUpWithoutShift(t);this.initDelayedCursor()},moveCursorUpWithShift:function(n){this.selectionEnd===this.selectionStart&&(this._selectionDirection="left");this._selectionDirection==="right"?this.setSelectionEnd(this.selectionEnd-n):this.setSelectionStart(this.selectionStart-n);this.selectionEnd<this.selectionStart&&this._selectionDirection==="right"&&(this.swapSelectionPoints(),this._selectionDirection="left")},moveCursorUpWithoutShift:function(n){this.selectionStart===this.selectionEnd&&this.setSelectionStart(this.selectionStart-n);this.setSelectionEnd(this.selectionStart);this._selectionDirection="left"},moveCursorLeft:function(n){(this.selectionStart!==0||this.selectionEnd!==0)&&(this.abortCursorAnimation(),this._currentCursorOpacity=1,n.shiftKey?this.moveCursorLeftWithShift(n):this.moveCursorLeftWithoutShift(n),this.initDelayedCursor())},_move:function(n,t,i){var r=t==="selectionStart"?"setSelectionStart":"setSelectionEnd";n.altKey?this[r](this["findWordBoundary"+i](this[t])):n.metaKey||n.keyCode===35||n.keyCode===36?this[r](this["findLineBoundary"+i](this[t])):this[r](this[t]+(i==="Left"?-1:1))},_moveLeft:function(n,t){this._move(n,t,"Left")},_moveRight:function(n,t){this._move(n,t,"Right")},moveCursorLeftWithoutShift:function(n){this._selectionDirection="left";this.selectionEnd===this.selectionStart&&this._moveLeft(n,"selectionStart");this.setSelectionEnd(this.selectionStart)},moveCursorLeftWithShift:function(n){this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(n,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(n,"selectionStart"),this.text.charAt(this.selectionStart)==="\n"&&this.setSelectionStart(this.selectionStart-1))},moveCursorRight:function(n){this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length||(this.abortCursorAnimation(),this._currentCursorOpacity=1,n.shiftKey?this.moveCursorRightWithShift(n):this.moveCursorRightWithoutShift(n),this.initDelayedCursor())},moveCursorRightWithShift:function(n){this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(n,"selectionStart"):(this._selectionDirection="right",this._moveRight(n,"selectionEnd"),this.text.charAt(this.selectionEnd-1)==="\n"&&this.setSelectionEnd(this.selectionEnd+1))},moveCursorRightWithoutShift:function(n){this._selectionDirection="right";this.selectionStart===this.selectionEnd?(this._moveRight(n,"selectionStart"),this.setSelectionEnd(this.selectionStart)):(this.setSelectionEnd(this.selectionEnd+this.getNumNewLinesInSelectedText()),this.setSelectionStart(this.selectionEnd))},removeChars:function(n){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(n):this._removeCharsFromTo(this.selectionStart,this.selectionEnd);this.setSelectionEnd(this.selectionStart);this._removeExtraneousStyles();this._clearCache();this.canvas&&this.canvas.renderAll();this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(n){var t,i,r;this.selectionStart!==0&&(n.metaKey?(t=this.findLineBoundaryLeft(this.selectionStart),this._removeCharsFromTo(t,this.selectionStart),this.setSelectionStart(t)):n.altKey?(i=this.findWordBoundaryLeft(this.selectionStart),this._removeCharsFromTo(i,this.selectionStart),this.setSelectionStart(i)):(r=this.text.slice(this.selectionStart-1,this.selectionStart)==="\n",this.removeStyleObject(r),this.setSelectionStart(this.selectionStart-1),this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)))}});fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(n,t,i,r,u,f){this.styles[n]?this._setSVGTextLineChars(n,t,i,r,f):this.callSuper("_setSVGTextLineText",n,t,i,r,u)},_setSVGTextLineChars:function(n,t,i,r,u){for(var e,c,o=this._textLines[n].split(""),s=0,l=this._getSVGLineLeftOffset(n)-this.width/2,h=this._getSVGLineTopOffset(n),a=this._getHeightOfLine(this.ctx,n),f=0,v=o.length;f<v;f++)e=this.styles[n][f]||{},t.push(this._createTextCharSpan(o[f],e,l,h.lineTop+h.offset,s)),c=this._getWidthOfChar(this.ctx,o[f],n,f),e.textBackgroundColor&&u.push(this._createTextCharBg(e,l,h.lineTop,a,c,s)),s+=c},_getSVGLineLeftOffset:function(n){return fabric.util.toFixed(this._getLineLeftOffset(this.__lineWidths[n]),2)},_getSVGLineTopOffset:function(n){for(var i=0,r=0,t=0;t<n;t++)i+=this._getHeightOfLine(this.ctx,t);return r=this._getHeightOfLine(this.ctx,t),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*r/(this.lineHeight*this._fontSizeMult)}},_createTextCharBg:function(n,t,i,r,u,f){return['<rect fill="',n.textBackgroundColor,'" x="',t+f,'" y="',i-this.height/2,'" width="',u,'" height="',r/this.lineHeight,'"><\/rect>'].join("")},_createTextCharSpan:function(n,t,i,r,u){var f=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},t));return['<tspan x="',i+u,'" y="',r-this.height/2,'" ',t.fontFamily?'font-family="'+t.fontFamily.replace(/"/g,"'")+'" ':"",t.fontSize?'font-size="'+t.fontSize+'" ':"",t.fontStyle?'font-style="'+t.fontStyle+'" ':"",t.fontWeight?'font-weight="'+t.fontWeight+'" ':"",t.textDecoration?'text-decoration="'+t.textDecoration+'" ':"",'style="',f,'">',fabric.util.string.escapeXml(n),"<\/tspan>"].join("")}}),function(){function n(n,t,i){var r=e.parse(n),f,u;r.port||(r.port=r.protocol.indexOf("https:")===0?443:80);f=r.protocol.indexOf("https:")===0?s:o;u=f.request({hostname:r.hostname,port:r.port,path:r.path,method:"GET"},function(n){var r="";t&&n.setEncoding(t);n.on("end",function(){i(r)});n.on("data",function(t){n.statusCode===200&&(r+=t)})});u.on("error",function(n){n.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+r.hostname+":"+r.port):fabric.log(n.message)});u.end()}function i(n,t){var i=require("fs");i.readFile(n,function(n,i){if(n){fabric.log(n);throw n;}else t(i)})}var r,u;if(typeof document=="undefined"||typeof window=="undefined"){var f=require("xmldom").DOMParser,e=require("url"),o=require("http"),s=require("https"),t=require("canvas"),h=require("canvas").Image;fabric.util.loadImage=function(t,r,u){function e(n){f.src=new Buffer(n,"binary");f._src=t;r&&r.call(u,f)}var f=new h;t&&(t instanceof Buffer||t.indexOf("data")===0)?(f.src=f._src=t,r&&r.call(u,f)):t&&t.indexOf("http")!==0?i(t,e):t?n(t,"binary",e):r&&r.call(u,t)};fabric.loadSVGFromURL=function(t,r,u){t=t.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();t.indexOf("http")!==0?i(t,function(n){fabric.loadSVGFromString(n.toString(),r,u)}):n(t,"",function(n){fabric.loadSVGFromString(n,r,u)})};fabric.loadSVGFromString=function(n,t,i){var r=(new f).parseFromString(n);fabric.parseSVGDocument(r.documentElement,function(n,i){t&&t(n,i)},i)};fabric.util.getScript=function(t,i){n(t,"",function(n){eval(n);i&&i()})};fabric.Image.fromObject=function(n,t){fabric.util.loadImage(n.src,function(i){var r=new fabric.Image(i);r._initConfig(n);r._initFilters(n,function(n){r.filters=n||[];t&&t(r)})})};fabric.createCanvasForNode=function(n,i,r,u){var f,e,s,o;return u=u||r,f=fabric.document.createElement("canvas"),e=new t(n||600,i||600,u),f.style={},f.width=e.width,f.height=e.height,s=fabric.Canvas||fabric.StaticCanvas,o=new s(f,r),o.contextContainer=e.getContext("2d"),o.nodeCanvas=e,o.Font=t.Font,o};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(n){return this.nodeCanvas.createJPEGStream(n)};r=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(n,t){return r.call(this,n,t),this.nodeCanvas.width=n,this};fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);u=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(n,t){return u.call(this,n,t),this.nodeCanvas.height=n,this};fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}}();
(function(n,t,i){"use strict";function r(n,t){var i;if(n===undefined)return t;for(i in t)t.hasOwnProperty(i)&&n.hasOwnProperty(i)===!1&&(n[i]=t[i]);return n}function u(n,t,i){return this.init(n,t,i)}function f(n,t){this.darkroom=n;this.options=r(t,this.defaults);this.initialize()}function e(n){this.element=n;this.actionsElement=n.querySelector(".darkroom-toolbar-actions")}function o(n){this.element=n}function s(n){this.element=n}n.Darkroom=u;u.plugins=[];f.prototype={defaults:{},initialize:function(){}};f.extend=function(n){var i=this,t,u;return t=n&&n.hasOwnProperty("constructor")?n.constructor:function(){return i.apply(this,arguments)},r(t,i),u=function(){this.constructor=t},u.prototype=i.prototype,t.prototype=new u,n&&r(t.prototype,n),t.__super__=i.prototype,t};u.Plugin=f;e.prototype.createButtonGroup=function(){var n=t.createElement("li");return n.className="darkroom-button-group",this.actionsElement.appendChild(n),new o(n)};o.prototype.createButton=function(n){var i;return n=r(n,{image:"help",type:"default",group:"default",hide:!1,disabled:!1}),i=t.createElement("button"),i.className="darkroom-button darkroom-button-"+n.type,i.innerHTML='<i class="darkroom-icon-'+n.image+'"><\/i>',this.element.appendChild(i),i=new s(i),i.hide(n.hide),i.disable(n.disabled),i};s.prototype={addEventListener:function(n,t){var i=this.element;i.addEventListener?i.addEventListener(n,t):i.attachEvent&&i.attachEvent("on"+n,t)},active:function(n){n?this.element.classList.add("darkroom-button-active"):this.element.classList.remove("darkroom-button-active")},hide:function(n){n?this.element.classList.add("darkroom-button-hidden"):this.element.classList.remove("darkroom-button-hidden")},disable:function(n){this.element.disabled=n?!0:!1}};var h=i.util.createClass(i.Canvas,{});u.prototype={defaults:{minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,backgroundColor:"#ccc",plugins:{},init:function(){},initDOM:function(){}},addEventListener:function(n,t){var i=this.canvas.getElement();i.addEventListener?i.addEventListener(n,t):i.attachEvent&&i.attachEvent("on"+n,t)},dispatchEvent:function(n){var i=t.createEvent("Event");i.initEvent(n,!0,!0);this.canvas.getElement().dispatchEvent(i)},init:function(n,i,f){var e=this,f,o;(this.options=r(i,this.defaults),typeof n=="string"&&(n=t.querySelector(n)),null!==n)&&(f=f||u.plugins,o=new Image,o.onload=function(){e.createFabricImage(n).initDOM(n).initPlugins(f);e.options.init.bind(e).call()},o.src=n.src)},initDOM:function(n){var i=t.createElement("div"),u,r;return i.className="darkroom-toolbar",i.innerHTML='<ul class="darkroom-toolbar-actions"><\/ul>',u=t.createElement("canvas"),r=t.createElement("div"),r.className="darkroom-image-container",r.appendChild(u),this.container=t.createElement("div"),this.container.className="darkroom-container",this.container.appendChild(i),this.container.appendChild(r),n.parentNode.replaceChild(this.container,n),this.toolbar=new e(i),this.canvas=new h(u,{selection:!1,backgroundColor:this.options.backgroundColor}),this.canvas.setWidth(this.image.getWidth()),this.canvas.setHeight(this.image.getHeight()),this.canvas.add(this.image),this.canvas.centerObject(this.image),this.image.setCoords(),this.options.initDOM.bind(this).call(),this},createFabricImage:function(n){var t=n.width,r=n.height,o=1,s=1,u=1,f=1,e;return null!==this.options.maxWidth&&this.options.maxWidth<t&&(u=this.options.maxWidth/t),null!==this.options.maxHeight&&this.options.maxHeight<r&&(f=this.options.maxHeight/r),o=Math.min(u,f),u=1,f=1,null!==this.options.minWidth&&this.options.minWidth>t&&(u=this.options.minWidth/t),null!==this.options.minHeight&&this.options.minHeight>r&&(f=this.options.minHeight/r),s=Math.max(u,f),e=s*o,t*=e,r*=e,this.image=new i.Image(n,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1}),this.image.setScaleX(e),this.image.setScaleY(e),this},initPlugins:function(n){var t,r,i;this.plugins={};for(t in n)(r=n[t],i=this.options.plugins[t],i!==!1)&&n.hasOwnProperty(t)&&(this.plugins[t]=new r(this,i))},getPlugin:function(n){return this.plugins[n]},selfDestroy:function(){var t=this.container,n=new Image;n.onload=function(){t.parentNode.replaceChild(n,t)};n.src=this.snapshotImage()},snapshotImage:function(){return this.image.toDataURL()}}})(window,window.document,fabric);
(function(n,t,i,r){"use strict";i.plugins.history=i.Plugin.extend({initialize:function(){this._initButtons();this.backHistoryStack=[];this.forwardHistoryStack=[];this._snapshotImage();this.darkroom.addEventListener("image:change",this._onImageChange.bind(this))},goBack:function(){this.backHistoryStack.length!==0&&(this.forwardHistoryStack.push(this.currentImage),this.currentImage=this.backHistoryStack.pop(),this._applyImage(this.currentImage),this._updateButtons(),this.darkroom.dispatchEvent("history:navigate"))},goForward:function(){this.forwardHistoryStack.length!==0&&(this.backHistoryStack.push(this.currentImage),this.currentImage=this.forwardHistoryStack.pop(),this._applyImage(this.currentImage),this._updateButtons(),this.darkroom.dispatchEvent("history:navigate"))},_initButtons:function(){var n=this.darkroom.toolbar.createButtonGroup();return this.backButton=n.createButton({image:"back",disabled:!0}),this.forwardButton=n.createButton({image:"forward",disabled:!0}),this.backButton.addEventListener("click",this.goBack.bind(this)),this.forwardButton.addEventListener("click",this.goForward.bind(this)),this},_updateButtons:function(){this.backButton.disable(this.backHistoryStack.length===0);this.forwardButton.disable(this.forwardHistoryStack.length===0)},_snapshotImage:function(){var t=this,n=new Image;n.src=this.darkroom.snapshotImage();this.currentImage=n},_onImageChange:function(){this.backHistoryStack.push(this.currentImage);this._snapshotImage();this.forwardHistoryStack.length=0;this._updateButtons()},_applyImage:function(n){var t=this.darkroom.canvas,i=new r.Image(n,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1});t.setWidth(n.width);t.setHeight(n.height);this.darkroom.image.remove();this.darkroom.image=i;t.add(i)}})})(window,document,Darkroom,fabric);
(function(n,t,i){"use strict";i.plugins.rotate=i.Plugin.extend({initialize:function(){var n=this.darkroom.toolbar.createButtonGroup();this.leftButton=n.createButton({image:"rotate-left"});this.rightButton=n.createButton({image:"rotate-right"});this.leftButton.addEventListener("click",this.rotateLeft.bind(this));this.rightButton.addEventListener("click",this.rotateRight.bind(this))},rotateLeft:function(){this.rotate(-90)},rotateRight:function(){this.rotate(90)},rotate:function(n){var e=this,r=this.darkroom,i=r.canvas,t=r.image,u,f;n=(t.getAngle()+n)%360;f=Math.abs(t.getWidth()*Math.sin(n*Math.PI/180))+Math.abs(t.getHeight()*Math.cos(n*Math.PI/180));u=Math.abs(t.getHeight()*Math.sin(n*Math.PI/180))+Math.abs(t.getWidth()*Math.cos(n*Math.PI/180));i.setWidth(u);i.setHeight(f);t.rotate(n);i.centerObject(t);t.setCoords();i.renderAll();r.dispatchEvent("image:change")}})})(window,document,Darkroom,fabric);
(function(n,t,i,r){"use strict";var u=r.util.createClass(r.Rect,{_render:function(n){this.callSuper("_render",n);var e=n.canvas,t=7,u=this.flipX?-1:1,f=this.flipY?-1:1,i=u/this.scaleX,r=f/this.scaleY;n.scale(i,r);n.fillStyle="rgba(0, 0, 0, 0.5)";this._renderOverlay(n);n.setLineDash!==undefined?n.setLineDash([t,t]):n.mozDash!==undefined&&(n.mozDash=[t,t]);n.strokeStyle="rgba(0, 0, 0, 0.2)";this._renderBorders(n);this._renderGrid(n);n.lineDashOffset=t;n.strokeStyle="rgba(255, 255, 255, 0.4)";this._renderBorders(n);this._renderGrid(n);n.scale(1/i,1/r)},_renderOverlay:function(n){var e=n.canvas,u=0,t=Math.ceil(-this.getWidth()/2-this.getLeft()),h=Math.ceil(-this.getWidth()/2),o=Math.ceil(this.getWidth()/2),f=Math.ceil(this.getWidth()/2+(e.width-this.getWidth()-this.getLeft())),s=Math.ceil(-this.getHeight()/2-this.getTop()),i=Math.ceil(-this.getHeight()/2),r=Math.ceil(this.getHeight()/2),c=Math.ceil(this.getHeight()/2+(e.height-this.getHeight()-this.getTop()));n.fillRect(t,s,f-t,i-s+u);n.fillRect(t,i,h-t,r-i+u);n.fillRect(o,i,f-o,r-i+u);n.fillRect(t,r,f-t,c-r)},_renderBorders:function(n){n.beginPath();n.moveTo(-this.getWidth()/2,-this.getHeight()/2);n.lineTo(this.getWidth()/2,-this.getHeight()/2);n.lineTo(this.getWidth()/2,this.getHeight()/2);n.lineTo(-this.getWidth()/2,this.getHeight()/2);n.lineTo(-this.getWidth()/2,-this.getHeight()/2);n.stroke()},_renderGrid:function(n){n.beginPath();n.moveTo(-this.getWidth()/2+1/3*this.getWidth(),-this.getHeight()/2);n.lineTo(-this.getWidth()/2+1/3*this.getWidth(),this.getHeight()/2);n.stroke();n.beginPath();n.moveTo(-this.getWidth()/2+2/3*this.getWidth(),-this.getHeight()/2);n.lineTo(-this.getWidth()/2+2/3*this.getWidth(),this.getHeight()/2);n.stroke();n.beginPath();n.moveTo(-this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight());n.lineTo(this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight());n.stroke();n.beginPath();n.moveTo(-this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight());n.lineTo(this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight());n.stroke()}});i.plugins.crop=i.Plugin.extend({startX:null,startY:null,isKeyCroping:!1,isKeyLeft:!1,isKeyUp:!1,defaults:{minHeight:1,minWidth:1,ratio:null,quickCropKey:!1,cropCallback:function(){this.toggleCrop()},okCallback:function(){this.cropCurrentZone()},cancelCallback:function(){this.releaseFocus()}},initialize:function(){var n=this.darkroom.toolbar.createButtonGroup();this.cropButton=n.createButton({image:"crop"});this.okButton=n.createButton({image:"accept",type:"success",hide:!0});this.cancelButton=n.createButton({image:"cancel",type:"danger",hide:!0});this.cropButton.addEventListener("click",this.options.cropCallback.bind(this));this.okButton.addEventListener("click",this.options.okCallback.bind(this));this.cancelButton.addEventListener("click",this.options.cancelCallback.bind(this));this.darkroom.canvas.on("mouse:down",this.onMouseDown.bind(this));this.darkroom.canvas.on("mouse:move",this.onMouseMove.bind(this));this.darkroom.canvas.on("mouse:up",this.onMouseUp.bind(this));this.darkroom.canvas.on("object:moving",this.onObjectMoving.bind(this));this.darkroom.canvas.on("object:scaling",this.onObjectScaling.bind(this));r.util.addListener(r.document,"keydown",this.onKeyDown.bind(this));r.util.addListener(r.document,"keyup",this.onKeyUp.bind(this));this.darkroom.addEventListener("image:change",this.releaseFocus.bind(this))},onObjectMoving:function(n){var t;if(this.hasFocus()&&(t=n.target,t===this.cropZone)){var i=this.darkroom.canvas,r=t.getLeft(),u=t.getTop(),o=t.getWidth(),s=t.getHeight(),f=i.getWidth()-o,e=i.getHeight()-s;r<0&&t.set("left",0);u<0&&t.set("top",0);r>f&&t.set("left",f);u>e&&t.set("top",e);this.darkroom.dispatchEvent("crop:update")}},onObjectScaling:function(n){var r,t,h,c;if(this.hasFocus()&&(r=!1,t=n.target,t===this.cropZone)){var i=this.darkroom.canvas,e=i.getPointer(n.e),l=e.x,a=e.y,u=t.getLeft(),f=t.getTop(),o=t.getLeft()+t.getWidth(),s=t.getTop()+t.getHeight();null!==this.options.ratio&&(u<0||o>i.getWidth()||f<0||s>i.getHeight())&&(r=!0);(u<0||o>i.getWidth()||r)&&(h=this.lastScaleX||1,t.setScaleX(h));u<0&&t.setLeft(0);(f<0||s>i.getHeight()||r)&&(c=this.lastScaleY||1,t.setScaleY(c));f<0&&t.setTop(0);t.getWidth()<this.options.minWidth&&t.scaleToWidth(this.options.minWidth);t.getHeight()<this.options.minHeight&&t.scaleToHeight(this.options.minHeight);this.lastScaleX=t.getScaleX();this.lastScaleY=t.getScaleY();this.darkroom.dispatchEvent("crop:update")}},onMouseDown:function(n){var t;if(this.hasFocus()){t=this.darkroom.canvas;t.calcOffset();var i=t.getPointer(n.e),u=i.x,f=i.y,e=new r.Point(u,f),o=t.getActiveObject();o===this.cropZone||this.cropZone.containsPoint(e)||(t.discardActiveObject(),this.cropZone.setWidth(0),this.cropZone.setHeight(0),this.cropZone.setScaleX(1),this.cropZone.setScaleY(1),this.startX=u,this.startY=f)}},onMouseMove:function(n){if(this.isKeyCroping)return this.onMouseMoveKeyCrop(n);if(null!==this.startX&&null!==this.startY){var i=this.darkroom.canvas,t=i.getPointer(n.e),r=t.x,u=t.y;this._renderCropZone(this.startX,this.startY,r,u)}},onMouseMoveKeyCrop:function(n){var f=this.darkroom.canvas,t=this.cropZone,u=f.getPointer(n.e),i=u.x,r=u.y;t.left&&t.top||(t.setTop(r),t.setLeft(i));this.isKeyLeft=i<t.left+t.width/2;this.isKeyUp=r<t.top+t.height/2;this._renderCropZone(Math.min(t.left,i),Math.min(t.top,r),Math.max(t.left+t.width,i),Math.max(t.top+t.height,r))},onMouseUp:function(){if(null!==this.startX&&null!==this.startY){var n=this.darkroom.canvas;this.cropZone.setCoords();n.setActiveObject(this.cropZone);n.calcOffset();this.startX=null;this.startY=null}},onKeyDown:function(n){!1===this.options.quickCropKey||n.keyCode!==this.options.quickCropKey||this.isKeyCroping||(this.isKeyCroping=!0,this.darkroom.canvas.discardActiveObject(),this.cropZone.setWidth(0),this.cropZone.setHeight(0),this.cropZone.setScaleX(1),this.cropZone.setScaleY(1),this.cropZone.setTop(0),this.cropZone.setLeft(0))},onKeyUp:function(n){!1!==this.options.quickCropKey&&n.keyCode===this.options.quickCropKey&&this.isKeyCroping&&(this.isKeyCroping=!1,this.startX=1,this.startY=1,this.onMouseUp())},selectZone:function(n,t,i,r,u){this.hasFocus()||this.requireFocus();u?this.cropZone.set({left:n,top:t,width:i,height:r}):this._renderCropZone(n,t,n+i,t+r);var f=this.darkroom.canvas;f.bringToFront(this.cropZone);this.cropZone.setCoords();f.setActiveObject(this.cropZone);f.calcOffset();this.darkroom.dispatchEvent("crop:update")},toggleCrop:function(){this.hasFocus()?this.releaseFocus():this.requireFocus()},cropCurrentZone:function(){var t;if(this.hasFocus()&&(!(this.cropZone.width<1)||!(this.cropZone.height<1))){var i=this,u=this.darkroom,n=u.canvas;this.cropZone.visible=!1;t=new Image;t.onload=function(){if(!(this.height<1)&&!(this.width<1)){var t=new r.Image(this,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1}),f=this.width,e=this.height;n.setWidth(f);n.setHeight(e);i.darkroom.image.remove();i.darkroom.image=t;n.add(t);u.dispatchEvent("image:change")}};this.cropZone.remove();t.src=n.toDataURL({left:this.cropZone.getLeft(),top:this.cropZone.getTop(),width:this.cropZone.getWidth(),height:this.cropZone.getHeight()})}},hasFocus:function(){return this.cropZone!==undefined},requireFocus:function(){this.cropZone=new u({fill:"transparent",hasBorders:!1,originX:"left",originY:"top",cornerColor:"#444",cornerSize:8,transparentCorners:!1,lockRotation:!0,hasRotatingPoint:!1});null!==this.options.ratio&&this.cropZone.set("lockUniScaling",!0);this.darkroom.canvas.add(this.cropZone);this.darkroom.canvas.defaultCursor="crosshair";this.cropButton.active(!0);this.okButton.hide(!1);this.cancelButton.hide(!1)},releaseFocus:function(){undefined!==this.cropZone&&(this.cropZone.remove(),this.cropZone=undefined,this.cropButton.active(!1),this.okButton.hide(!0),this.cancelButton.hide(!0),this.darkroom.canvas.defaultCursor="default",this.darkroom.dispatchEvent("crop:update"))},_renderCropZone:function(n,t,i,r){var e=this.darkroom.canvas,d=i>n,y=!d,g=r>t,p=!g,w=Math.min(+this.options.minWidth,e.getWidth()),b=Math.min(+this.options.minHeight,e.getHeight()),u=Math.min(n,i),h=Math.max(n,i),f=Math.min(t,r),c=Math.max(t,r),v,l,a;u=Math.max(0,u);h=Math.min(e.getWidth(),h);f=Math.max(0,f);c=Math.min(e.getHeight(),c);h-u<w&&(d?h=u+w:u=h-w);c-f<b&&(g?c=f+b:f=c-b);u<0&&(h+=Math.abs(u),u=0);h>e.getWidth()&&(u-=h-e.getWidth(),h=e.getWidth());f<0&&(c+=Math.abs(f),f=0);c>e.getHeight()&&(f-=c-e.getHeight(),c=e.getHeight());var s=h-u,o=c-f,k=s/o;this.options.ratio&&+this.options.ratio!==k&&(v=+this.options.ratio,this.isKeyCroping&&(y=this.isKeyLeft,p=this.isKeyUp),k<v?(l=o*v,y&&(u-=l-s),s=l):k>v&&(a=o/(v*o/s),p&&(f-=a-o),o=a),u<0&&(u=0),f<0&&(f=0),u+s>e.getWidth()&&(l=e.getWidth()-u,o=l*o/s,s=l,p&&(f=t-o)),f+o>e.getHeight()&&(a=e.getHeight()-f,s=s*a/o,o=a,y&&(u=n-s)));this.cropZone.left=u;this.cropZone.top=f;this.cropZone.width=s;this.cropZone.height=o;this.darkroom.canvas.bringToFront(this.cropZone);this.darkroom.dispatchEvent("crop:update")}})})(window,document,Darkroom,fabric);
(function(n,t,i){"use strict";i.plugins.save=i.Plugin.extend({defaults:{callback:function(){this.darkroom.selfDestroy()}},initialize:function(){var n=this.darkroom.toolbar.createButtonGroup();this.saveButton=n.createButton({action:"save",disabled:!0});this.darkroom.addEventListener("image:change",this._onImageChange.bind(this));this.darkroom.addEventListener("history:navigate",this._onHistoryChange.bind(this));this.darkroom.addEventListener("history:reset",this._onHistoryReset.bind(this));this.darkroom.addEventListener("save:after",this._onSave.bind(this));this.darkroom.addEventListener("save:flag",this._onSave.bind(this));this.saveButton.addEventListener("click",this.options.callback.bind(this))},_flag:function(n){var t=this.darkroom.options.base.flags;return typeof n=="boolean"&&(t.isSaved=n),t.isSaved},_onHistoryChange:function(){this._flag(!1);this.saveButton.disable(this._flag())},_onHistoryReset:function(){this._flag(!0);this.saveButton.disable(this._flag())},_onImageChange:function(){this._flag(!1);this.saveButton.disable(this._flag())},_onSave:function(){this._flag(!0);this.saveButton.disable(this._flag())}})})(window,document,Darkroom);
(function(n,t,i){"use strict";i.plugins.nosave=i.Plugin.extend({defaults:{plugin:"history",callback:function(){this._getStack().length&&(this._resetImage(),this._clearStack(),this._getPlugin()._updateButtons(),this.darkroom.dispatchEvent("history:navigate"),this.darkroom.dispatchEvent("history:reset"))}},initialize:function(){var n,t,i;(this._getPlugin()||(n=t=!0),i=this.darkroom.toolbar.createButtonGroup(),this.noSaveButton=i.createButton({action:"nosave",disabled:!0,hide:n}),t)||(this.darkroom.addEventListener("image:change",this._onImageChange.bind(this)),this.darkroom.addEventListener("history:navigate",this._onHistoryChange.bind(this)),this.noSaveButton.addEventListener("click",this.options.callback.bind(this)))},_getPlugin:function(){return this.darkroom.getPlugin(this.options.plugin)},_getStack:function(){return this._getPlugin().backHistoryStack},_clearStack:function(){this._getPlugin().backHistoryStack=[];this._getPlugin().forwardHistoryStack=[]},_resetImage:function(){this._getPlugin().currentImage=this._getStack().shift();this._getPlugin()._applyImage(this._getPlugin().currentImage)},_onHistoryChange:function(){this.noSaveButton.disable(this._getStack().length===0)},_onImageChange:function(){this.noSaveButton.disable(this._getStack().length===0)}})})(window,document,Darkroom);
(function(n,t,i){"use strict";i.plugins.rotatemore=i.Plugin.extend({defaults:{plugin:"rotate",callback:function(){this._getPlugin().rotate(180)}},initialize:function(){var n,t,i;(this._getPlugin()||(n=t=!0),i=this.darkroom.toolbar.createButtonGroup(),this.rotate180Button=i.createButton({action:"rotate-180",hide:n}),t)||this.rotate180Button.addEventListener("click",this.options.callback.bind(this))},_getPlugin:function(){return this.darkroom.getPlugin(this.options.plugin)}})})(window,document,Darkroom);
(function(n,t,i){"use strict";i.plugins.flip=i.Plugin.extend({defaults:{},initialize:function(){var n=this.darkroom.toolbar.createButtonGroup();this.flipXButton=n.createButton({action:"flip-x"});this.flipYButton=n.createButton({action:"flip-y"});this.flipXButton.addEventListener("click",this.flipx.bind(this));this.flipYButton.addEventListener("click",this.flipy.bind(this))},flipx:function(){this.darkroom.image.flipX=!this.darkroom.image.flipX;this.darkroom.canvas.renderAll();this.darkroom.dispatchEvent("image:change")},flipy:function(){this.darkroom.image.flipY=!this.darkroom.image.flipY;this.darkroom.canvas.renderAll();this.darkroom.dispatchEvent("image:change")}})})(window,document,Darkroom);
(function(n,t,i){"use strict";i.plugins.cropcustomiser=i.Plugin.extend({defaults:{plugin:"crop",handle:{size:null,colour:null,border:null}},base:null,initialize:function(){if(this.base=this.darkroom.options.base,this.base.options.scroller&&(this.darkroom.addEventListener("crop:open",this.scrollOff.bind(this)),this.darkroom.addEventListener("crop:close",this.scrollOn.bind(this))),this._getPlugin()){this.darkroom.addEventListener("action:open",this.cropToggle.bind(this));this.darkroom.addEventListener("history:navigate",this.cropOff.bind(this));this.darkroom.addEventListener("save:before",this.cropOff.bind(this));this.darkroom.addEventListener("crop:update",this.cropUpdate.bind(this));this.darkroom.canvas.on("mouse:up",this.cropMouseUp.bind(this));this.darkroom.canvas.on("object:moving",this.cropDragging.bind(this));this.cropInit();this.cropApply();this.cropCreate();this.cropInsert()}},_getPlugin:function(){return this.darkroom.getPlugin(this.options.plugin)},scrollOn:function(){this.base.scroller.kinetic("attach")},scrollOff:function(){this.base.scroller.kinetic("detach")},cropCallback:function(){var n=this._getPlugin(),t=this.darkroom.options.base.options.css.radius.value;n.defaults.cropCallback.bind(n).call();n.hasFocus()&&(this.darkroom.dispatchEvent("crop:open"),this.darkroom.action("crop"),n.cropButton.element.removeClass(t))},okCallback:function(){var n=this._getPlugin();n.cropZone.setLeft(Math.floor(n.cropZone.getLeft()));n.cropZone.setTop(Math.floor(n.cropZone.getTop()));n.cropZone.setWidth(Math.floor(n.cropZone.getWidth()));n.cropZone.setHeight(Math.floor(n.cropZone.getHeight()));n.defaults.okCallback.bind(n).call()},cropUpdate:function(){var n=this._getPlugin(),t=this.darkroom.options.base.options.css.radius.value;n.cropButton.element.toggleClass(t,n.hasFocus()?!1:!0);n.hasFocus()||(this.darkroom.dispatchEvent("crop:close"),this.darkroom.action())},cropInit:function(){this._getPlugin().options._constrain=!1;this._getPlugin().options._dragging=!1},cropApply:function(){var n=this._getPlugin().cropCurrentZone;this._getPlugin().cropCurrentZone=function(){!this.hasFocus()||this.cropZone.width<1&&this.cropZone.height<1||(this.cropZone.scaleX=1,this.cropZone.scaleY=1,n.call(this))}},cropCreate:function(){var n=this._getPlugin().selectZone;this._getPlugin().selectZone=function(t,i,r,u,f){n.apply(this,[t,i,r,u,f]);this.options._constrain?(this.cropZone.lockScalingX=!0,this.cropZone.lockScalingY=!0,this.cropZone.hasControls=!1):(this.cropZone.lockScalingX=!1,this.cropZone.lockScalingY=!1,this.cropZone.hasControls=!0);this.darkroom.canvas.renderAll()}},cropDragging:function(n){var t=this._getPlugin();t.hasFocus()&&n.target===t.cropZone&&(t.options._dragging=!0)},cropMouseUp:function(){var n=this._getPlugin();n.hasFocus()&&n.cropZone&&(n.options._dragging||(n.options._constrain=!1),n.options._dragging||n.options._constrain||(n.cropZone.lockScalingX=!1,n.cropZone.lockScalingY=!1,n.cropZone.hasControls=!0),n.options._dragging=!1,n.darkroom.canvas.renderAll())},cropInsert:function(){var n=this,t=this._getPlugin().requireFocus;this._getPlugin().requireFocus=function(){t.call(this);n.options.handle.size&&(this.cropZone.cornerSize=n.options.handle.size);n.options.handle.colour&&(this.cropZone.cornerColor=n.options.handle.colour);n.options.handle.border&&(this.cropZone.borderColor=n.options.handle.border,this.cropZone.hasBorders=!0)}},cropToggle:function(){var n=this._getPlugin();this.darkroom.options.action!==this.options.plugin&&n.hasFocus()&&n.releaseFocus()},cropOff:function(){var n=this._getPlugin();n.hasFocus()&&n.releaseFocus()}})})(window,document,Darkroom,window.jQuery);
(function(n,t,i){"use strict";i.plugins.cropdimensions=i.Plugin.extend({defaults:{plugin:"crop",glue:"x",lock:""},initialize:function(){var n,t;(this._getPlugin()||(n=!0),t=this.darkroom.toolbar.createButtonGroup(),this.cropDimensionsButton=t.createButton({action:"crop-dimensions",disabled:!1,hide:!0}),n)||(this.darkroom.addEventListener("crop:open",this.cropOpen.bind(this)),this.darkroom.addEventListener("crop:close",this.cropClose.bind(this)),this.darkroom.addEventListener("crop:update",this.cropUpdate.bind(this)),this.darkroom.addEventListener("history:navigate",this.imageUpdate.bind(this)))},_getPlugin:function(){return this.darkroom.getPlugin(this.options.plugin)},cropOpen:function(){this.imageUpdate();this.cropDimensionsButton.hide(!1)},cropClose:function(){this.cropDimensionsButton.hide(!0)},imageUpdate:function(){var n=this.darkroom.canvas;this._update(n.getWidth(),n.getHeight())},cropUpdate:function(){var n=this._getPlugin();if(!n.cropZone)return this.imageUpdate();this._update(n.cropZone.getWidth(),n.cropZone.getHeight())},_update:function(n,t){var n=Math.floor(n),t=Math.floor(t),r=this._getPlugin(),i=n+this.options.glue+t;r.options._constrain&&(i=this.options.lock+i);this.cropDimensionsButton.element.html(i)}})})(window,document,Darkroom);
(function(n,t,i,r){"use strict";i.plugins.croppresets=i.Plugin.extend({defaults:{plugin:"crop",glue:"x",presets:[],offset:{x:0,y:0},action:""},buttonGroup:null,primary:{x:0,y:0,constrain:!1},initialize:function(){var n;(this._getPlugin()||(n=!0),this.buttonGroup=this.darkroom.toolbar.createButtonGroup(),this.cropPresetsButton=this.buttonGroup.createButton({action:"crop-presets",disabled:!1,hide:!0}),this.cropPresetsNoneButton=this.buttonGroup.createButton({action:"crop-preset-none",disabled:!0}),this.cropPresetsTmplButton=this.buttonGroup.createButton({action:"crop-preset-tmpl"}),this.cropPresetsButtons={},n)||(this.darkroom.addEventListener("crop:open",this.cropOpen.bind(this)),this.darkroom.addEventListener("crop:close",this.cropClose.bind(this)),this._load())},_getPlugin:function(){return this.darkroom.getPlugin(this.options.plugin)},cropOpen:function(){this.primary.x&&this.primary.y&&this._update(this.primary.x,this.primary.y,this.primary.constrain);this.cropPresetsButton.hide(!1)},cropClose:function(){this.cropPresetsButton.hide(!0)},getRow:function(n){return n.element.parent()},getButton:function(n){return n.children()},_load:function(){if(this.options.presets.length){var n=this.getRow(this.cropPresetsTmplButton);r.each(this.options.presets,r.proxy(function(t,i){i.primary&&(this.primary.x=i.x,this.primary.y=i.y,this.primary.constrain=i.constrain);var e=n.clone(),u=this.getButton(e),f=this.darkroom.options.base.id({length:6,special:"",numeric:""});u.html(i.x+this.options.glue+i.y);u.attr("title",u.html());u.attr(this.options.action,f);n.after(e);this.cropPresetsButtons[f]=this.buttonGroup.createButton({action:f,refresh:!0});this.cropPresetsButtons[f].addEventListener("click",r.proxy(function(){this._update(i.x,i.y,i.constrain)},this))},this));this.getRow(this.cropPresetsNoneButton).hide();this.getRow(this.cropPresetsTmplButton).hide()}else this.getRow(this.cropPresetsTmplButton).hide()},_update:function(n,t,i){if(n&&t){var r=this._getPlugin(),u=this.darkroom.options.base.el.holder,f=u.scrollLeft()+parseInt(this.options.offset.x),e=u.scrollTop()+parseInt(this.options.offset.y);r.options._constrain=i;r.cropZone.scaleX=1;r.cropZone.scaleY=1;r.selectZone(f,e,parseInt(n),parseInt(t))}}})})(window,document,Darkroom,window.jQuery);
(function(n,t,i){"use strict";i.plugins.resize=i.Plugin.extend({defaults:{plugin:"resize",handle:{size:null,colour:null,border:null,overlay:null},size:{x:75,y:75},min:{x:1,y:1},ratio:null,uniscale:!1,draggable:!1,resizeCallback:function(){this.toggleResize()},okCallback:function(){this.resizeCurrentZone()},cancelCallback:function(){this.releaseFocus()}},base:null,active:!1,overlay:null,zone:null,scale:{x:null,y:null},position:{x:null,y:null},initialize:function(){this.base=this.darkroom.options.base;var n=this.darkroom.toolbar.createButtonGroup();this.resizeButton=n.createButton({action:"resize"});this.resizeApplyButton=n.createButton({action:"resize-apply",hide:!0});this.resizeCancelButton=n.createButton({action:"resize-cancel",hide:!0});this.base.options.scroller&&(this.darkroom.addEventListener("resize:open",this.scrollOff.bind(this)),this.darkroom.addEventListener("resize:close",this.scrollOn.bind(this)));this.resizeButton.addEventListener("click",this.options.resizeCallback.bind(this));this.resizeApplyButton.addEventListener("click",this.options.okCallback.bind(this));this.resizeCancelButton.addEventListener("click",this.options.cancelCallback.bind(this));this.darkroom.canvas.on("mouse:down",this.onMouseDown.bind(this));this.darkroom.canvas.on("object:moving",this.onObjectMoving.bind(this));this.darkroom.canvas.on("object:scaling",this.onObjectScaling.bind(this));this.darkroom.addEventListener("action:open",this.resizeToggle.bind(this));this.darkroom.addEventListener("history:navigate",this.releaseFocus.bind(this));this.darkroom.addEventListener("save:before",this.releaseFocus.bind(this));this.darkroom.addEventListener("image:change",this.releaseFocus.bind(this))},scrollOn:function(){this.base.scroller.kinetic("attach")},scrollOff:function(){this.base.scroller.kinetic("detach")},hasFocus:function(){return this.active},toggleResize:function(){this.hasFocus()?this.releaseFocus():this.requireFocus()},requireFocus:function(){this.active=!0;this.resizeButton.element.removeClass(this.darkroom.options.base.options.css.radius.value);this.resizeButton.active(!0);this.resizeApplyButton.hide(!1);this.resizeCancelButton.hide(!1);this.renderOverlay();this.renderZone();this.darkroom.dispatchEvent("resize:open");this.darkroom.action("resize")},releaseFocus:function(){this.hasFocus()&&(this.active=!1,this.resizeButton.element.addClass(this.darkroom.options.base.options.css.radius.value),this.resizeButton.active(!1),this.resizeApplyButton.hide(!0),this.resizeCancelButton.hide(!0),this.unRenderOverlay(),this.unRenderZone(),this.darkroom.dispatchEvent("resize:close"),this.darkroom.action())},resizeCurrentZone:function(){var n=Math.floor(this.zone.getWidth()),t=Math.floor(this.zone.getHeight());this.releaseFocus();this.darkroom.image.setWidth(n);this.darkroom.image.setHeight(t);this.darkroom.image.setCoords();this.darkroom.canvas.renderAll();this.darkroom.canvas.setWidth(n);this.darkroom.canvas.setHeight(t);this.darkroom.canvas.calcOffset();this.darkroom.dispatchEvent("image:change")},renderOverlay:function(){this.overlay||(this.overlay=new fabric.Rect({left:0,top:0,width:this.getX(),height:this.getY(),fill:this.options.handle.overlay,selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1,hasRotatingPoint:!1}),this.darkroom.canvas.add(this.overlay))},renderZone:function(){this.darkroom.image.cloneAsImage(function(n){this.zone=n;this._renderZone()}.bind(this))},_renderZone:function(){var t=!this.options.uniscale,n=!this.options.draggable;this.zone.setWidth(Math.floor(this.zone.getWidth()/100*this.options.size.x));this.zone.setHeight(Math.floor(this.zone.getHeight()/100*this.options.size.y));this.zone.set({left:0,top:0,selectable:!0,evented:!0,lockMovementX:n,lockMovementY:n,lockRotation:!0,lockScalingX:!1,lockScalingY:!1,lockUniScaling:t,hasControls:!0,hasBorders:!1,hasRotatingPoint:!1,transparentCorners:!1});this.options.handle.size&&this.zone.set("cornerSize",this.options.handle.size);this.options.handle.colour&&this.zone.set("cornerColor",this.options.handle.colour);this.options.handle.border&&this.zone.set("borderColor",this.options.handle.border);this.darkroom.canvas.add(this.zone);this.darkroom.canvas.setActiveObject(this.zone);this.darkroom.dispatchEvent("resize:insert")},unRenderOverlay:function(){this.overlay!==null&&(this.overlay.remove(),this.overlay=null)},unRenderZone:function(){this.zone!==null&&(this.zone.remove(),this.zone=null)},getX:function(){return this.getSize("x")},getY:function(){return this.getSize("y")},getSize:function(n){switch(n){case"x":return this.darkroom.canvas.getWidth();case"y":return this.darkroom.canvas.getHeight()}},resizeToggle:function(){this.darkroom.options.action&&this.darkroom.options.action!==this.options.plugin&&this.hasFocus()&&this.toggleResize()},onMouseDown:function(){this.hasFocus()&&(this.darkroom.canvas.getActiveObject()||this.darkroom.canvas.setActiveObject(this.zone))},onObjectMoving:function(){},onObjectScaling:function(n){var u,t;if(this.hasFocus()&&(u=!1,t=n.target,t===this.zone)){var r=this.darkroom.canvas,e=r.getPointer(n.e),o=e.x,s=e.y,i={x:t.getLeft(),y:t.getTop()},f={x:t.getLeft()+t.getWidth(),y:t.getTop()+t.getHeight()};this.options.ratio!==null&&(i.x<0||f.x>r.getWidth()||i.y<0||f.y>r.getHeight())&&(u=!0);(i.x<0||f.x>r.getWidth()||u)&&(t.setScaleX(this.scale.x||1),this.options.uniscale||(t.setScaleY(this.scale.y||1),t.setTop(this.position.y)));i.x<0&&t.setLeft(0);(i.y<0||f.y>r.getHeight()||u)&&(t.setScaleY(this.scale.y||1),this.options.uniscale||(t.setScaleX(this.scale.x||1),t.setLeft(this.position.x)));i.y<0&&t.setTop(0);t.getWidth()<this.options.min.x&&t.scaleToWidth(this.options.min.x);t.getHeight()<this.options.min.y&&t.scaleToHeight(this.options.min.y);this.scale.x=t.getScaleX();this.scale.y=t.getScaleY();this.position.x=t.getLeft();this.position.y=t.getTop();this.darkroom.dispatchEvent("resize:update")}}})})(window,document,Darkroom);
(function(n,t,i){"use strict";i.plugins.resizedimensions=i.Plugin.extend({defaults:{plugin:"resize",glue:"x",error:"! "},initialize:function(){var n,t;(this._getPlugin()||(n=!0),t=this.darkroom.toolbar.createButtonGroup(),this.resizeDimensionsButton=t.createButton({action:"resize-dimensions",disabled:!1,hide:!0}),n)||(this.darkroom.addEventListener("resize:open",this.resizeOpen.bind(this)),this.darkroom.addEventListener("resize:close",this.resizeClose.bind(this)),this.darkroom.addEventListener("resize:insert",this.resizeInsert.bind(this)),this.darkroom.addEventListener("resize:update",this.resizeUpdate.bind(this)),this.darkroom.addEventListener("resize:fail",this.resizeError.bind(this)),this.darkroom.addEventListener("history:navigate",this.resizeUpdate.bind(this)))},_getPlugin:function(){return this.darkroom.getPlugin(this.options.plugin)},resizeOpen:function(){this.resizeDimensionsButton.hide(!1)},resizeClose:function(){this.resizeDimensionsButton.hide(!0)},resizeInsert:function(){this.resizeUpdate()},imageUpdate:function(){var n=this.darkroom.canvas;this._update(n.getWidth(),n.getHeight())},resizeError:function(){if(!this.resizeDimensionsButton.element.find("i").length){var n=this.resizeDimensionsButton.element.html();n=this.options.error+n;this.resizeDimensionsButton.element.html(n)}},resizeUpdate:function(){var n=this._getPlugin();if(!n.zone)return this.imageUpdate();this._update(n.zone.getWidth(),n.zone.getHeight())},_update:function(n,t){var n=Math.floor(n),t=Math.floor(t),i=n+this.options.glue+t;this.resizeDimensionsButton.element.html(i)}})})(window,document,Darkroom);
(function(n,t,i,r){"use strict";i.plugins.resizepresets=i.Plugin.extend({defaults:{plugin:"resize",glue:{px:"x",pc:"%",a:"auto"},presets:[],offset:{x:0,y:0},action:"",messages:{big:"Too Large!",small:"Too Small!",invalid:"Invalid!"}},buttonGroup:null,primary:{x:0,y:0,pc:0},initialize:function(){var n;(this._getPlugin()||(n=!0),this.buttonGroup=this.darkroom.toolbar.createButtonGroup(),this.resizePresetsButton=this.buttonGroup.createButton({action:"resize-presets",disabled:!1,hide:!0}),this.resizePresetsNoneButton=this.buttonGroup.createButton({action:"resize-preset-none",disabled:!0}),this.resizePresetsTmplButton=this.buttonGroup.createButton({action:"resize-preset-tmpl"}),this.resizePresetsButtons={},n)||(this.darkroom.addEventListener("resize:open",this.resizeOpen.bind(this)),this.darkroom.addEventListener("resize:close",this.resizeClose.bind(this)),this._load())},_getPlugin:function(){return this.darkroom.getPlugin(this.options.plugin)},resizeOpen:function(){(this.primary.pc||this.primary.x||this.primary.y)&&this._update(this.primary.x,this.primary.y,this.primary.pc);this.resizePresetsButton.hide(!1)},resizeClose:function(){this.resizePresetsButton.hide(!0)},getRow:function(n){return n.element.parent()},getButton:function(n){return n.children()},_load:function(){if(this.options.presets.length){var n=this.getRow(this.resizePresetsTmplButton);r.each(this.options.presets,r.proxy(function(t,i){i.primary&&(this.primary.x=i.x||0,this.primary.y=i.y||0,this.primary.pc=i.pc||0);var e=n.clone(),u=this.getButton(e),f=this.darkroom.options.base.id({length:6,special:"",numeric:""});i.pc?u.html(i.pc+this.options.glue.pc):u.html((i.x||this.options.glue.a)+this.options.glue.px+(i.y||this.options.glue.a));u.attr("title",u.html());u.attr(this.options.action,f);n.after(e);this.resizePresetsButtons[f]=this.buttonGroup.createButton({action:f,refresh:!0});this.resizePresetsButtons[f].addEventListener("click",r.proxy(function(){this._update(i.x,i.y,i.pc)},this))},this));this.getRow(this.resizePresetsNoneButton).hide();this.getRow(this.resizePresetsTmplButton).hide()}else this.getRow(this.resizePresetsTmplButton).hide()},_update:function(n,t,i){var o=this._getPlugin(),e=o.zone,u=0,f=0,r={x:o.getX(),y:o.getY()},s;return i?(u=Math.floor(r.x/100*(100-i)),f=Math.floor(r.y/100*(100-i))):(n||t)&&(s={x:n/r.x,y:t/r.y},u=n||Math.floor(r.x*s.y),f=t||Math.floor(r.y*s.x)),u&&f?u<0||f<0?(this.darkroom.dispatchEvent("resize:fail"),this.darkroom.options.base.message(this.options.messages.small,"error"),!1):u>r.x||f>r.y?(this.darkroom.dispatchEvent("resize:fail"),this.darkroom.options.base.message(this.options.messages.big,"error"),!1):(e.scaleX=1,e.scaleY=1,e.setWidth(u),e.setHeight(f),e.setCoords(),this.darkroom.canvas.renderAll(),this.darkroom.dispatchEvent("resize:update"),!0):(this.darkroom.dispatchEvent("resize:fail"),this.darkroom.options.base.message(this.options.messages.invalid,"error"),!1)}})})(window,document,Darkroom,window.jQuery);
/**
 jQuery.kinetic v2.0.6
 Dave Taylor http://davetayls.me
 @license The MIT License (MIT)
 @preserve Copyright (c) 2012 Dave Taylor http://davetayls.me
 */
(function(n){"use strict";var i="kinetic-active",r,t;window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}());n.support=n.support||{};n.extend(n.support,{touch:"ontouchend"in document});r=function(){return!1};t=function(t,i){return this.settings=i,this.el=t,this.$el=n(t),this._initElements(),this};t.DATA_KEY="kinetic";t.DEFAULTS={cursor:"move",decelerate:!0,triggerHardware:!1,y:!0,x:!0,slowdown:.9,maxvelocity:40,throttleFPS:60,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}};t.prototype.start=function(t){this.settings=n.extend(this.settings,t);this.velocity=t.velocity||this.velocity;this.velocityY=t.velocityY||this.velocityY;this.settings.decelerate=!1;this._move()};t.prototype.end=function(){this.settings.decelerate=!0};t.prototype.stop=function(){this.velocity=0;this.velocityY=0;this.settings.decelerate=!0;n.isFunction(this.settings.stopped)&&this.settings.stopped.call(this)};t.prototype.detach=function(){this._detachListeners();this.$el.removeClass(i).css("cursor","")};t.prototype.attach=function(){this.$el.hasClass(i)||(this._attachListeners(this.$el),this.$el.addClass(i).css("cursor",this.settings.cursor))};t.prototype._initElements=function(){this.$el.addClass(i);n.extend(this,{xpos:null,prevXPos:!1,ypos:null,prevYPos:!1,mouseDown:!1,throttleTimeout:1e3/this.settings.throttleFPS,lastMove:null,elementFocused:null});this.velocity=0;this.velocityY=0;n(document).mouseup(n.proxy(this._resetMouse,this)).click(n.proxy(this._resetMouse,this));this._initEvents();this.$el.css("cursor",this.settings.cursor);this.settings.triggerHardware&&this.$el.css({"-webkit-transform":"translate3d(0,0,0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})};t.prototype._initEvents=function(){var t=this;this.settings.events={touchStart:function(n){var i;t._useTarget(n.target,n)&&(i=n.originalEvent.touches[0],t._start(i.clientX,i.clientY),n.stopPropagation())},touchMove:function(n){var i;t.mouseDown&&(i=n.originalEvent.touches[0],t._inputmove(i.clientX,i.clientY),n.preventDefault&&n.preventDefault())},inputDown:function(n){t._useTarget(n.target,n)&&(t._start(n.clientX,n.clientY),t.elementFocused=n.target,n.target.nodeName==="IMG"&&n.preventDefault(),n.stopPropagation())},inputEnd:function(n){t._useTarget(n.target,n)&&(t._end(),t.elementFocused=null,n.preventDefault&&n.preventDefault())},inputMove:function(n){t.mouseDown&&(t._inputmove(n.clientX,n.clientY),n.preventDefault&&n.preventDefault())},scroll:function(i){n.isFunction(t.settings.moved)&&t.settings.moved.call(t,t.settings);i.preventDefault&&i.preventDefault()},inputClick:function(n){if(Math.abs(t.velocity)>0)return n.preventDefault(),!1},dragStart:function(n){if(t._useTarget(n.target,n)&&t.elementFocused)return!1}};this._attachListeners(this.$el,this.settings)};t.prototype._inputmove=function(t,i){var r=this.$el,s=this.el;if((!this.lastMove||new Date>new Date(this.lastMove.getTime()+this.throttleTimeout))&&(this.lastMove=new Date,this.mouseDown&&(this.xpos||this.ypos))){this.elementFocused&&(n(this.elementFocused).blur(),this.elementFocused=null,r.focus());this.settings.decelerate=!1;this.velocity=this.velocityY=0;var u=this.scrollLeft(),f=this.scrollTop(),e=t-this.xpos,o=i-this.ypos;this.scrollLeft(this.settings.x?u-e:u);this.scrollTop(this.settings.y?f-o:f);this.prevXPos=this.xpos;this.prevYPos=this.ypos;this.xpos=t;this.ypos=i;this._calculateVelocities();this._setMoveClasses(this.settings.movingClass);n.isFunction(this.settings.moved)&&this.settings.moved.call(r,this.settings)}};t.prototype._calculateVelocities=function(){this.velocity=this._capVelocity(this.prevXPos-this.xpos,this.settings.maxvelocity);this.velocityY=this._capVelocity(this.prevYPos-this.ypos,this.settings.maxvelocity)};t.prototype._end=function(){this.xpos&&this.prevXPos&&this.settings.decelerate===!1&&(this.settings.decelerate=!0,this._calculateVelocities(),this.xpos=this.prevXPos=this.mouseDown=!1,this._move())};t.prototype._useTarget=function(t,i){return n.isFunction(this.settings.filterTarget)?this.settings.filterTarget.call(this,t,i)!==!1:!0};t.prototype._start=function(n,t){this.mouseDown=!0;this.velocity=this.prevXPos=0;this.velocityY=this.prevYPos=0;this.xpos=n;this.ypos=t};t.prototype._resetMouse=function(){this.xpos=!1;this.ypos=!1;this.mouseDown=!1};t.prototype._decelerateVelocity=function(n,t){return Math.floor(Math.abs(n))===0?0:n*t};t.prototype._capVelocity=function(n,t){var i=n;return n>0?n>t&&(i=t):n<0-t&&(i=0-t),i};t.prototype._setMoveClasses=function(n){var t=this.settings,i=this.$el;i.removeClass(t.movingClass.up).removeClass(t.movingClass.down).removeClass(t.movingClass.left).removeClass(t.movingClass.right).removeClass(t.deceleratingClass.up).removeClass(t.deceleratingClass.down).removeClass(t.deceleratingClass.left).removeClass(t.deceleratingClass.right);this.velocity>0&&i.addClass(n.right);this.velocity<0&&i.addClass(n.left);this.velocityY>0&&i.addClass(n.down);this.velocityY<0&&i.addClass(n.up)};t.prototype._move=function(){var u=this.$el,r=this.el,i=this,t=i.settings;t.x&&r.scrollWidth>0?(this.scrollLeft(this.scrollLeft()+this.velocity),Math.abs(this.velocity)>0&&(this.velocity=t.decelerate?i._decelerateVelocity(this.velocity,t.slowdown):this.velocity)):this.velocity=0;t.y&&r.scrollHeight>0?(this.scrollTop(this.scrollTop()+this.velocityY),Math.abs(this.velocityY)>0&&(this.velocityY=t.decelerate?i._decelerateVelocity(this.velocityY,t.slowdown):this.velocityY)):this.velocityY=0;i._setMoveClasses(t.deceleratingClass);n.isFunction(t.moved)&&t.moved.call(this,t);Math.abs(this.velocity)>0||Math.abs(this.velocityY)>0?this.moving||(this.moving=!0,window.requestAnimationFrame(function(){i.moving=!1;i._move()})):i.stop()};t.prototype._getScroller=function(){var t=this.$el;return(this.$el.is("body")||this.$el.is("html"))&&(t=n(window)),t};t.prototype.scrollLeft=function(n){var t=this._getScroller();if(typeof n=="number")t.scrollLeft(n),this.settings.scrollLeft=n;else return t.scrollLeft()};t.prototype.scrollTop=function(n){var t=this._getScroller();if(typeof n=="number")t.scrollTop(n),this.settings.scrollTop=n;else return t.scrollTop()};t.prototype._attachListeners=function(){var i=this.$el,t=this.settings;n.support.touch&&i.bind("touchstart",t.events.touchStart).bind("touchend",t.events.inputEnd).bind("touchmove",t.events.touchMove);i.mousedown(t.events.inputDown).mouseup(t.events.inputEnd).mousemove(t.events.inputMove);i.click(t.events.inputClick).scroll(t.events.scroll).bind("selectstart",r).bind("dragstart",t.events.dragStart)};t.prototype._detachListeners=function(){var i=this.$el,t=this.settings;n.support.touch&&i.unbind("touchstart",t.events.touchStart).unbind("touchend",t.events.inputEnd).unbind("touchmove",t.events.touchMove);i.unbind("mousedown",t.events.inputDown).unbind("mouseup",t.events.inputEnd).unbind("mousemove",t.events.inputMove);i.unbind("click",t.events.inputClick).unbind("scroll",t.events.scroll).unbind("selectstart",r).unbind("dragstart",t.events.dragStart)};n.Kinetic=t;n.fn.kinetic=function(i,r){return this.each(function(){var u=n(this),f=u.data(t.DATA_KEY),e=n.extend({},t.DEFAULTS,u.data(),typeof i=="object"&&i);f||u.data(t.DATA_KEY,f=new t(this,e));typeof i=="string"&&f[i](r)})}})(window.jQuery||window.Zepto);
(function(n){var t={},i=function(n){this.initialise(n)};i.prototype=n.extend({},n.fn.arkbase(),{constructor:i,options:{css:{control:'[data-toggle="ark-collapse"]',group:"[data-group]"},data:{target:"data-target",group:"data-group",active:"data-active"},html:{},namespace:".arkcollapse",permission:null,group:null,animate:100},active:!0,value:null,el:{root:null,controls:{}},initialise:function(t){this.set(t);this.el.root=n(this.options.css.root);this.controls();this.addControlEvents();this.requests();this.setDefault()},controls:function(){n(document).trigger("arkcollapse:before:controls");this.el.controls=this.el.root.find(this.options.css.control);this.el.controls.each(n.proxy(function(t,i){n(i).attr(this.options.data.group)!=this.options.group&&delete this.el.controls[t]},this));n(document).trigger("arkcollapse:after:controls",[this.el.controls])},addControlEvents:function(){n(document).trigger("arkcollapse:before:add",[this.el.controls]);var t=this;this.el.controls.on("click"+this.options.namespace,function(i){var r;if(i.preventDefault(),i.stopPropagation(),!t.active)return t.message(t.options.html.errors.permission,"error"),t.debug("addControlEvents","This Collapser is Currently Disabled."),!1;if(r=n(this).attr(t.options.data.value.data),r===t.value)return!1;t.value=r;var u=n(this).attr(t.options.data.target),e=n(this).attr(t.options.data.group),f=t.el.root.find(u),o=t.el.root.find(t.options.css.group);f.length&&f.show(t.options.animate?t.options.animate:null);o.each(function(i,r){var o=n(r).attr(t.options.data.target),f;n(r).attr(t.options.data.group)==e&&o!=u&&(f=t.el.root.find(o),f.length&&f.hide())})});n(document).trigger("arkcollapse:after:add",[this.el.controls])},setDefault:function(){n(document).trigger("arkcollapse:before:default",[this.el.controls]);this.el.controls.each(n.proxy(function(t,i){n(i).attr(this.options.data.active)&&(n(document).triggerHandler("arkcollapse:request:toggle",{value:n(i).attr(this.options.data.value.data),group:this.options.group}),n(i).removeAttr(this.options.data.active),n(i).addClass(this.options.css.bootstrap.active.value))},this));this.options.permission&&!this.permission(this.options.permission)&&this.el.controls.remove();n(document).trigger("arkcollapse:after:default",[this.el.controls])},requests:function(){n(document).on("arkcollapse:request:state",n.proxy(function(n,t){t.group===this.options.group&&(t.type==="on"?(this.active=!0,this.el.controls.removeAttr("disabled")):(this.active=!1,this.el.controls.attr("disabled","disabled")))},this));n(document).on("arkcollapse:request:toggle",n.proxy(function(t,i){i.group===this.options.group&&this.active&&this.el.controls.each(n.proxy(function(t,r){n(r).attr(this.options.data.value.data)===i.value&&(n(r).trigger("click"),typeof n(r).button=="function"&&n(r).button("toggle"))},this))},this));n(document).on("arkcollapse:request:value",n.proxy(function(n,t){if(t.group===this.options.group)return this.value},this))}});n.fn.arkcollapse=function(n){return t.hasOwnProperty(n.group)||(t[n.group]=new i(n)),t[n.group]}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{form:"#form-subactions-deleteitems",stack:"#stack-subactions-deleteitems",path:"#path-subactions-deleteitems",folders:"#folders-subactions-deleteitems",files:"#files-subactions-deleteitems",control:"#ctrl-subactions-deleteitems"},html:{errors:{confirm:{all:"Proceed?",folders:"Proceed?",folder:"Proceed?",files:"Proceed?",file:"Proceed?"},path:"No Path!",select:"No Folders or File!"}},namespace:".deleteitems",confirm:!0},active:!0,el:{root:null,form:null,stack:null,path:null,folders:null,files:null,controls:null},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),this.el.form=this.el.root.find(this.options.css.form),this.el.controls=this.el.root.find(this.options.css.control),this.el.stack=this.el.form.find(this.options.css.stack),this.el.path=this.el.form.find(this.options.css.path),this.el.folders=this.el.form.find(this.options.css.folders),this.el.files=this.el.form.find(this.options.css.files),n.views){if(!this.el.form)return this.message('"Delete Items" Functionality Error'),this.debug("initialise","Delete Items Form Element Not Found"),!1}else return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.addFormEvents();this.requests();this.toggle()},addFormEvents:function(){n(document).trigger("deleteitems:before:event",[this.el.form]);n(this.el.controls).on("click"+this.options.namespace,n.proxy(function(){this.submit()},this));n(this).delay(0).queue(function(){var t=n(document).triggerHandler("observer:request:all"),i=n(document).triggerHandler("observer:request:active",{type:"stack"});n.each(t,n.proxy(function(t){var i=n(document).triggerHandler("observer:request:active",{type:"folders",stack:t}),r=n(document).triggerHandler("observer:request:active",{type:"files",stack:t});n.observe(i,r,n.proxy(function(){this.toggle(i,r)},this))},this));n.observe(i,"*",n.proxy(function(t){var i=n(document).triggerHandler("observer:request:active",{type:"folders",stack:t.target.value}),r=n(document).triggerHandler("observer:request:active",{type:"files",stack:t.target.value});this.toggle(i,r)},this));n(this).dequeue});n(document).trigger("deleteitems:after:event",[this.el.form])},submit:function(){var u;if(n(document).trigger("deleteitems:before:submit",[this.el.form]),!this.active)return this.message(this.options.html.errors.permission,"error"),this.debug("submit","The Delete Logic is Currently Disabled."),!1;var r=n(document).triggerHandler("observer:request:active",{type:"stack"}),f=n(document).triggerHandler("observer:request:active",{type:"path",stack:r.value}),t=n(document).triggerHandler("observer:request:active",{type:"folders",stack:r.value}),i=n(document).triggerHandler("observer:request:active",{type:"files",stack:r.value});t.length&&!i.length?u=t.length>1?this.options.html.errors.confirm.folders.replace("%s",t.length):this.options.html.errors.confirm.folder.replace("%s",t[0]):!t.length&&i.length?u=i.length>1?this.options.html.errors.confirm.files.replace("%s",i.length):this.options.html.errors.confirm.file.replace("%s",i[0]):t.length&&i.length&&(u=this.options.html.errors.confirm.all.replace("%foldercount",t.length).replace("%filecount",i.length));r.value&&f.path&&this.el.stack&&this.el.path?this.el.folders&&this.el.files?t.length+i.length?this.options.confirm&&!confirm(u)?this.debug("submit","Delete Process Not Confirmed by User"):typeof JSON=="object"?(this.el.stack.val(r.value),this.el.path.val(f.path),this.el.folders.val(JSON.stringify(t)),this.el.files.val(JSON.stringify(i)),n(this.el.form).submit()):(this.message(this.options.html.errors.support,"error",{wink:"slowest"}),this.debug("submit","The JSON Library is Not Available")):(this.message(this.options.html.errors.select,"warning"),this.debug("submit","No Count of Folders & Files Observers")):(this.message(this.options.html.errors.generic,"error",{wink:"slower"}),this.debug("submit","The Folders/Files Input Could Not Be Found")):(this.message(this.options.html.errors.path),this.debug("submit","The Observer Active Stack Path Could Not be Found"));n(document).trigger("deleteitems:after:submit",[this.el.form])},toggle:function(t,i){n(document).trigger("deleteitems:before:toggle",[t,i]);t=n.isArray(t)?t:[];i=n.isArray(i)?i:[];t.length||i.length?n(document).triggerHandler("deleteitems:request:state",{type:"on"}):n(document).triggerHandler("deleteitems:request:state",{type:"off"});n(document).trigger("deleteitems:after:toggle",[t,i])},requests:function(){n(document).on("deleteitems:request:state",n.proxy(function(n,t){t.type==="on"?(this.active=!0,this.el.controls.removeAttr("disabled")):(this.active=!1,this.el.controls.attr("disabled","disabled"))},this))}});n.fn.deleteitems=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{control:"#ctrl-subactions-insertfile",loading:"#load-subactions-insertfile"},data:{file:{value:"file",data:"data-file"}},html:{errors:{select:"Error!"}},render:!0,namespace:".insertfile"},el:{root:null,controls:null},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),this.el.controls=this.el.root.find(this.options.css.control),this.el.loading=this.el.root.find(this.options.css.loading),!n.views)return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;if(!this.options.render)return this.disable(),this.debug("initialise",'The "Insert File" Class Was Instructed Not to Render.',"info"),!1;this.addFormEvents()},disable:function(){n(document).trigger("insertfile:before:disable",[this.el.controls]);this.el.controls.addClass(this.options.css.hide.value);n(document).trigger("insertfile:after:disable",[this.el.controls])},addFormEvents:function(){n(document).trigger("insertfile:before:event",[this.el.form]);this.el.controls.on("click"+this.options.namespace,n.proxy(function(){this.submit()},this));n(document).on("edit:request:file",n.proxy(function(n,t){if(this.el.loading.length){var r=this.el.loading.data(this.options.data.file.value),i=t.file?t.file:"";this.el.loading.html(this.el.loading.html().replace(r,i));this.el.loading.data(this.options.data.file.value,i);this.toggle("loading")}else this.debug("submit","A Loading Button Could Not be Found.");return!0},this));n(document).on("edit:request:close edit:request:save edit:request:browse edit:request:insert",n.proxy(function(){return this.toggle("normal")},this));n(document).trigger("insertfile:after:event",[this.el.form])},submit:function(){n(document).trigger("insertfile:before:submit",[this.el.form]);var t=n(document).triggerHandler("observer:request:active",{type:"stack"}),i=n(document).triggerHandler("observer:request:active",{type:"path",stack:t.value}),r=n(document).triggerHandler("observer:request:active",{type:"files",stack:t.value});t.value&&i.path?r.length?n(document).triggerHandler("edit:request:file",{file:r[0],stack:t.value,path:i.path}):(this.message(this.options.html.errors.select,"warning"),this.debug("submit","No Count of Files Observers")):(this.message(this.options.html.errors.path),this.debug("submit","The Observer Active Stack Path Could Not be Found"));n(document).trigger("insertfile:after:submit",[this.el.form])},toggle:function(t){n(document).trigger("insertfile:before:toggle",[t]);switch(t){case"loading":this.el.loading.removeClass(this.options.css.hide.value);this.el.controls.addClass(this.options.css.hide.value);break;case"normal":this.el.loading.addClass(this.options.css.hide.value);this.el.controls.removeClass(this.options.css.hide.value)}return n(document).trigger("insertfile:after:toggle",[t]),!0}});n.fn.insertfile=function(n){return new t(n)}})(window.jQuery);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{form:"#form-subactions-upload",statistics:"#stats-subactions-upload",droparea:"#drop-subactions-upload",pastearea:"#paste-subactions-upload",queue:"#queue-subactions-upload",toggle:"#toggle-actions-upload",stack:"#stack-subactions-upload",path:"#path-subactions-upload",control:"#ctrl-subactions-upload",tooltip:{value:"tooltip",selector:".tooltip"},tip:{prefix:"tooltip-",extra:"tooltip-lg"},templates:{before:"#tmpl-upload-before",after:"#tmpl-upload-after",more:"#tmpl-upload-more"}},data:{count:"data-count",complete:"data-complete"},html:{ajax:"index.php",start:"Uploading",status:"Uploading",errors:{path:"No Upload Path!",field:"No File(s)!",observer:"Cannot Display File!"}},documentdrop:!1,autoupload:!1,namespace:".upload"},active:!0,el:{root:null,toggle:null,form:null,statistics:null,droparea:null,pastearea:null,queue:null,stack:null,path:null,controls:null},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),this.el.content=this.el.root.find(this.options.css.content),this.el.toggle=this.el.root.find(this.options.css.toggle),this.el.form=this.el.root.find(this.options.css.form),this.el.statistics=this.el.form.find(this.options.css.statistics),this.el.droparea=this.el.form.find(this.options.css.droparea),this.el.pastearea=this.el.form.find(this.options.css.pastearea),this.el.queue=this.el.form.find(this.options.css.queue),this.el.stack=this.el.form.find(this.options.css.stack),this.el.path=this.el.form.find(this.options.css.path),this.el.controls=this.el.form.find(this.options.css.control),n.views){if(!this.el.form.length)return this.message('"Upload" Functionality Error'),this.debug("initialise","Upload Form Element Not Found"),!1}else return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.assets();this.setup();this.addFormEvents();this.requests()},assets:function(){n(document).trigger("upload:before:assets");n.views.helpers({tooltip:function(n,t){return t=t||" ",n.length?n.join(t):""},type:function(t){var i=t.match(/(image|audio|video){1}(\/){1}/);return n.isArray(i)&&i.length===3?i[1]:""}});n(document).trigger("upload:after:assets")},setup:function(){if(this.options.documentdrop||n(document).bind("drop dragover",function(n){n.preventDefault()}),this.el.form.off("focusout change"),this.el.form.fileupload({url:this.options.html.ajax,dropZone:this.el.droparea,pasteZone:this.el.pastearea,filesContainer:this.el.queue,autoUpload:this.options.autoupload,uploadTemplateId:this.options.css.templates.before,downloadTemplateId:this.options.css.templates.after,uploadTemplate:this.before,downloadTemplate:this.after}),this.el.statistics.length){var t=n.templates(this.options.css.templates.more).render({size:{}});this.el.statistics.html(t)}},addFormEvents:function(){n(document).on("fileuploadsubmit",this.options.css.form,n.proxy(function(){var r,t,i;return this.active?(r=this.el.queue.attr(this.options.data.count)-this.el.queue.attr(this.options.data.complete),!r)?(this.message(this.options.html.errors.field),this.debug("fileuploadsubmit","The Upload Queue is Empty."),!1):(t=n(document).triggerHandler("observer:request:active",{type:"stack"}),i=n(document).triggerHandler("observer:request:active",{type:"path",stack:t.value}),t.value&&i.path)?(this.el.stack.val(t.value),this.el.path.val(i.path),!0):(this.message(this.options.html.errors.path),this.debug("fileuploadsubmit","The Observer Active Stack Path Could Not be Found"),!1):(this.message(this.options.html.errors.permission,"error"),this.debug("fileuploadsubmit","The Upload Logic is Currently Disabled."),!1)},this));n(document).on("fileuploaddone",this.options.css.form,n.proxy(function(t,i){n.each(i.result.files,n.proxy(function(t,i){var u;if(!i.error&&i.hasOwnProperty("observer")&&i.observer.stack&&i.observer.path&&i.observer.name){var r=i.observer.stack,f=i.observer.path,e=n(document).triggerHandler("observer:request:key",{value:i.observer.name});delete i.observer.stack;delete i.observer.path;this.el.queue.attr(this.options.data.complete,parseInt(this.el.queue.attr(this.options.data.complete))+1);u=n(document).triggerHandler("observer:request:add",{type:"file",stack:r,path:f,name:e,item:i.observer});u?this.find(r,i.observer.name).length?n(document).triggerHandler("thumbnail:request:requeue",{element:this.el.content}):window.location.reload():this.message(this.options.html.errors.observer)}},this))},this));n(document).on("fileuploadstart",this.options.css.form,n.proxy(function(){this.preloader("on",{message:this.options.html.start})},this));n(document).on("fileuploadprogressall",this.options.css.form,n.proxy(function(t,i){var u=this.el.form.data().blueimpFileupload,f=Math.floor(i.loaded/i.total*100),r,e;this.preloader("update",{message:this.options.html.status.replace(this.options.html.sprintf,f)});u&&this.el.statistics.length&&(r={},r.bitrate=u._formatBitrate(i.bitrate),r.time=u._formatTime((i.total-i.loaded)*8/i.bitrate),r.percent=f.toFixed(2),r.size={},r.size.loaded=u._formatFileSize(i.loaded),r.size.total=u._formatFileSize(i.total),e=n.templates(this.options.css.templates.more).render(r),this.el.statistics.html(e))},this));n(document).on("fileuploadstop",this.options.css.form,n.proxy(function(){this.preloader("off")},this));var t=0;n(document).on("dragenter",this.options.css.form,n.proxy(function(){t++;this.el.droparea.addClass(this.options.css.bootstrap.active.value)},this));n(document).on("dragleave drop",this.options.css.form,n.proxy(function(n){t--;t&&n.type!=="drop"||this.el.droparea.removeClass(this.options.css.bootstrap.active.value)},this));n(document).on("fileuploadadd",this.options.css.form,n.proxy(function(){this.el.queue.attr(this.options.data.count,parseInt(this.el.queue.attr(this.options.data.count))+1)},this));n(document).on("fileuploadfail",this.options.css.form,n.proxy(function(n,t){t.errorThrown==="abort"&&this.el.queue.attr(this.options.data.count,parseInt(this.el.queue.attr(this.options.data.count))-1)},this));this.el.queue.on("show show.bs.tooltip",this.options.css.tooltip.selector,n.proxy(function(t){var i=n(t.target),u=i.data(this.options.data.type.value),r;i.hasClass(this.options.css.tooltip.value)&&u&&(r=n(i.data("tooltip").options.template),r&&(r.addClass(this.options.css.tip.prefix+u),r.addClass(this.options.css.tip.extra),i.data().tooltip.options.template=r.prop("outerHTML"),i.data(this.options.data.type.value,"")))},this));n(document).on("fileuploadfail",this.options.css.form,n.proxy(function(t){var r=t.hasOwnProperty("originalEvent")?t.originalEvent.target:!1,i;r&&(i=n(r).closest(this.options.css.tooltip.selector),i&&typeof i.tooltip=="function"&&i.tooltip("hide"))},this))},requests:function(){n(document).on("upload:request:state",n.proxy(function(n,t){t.type==="on"?(this.active=!0,this.el.toggle.removeAttr("disabled"),this.el.controls.removeAttr("disabled"),this.el.form.fileupload("enable")):(this.active=!1,this.el.toggle.attr("disabled","disabled"),this.el.controls.attr("disabled","disabled"),this.el.form.fileupload("disable"))},this))},before:function(t){return n.templates(t.options.uploadTemplateId).render(t)},after:function(t){return n.templates(t.options.downloadTemplateId).render(t)}});n.fn.upload=function(n){return new t(n)}})(window.jQuery);
/*! jQuery UI - v1.11.2 - 2015-01-19
* http://jqueryui.com
* Includes: widget.js
* Copyright 2015 jQuery Foundation and other contributors; Licensed MIT */

(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){var t=0,i=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,a,n;for(n=0;null!=(a=i[n]);n++)try{s=e._data(a,"events"),s&&s.remove&&e(a).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var a,n,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],a=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][a.toLowerCase()]=function(t){return!!e.data(t,a)},e[l]=e[l]||{},n=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,n,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},a=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,n=this._superApply;return this._super=e,this._superApply=a,t=s.apply(this,arguments),this._super=i,this._superApply=n,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:n?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:a}),n?(e.each(n._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete n._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var s,a,n=i.call(arguments,1),o=0,r=n.length;r>o;o++)for(s in n[o])a=n[o][s],n[o].hasOwnProperty(s)&&void 0!==a&&(t[s]=e.isPlainObject(a)?e.isPlainObject(t[s])?e.widget.extend({},t[s],a):e.widget.extend({},a):a);return t},e.widget.bridge=function(t,s){var a=s.prototype.widgetFullName||t;e.fn[t]=function(n){var o="string"==typeof n,r=i.call(arguments,1),h=this;return n=!o&&r.length?e.widget.extend.apply(null,[n].concat(r)):n,o?this.each(function(){var i,s=e.data(this,a);return"instance"===n?(h=s,!1):s?e.isFunction(s[n])&&"_"!==n.charAt(0)?(i=s[n].apply(s,r),i!==s&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+n+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+n+"'")}):this.each(function(){var t=e.data(this,a);t?(t.option(n||{}),t._init&&t._init()):e.data(this,a,new s(n,this))}),h}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(i,s){s=e(s||this.defaultElement||this)[0],this.element=e(s),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),s!==this&&(e.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===s&&this.destroy()}}),this.document=e(s.style?s.ownerDocument:s.document||s),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),i),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,a,n,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(a=o[t]=e.widget.extend({},this.options[t]),n=0;s.length-1>n;n++)a[s[n]]=a[s[n]]||{},a=a[s[n]];if(t=s.pop(),1===arguments.length)return void 0===a[t]?null:a[t];a[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var a,n=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=a=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,a=this.widget()),e.each(s,function(s,o){function r(){return t||n.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?n[o]:o).apply(n,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+n.eventNamespace,u=h[2];u?a.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var a,n,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],n=i.originalEvent)for(a in n)a in i||(i[a]=n[a]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,a,n){"string"==typeof a&&(a={effect:a});var o,r=a?a===!0||"number"==typeof a?i:a.effect||i:t;a=a||{},"number"==typeof a&&(a={duration:a}),o=!e.isEmptyObject(a),a.complete=n,a.delay&&s.delay(a.delay),o&&e.effects&&e.effects.effect[r]?s[t](a):r!==t&&s[r]?s[r](a.duration,a.easing,n):s.queue(function(i){e(this)[t](),n&&n.call(s[0]),i()})}}),e.widget});
(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery"],e)}else{e(window.jQuery)}})(function(e){"use strict";var t=0;e.ajaxTransport("iframe",function(n){if(n.async){var r=n.initialIframeSrc||"javascript:false;",i,s,o;return{send:function(u,a){i=e('<form style="display:none;"></form>');i.attr("accept-charset",n.formAcceptCharset);o=/\?/.test(n.url)?"&":"?";if(n.type==="DELETE"){n.url=n.url+o+"_method=DELETE";n.type="POST"}else if(n.type==="PUT"){n.url=n.url+o+"_method=PUT";n.type="POST"}else if(n.type==="PATCH"){n.url=n.url+o+"_method=PATCH";n.type="POST"}t+=1;s=e('<iframe src="'+r+'" name="iframe-transport-'+t+'"></iframe>').bind("load",function(){var t,o=e.isArray(n.paramName)?n.paramName:[n.paramName];s.unbind("load").bind("load",function(){var t;try{t=s.contents();if(!t.length||!t[0].firstChild){throw new Error}}catch(n){t=undefined}a(200,"success",{iframe:t});e('<iframe src="'+r+'"></iframe>').appendTo(i);window.setTimeout(function(){i.remove()},0)});i.prop("target",s.prop("name")).prop("action",n.url).prop("method",n.type);if(n.formData){e.each(n.formData,function(t,n){e('<input type="hidden"/>').prop("name",n.name).val(n.value).appendTo(i)})}if(n.fileInput&&n.fileInput.length&&n.type==="POST"){t=n.fileInput.clone();n.fileInput.after(function(e){return t[e]});if(n.paramName){n.fileInput.each(function(t){e(this).prop("name",o[t]||n.paramName)})}i.append(n.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data");n.fileInput.removeAttr("form")}i.submit();if(t&&t.length){n.fileInput.each(function(n,r){var i=e(t[n]);e(r).prop("name",i.prop("name")).attr("form",i.attr("form"));i.replaceWith(r)})}});i.append(s).appendTo(document.body)},abort:function(){if(s){s.unbind("load").prop("src",r)}if(i){i.remove()}}}}});e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var n=t&&t[0];return n&&e.isXMLDoc(n)?n:e.parseXML(n.XMLDocument&&n.XMLDocument.xml||e(n.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})});
(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery","jquery.ui.widget"],e)}else if(typeof exports==="object"){e(require("jquery"),require("./vendor/jquery.ui.widget"))}else{e(window.jQuery)}})(function(e){"use strict";function t(t){var n=t==="dragover";return function(r){r.dataTransfer=r.originalEvent&&r.originalEvent.dataTransfer;var i=r.dataTransfer;if(i&&e.inArray("Files",i.types)!==-1&&this._trigger(t,e.Event(t,{delegatedEvent:r}))!==false){r.preventDefault();if(n){i.dropEffect="copy"}}}}e.support.fileInput=!((new RegExp("(Android (1\\.[0156]|2\\.[01]))"+"|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)"+"|(w(eb)?OSBrowser)|(webOS)"+"|(Kindle/(1\\.0|2\\.[05]|3\\.0))")).test(window.navigator.userAgent)||e('<input type="file">').prop("disabled"));e.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader);e.support.xhrFormDataFileUpload=!!window.FormData;e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:true,paramName:undefined,singleFileUploads:true,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:false,limitConcurrentUploads:undefined,forceIframeTransport:false,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:true,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:true,progressInterval:100,bitrateInterval:500,autoUpload:true,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,n){t=this.messages[t]||t.toString();if(n){e.each(n,function(e,n){t=t.replace("{"+e+"}",n)})}return t},formData:function(e){return e.serializeArray()},add:function(t,n){if(t.isDefaultPrevented()){return false}if(n.autoUpload||n.autoUpload!==false&&e(this).fileupload("option","autoUpload")){n.process().done(function(){n.submit()})}},processData:false,contentType:false,cache:false},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.loaded=0;this.bitrate=0;this.getBitrate=function(e,t,n){var r=e-this.timestamp;if(!this.bitrate||!n||r>n){this.bitrate=(t-this.loaded)*(1e3/r)*8;this.loaded=t;this.timestamp=e}return this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;if(e.type(t.formData)==="function"){return t.formData(t.form)}if(e.isArray(t.formData)){return t.formData}if(e.type(t.formData)==="object"){n=[];e.each(t.formData,function(e,t){n.push({name:e,value:t})});return n}return[]},_getTotal:function(t){var n=0;e.each(t,function(e,t){n+=t.size||1});return n},_initProgressObject:function(t){var n={loaded:0,total:0,bitrate:0};if(t._progress){e.extend(t._progress,n)}else{t._progress=n}},_initResponseObject:function(e){var t;if(e._response){for(t in e._response){if(e._response.hasOwnProperty(t)){delete e._response[t]}}}else{e._response={}}},_onProgress:function(t,n){if(t.lengthComputable){var r=Date.now?Date.now():(new Date).getTime(),i;if(n._time&&n.progressInterval&&r-n._time<n.progressInterval&&t.loaded!==t.total){return}n._time=r;i=Math.floor(t.loaded/t.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0);this._progress.loaded+=i-n._progress.loaded;this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,n.bitrateInterval);n._progress.loaded=n.loaded=i;n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(r,i,n.bitrateInterval);this._trigger("progress",e.Event("progress",{delegatedEvent:t}),n);this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var n=this,r=t.xhr?t.xhr():e.ajaxSettings.xhr();if(r.upload){e(r.upload).bind("progress",function(e){var r=e.originalEvent;e.lengthComputable=r.lengthComputable;e.loaded=r.loaded;e.total=r.total;n._onProgress(e,t)});t.xhr=function(){return r}}},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var n=this,r,i=t.files[0],s=t.multipart||!e.support.xhrFileUpload,o=e.type(t.paramName)==="array"?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers);if(t.contentRange){t.headers["Content-Range"]=t.contentRange}if(!s||t.blob||!this._isInstanceOf("File",i)){t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(i.name)+'"'}if(!s){t.contentType=i.type||"application/octet-stream";t.data=t.blob||i}else if(e.support.xhrFormDataFileUpload){if(t.postMessage){r=this._getFormData(t);if(t.blob){r.push({name:o,value:t.blob})}else{e.each(t.files,function(n,i){r.push({name:e.type(t.paramName)==="array"&&t.paramName[n]||o,value:i})})}}else{if(n._isInstanceOf("FormData",t.formData)){r=t.formData}else{r=new FormData;e.each(this._getFormData(t),function(e,t){r.append(t.name,t.value)})}if(t.blob){r.append(o,t.blob,i.name)}else{e.each(t.files,function(i,s){if(n._isInstanceOf("File",s)||n._isInstanceOf("Blob",s)){r.append(e.type(t.paramName)==="array"&&t.paramName[i]||o,s,s.uploadName||s.name)}})}}t.data=r}t.blob=null},_initIframeSettings:function(t){var n=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||"");t.formData=this._getFormData(t);if(t.redirect&&n&&n!==location.host){t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})}},_initDataSettings:function(e){if(this._isXHRUpload(e)){if(!this._chunkedUpload(e,true)){if(!e.data){this._initXHRData(e)}this._initProgressListener(e)}if(e.postMessage){e.dataType="postmessage "+(e.dataType||"")}}else{this._initIframeSettings(e)}},_getParamName:function(t){var n=e(t.fileInput),r=t.paramName;if(!r){r=[];n.each(function(){var t=e(this),n=t.prop("name")||"files[]",i=(t.prop("files")||[1]).length;while(i){r.push(n);i-=1}});if(!r.length){r=[n.prop("name")||"files[]"]}}else if(!e.isArray(r)){r=[r]}return r},_initFormSettings:function(t){if(!t.form||!t.form.length){t.form=e(t.fileInput.prop("form"));if(!t.form.length){t.form=e(this.options.fileInput.prop("form"))}}t.paramName=this._getParamName(t);if(!t.url){t.url=t.form.prop("action")||location.href}t.type=(t.type||e.type(t.form.prop("method"))==="string"&&t.form.prop("method")||"").toUpperCase();if(t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"){t.type="POST"}if(!t.formAcceptCharset){t.formAcceptCharset=t.form.attr("accept-charset")}},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);this._initFormSettings(n);this._initDataSettings(n);return n},_getDeferredState:function(e){if(e.state){return e.state()}if(e.isResolved()){return"resolved"}if(e.isRejected()){return"rejected"}return"pending"},_enhancePromise:function(e){e.success=e.done;e.error=e.fail;e.complete=e.always;return e},_getXHRPromise:function(t,n,r){var i=e.Deferred(),s=i.promise();n=n||this.options.context||s;if(t===true){i.resolveWith(n,r)}else if(t===false){i.rejectWith(n,r)}s.abort=i.promise;return this._enhancePromise(s)},_addConvenienceMethods:function(t,n){var r=this,i=function(t){return e.Deferred().resolveWith(r,t).promise()};n.process=function(t,s){if(t||s){n._processQueue=this._processQueue=(this._processQueue||i([this])).pipe(function(){if(n.errorThrown){return e.Deferred().rejectWith(r,[n]).promise()}return i(arguments)}).pipe(t,s)}return this._processQueue||i([this])};n.submit=function(){if(this.state()!=="pending"){n.jqXHR=this.jqXHR=r._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==false&&r._onSend(t,this)}return this.jqXHR||r._getXHRPromise()};n.abort=function(){if(this.jqXHR){return this.jqXHR.abort()}this.errorThrown="abort";r._trigger("fail",null,this);return r._getXHRPromise(false)};n.state=function(){if(this.jqXHR){return r._getDeferredState(this.jqXHR)}if(this._processQueue){return r._getDeferredState(this._processQueue)}};n.processing=function(){return!this.jqXHR&&this._processQueue&&r._getDeferredState(this._processQueue)==="pending"};n.progress=function(){return this._progress};n.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),r=n&&n.length>1&&parseInt(n[1],10);return r&&r+1},_chunkedUpload:function(t,n){t.uploadedBytes=t.uploadedBytes||0;var r=this,i=t.files[0],s=i.size,o=t.uploadedBytes,u=t.maxChunkSize||s,a=this._blobSlice,f=e.Deferred(),l=f.promise(),c,h;if(!(this._isXHRUpload(t)&&a&&(o||u<s))||t.data){return false}if(n){return true}if(o>=s){i.error=t.i18n("uploadedBytes");return this._getXHRPromise(false,t.context,[null,"error",i.error])}h=function(){var n=e.extend({},t),l=n._progress.loaded;n.blob=a.call(i,o,o+u,i.type);n.chunkSize=n.blob.size;n.contentRange="bytes "+o+"-"+(o+n.chunkSize-1)+"/"+s;r._initXHRData(n);r._initProgressListener(n);c=(r._trigger("chunksend",null,n)!==false&&e.ajax(n)||r._getXHRPromise(false,n.context)).done(function(i,u,a){o=r._getUploadedBytes(a)||o+n.chunkSize;if(l+n.chunkSize-n._progress.loaded){r._onProgress(e.Event("progress",{lengthComputable:true,loaded:o-n.uploadedBytes,total:o-n.uploadedBytes}),n)}t.uploadedBytes=n.uploadedBytes=o;n.result=i;n.textStatus=u;n.jqXHR=a;r._trigger("chunkdone",null,n);r._trigger("chunkalways",null,n);if(o<s){h()}else{f.resolveWith(n.context,[i,u,a])}}).fail(function(e,t,i){n.jqXHR=e;n.textStatus=t;n.errorThrown=i;r._trigger("chunkfail",null,n);r._trigger("chunkalways",null,n);f.rejectWith(n.context,[e,t,i])})};this._enhancePromise(l);l.abort=function(){return c.abort()};h();return l},_beforeSend:function(e,t){if(this._active===0){this._trigger("start");this._bitrateTimer=new this._BitrateTimer;this._progress.loaded=this._progress.total=0;this._progress.bitrate=0}this._initResponseObject(t);this._initProgressObject(t);t._progress.loaded=t.loaded=t.uploadedBytes||0;t._progress.total=t.total=this._getTotal(t.files)||1;t._progress.bitrate=t.bitrate=0;this._active+=1;this._progress.loaded+=t.loaded;this._progress.total+=t.total},_onDone:function(t,n,r,i){var s=i._progress.total,o=i._response;if(i._progress.loaded<s){this._onProgress(e.Event("progress",{lengthComputable:true,loaded:s,total:s}),i)}o.result=i.result=t;o.textStatus=i.textStatus=n;o.jqXHR=i.jqXHR=r;this._trigger("done",null,i)},_onFail:function(e,t,n,r){var i=r._response;if(r.recalculateProgress){this._progress.loaded-=r._progress.loaded;this._progress.total-=r._progress.total}i.jqXHR=r.jqXHR=e;i.textStatus=r.textStatus=t;i.errorThrown=r.errorThrown=n;this._trigger("fail",null,r)},_onAlways:function(e,t,n,r){this._trigger("always",null,r)},_onSend:function(t,n){if(!n.submit){this._addConvenienceMethods(t,n)}var r=this,i,s,o,u,a=r._getAJAXSettings(n),f=function(){r._sending+=1;a._bitrateTimer=new r._BitrateTimer;i=i||((s||r._trigger("send",e.Event("send",{delegatedEvent:t}),a)===false)&&r._getXHRPromise(false,a.context,s)||r._chunkedUpload(a)||e.ajax(a)).done(function(e,t,n){r._onDone(e,t,n,a)}).fail(function(e,t,n){r._onFail(e,t,n,a)}).always(function(e,t,n){r._onAlways(e,t,n,a);r._sending-=1;r._active-=1;if(a.limitConcurrentUploads&&a.limitConcurrentUploads>r._sending){var i=r._slots.shift();while(i){if(r._getDeferredState(i)==="pending"){i.resolve();break}i=r._slots.shift()}}if(r._active===0){r._trigger("stop")}});return i};this._beforeSend(t,a);if(this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending){if(this.options.limitConcurrentUploads>1){o=e.Deferred();this._slots.push(o);u=o.pipe(f)}else{this._sequence=this._sequence.pipe(f,f);u=this._sequence}u.abort=function(){s=[undefined,"abort","abort"];if(!i){if(o){o.rejectWith(a.context,s)}return f()}return i.abort()};return this._enhancePromise(u)}return f()},_onAdd:function(t,n){var r=this,i=true,s=e.extend({},this.options,n),o=n.files,u=o.length,a=s.limitMultiFileUploads,f=s.limitMultiFileUploadSize,l=s.limitMultiFileUploadSizeOverhead,c=0,h=this._getParamName(s),p,d,v,m,g=0;if(f&&(!u||o[0].size===undefined)){f=undefined}if(!(s.singleFileUploads||a||f)||!this._isXHRUpload(s)){v=[o];p=[h]}else if(!(s.singleFileUploads||f)&&a){v=[];p=[];for(m=0;m<u;m+=a){v.push(o.slice(m,m+a));d=h.slice(m,m+a);if(!d.length){d=h}p.push(d)}}else if(!s.singleFileUploads&&f){v=[];p=[];for(m=0;m<u;m=m+1){c+=o[m].size+l;if(m+1===u||c+o[m+1].size+l>f||a&&m+1-g>=a){v.push(o.slice(g,m+1));d=h.slice(g,m+1);if(!d.length){d=h}p.push(d);g=m+1;c=0}}}else{p=h}n.originalFiles=o;e.each(v||o,function(s,o){var u=e.extend({},n);u.files=v?o:[o];u.paramName=p[s];r._initResponseObject(u);r._initProgressObject(u);r._addConvenienceMethods(t,u);i=r._trigger("add",e.Event("add",{delegatedEvent:t}),u);return i});return i},_replaceFileInput:function(t){var n=t.fileInput,r=n.clone(true);t.fileInputClone=r;e("<form></form>").append(r)[0].reset();n.after(r).detach();e.cleanData(n.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(e,t){if(t===n[0]){return r[0]}return t});if(n[0]===this.element[0]){this.element=r}},_handleFileTreeEntry:function(t,n){var r=this,i=e.Deferred(),s=function(e){if(e&&!e.entry){e.entry=t}i.resolve([e])},o=function(e){r._handleFileTreeEntries(e,n+t.name+"/").done(function(e){i.resolve(e)}).fail(s)},u=function(){a.readEntries(function(e){if(!e.length){o(f)}else{f=f.concat(e);u()}},s)},a,f=[];n=n||"";if(t.isFile){if(t._file){t._file.relativePath=n;i.resolve(t._file)}else{t.file(function(e){e.relativePath=n;i.resolve(e)},s)}}else if(t.isDirectory){a=t.createReader();u()}else{i.resolve([])}return i.promise()},_handleFileTreeEntries:function(t,n){var r=this;return e.when.apply(e,e.map(t,function(e){return r._handleFileTreeEntry(e,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;if(n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)){return this._handleFileTreeEntries(e.map(n,function(e){var t;if(e.webkitGetAsEntry){t=e.webkitGetAsEntry();if(t){t._file=e.getAsFile()}return t}return e.getAsEntry()}))}return e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n=t.prop("webkitEntries")||t.prop("entries"),r,i;if(n&&n.length){return this._handleFileTreeEntries(n)}r=e.makeArray(t.prop("files"));if(!r.length){i=t.prop("value");if(!i){return e.Deferred().resolve([]).promise()}r=[{name:i.replace(/^.*\\/,"")}]}else if(r[0].name===undefined&&r[0].fileName){e.each(r,function(e,t){t.name=t.fileName;t.size=t.fileSize})}return e.Deferred().resolve(r).promise()},_getFileInputFiles:function(t){if(!(t instanceof e)||t.length===1){return this._getSingleFileInputFiles(t)}return e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(t){var n=this,r={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(r.fileInput).always(function(i){r.files=i;if(n.options.replaceFileInput){n._replaceFileInput(r)}if(n._trigger("change",e.Event("change",{delegatedEvent:t}),r)!==false){n._onAdd(t,r)}})},_onPaste:function(t){var n=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,r={files:[]};if(n&&n.length){e.each(n,function(e,t){var n=t.getAsFile&&t.getAsFile();if(n){r.files.push(n)}});if(this._trigger("paste",e.Event("paste",{delegatedEvent:t}),r)!==false){this._onAdd(t,r)}}},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=this,r=t.dataTransfer,i={};if(r&&r.files&&r.files.length){t.preventDefault();this._getDroppedFiles(r).always(function(r){i.files=r;if(n._trigger("drop",e.Event("drop",{delegatedEvent:t}),i)!==false){n._onAdd(t,i)}})}},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){if(this._isXHRUpload(this.options)){this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave});this._on(this.options.pasteZone,{paste:this._onPaste})}if(e.support.fileInput){this._on(this.options.fileInput,{change:this._onChange})}},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(t,n){var r=e.inArray(t,this._specialOptions)!==-1;if(r){this._destroyEventHandlers()}this._super(t,n);if(r){this._initSpecialOptions();this._initEventHandlers()}},_initSpecialOptions:function(){var t=this.options;if(t.fileInput===undefined){t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]')}else if(!(t.fileInput instanceof e)){t.fileInput=e(t.fileInput)}if(!(t.dropZone instanceof e)){t.dropZone=e(t.dropZone)}if(!(t.pasteZone instanceof e)){t.pasteZone=e(t.pasteZone)}},_getRegExp:function(e){var t=e.split("/"),n=t.pop();t.shift();return new RegExp(t.join("/"),n)},_isRegExpOption:function(t,n){return t!=="url"&&e.type(n)==="string"&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var t=this,n=this.options,r=e(this.element[0].cloneNode(false)),i=r.data();r.remove();e.each(i,function(e,i){var s="data-"+e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();if(r.attr(s)){if(t._isRegExpOption(e,i)){i=t._getRegExp(i)}n[e]=i}})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(true);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;if(!t||this.options.disabled){return}if(t.fileInput&&!t.files){this._getFileInputFiles(t.fileInput).always(function(e){t.files=e;n._onAdd(null,t)})}else{t.files=e.makeArray(t.files);this._onAdd(null,t)}},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n=this,r=e.Deferred(),i=r.promise(),s,o;i.abort=function(){o=true;if(s){return s.abort()}r.reject(null,"abort","abort");return i};this._getFileInputFiles(t.fileInput).always(function(e){if(o){return}if(!e.length){r.reject();return}t.files=e;s=n._onSend(null,t);s.then(function(e,t,n){r.resolve(e,t,n)},function(e,t,n){r.reject(e,t,n)})});return this._enhancePromise(i)}t.files=e.makeArray(t.files);if(t.files.length){return this._onSend(null,t)}}return this._getXHRPromise(false,t&&t.context)}})});
(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery","./jquery.fileupload"],e)}else if(typeof exports==="object"){e(require("jquery"))}else{e(window.jQuery)}})(function(e){"use strict";var t=e.blueimp.fileupload.prototype.options.add;e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{processQueue:[],add:function(n,r){var i=e(this);r.process(function(){return i.fileupload("process",r)});t.call(this,n,r)}},processActions:{},_processFile:function(t,n){var r=this,i=e.Deferred().resolveWith(r,[t]),s=i.promise();this._trigger("process",null,t);e.each(t.processQueue,function(t,i){var o=function(t){if(n.errorThrown){return e.Deferred().rejectWith(r,[n]).promise()}return r.processActions[i.action].call(r,t,i)};s=s.pipe(o,i.always&&o)});s.done(function(){r._trigger("processdone",null,t);r._trigger("processalways",null,t)}).fail(function(){r._trigger("processfail",null,t);r._trigger("processalways",null,t)});return s},_transformProcessQueue:function(t){var n=[];e.each(t.processQueue,function(){var r={},i=this.action,s=this.prefix===true?i:this.prefix;e.each(this,function(n,i){if(e.type(i)==="string"&&i.charAt(0)==="@"){r[n]=t[i.slice(1)||(s?s+n.charAt(0).toUpperCase()+n.slice(1):n)]}else{r[n]=i}});n.push(r)});t.processQueue=n},processing:function(){return this._processing},process:function(t){var n=this,r=e.extend({},this.options,t);if(r.processQueue&&r.processQueue.length){this._transformProcessQueue(r);if(this._processing===0){this._trigger("processstart")}e.each(t.files,function(i){var s=i?e.extend({},r):r,o=function(){if(t.errorThrown){return e.Deferred().rejectWith(n,[t]).promise()}return n._processFile(s,t)};s.index=i;n._processing+=1;n._processingQueue=n._processingQueue.pipe(o,o).always(function(){n._processing-=1;if(n._processing===0){n._trigger("processstop")}})})}return this._processingQueue},_create:function(){this._super();this._processing=0;this._processingQueue=e.Deferred().resolveWith(this).promise()}})});
(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery","./jquery.fileupload-process"],e)}else if(typeof exports==="object"){e(require("jquery"))}else{e(window.jQuery)}})(function(e){"use strict";e.blueimp.fileupload.prototype.options.processQueue.push({action:"validate",always:true,acceptFileTypes:"@",maxFileSize:"@",minFileSize:"@",maxNumberOfFiles:"@",disabled:"@disableValidation"});e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{getNumberOfFiles:e.noop,messages:{maxNumberOfFiles:"Maximum number of files exceeded",acceptFileTypes:"File type not allowed",maxFileSize:"File is too large",minFileSize:"File is too small"}},processActions:{validate:function(t,n){if(n.disabled){return t}var r=e.Deferred(),i=this.options,s=t.files[t.index],o;if(n.minFileSize||n.maxFileSize){o=s.size}if(e.type(n.maxNumberOfFiles)==="number"&&(i.getNumberOfFiles()||0)+t.files.length>n.maxNumberOfFiles){s.error=i.i18n("maxNumberOfFiles")}else if(n.acceptFileTypes&&!(n.acceptFileTypes.test(s.type)||n.acceptFileTypes.test(s.name))){s.error=i.i18n("acceptFileTypes")}else if(o>n.maxFileSize){s.error=i.i18n("maxFileSize")}else if(e.type(o)==="number"&&o<n.minFileSize){s.error=i.i18n("minFileSize")}else{delete s.error}if(s.error||t.files.error){t.files.error=true;r.rejectWith(this,[t])}else{r.resolveWith(this,[t])}return r.promise()}}})});
(function(e){"use strict";if(typeof define==="function"&&define.amd){define(["jquery","tmpl","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],e)}else if(typeof exports==="object"){e(require("jquery"),require("tmpl"))}else{e(window.jQuery,window.tmpl)}})(function(e,t){"use strict";e.blueimp.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId");e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{autoUpload:false,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:undefined,prependFiles:false,dataType:"json",messages:{unknownError:"Unknown error"},getNumberOfFiles:function(){return this.filesContainer.children().not(".processing").length},getFilesFromResponse:function(t){if(t.result&&e.isArray(t.result.files)){return t.result.files}return[]},add:function(t,n){if(t.isDefaultPrevented()){return false}var r=e(this),i=r.data("blueimp-fileupload")||r.data("fileupload"),s=i.options;n.context=i._renderUpload(n.files).data("data",n).addClass("processing");s.filesContainer[s.prependFiles?"prepend":"append"](n.context);i._forceReflow(n.context);i._transition(n.context);n.process(function(){return r.fileupload("process",n)}).always(function(){n.context.each(function(t){e(this).find(".size").text(i._formatFileSize(n.files[t].size))}).removeClass("processing");i._renderPreviews(n)}).done(function(){n.context.find(".start").prop("disabled",false);if(i._trigger("added",t,n)!==false&&(s.autoUpload||n.autoUpload)&&n.autoUpload!==false){n.submit()}}).fail(function(){if(n.files.error){n.context.each(function(t){var r=n.files[t].error;if(r){e(this).find(".error").text(r)}})}})},send:function(t,n){if(t.isDefaultPrevented()){return false}var r=e(this).data("blueimp-fileupload")||e(this).data("fileupload");if(n.context&&n.dataType&&n.dataType.substr(0,6)==="iframe"){n.context.find(".progress").addClass(!e.support.transition&&"progress-animated").attr("aria-valuenow",100).children().first().css("width","100%")}return r._trigger("sent",t,n)},done:function(t,n){if(t.isDefaultPrevented()){return false}var r=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),i=n.getFilesFromResponse||r.options.getFilesFromResponse,s=i(n),o,u;if(n.context){n.context.each(function(i){var a=s[i]||{error:"Empty file upload result"};u=r._addFinishedDeferreds();r._transition(e(this)).done(function(){var i=e(this);o=r._renderDownload([a]).replaceAll(i);r._forceReflow(o);r._transition(o).done(function(){n.context=e(this);r._trigger("completed",t,n);r._trigger("finished",t,n);u.resolve()})})})}else{o=r._renderDownload(s)[r.options.prependFiles?"prependTo":"appendTo"](r.options.filesContainer);r._forceReflow(o);u=r._addFinishedDeferreds();r._transition(o).done(function(){n.context=e(this);r._trigger("completed",t,n);r._trigger("finished",t,n);u.resolve()})}},fail:function(t,n){if(t.isDefaultPrevented()){return false}var r=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),i,s;if(n.context){n.context.each(function(o){if(n.errorThrown!=="abort"){var u=n.files[o];u.error=u.error||n.errorThrown||n.i18n("unknownError");s=r._addFinishedDeferreds();r._transition(e(this)).done(function(){var o=e(this);i=r._renderDownload([u]).replaceAll(o);r._forceReflow(i);r._transition(i).done(function(){n.context=e(this);r._trigger("failed",t,n);r._trigger("finished",t,n);s.resolve()})})}else{s=r._addFinishedDeferreds();r._transition(e(this)).done(function(){e(this).remove();r._trigger("failed",t,n);r._trigger("finished",t,n);s.resolve()})}})}else if(n.errorThrown!=="abort"){n.context=r._renderUpload(n.files)[r.options.prependFiles?"prependTo":"appendTo"](r.options.filesContainer).data("data",n);r._forceReflow(n.context);s=r._addFinishedDeferreds();r._transition(n.context).done(function(){n.context=e(this);r._trigger("failed",t,n);r._trigger("finished",t,n);s.resolve()})}else{r._trigger("failed",t,n);r._trigger("finished",t,n);r._addFinishedDeferreds().resolve()}},progress:function(t,n){if(t.isDefaultPrevented()){return false}var r=Math.floor(n.loaded/n.total*100);if(n.context){n.context.each(function(){e(this).find(".progress").attr("aria-valuenow",r).children().first().css("width",r+"%")})}},progressall:function(t,n){if(t.isDefaultPrevented()){return false}var r=e(this),i=Math.floor(n.loaded/n.total*100),s=r.find(".fileupload-progress"),o=s.find(".progress-extended");if(o.length){o.html((r.data("blueimp-fileupload")||r.data("fileupload"))._renderExtendedProgress(n))}s.find(".progress").attr("aria-valuenow",i).children().first().css("width",i+"%")},start:function(t){if(t.isDefaultPrevented()){return false}var n=e(this).data("blueimp-fileupload")||e(this).data("fileupload");n._resetFinishedDeferreds();n._transition(e(this).find(".fileupload-progress")).done(function(){n._trigger("started",t)})},stop:function(t){if(t.isDefaultPrevented()){return false}var n=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),r=n._addFinishedDeferreds();e.when.apply(e,n._getFinishedDeferreds()).done(function(){n._trigger("stopped",t)});n._transition(e(this).find(".fileupload-progress")).done(function(){e(this).find(".progress").attr("aria-valuenow","0").children().first().css("width","0%");e(this).find(".progress-extended").html("&nbsp;");r.resolve()})},processstart:function(t){if(t.isDefaultPrevented()){return false}e(this).addClass("fileupload-processing")},processstop:function(t){if(t.isDefaultPrevented()){return false}e(this).removeClass("fileupload-processing")},destroy:function(t,n){if(t.isDefaultPrevented()){return false}var r=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),i=function(){r._transition(n.context).done(function(){e(this).remove();r._trigger("destroyed",t,n)})};if(n.url){n.dataType=n.dataType||r.options.dataType;e.ajax(n).done(i).fail(function(){r._trigger("destroyfailed",t,n)})}else{i()}}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(t){if(!t){t=e.Deferred()}this._finishedUploads.push(t);return t},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var t=e(this),n=t.prop("href"),r=t.prop("download"),i="application/octet-stream";t.bind("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",[i,r,n].join(":"))}catch(t){}})},_formatFileSize:function(e){if(typeof e!=="number"){return""}if(e>=1e9){return(e/1e9).toFixed(2)+" GB"}if(e>=1e6){return(e/1e6).toFixed(2)+" MB"}return(e/1e3).toFixed(2)+" KB"},_formatBitrate:function(e){if(typeof e!=="number"){return""}if(e>=1e9){return(e/1e9).toFixed(2)+" Gbit/s"}if(e>=1e6){return(e/1e6).toFixed(2)+" Mbit/s"}if(e>=1e3){return(e/1e3).toFixed(2)+" kbit/s"}return e.toFixed(2)+" bit/s"},_formatTime:function(e){var t=new Date(e*1e3),n=Math.floor(e/86400);n=n?n+"d ":"";return n+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)},_formatPercentage:function(e){return(e*100).toFixed(2)+" %"},_renderExtendedProgress:function(e){return this._formatBitrate(e.bitrate)+" | "+this._formatTime((e.total-e.loaded)*8/e.bitrate)+" | "+this._formatPercentage(e.loaded/e.total)+" | "+this._formatFileSize(e.loaded)+" / "+this._formatFileSize(e.total)},_renderTemplate:function(t,n){if(!t){return e()}var r=t({files:n,formatFileSize:this._formatFileSize,options:this.options});if(r instanceof e){return r}return e(this.options.templatesContainer).html(r).children()},_renderPreviews:function(t){t.context.find(".preview").each(function(n,r){e(r).append(t.files[n].preview)})},_renderUpload:function(e){return this._renderTemplate(this.options.uploadTemplate,e)},_renderDownload:function(e){return this._renderTemplate(this.options.downloadTemplate,e).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(t){t.preventDefault();var n=e(t.currentTarget),r=n.closest(".template-upload"),i=r.data("data");n.prop("disabled",true);if(i&&i.submit){i.submit()}},_cancelHandler:function(t){t.preventDefault();var n=e(t.currentTarget).closest(".template-upload,.template-download"),r=n.data("data")||{};r.context=r.context||n;if(r.abort){r.abort()}else{r.errorThrown="abort";this._trigger("fail",t,r)}},_deleteHandler:function(t){t.preventDefault();var n=e(t.currentTarget);this._trigger("destroy",t,e.extend({context:n.closest(".template-download"),type:"DELETE"},n.data()))},_forceReflow:function(t){return e.support.transition&&t.length&&t[0].offsetWidth},_transition:function(t){var n=e.Deferred();if(e.support.transition&&t.hasClass("fade")&&t.is(":visible")){t.bind(e.support.transition.end,function(r){if(r.target===t[0]){t.unbind(e.support.transition.end);n.resolveWith(t)}}).toggleClass("in")}else{t.toggleClass("in");n.resolveWith(t)}return n},_initButtonBarEventHandlers:function(){var t=this.element.find(".fileupload-buttonbar"),n=this.options.filesContainer;this._on(t.find(".start"),{click:function(e){e.preventDefault();n.find(".start").click()}});this._on(t.find(".cancel"),{click:function(e){e.preventDefault();n.find(".cancel").click()}});this._on(t.find(".delete"),{click:function(e){e.preventDefault();n.find(".toggle:checked").closest(".template-download").find(".delete").click();t.find(".toggle").prop("checked",false)}});this._on(t.find(".toggle"),{change:function(t){n.find(".toggle").prop("checked",e(t.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar").find(".start, .cancel, .delete"),"click");this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super();this._on(this.options.filesContainer,{"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler});this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers();this._off(this.options.filesContainer,"click");this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",false).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",true).parent().addClass("disabled")},_initTemplates:function(){var e=this.options;e.templatesContainer=this.document[0].createElement(e.filesContainer.prop("nodeName"));if(t){if(e.uploadTemplateId){e.uploadTemplate=t(e.uploadTemplateId)}if(e.downloadTemplateId){e.downloadTemplate=t(e.downloadTemplateId)}}},_initFilesContainer:function(){var t=this.options;if(t.filesContainer===undefined){t.filesContainer=this.element.find(".files")}else if(!(t.filesContainer instanceof e)){t.filesContainer=e(t.filesContainer)}},_initSpecialOptions:function(){this._super();this._initFilesContainer();this._initTemplates()},_create:function(){this._super();this._resetFinishedDeferreds();if(!e.support.fileInput){this._disableFileInputButton()}},enable:function(){var e=false;if(this.options.disabled){e=true}this._super();if(e){this.element.find("input, button").prop("disabled",false);this._enableFileInputButton()}},disable:function(){if(!this.options.disabled){this.element.find("input, button").prop("disabled",true);this._disableFileInputButton()}this._super()}})});
!function(a){"use strict";var b=function(a,c,d){var e,f,g=document.createElement("img");if(g.onerror=c,g.onload=function(){!f||d&&d.noRevoke||b.revokeObjectURL(f),c&&c(b.scale(g,d))},b.isInstanceOf("Blob",a)||b.isInstanceOf("File",a))e=f=b.createObjectURL(a),g._type=a.type;else{if("string"!=typeof a)return!1;e=a,d&&d.crossOrigin&&(g.crossOrigin=d.crossOrigin)}return e?(g.src=e,g):b.readFile(a,function(a){var b=a.target;b&&b.result?g.src=b.result:c&&c(a)})},c=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;b.isInstanceOf=function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},b.transformCoordinates=function(){},b.getTransformedOptions=function(a,b){var c,d,e,f,g=b.aspectRatio;if(!g)return b;c={};for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c.crop=!0,e=a.naturalWidth||a.width,f=a.naturalHeight||a.height,e/f>g?(c.maxWidth=f*g,c.maxHeight=f):(c.maxWidth=e,c.maxHeight=e/g),c},b.renderImageToCanvas=function(a,b,c,d,e,f,g,h,i,j){return a.getContext("2d").drawImage(b,c,d,e,f,g,h,i,j),a},b.hasCanvasOption=function(a){return a.canvas||a.crop||a.aspectRatio},b.scale=function(a,c){c=c||{};var d,e,f,g,h,i,j,k,l,m=document.createElement("canvas"),n=a.getContext||b.hasCanvasOption(c)&&m.getContext,o=a.naturalWidth||a.width,p=a.naturalHeight||a.height,q=o,r=p,s=function(){var a=Math.max((f||q)/q,(g||r)/r);a>1&&(q*=a,r*=a)},t=function(){var a=Math.min((d||q)/q,(e||r)/r);1>a&&(q*=a,r*=a)};return n&&(c=b.getTransformedOptions(a,c),j=c.left||0,k=c.top||0,c.sourceWidth?(h=c.sourceWidth,void 0!==c.right&&void 0===c.left&&(j=o-h-c.right)):h=o-j-(c.right||0),c.sourceHeight?(i=c.sourceHeight,void 0!==c.bottom&&void 0===c.top&&(k=p-i-c.bottom)):i=p-k-(c.bottom||0),q=h,r=i),d=c.maxWidth,e=c.maxHeight,f=c.minWidth,g=c.minHeight,n&&d&&e&&c.crop?(q=d,r=e,l=h/i-d/e,0>l?(i=e*h/d,void 0===c.top&&void 0===c.bottom&&(k=(p-i)/2)):l>0&&(h=d*i/e,void 0===c.left&&void 0===c.right&&(j=(o-h)/2))):((c.contain||c.cover)&&(f=d=d||f,g=e=e||g),c.cover?(t(),s()):(s(),t())),n?(m.width=q,m.height=r,b.transformCoordinates(m,c),b.renderImageToCanvas(m,a,j,k,h,i,0,0,q,r)):(a.width=q,a.height=r,a)},b.createObjectURL=function(a){return c?c.createObjectURL(a):!1},b.revokeObjectURL=function(a){return c?c.revokeObjectURL(a):!1},b.readFile=function(a,b,c){if(window.FileReader){var d=new FileReader;if(d.onload=d.onerror=b,c=c||"readAsDataURL",d[c])return d[c](a),d}return!1},"function"==typeof define&&define.amd?define(function(){return b}):a.loadImage=b}(this),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)}(function(a){"use strict";if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var b=a.renderImageToCanvas;a.detectSubsampling=function(a){var b,c;return a.width*a.height>1048576?(b=document.createElement("canvas"),b.width=b.height=1,c=b.getContext("2d"),c.drawImage(a,-a.width+1,0),0===c.getImageData(0,0,1,1).data[3]):!1},a.detectVerticalSquash=function(a,b){var c,d,e,f,g,h=a.naturalHeight||a.height,i=document.createElement("canvas"),j=i.getContext("2d");for(b&&(h/=2),i.width=1,i.height=h,j.drawImage(a,0,0),c=j.getImageData(0,0,1,h).data,d=0,e=h,f=h;f>d;)g=c[4*(f-1)+3],0===g?e=f:d=f,f=e+d>>1;return f/h||1},a.renderImageToCanvas=function(c,d,e,f,g,h,i,j,k,l){if("image/jpeg"===d._type){var m,n,o,p,q=c.getContext("2d"),r=document.createElement("canvas"),s=1024,t=r.getContext("2d");if(r.width=s,r.height=s,q.save(),m=a.detectSubsampling(d),m&&(e/=2,f/=2,g/=2,h/=2),n=a.detectVerticalSquash(d,m),m||1!==n){for(f*=n,k=Math.ceil(s*k/g),l=Math.ceil(s*l/h/n),j=0,p=0;h>p;){for(i=0,o=0;g>o;)t.clearRect(0,0,s,s),t.drawImage(d,e,f,g,h,-o,-p,g,h),q.drawImage(r,0,0,s,s,i,j,k,l),o+=s,i+=k;p+=s,j+=l}return q.restore(),c}}return b(c,d,e,f,g,h,i,j,k,l)}}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)}(function(a){"use strict";var b=a.hasCanvasOption,c=a.transformCoordinates,d=a.getTransformedOptions;a.hasCanvasOption=function(c){return b.call(a,c)||c.orientation},a.transformCoordinates=function(b,d){c.call(a,b,d);var e=b.getContext("2d"),f=b.width,g=b.height,h=d.orientation;if(h&&!(h>8))switch(h>4&&(b.width=g,b.height=f),h){case 2:e.translate(f,0),e.scale(-1,1);break;case 3:e.translate(f,g),e.rotate(Math.PI);break;case 4:e.translate(0,g),e.scale(1,-1);break;case 5:e.rotate(.5*Math.PI),e.scale(1,-1);break;case 6:e.rotate(.5*Math.PI),e.translate(0,-g);break;case 7:e.rotate(.5*Math.PI),e.translate(f,-g),e.scale(-1,1);break;case 8:e.rotate(-.5*Math.PI),e.translate(-f,0)}},a.getTransformedOptions=function(b,c){var e,f,g=d.call(a,b,c),h=g.orientation;if(!h||h>8||1===h)return g;e={};for(f in g)g.hasOwnProperty(f)&&(e[f]=g[f]);switch(g.orientation){case 2:e.left=g.right,e.right=g.left;break;case 3:e.left=g.right,e.top=g.bottom,e.right=g.left,e.bottom=g.top;break;case 4:e.top=g.bottom,e.bottom=g.top;break;case 5:e.left=g.top,e.top=g.left,e.right=g.bottom,e.bottom=g.right;break;case 6:e.left=g.top,e.top=g.right,e.right=g.bottom,e.bottom=g.left;break;case 7:e.left=g.bottom,e.top=g.right,e.right=g.top,e.bottom=g.left;break;case 8:e.left=g.bottom,e.top=g.left,e.right=g.top,e.bottom=g.right}return g.orientation>4&&(e.maxWidth=g.maxHeight,e.maxHeight=g.maxWidth,e.minWidth=g.minHeight,e.minHeight=g.minWidth,e.sourceWidth=g.sourceHeight,e.sourceHeight=g.sourceWidth),e}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image"],a):a(window.loadImage)}(function(a){"use strict";var b=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);a.blobSlice=b&&function(){var a=this.slice||this.webkitSlice||this.mozSlice;return a.apply(this,arguments)},a.metaDataParsers={jpeg:{65505:[]}},a.parseMetaData=function(b,c,d){d=d||{};var e=this,f=d.maxMetaDataSize||262144,g={},h=!(window.DataView&&b&&b.size>=12&&"image/jpeg"===b.type&&a.blobSlice);(h||!a.readFile(a.blobSlice.call(b,0,f),function(b){if(b.target.error)return console.log(b.target.error),void c(g);var f,h,i,j,k=b.target.result,l=new DataView(k),m=2,n=l.byteLength-4,o=m;if(65496===l.getUint16(0)){for(;n>m&&(f=l.getUint16(m),f>=65504&&65519>=f||65534===f);){if(h=l.getUint16(m+2)+2,m+h>l.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(i=a.metaDataParsers.jpeg[f])for(j=0;j<i.length;j+=1)i[j].call(e,l,m,h,g,d);m+=h,o=m}!d.disableImageHead&&o>6&&(g.imageHead=k.slice?k.slice(0,o):new Uint8Array(k).subarray(0,o))}else console.log("Invalid JPEG file: Missing JPEG marker.");c(g)},"readAsArrayBuffer"))&&c(g)}}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image","load-image-meta"],a):a(window.loadImage)}(function(a){"use strict";a.ExifMap=function(){return this},a.ExifMap.prototype.map={Orientation:274},a.ExifMap.prototype.get=function(a){return this[a]||this[this.map[a]]},a.getExifThumbnail=function(a,b,c){var d,e,f;if(!c||b+c>a.byteLength)return void console.log("Invalid Exif data: Invalid thumbnail data.");for(d=[],e=0;c>e;e+=1)f=a.getUint8(b+e),d.push((16>f?"0":"")+f.toString(16));return"data:image/jpeg,%"+d.join("%")},a.exifTagTypes={1:{getValue:function(a,b){return a.getUint8(b)},size:1},2:{getValue:function(a,b){return String.fromCharCode(a.getUint8(b))},size:1,ascii:!0},3:{getValue:function(a,b,c){return a.getUint16(b,c)},size:2},4:{getValue:function(a,b,c){return a.getUint32(b,c)},size:4},5:{getValue:function(a,b,c){return a.getUint32(b,c)/a.getUint32(b+4,c)},size:8},9:{getValue:function(a,b,c){return a.getInt32(b,c)},size:4},10:{getValue:function(a,b,c){return a.getInt32(b,c)/a.getInt32(b+4,c)},size:8}},a.exifTagTypes[7]=a.exifTagTypes[1],a.getExifValue=function(b,c,d,e,f,g){var h,i,j,k,l,m,n=a.exifTagTypes[e];if(!n)return void console.log("Invalid Exif data: Invalid tag type.");if(h=n.size*f,i=h>4?c+b.getUint32(d+8,g):d+8,i+h>b.byteLength)return void console.log("Invalid Exif data: Invalid data offset.");if(1===f)return n.getValue(b,i,g);for(j=[],k=0;f>k;k+=1)j[k]=n.getValue(b,i+k*n.size,g);if(n.ascii){for(l="",k=0;k<j.length&&(m=j[k],"\x00"!==m);k+=1)l+=m;return l}return j},a.parseExifTag=function(b,c,d,e,f){var g=b.getUint16(d,e);f.exif[g]=a.getExifValue(b,c,d,b.getUint16(d+2,e),b.getUint32(d+4,e),e)},a.parseExifTags=function(a,b,c,d,e){var f,g,h;if(c+6>a.byteLength)return void console.log("Invalid Exif data: Invalid directory offset.");if(f=a.getUint16(c,d),g=c+2+12*f,g+4>a.byteLength)return void console.log("Invalid Exif data: Invalid directory size.");for(h=0;f>h;h+=1)this.parseExifTag(a,b,c+2+12*h,d,e);return a.getUint32(g,d)},a.parseExifData=function(b,c,d,e,f){if(!f.disableExif){var g,h,i,j=c+10;if(1165519206===b.getUint32(c+4)){if(j+8>b.byteLength)return void console.log("Invalid Exif data: Invalid segment size.");if(0!==b.getUint16(c+8))return void console.log("Invalid Exif data: Missing byte alignment offset.");switch(b.getUint16(j)){case 18761:g=!0;break;case 19789:g=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==b.getUint16(j+2,g))return void console.log("Invalid Exif data: Missing TIFF marker.");h=b.getUint32(j+4,g),e.exif=new a.ExifMap,h=a.parseExifTags(b,j,j+h,g,e),h&&!f.disableExifThumbnail&&(i={exif:{}},h=a.parseExifTags(b,j,j+h,g,i),i.exif[513]&&(e.exif.Thumbnail=a.getExifThumbnail(b,j+i.exif[513],i.exif[514]))),e.exif[34665]&&!f.disableExifSub&&a.parseExifTags(b,j,j+e.exif[34665],g,e),e.exif[34853]&&!f.disableExifGps&&a.parseExifTags(b,j,j+e.exif[34853],g,e)}}},a.metaDataParsers.jpeg[65505].push(a.parseExifData)}),function(a){"use strict";"function"==typeof define&&define.amd?define(["load-image","load-image-exif"],a):a(window.loadImage)}(function(a){"use strict";a.ExifMap.prototype.tags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright",36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",42240:"Gamma",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubSecTime",37521:"SubSecTimeOriginal",37522:"SubSecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"PhotographicSensitivity",34856:"OECF",34864:"SensitivityType",34865:"StandardOutputSensitivity",34866:"RecommendedExposureIndex",34867:"ISOSpeed",34868:"ISOSpeedLatitudeyyy",34869:"ISOSpeedLatitudezzz",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRatio",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",42016:"ImageUniqueID",42032:"CameraOwnerName",42033:"BodySerialNumber",42034:"LensSpecification",42035:"LensMake",42036:"LensModel",42037:"LensSerialNumber",0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential",31:"GPSHPositioningError"},a.ExifMap.prototype.stringValues={ExposureProgram:{0:"Undefined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Undefined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},ComponentsConfiguration:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"},Orientation:{1:"top-left",2:"top-right",3:"bottom-right",4:"bottom-left",5:"left-top",6:"right-top",7:"right-bottom",8:"left-bottom"}},a.ExifMap.prototype.getText=function(a){var b=this.get(a);switch(a){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":case"Orientation":return this.stringValues[a][b];case"ExifVersion":case"FlashpixVersion":return String.fromCharCode(b[0],b[1],b[2],b[3]);case"ComponentsConfiguration":return this.stringValues[a][b[0]]+this.stringValues[a][b[1]]+this.stringValues[a][b[2]]+this.stringValues[a][b[3]];case"GPSVersionID":return b[0]+"."+b[1]+"."+b[2]+"."+b[3]}return String(b)},function(a){var b,c=a.tags,d=a.map;for(b in c)c.hasOwnProperty(b)&&(d[c[b]]=b)}(a.ExifMap.prototype),a.ExifMap.prototype.getAll=function(){var a,b,c={};for(a in this)this.hasOwnProperty(a)&&(b=this.tags[a],b&&(c[b]=this.getText(b)));return c}});
(function(n){"use strict";var t=n.HTMLCanvasElement&&n.HTMLCanvasElement.prototype,r=n.Blob&&function(){try{return Boolean(new Blob)}catch(n){return!1}}(),f=r&&n.Uint8Array&&function(){try{return new Blob([new Uint8Array(100)]).size===100}catch(n){return!1}}(),u=n.BlobBuilder||n.WebKitBlobBuilder||n.MozBlobBuilder||n.MSBlobBuilder,i=(r||u)&&n.atob&&n.ArrayBuffer&&n.Uint8Array&&function(n){var i,e,o,t,s,h;for(i=n.split(",")[0].indexOf("base64")>=0?atob(n.split(",")[1]):decodeURIComponent(n.split(",")[1]),e=new ArrayBuffer(i.length),o=new Uint8Array(e),t=0;t<i.length;t+=1)o[t]=i.charCodeAt(t);return(s=n.split(",")[0].split(":")[1].split(";")[0],r)?new Blob([f?o:e],{type:s}):(h=new u,h.append(e),h.getBlob(s))};n.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(n,r,u){u&&t.toDataURL&&i?n(i(this.toDataURL(r,u))):n(this.mozGetAsFile("blob",r))}:t.toDataURL&&i&&(t.toBlob=function(n,t,r){n(i(this.toDataURL(t,r)))}));typeof define=="function"&&define.amd?define(function(){return i}):n.dataURLtoBlob=i})(this);
(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{toggle:"#toggle-actions-newfolder",container:"#html-subactions-newfolder",form:"#form-subactions-newfolder",control:"#ctrl-subactions-newfolder",field:"#field-subactions-newfolder",template:"#tmpl-subactions-newfolder"},html:{errors:{invalid:"Error!"},invalid:[/^\..*/,/.*~/,/\s/]},namespace:".newfolder"},active:!0,el:{root:null,toggle:null,container:null,form:null,controls:null},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),this.el.toggle=this.el.root.find(this.options.css.toggle),this.el.container=this.el.root.find(this.options.css.container),this.el.form=this.el.root.find(this.options.css.form),this.el.controls=this.el.form.find(this.options.css.control),this.el.field=this.el.form.find(this.options.css.field),n.views){if(!this.el.form)return this.message('"New Folder" Functionality Error'),this.debug("initialise","New Folder Form Element Not Found"),!1}else return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.assets();this.register();this.addFormEvents();this.requests()},assets:function(){n(document).trigger("newfolder:before:assets");var t=this;n.views.tags({folder:{render:function(){return this.tagCtx.render({stack:this.ctx.root.stack,path:this.ctx.root.path})},linked:!1,onAfterLink:function(){this.linked||(n.observe(n(document).triggerHandler("observer:request:active",{type:"stack"}),"*",n.proxy(function(t){this.ctx.root.path=n(document).triggerHandler("observer:request:active",{type:"path",stack:t.target.value});this.refresh()},this)),this.linked=!0)}}},n.templates(this.options.css.template));n(document).trigger("newfolder:after:assets")},register:function(){var t,i,r;n(document).trigger("newfolder:before:register");t=n.templates(this.options.css.template);t?(i=n(document).triggerHandler("observer:request:active",{type:"stack"}),r=n(document).triggerHandler("observer:request:active",{type:"path",stack:i.value}),n(this.el.container).link(t,{stack:i,path:r})):this.debug("register","Could Not Find Template");n(document).trigger("newfolder:after:register")},addFormEvents:function(){n(document).trigger("newfolder:before:event",[this.el.form]);n(this.el.field).on("keyup"+this.options.namespace,n.proxy(function(n){n.keyCode==13&&this.submit()},this));n(this.el.controls).on("click"+this.options.namespace,n.proxy(function(){this.submit()},this));n(document).trigger("newfolder:after:event",[this.el.form])},submit:function(){if(n(document).trigger("newfolder:before:submit",[this.el.form]),!this.active)return this.message(this.options.html.errors.permission,"error"),this.debug("submit","The New Folder Logic is Currently Disabled."),!1;var t=!1,i=this.el.field.val();n.each(this.options.html.invalid,n.proxy(function(n,r){r.test(i)&&(this.debug("submit","The Following Regex Failed for New Folder Name: "+r),t=!0)},this));t?this.message(this.options.html.errors.invalid,"error",{wink:"slower"}):this.el.form.get(0).submit();n(document).trigger("newfolder:after:submit",[this.el.form])},requests:function(){n(document).on("newfolder:request:state",n.proxy(function(n,t){t.type==="on"?(this.active=!0,this.el.toggle.removeAttr("disabled"),this.el.field.removeProp("disabled"),this.el.controls.removeAttr("disabled")):(this.active=!1,this.el.toggle.attr("disabled","disabled"),this.el.field.prop("disabled","disabled"),this.el.controls.attr("disabled","disabled"))},this))}});n.fn.newfolder=function(n){return new t(n)}})(window.jQuery);
(function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery","load-image","load-image-meta","load-image-exif","load-image-ios","canvas-to-blob","./jquery.fileupload-process"],n):n(window.jQuery,window.loadImage)})(function(n,t){"use strict";n.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadImageMetaData",disableImageHead:"@",disableExif:"@",disableExifThumbnail:"@",disableExifSub:"@",disableExifGps:"@",disabled:"@disableImageMetaDataLoad"},{action:"loadImage",prefix:!0,fileTypes:"@",maxFileSize:"@",noRevoke:"@",disabled:"@disableImageLoad"},{action:"resizeImage",prefix:"image",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",forceResize:"@",disabled:"@disableImageResize"},{action:"saveImage",quality:"@imageQuality",type:"@imageType",disabled:"@disableImageResize"},{action:"saveImageMetaData",disabled:"@disableImageMetaDataSave"},{action:"resizeImage",prefix:"preview",maxWidth:"@",maxHeight:"@",minWidth:"@",minHeight:"@",crop:"@",orientation:"@",thumbnail:"@",canvas:"@",disabled:"@disableImagePreview"},{action:"setImage",name:"@imagePreviewName",disabled:"@disableImagePreview"},{action:"deleteImageReferences",disabled:"@disableImageReferencesDeletion"});n.widget("blueimp.fileupload",n.blueimp.fileupload,{options:{loadImageFileTypes:/^image\/(gif|jpeg|png|svg\+xml)$/,loadImageMaxFileSize:1e7,imageMaxWidth:1920,imageMaxHeight:1080,imageOrientation:!1,imageCrop:!1,disableImageResize:!0,previewMaxWidth:80,previewMaxHeight:80,previewOrientation:!0,previewThumbnail:!0,previewCrop:!1,previewCanvas:!0},processActions:{loadImage:function(i,r){if(r.disabled)return i;var e=this,u=i.files[i.index],f=n.Deferred();return n.type(r.maxFileSize)==="number"&&u.size>r.maxFileSize||r.fileTypes&&!r.fileTypes.test(u.type)||!t(u,function(n){n.src&&(i.img=n);f.resolveWith(e,[i])},r)?i:f.promise()},resizeImage:function(i,r){if(r.disabled||!(i.canvas||i.img))return i;r=n.extend({canvas:!0},r);var s=this,f=n.Deferred(),u=r.canvas&&i.canvas||i.img,o=function(n){n&&(n.width!==u.width||n.height!==u.height||r.forceResize)&&(i[n.getContext?"canvas":"img"]=n);i.preview=n;f.resolveWith(s,[i])},e;if(i.exif){if(r.orientation===!0&&(r.orientation=i.exif.get("Orientation")),r.thumbnail&&(e=i.exif.get("Thumbnail"),e))return t(e,o,r),f.promise();i.orientation?delete r.orientation:i.orientation=r.orientation}return u?(o(t.scale(u,r)),f.promise()):i},saveImage:function(t,i){if(!t.canvas||i.disabled)return t;var f=this,r=t.files[t.index],u=n.Deferred();if(t.canvas.toBlob)t.canvas.toBlob(function(n){n.name||(r.type===n.type?n.name=r.name:r.name&&(n.name=r.name.replace(/\..+$/,"."+n.type.substr(6))));r.type!==n.type&&delete t.imageHead;t.files[t.index]=n;u.resolveWith(f,[t])},i.type||r.type,i.quality);else return t;return u.promise()},loadImageMetaData:function(i,r){if(r.disabled)return i;var f=this,u=n.Deferred();return t.parseMetaData(i.files[i.index],function(t){n.extend(i,t);u.resolveWith(f,[i])},r),u.promise()},saveImageMetaData:function(n,t){if(!(n.imageHead&&n.canvas&&n.canvas.toBlob&&!t.disabled))return n;var i=n.files[n.index],r=new Blob([n.imageHead,this._blobSlice.call(i,20)],{type:i.type});return r.name=i.name,n.files[n.index]=r,n},setImage:function(n,t){return n.preview&&!t.disabled&&(n.files[n.index][t.name||"preview"]=n.preview),n},deleteImageReferences:function(n,t){return t.disabled||(delete n.img,delete n.canvas,delete n.preview,delete n.imageHead),n}}})});
(function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery","load-image","./jquery.fileupload-process"],n):n(window.jQuery,window.loadImage)})(function(n,t){"use strict";n.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadVideo",prefix:!0,fileTypes:"@",maxFileSize:"@",disabled:"@disableVideoPreview"},{action:"setVideo",name:"@videoPreviewName",disabled:"@disableVideoPreview"});n.widget("blueimp.fileupload",n.blueimp.fileupload,{options:{loadVideoFileTypes:/^video\/.*$/},_videoElement:document.createElement("video"),processActions:{loadVideo:function(i,r){if(r.disabled)return i;var u=i.files[i.index],e,f;return this._videoElement.canPlayType&&this._videoElement.canPlayType(u.type)&&(n.type(r.maxFileSize)!=="number"||u.size<=r.maxFileSize)&&(!r.fileTypes||r.fileTypes.test(u.type))&&(e=t.createObjectURL(u),e)?(f=this._videoElement.cloneNode(!1),f.src=e,f.controls=!0,i.video=f,i):i},setVideo:function(n,t){return n.video&&!t.disabled&&(n.files[n.index][t.name||"preview"]=n.video),n}}})});
(function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery","load-image","./jquery.fileupload-process"],n):n(window.jQuery,window.loadImage)})(function(n,t){"use strict";n.blueimp.fileupload.prototype.options.processQueue.unshift({action:"loadAudio",prefix:!0,fileTypes:"@",maxFileSize:"@",disabled:"@disableAudioPreview"},{action:"setAudio",name:"@audioPreviewName",disabled:"@disableAudioPreview"});n.widget("blueimp.fileupload",n.blueimp.fileupload,{options:{loadAudioFileTypes:/^audio\/.*$/},_audioElement:document.createElement("audio"),processActions:{loadAudio:function(i,r){if(r.disabled)return i;var u=i.files[i.index],e,f;return this._audioElement.canPlayType&&this._audioElement.canPlayType(u.type)&&(n.type(r.maxFileSize)!=="number"||u.size<=r.maxFileSize)&&(!r.fileTypes||r.fileTypes.test(u.type))&&(e=t.createObjectURL(u),e)?(f=this._audioElement.cloneNode(!1),f.src=e,f.controls=!0,i.audio=f,i):i},setAudio:function(n,t){return n.audio&&!t.disabled&&(n.files[n.index][t.name||"preview"]=n.audio),n}}})});