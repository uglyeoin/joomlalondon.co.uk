(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{control:"[data-stack-control]",values:{stack:'[data-stack-control="stack"]',refresh:'[data-stack-control="refresh"]'}},data:{control:"data-stack-control",value:"data-stack-value",values:{stack:"stack",refresh:"refresh",path:"path",explorer:"explorer",breadcrumb:"breadcrumb"}},html:{},namespace:".stack",active:null,animate:100},el:{root:null,stacks:{all:{}},controls:{all:{}}},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),!n.views)return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.register();this.links();this.requests();this.controls();this.addControlEvents();this.setDefault()},register:function(){n(document).trigger("stack:before:register");this.el.stacks.all=this.el.root.find(this.options.css.stack);this.el.stacks.all.each(n.proxy(function(t,i){var r=n(i).attr(this.options.data.stack);r&&(this.el.stacks.hasOwnProperty(r)||(this.el.stacks[r]=[]),this.el.stacks[r].push(i))},this));n(document).trigger("stack:after:register",[this.el.stacks])},links:function(){var t=n(document).triggerHandler("observer:request:active",{type:"stack"}),i=n(document).triggerHandler("observer:request:active",{type:"edit"});n.observe(t,"*",n.proxy(function(n){this.switchStack(n.target.value)},this))},requests:function(){n(document).on("stack:request:toggle",n.proxy(function(t,i){i.type=i.type||"disable";i.stack=n.isArray(i.stack)?i.stack:[i.stack];i.stack.length&&this.toggleStack(i.type,i.stack)},this));n(document).on("stack:request:solo",n.proxy(function(){this.toggleStack("disable")},this));n(document).on("stack:request:unsolo",n.proxy(function(){this.toggleStack("enable")},this))},controls:function(){n(document).trigger("stack:before:controls");this.el.controls.all=this.el.root.find(this.options.css.control);n.each(this.options.data.values,n.proxy(function(n,t){this.el.controls[t]=[]},this));this.el.controls.all.each(n.proxy(function(t,i){var r=n(i).attr(this.options.data.control);r&&(this.el.controls.hasOwnProperty(r)?this.el.controls[r].push(i):this.debug("controls","Stack Control Does Not Exist"))},this));n(document).trigger("stack:after:controls",[this.el.controls])},addControlEvents:function(){n(document).trigger("stack:before:event",[this.options.data.values.stack]);this.el.root.on("click"+this.options.namespace,this.options.css.values.stack,{options:this.options},function(t){var i=n(this).attr(t.data.options.data.value),r=n(document).triggerHandler("observer:request:active",{type:"stack"});r.value!=i&&n(document).triggerHandler("observer:request:active",{type:"stack",value:i})});n(document).trigger("stack:after:event",[this.options.data.values.stack,this.el.controls])},switchStack:function(t){n(document).trigger("stack:before:switch",[t]);this.el.stacks.hasOwnProperty(t)?(n.each(this.el.stacks,n.proxy(function(i){i===t?i!=="all"&&n.each(this.el.stacks[i],n.proxy(function(t,i){n(i).show(this.options.animate?this.options.animate:null)},this)):n.each(this.el.stacks[i],function(t,i){n(i).hide()})},this)),this.el.controls.hasOwnProperty(this.options.data.values.stack)&&n.each(this.el.controls[this.options.data.values.stack],n.proxy(function(i,r){n(r).attr(this.options.data.value)===t&&(n(r).trigger("click"),typeof n(r).button=="function"&&n(r).button("toggle"))},this))):this.debug("switchStack","Stack Not Found");n(document).trigger("stack:after:switch",[t])},toggleStack:function(t,i){n(document).trigger("stack:before:toggle",[stack,this.el.controls]);var r=n.type(i)!=="array"?!0:!1;this.el.controls.hasOwnProperty(this.options.data.values.stack)&&n.each(this.el.controls[this.options.data.values.stack],n.proxy(function(u,f){(r||n.inArray(n(f).attr(this.options.data.value),i)!==-1)&&(t=="disable"?n(f).attr("disabled","disabled"):n(f).removeAttr("disabled"))},this));n(document).trigger("stack:after:toggle",[stack,this.el.controls])},setDefault:function(){n(document).trigger("stack:before:default",[this.options.active]);this.options.active&&n(document).triggerHandler("observer:request:active",{type:"stack",value:this.options.active});n(document).trigger("stack:after:default",[this.options.active])}});n.fn.stack=function(n){return new t(n)}})(window.jQuery)