(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{breadcrumb:"#ark-breadcrumb",path:"[data-stack-control]",template:"#tmpl-breadcrumb"},data:{path:"data-path"},html:{},namespace:".breadcrumb",fullpath:!0},el:{root:null,breadcrumb:null,stacks:null},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),this.el.breadcrumb=this.el.root.find(this.options.css.breadcrumb),this.el.stacks=this.el.breadcrumb.find(this.options.css.stack),n.views){if(!this.el.stacks.length)return this.debug("initialise","No Breadcrumb Stacks"),!1}else return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.assets();this.register()},assets:function(){n(document).trigger("arkbreadcrumb:before:assets");var t=this;n.views.helpers({canBreadcrumb:function(){if(this.data.name){var n=this.data.key,i=this.ctx.root.base.length,r=this.data.name,u=this.ctx.root.base[n];return!(!t.options.fullpath&&r==u&&n+1!==i)}return!1},isDisabledBreadcrumb:function(n){if(n)return!0;var i=this.data.count,t=this.data.key,r=this.ctx.root.base.length,u=this.data.name,f=this.ctx.root.base[t];return u==f?t+1!==r:t+1==i}});n.views.tags({breadcrumb:{render:function(){var i=this.ctx.root.active.path.split(t.options.html.ds),r=[],u=[];return n.each(i,n.proxy(function(n,f){r.push(i[n]);u.push(this.tagCtx.render({key:n,name:f,path:r.join(t.options.html.ds),count:i.length}))},this)),u.join("\n")},linked:!1,onAfterLink:function(){this.linked||(n.observe(this.ctx.root.active,"path",n.proxy(function(){this.refresh()},this)),this.linked=!0)}}});n(document).trigger("arkbreadcrumb:after:assets")},register:function(){n(document).trigger("arkbreadcrumb:before:register");var i=n(document).triggerHandler("observer:request:all"),t=n.templates(this.options.css.template);t?this.el.stacks.each(n.proxy(function(r,u){var f=n(u).attr(this.options.data.stack),e=i[f].path.split(this.options.html.ds),o=n(document).triggerHandler("observer:request:active",{type:"path",stack:f}),s=n(document).triggerHandler("observer:request:active",{type:"edit"});n(u).link(t,{stack:f,base:e,active:o,file:s});n(u).on("click"+this.options.namespace,this.options.css.path,{stack:f,path:this.options.data.path},function(t){n(document).triggerHandler("observer:request:active",{type:"path",stack:t.data.stack,value:n(this).attr(t.data.path)})})},this)):this.debug("register","Could Not Find Template");n(document).trigger("arkbreadcrumb:after:register")}});n.fn.breadcrumb=function(n){return new t(n)}})(window.jQuery)