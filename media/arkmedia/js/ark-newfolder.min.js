(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{toggle:"#toggle-actions-newfolder",container:"#html-subactions-newfolder",form:"#form-subactions-newfolder",control:"#ctrl-subactions-newfolder",field:"#field-subactions-newfolder",template:"#tmpl-subactions-newfolder"},html:{errors:{invalid:"Error!"},invalid:[/^\..*/,/.*~/,/\s/]},namespace:".newfolder"},active:!0,el:{root:null,toggle:null,container:null,form:null,controls:null},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),this.el.toggle=this.el.root.find(this.options.css.toggle),this.el.container=this.el.root.find(this.options.css.container),this.el.form=this.el.root.find(this.options.css.form),this.el.controls=this.el.form.find(this.options.css.control),this.el.field=this.el.form.find(this.options.css.field),n.views){if(!this.el.form)return this.message('"New Folder" Functionality Error'),this.debug("initialise","New Folder Form Element Not Found"),!1}else return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;this.assets();this.register();this.addFormEvents();this.requests()},assets:function(){n(document).trigger("newfolder:before:assets");var t=this;n.views.tags({folder:{render:function(){return this.tagCtx.render({stack:this.ctx.root.stack,path:this.ctx.root.path})},linked:!1,onAfterLink:function(){this.linked||(n.observe(n(document).triggerHandler("observer:request:active",{type:"stack"}),"*",n.proxy(function(t){this.ctx.root.path=n(document).triggerHandler("observer:request:active",{type:"path",stack:t.target.value});this.refresh()},this)),this.linked=!0)}}},n.templates(this.options.css.template));n(document).trigger("newfolder:after:assets")},register:function(){var t,i,r;n(document).trigger("newfolder:before:register");t=n.templates(this.options.css.template);t?(i=n(document).triggerHandler("observer:request:active",{type:"stack"}),r=n(document).triggerHandler("observer:request:active",{type:"path",stack:i.value}),n(this.el.container).link(t,{stack:i,path:r})):this.debug("register","Could Not Find Template");n(document).trigger("newfolder:after:register")},addFormEvents:function(){n(document).trigger("newfolder:before:event",[this.el.form]);n(this.el.field).on("keyup"+this.options.namespace,n.proxy(function(n){n.keyCode==13&&this.submit()},this));n(this.el.controls).on("click"+this.options.namespace,n.proxy(function(){this.submit()},this));n(document).trigger("newfolder:after:event",[this.el.form])},submit:function(){if(n(document).trigger("newfolder:before:submit",[this.el.form]),!this.active)return this.message(this.options.html.errors.permission,"error"),this.debug("submit","The New Folder Logic is Currently Disabled."),!1;var t=!1,i=this.el.field.val();n.each(this.options.html.invalid,n.proxy(function(n,r){r.test(i)&&(this.debug("submit","The Following Regex Failed for New Folder Name: "+r),t=!0)},this));t?this.message(this.options.html.errors.invalid,"error",{wink:"slower"}):this.el.form.get(0).submit();n(document).trigger("newfolder:after:submit",[this.el.form])},requests:function(){n(document).on("newfolder:request:state",n.proxy(function(n,t){t.type==="on"?(this.active=!0,this.el.toggle.removeAttr("disabled"),this.el.field.removeProp("disabled"),this.el.controls.removeAttr("disabled")):(this.active=!1,this.el.toggle.attr("disabled","disabled"),this.el.field.prop("disabled","disabled"),this.el.controls.attr("disabled","disabled"))},this))}});n.fn.newfolder=function(n){return new t(n)}})(window.jQuery)