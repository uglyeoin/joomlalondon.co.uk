(function(n){var t=function(n){this.initialise(n)};t.prototype=n.extend({},n.fn.arkbase(),{constructor:t,options:{css:{control:"#ctrl-subactions-insertfile",loading:"#load-subactions-insertfile"},data:{file:{value:"file",data:"data-file"}},html:{errors:{select:"Error!"}},render:!0,namespace:".insertfile"},el:{root:null,controls:null},initialise:function(t){if(this.set(t),this.el.root=n(this.options.css.root),this.el.controls=this.el.root.find(this.options.css.control),this.el.loading=this.el.root.find(this.options.css.loading),!n.views)return this.message("Dependent Classes Not Found"),this.debug("initialise","Dependent Classes Not Found"),!1;if(!this.options.render)return this.disable(),this.debug("initialise",'The "Insert File" Class Was Instructed Not to Render.',"info"),!1;this.addFormEvents()},disable:function(){n(document).trigger("insertfile:before:disable",[this.el.controls]);this.el.controls.addClass(this.options.css.hide.value);n(document).trigger("insertfile:after:disable",[this.el.controls])},addFormEvents:function(){n(document).trigger("insertfile:before:event",[this.el.form]);this.el.controls.on("click"+this.options.namespace,n.proxy(function(){this.submit()},this));n(document).on("edit:request:file",n.proxy(function(n,t){if(this.el.loading.length){var r=this.el.loading.data(this.options.data.file.value),i=t.file?t.file:"";this.el.loading.html(this.el.loading.html().replace(r,i));this.el.loading.data(this.options.data.file.value,i);this.toggle("loading")}else this.debug("submit","A Loading Button Could Not be Found.");return!0},this));n(document).on("edit:request:close edit:request:save edit:request:browse edit:request:insert",n.proxy(function(){return this.toggle("normal")},this));n(document).trigger("insertfile:after:event",[this.el.form])},submit:function(){n(document).trigger("insertfile:before:submit",[this.el.form]);var t=n(document).triggerHandler("observer:request:active",{type:"stack"}),i=n(document).triggerHandler("observer:request:active",{type:"path",stack:t.value}),r=n(document).triggerHandler("observer:request:active",{type:"files",stack:t.value});t.value&&i.path?r.length?n(document).triggerHandler("edit:request:file",{file:r[0],stack:t.value,path:i.path}):(this.message(this.options.html.errors.select,"warning"),this.debug("submit","No Count of Files Observers")):(this.message(this.options.html.errors.path),this.debug("submit","The Observer Active Stack Path Could Not be Found"));n(document).trigger("insertfile:after:submit",[this.el.form])},toggle:function(t){n(document).trigger("insertfile:before:toggle",[t]);switch(t){case"loading":this.el.loading.removeClass(this.options.css.hide.value);this.el.controls.addClass(this.options.css.hide.value);break;case"normal":this.el.loading.addClass(this.options.css.hide.value);this.el.controls.removeClass(this.options.css.hide.value)}return n(document).trigger("insertfile:after:toggle",[t]),!0}});n.fn.insertfile=function(n){return new t(n)}})(window.jQuery)