(function(n){var t={},i=function(n){this.initialise(n)};i.prototype=n.extend({},n.fn.arkbase(),{constructor:i,options:{css:{control:'[data-toggle="ark-collapse"]',group:"[data-group]"},data:{target:"data-target",group:"data-group",active:"data-active"},html:{},namespace:".arkcollapse",permission:null,group:null,animate:100},active:!0,value:null,el:{root:null,controls:{}},initialise:function(t){this.set(t);this.el.root=n(this.options.css.root);this.controls();this.addControlEvents();this.requests();this.setDefault()},controls:function(){n(document).trigger("arkcollapse:before:controls");this.el.controls=this.el.root.find(this.options.css.control);this.el.controls.each(n.proxy(function(t,i){n(i).attr(this.options.data.group)!=this.options.group&&delete this.el.controls[t]},this));n(document).trigger("arkcollapse:after:controls",[this.el.controls])},addControlEvents:function(){n(document).trigger("arkcollapse:before:add",[this.el.controls]);var t=this;this.el.controls.on("click"+this.options.namespace,function(i){var r;if(i.preventDefault(),i.stopPropagation(),!t.active)return t.message(t.options.html.errors.permission,"error"),t.debug("addControlEvents","This Collapser is Currently Disabled."),!1;if(r=n(this).attr(t.options.data.value.data),r===t.value)return!1;t.value=r;var u=n(this).attr(t.options.data.target),e=n(this).attr(t.options.data.group),f=t.el.root.find(u),o=t.el.root.find(t.options.css.group);f.length&&f.show(t.options.animate?t.options.animate:null);o.each(function(i,r){var o=n(r).attr(t.options.data.target),f;n(r).attr(t.options.data.group)==e&&o!=u&&(f=t.el.root.find(o),f.length&&f.hide())})});n(document).trigger("arkcollapse:after:add",[this.el.controls])},setDefault:function(){n(document).trigger("arkcollapse:before:default",[this.el.controls]);this.el.controls.each(n.proxy(function(t,i){n(i).attr(this.options.data.active)&&(n(document).triggerHandler("arkcollapse:request:toggle",{value:n(i).attr(this.options.data.value.data),group:this.options.group}),n(i).removeAttr(this.options.data.active),n(i).addClass(this.options.css.bootstrap.active.value))},this));this.options.permission&&!this.permission(this.options.permission)&&this.el.controls.remove();n(document).trigger("arkcollapse:after:default",[this.el.controls])},requests:function(){n(document).on("arkcollapse:request:state",n.proxy(function(n,t){t.group===this.options.group&&(t.type==="on"?(this.active=!0,this.el.controls.removeAttr("disabled")):(this.active=!1,this.el.controls.attr("disabled","disabled")))},this));n(document).on("arkcollapse:request:toggle",n.proxy(function(t,i){i.group===this.options.group&&this.active&&this.el.controls.each(n.proxy(function(t,r){n(r).attr(this.options.data.value.data)===i.value&&(n(r).trigger("click"),typeof n(r).button=="function"&&n(r).button("toggle"))},this))},this));n(document).on("arkcollapse:request:value",n.proxy(function(n,t){if(t.group===this.options.group)return this.value},this))}});n.fn.arkcollapse=function(n){return t.hasOwnProperty(n.group)||(t[n.group]=new i(n)),t[n.group]}})(window.jQuery)